(self["webpackChunk_jupyterlab_application_top"]=self["webpackChunk_jupyterlab_application_top"]||[]).push([[7373],{6493:(t,e,s)=>{"use strict";s.d(e,{GL:()=>u,Ag:()=>g,xq:()=>y,oy:()=>m});var n=s(3260);var a=s(94072);var o=s(40870);var i=s(21332);var r=s(75736);var c=s(1872);var l=s(11038);var d=s.n(l);const h=3e4;class u extends r.y{constructor(t){super();this.doc=t;this.clientID=t.clientID;this.states=new Map;this.meta=new Map;this._checkInterval=setInterval((()=>{const t=o.ZG();if(this.getLocalState()!==null&&h/2<=t-this.meta.get(this.clientID).lastUpdated){this.setLocalState(this.getLocalState())}const e=[];this.meta.forEach(((s,n)=>{if(n!==this.clientID&&h<=t-s.lastUpdated&&this.states.has(n)){e.push(n)}}));if(e.length>0){g(this,e,"timeout")}}),i.GW(h/10));t.on("destroy",(()=>{this.destroy()}));this.setLocalState({})}destroy(){this.emit("destroy",[this]);this.setLocalState(null);super.destroy();clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(t){const e=this.clientID;const s=this.meta.get(e);const n=s===undefined?0:s.clock+1;const a=this.states.get(e);if(t===null){this.states.delete(e)}else{this.states.set(e,t)}this.meta.set(e,{clock:n,lastUpdated:o.ZG()});const i=[];const r=[];const l=[];const d=[];if(t===null){d.push(e)}else if(a==null){if(t!=null){i.push(e)}}else{r.push(e);if(!c.Hi(a,t)){l.push(e)}}if(i.length>0||l.length>0||d.length>0){this.emit("change",[{added:i,updated:l,removed:d},"local"])}this.emit("update",[{added:i,updated:r,removed:d},"local"])}setLocalStateField(t,e){const s=this.getLocalState();if(s!==null){this.setLocalState({...s,[t]:e})}}getStates(){return this.states}}const g=(t,e,s)=>{const n=[];for(let a=0;a<e.length;a++){const s=e[a];if(t.states.has(s)){t.states.delete(s);if(s===t.clientID){const e=t.meta.get(s);t.meta.set(s,{clock:e.clock+1,lastUpdated:o.ZG()})}n.push(s)}}if(n.length>0){t.emit("change",[{added:[],updated:[],removed:n},s]);t.emit("update",[{added:[],updated:[],removed:n},s])}};const y=(t,e,s=t.states)=>{const a=e.length;const o=n.Mf();n.uE(o,a);for(let i=0;i<a;i++){const a=e[i];const r=s.get(a)||null;const c=t.meta.get(a).clock;n.uE(o,a);n.uE(o,c);n.uw(o,JSON.stringify(r))}return n._f(o)};const p=(t,e)=>{const s=decoding.createDecoder(t);const n=encoding.createEncoder();const a=decoding.readVarUint(s);encoding.writeVarUint(n,a);for(let o=0;o<a;o++){const t=decoding.readVarUint(s);const a=decoding.readVarUint(s);const o=JSON.parse(decoding.readVarString(s));const i=e(o);encoding.writeVarUint(n,t);encoding.writeVarUint(n,a);encoding.writeVarString(n,JSON.stringify(i))}return encoding.toUint8Array(n)};const m=(t,e,s)=>{const n=a.l1(e);const i=o.ZG();const r=[];const l=[];const d=[];const h=[];const u=a.yg(n);for(let o=0;o<u;o++){const e=a.yg(n);let s=a.yg(n);const o=JSON.parse(a.kf(n));const u=t.meta.get(e);const g=t.states.get(e);const y=u===undefined?0:u.clock;if(y<s||y===s&&o===null&&t.states.has(e)){if(o===null){if(e===t.clientID&&t.getLocalState()!=null){s++}else{t.states.delete(e)}}else{t.states.set(e,o)}t.meta.set(e,{clock:s,lastUpdated:i});if(u===undefined&&o!==null){r.push(e)}else if(u!==undefined&&o===null){h.push(e)}else if(o!==null){if(!c.Hi(o,g)){d.push(e)}l.push(e)}}}if(r.length>0||d.length>0||h.length>0){t.emit("change",[{added:r,updated:d,removed:h},s])}if(r.length>0||l.length>0||h.length>0){t.emit("update",[{added:r,updated:l,removed:h},s])}}},47373:(t,e,s)=>{"use strict";s.r(e);s.d(e,{YBaseCell:()=>g,YCodeCell:()=>y,YDocument:()=>c,YFile:()=>l,YMarkdownCell:()=>m,YNotebook:()=>d,YRawCell:()=>p,convertYMapEventToMapChange:()=>f,createCellFromType:()=>h,createMutex:()=>M,createStandaloneCell:()=>u});var n=s(98034);var a=s(8595);var o=s(6493);var i=s(11038);const r=t=>JSON.parse(JSON.stringify(t));class c{constructor(){this.isDisposed=false;this.ydoc=new i.Doc;this.source=this.ydoc.getText("source");this.ystate=this.ydoc.getMap("state");this.undoManager=new i.UndoManager([this.source],{trackedOrigins:new Set([this])});this.awareness=new o.GL(this.ydoc);this._changed=new a.Signal(this)}get dirty(){return this.ystate.get("dirty")}set dirty(t){this.transact((()=>{this.ystate.set("dirty",t)}),false)}transact(t,e=true){this.ydoc.transact(t,e?this:null)}dispose(){this.isDisposed=true;this.ydoc.destroy()}canUndo(){return this.undoManager.undoStack.length>0}canRedo(){return this.undoManager.redoStack.length>0}undo(){this.undoManager.undo()}redo(){this.undoManager.redo()}clearUndoHistory(){this.undoManager.clear()}get changed(){return this._changed}}class l extends c{constructor(){super();this._modelObserver=t=>{const e={};e.sourceChange=t.changes.delta;this._changed.emit(e)};this._onStateChanged=t=>{const e=[];t.keysChanged.forEach((s=>{const n=t.changes.keys.get(s);if(n){e.push({name:s,oldValue:n.oldValue,newValue:this.ystate.get(s)})}}));this._changed.emit({stateChange:e})};this.ysource=this.ydoc.getText("source");this.ysource.observe(this._modelObserver);this.ystate.observe(this._onStateChanged)}dispose(){this.ysource.unobserve(this._modelObserver);this.ystate.unobserve(this._onStateChanged)}static create(){return new l}getSource(){return this.ysource.toString()}setSource(t){this.transact((()=>{const e=this.ysource;e.delete(0,e.length);e.insert(0,t)}))}updateSource(t,e,s=""){this.transact((()=>{const n=this.ysource;n.insert(t,s);n.delete(t+s.length,e-t)}))}}class d extends c{constructor(t){super();this._onYCellsChanged=t=>{t.changes.added.forEach((t=>{const e=t.content.type;if(!this._ycellMapping.has(e)){this._ycellMapping.set(e,h(e))}const s=this._ycellMapping.get(e);s._notebook=this;if(!this.disableDocumentWideUndoRedo){s._undoManager=this.undoManager}else{s._undoManager=new i.UndoManager([s.ymodel],{})}}));t.changes.deleted.forEach((t=>{const e=t.content.type;const s=this._ycellMapping.get(e);if(s){s.dispose();this._ycellMapping.delete(e)}}));let e=0;const s=[];t.changes.delta.forEach((t=>{if(t.insert!=null){const n=t.insert.map((t=>this._ycellMapping.get(t)));s.push({insert:n});this.cells.splice(e,0,...n);e+=t.insert.length}else if(t.delete!=null){s.push(t);this.cells.splice(e,t.delete)}else if(t.retain!=null){s.push(t);e+=t.retain}}));this._changed.emit({cellsChange:s})};this._onMetadataChanged=t=>{if(t.keysChanged.has("metadata")){const e=t.changes.keys.get("metadata");const s={oldValue:(e===null||e===void 0?void 0:e.oldValue)?e.oldValue:undefined,newValue:this.getMetadata()};this._changed.emit({metadataChange:s})}};this._onStateChanged=t=>{const e=[];t.keysChanged.forEach((s=>{const n=t.changes.keys.get(s);if(n){e.push({name:s,oldValue:n.oldValue,newValue:this.ystate.get(s)})}}));this._changed.emit({stateChange:e})};this.ycells=this.ydoc.getArray("cells");this.ymeta=this.ydoc.getMap("meta");this.ymodel=this.ydoc.getMap("model");this.undoManager=new i.UndoManager([this.ycells],{trackedOrigins:new Set([this])});this._ycellMapping=new Map;this._disableDocumentWideUndoRedo=t.disableDocumentWideUndoRedo;this.ycells.observe(this._onYCellsChanged);this.cells=this.ycells.toArray().map((t=>{if(!this._ycellMapping.has(t)){this._ycellMapping.set(t,h(t))}return this._ycellMapping.get(t)}));this.ymeta.observe(this._onMetadataChanged);this.ystate.observe(this._onStateChanged)}get nbformat(){return this.ystate.get("nbformat")}set nbformat(t){this.transact((()=>{this.ystate.set("nbformat",t)}),false)}get nbformat_minor(){return this.ystate.get("nbformatMinor")}set nbformat_minor(t){this.transact((()=>{this.ystate.set("nbformatMinor",t)}),false)}dispose(){this.ycells.unobserve(this._onYCellsChanged);this.ymeta.unobserve(this._onMetadataChanged);this.ystate.unobserve(this._onStateChanged)}getCell(t){return this.cells[t]}insertCell(t,e){this.insertCells(t,[e])}insertCells(t,e){e.forEach((t=>{this._ycellMapping.set(t.ymodel,t);if(!this.disableDocumentWideUndoRedo){t.undoManager=this.undoManager}}));this.transact((()=>{this.ycells.insert(t,e.map((t=>t.ymodel)))}))}moveCell(t,e){this.transact((()=>{const s=this.getCell(t).clone();this.deleteCell(t);this.insertCell(e,s)}))}deleteCell(t){this.deleteCellRange(t,t+1)}deleteCellRange(t,e){this.transact((()=>{this.ycells.delete(t,e-t)}))}getMetadata(){const t=this.ymeta.get("metadata");return t?r(t):{}}setMetadata(t){this.ymeta.set("metadata",r(t))}updateMetadata(t){this.ymeta.set("metadata",Object.assign({},this.getMetadata(),t))}static create(t){return new d({disableDocumentWideUndoRedo:t})}get disableDocumentWideUndoRedo(){return this._disableDocumentWideUndoRedo}}const h=t=>{switch(t.get("cell_type")){case"code":return new y(t);case"markdown":return new m(t);case"raw":return new p(t);default:throw new Error("Found unknown cell type")}};const u=(t,e)=>{switch(t){case"markdown":return m.createStandalone(e);case"code":return y.createStandalone(e);default:return p.createStandalone(e)}};class g{constructor(t){this._notebook=null;this.isStandalone=false;this._modelObserver=t=>{const e={};const s=t.find((t=>t.target===this.ymodel.get("source")));if(s){e.sourceChange=s.changes.delta}const n=t.find((t=>t.target===this.ymodel.get("outputs")));if(n){e.outputsChange=n.changes.delta}const a=t.find((t=>t.target===this.ymodel));if(a&&a.keysChanged.has("metadata")){const t=a.changes.keys.get("metadata");e.metadataChange={oldValue:(t===null||t===void 0?void 0:t.oldValue)?t.oldValue:undefined,newValue:this.getMetadata()}}if(a&&a.keysChanged.has("execution_count")){const t=a.changes.keys.get("execution_count");e.executionCountChange={oldValue:t.oldValue,newValue:this.ymodel.get("execution_count")}}const o=this.ymodel.get("source");if(a&&a.keysChanged.has("source")){e.sourceChange=[{delete:this._prevSourceLength},{insert:o.toString()}]}this._prevSourceLength=o.length;this._changed.emit(e)};this.isDisposed=false;this._undoManager=null;this._changed=new a.Signal(this);this.ymodel=t;const e=t.get("source");this._prevSourceLength=e?e.length:0;this.ymodel.observeDeep(this._modelObserver);this._awareness=null}get ysource(){return this.ymodel.get("source")}get awareness(){var t,e,s;return(s=(t=this._awareness)!==null&&t!==void 0?t:(e=this.notebook)===null||e===void 0?void 0:e.awareness)!==null&&s!==void 0?s:null}transact(t,e=true){this.notebook&&e?this.notebook.transact(t):this.ymodel.doc.transact(t,this)}get undoManager(){var t;if(!this.notebook){return this._undoManager}return((t=this.notebook)===null||t===void 0?void 0:t.disableDocumentWideUndoRedo)?this._undoManager:this.notebook.undoManager}set undoManager(t){this._undoManager=t}undo(){var t;(t=this.undoManager)===null||t===void 0?void 0:t.undo()}redo(){var t;(t=this.undoManager)===null||t===void 0?void 0:t.redo()}canUndo(){return!!this.undoManager&&this.undoManager.undoStack.length>0}canRedo(){return!!this.undoManager&&this.undoManager.redoStack.length>0}clearUndoHistory(){var t;(t=this.undoManager)===null||t===void 0?void 0:t.clear()}get notebook(){return this._notebook}static create(t=n.UUID.uuid4()){const e=new i.Map;const s=new i.Text;e.set("source",s);e.set("metadata",{});e.set("cell_type",this.prototype.cell_type);e.set("id",t);return new this(e)}static createStandalone(t){const e=this.create(t);e.isStandalone=true;const s=new i.Doc;s.getArray().insert(0,[e.ymodel]);e._awareness=new o.GL(s);e._undoManager=new i.UndoManager([e.ymodel],{trackedOrigins:new Set([e])});return e}clone(){const t=new i.Map;const e=new i.Text(this.getSource());t.set("source",e);t.set("metadata",this.getMetadata());t.set("cell_type",this.cell_type);t.set("id",this.getId());const s=this.constructor;const n=new s(t);n._undoManager=this.undoManager;return n}get changed(){return this._changed}dispose(){this.ymodel.unobserveDeep(this._modelObserver)}getAttachments(){return this.ymodel.get("attachments")}setAttachments(t){this.transact((()=>{if(t==null){this.ymodel.delete("attachments")}else{this.ymodel.set("attachments",t)}}))}getId(){return this.ymodel.get("id")}getSource(){return this.ymodel.get("source").toString()}setSource(t){const e=this.ymodel.get("source");this.transact((()=>{e.delete(0,e.length);e.insert(0,t)}))}updateSource(t,e,s=""){this.transact((()=>{const n=this.ysource;n.insert(t,s);n.delete(t+s.length,e-t)}))}get cell_type(){throw new Error("A YBaseCell must not be constructed")}getMetadata(){return r(this.ymodel.get("metadata"))}setMetadata(t){this.transact((()=>{this.ymodel.set("metadata",r(t))}))}toJSON(){return{id:this.getId(),cell_type:this.cell_type,source:this.getSource(),metadata:this.getMetadata()}}}class y extends g{get cell_type(){return"code"}get execution_count(){return this.ymodel.get("execution_count")}set execution_count(t){this.transact((()=>{this.ymodel.set("execution_count",t)}))}getOutputs(){return r(this.ymodel.get("outputs").toArray())}setOutputs(t){const e=this.ymodel.get("outputs");this.transact((()=>{e.delete(0,e.length);e.insert(0,t)}),false)}updateOutputs(t,e,s=[]){const n=this.ymodel.get("outputs");const a=e<n.length?e-t:n.length-t;this.transact((()=>{n.delete(t,a);n.insert(t,s)}),false)}static create(t){const e=super.create(t);e.ymodel.set("execution_count",0);e.ymodel.set("outputs",new i.Array);return e}static createStandalone(t){const e=super.createStandalone(t);e.ymodel.set("execution_count",null);e.ymodel.set("outputs",new i.Array);return e}clone(){const t=super.clone();const e=new i.Array;e.insert(0,this.getOutputs());t.ymodel.set("execution_count",this.execution_count);t.ymodel.set("outputs",e);return t}toJSON(){return{id:this.getId(),cell_type:"code",source:this.getSource(),metadata:this.getMetadata(),outputs:this.getOutputs(),execution_count:this.execution_count}}}class p extends g{static create(t){return super.create(t)}static createStandalone(t){return super.createStandalone(t)}get cell_type(){return"raw"}toJSON(){return{id:this.getId(),cell_type:"raw",source:this.getSource(),metadata:this.getMetadata(),attachments:this.getAttachments()}}}class m extends g{static create(t){return super.create(t)}static createStandalone(t){return super.createStandalone(t)}get cell_type(){return"markdown"}toJSON(){return{id:this.getId(),cell_type:"markdown",source:this.getSource(),metadata:this.getMetadata(),attachments:this.getAttachments()}}}const _=null&&d;function f(t){let e=new Map;t.changes.keys.forEach(((t,s)=>{e.set(s,{action:t.action,oldValue:t.oldValue,newValue:this.ymeta.get(s)})}));return e}const M=()=>{let t=true;return e=>{if(t){t=false;try{e()}finally{t=true}}}}}}]);
//# sourceMappingURL=7373.e808c7e16c797e0e84a7.js.map?v=e808c7e16c797e0e84a7