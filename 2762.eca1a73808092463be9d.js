"use strict";(self["webpackChunk_jupyterlab_application_top"]=self["webpackChunk_jupyterlab_application_top"]||[]).push([[2762],{52762:(e,t,n)=>{n.r(t);n.d(t,{CellList:()=>v,CellTypeSwitcher:()=>y,CommandEditStatus:()=>N,ExecutionIndicator:()=>x,ExecutionIndicatorComponent:()=>S,INotebookTools:()=>Le,INotebookTracker:()=>Oe,INotebookWidgetFactory:()=>De,KernelError:()=>g,Notebook:()=>be,NotebookActions:()=>f,NotebookAdapter:()=>D,NotebookModel:()=>A,NotebookModelFactory:()=>E,NotebookPanel:()=>Ie,NotebookSearchProvider:()=>Ee,NotebookToCFactory:()=>Pe,NotebookToCModel:()=>Ne,NotebookTools:()=>F,NotebookTracker:()=>Re,NotebookTrustStatus:()=>We,NotebookViewModel:()=>G,NotebookWidgetFactory:()=>qe,NotebookWindowedLayout:()=>Y,RunningStatus:()=>Te,StaticNotebook:()=>ye,ToolbarItems:()=>w,getIdForHeading:()=>He});var i=n(87447);var o=n(82713);var s=n(78098);var l=n(50724);var a=n(10535);var r=n(55172);var d=n(19289);var c=n(37900);var h=n.n(c);const u="application/vnd.jupyter.cells";class g extends Error{constructor(e){const t=e;const n=t.ename;const i=t.evalue;super(`KernelReplyNotOK: ${n} ${i}`);this.errorName=n;this.errorValue=i;this.traceback=t.traceback;Object.setPrototypeOf(this,g.prototype)}}class f{static get executed(){return C.executed}static get executionScheduled(){return C.executionScheduled}static get selectionExecuted(){return C.selectionExecuted}static get outputCleared(){return C.outputCleared}constructor(){}}(function(e){function t(e){if(!e.model||!e.activeCell){return}const t=C.getState(e);e.mode="edit";e.deselectAll();const n=e.model;const i=e.activeCellIndex;const o=e.widgets[i];const s=o.editor;if(!s){return}const l=s.getSelections();const a=o.model.sharedModel.getSource();const r=[0];let d=-1;let c=-1;for(let g=0;g<l.length;g++){d=s.getOffsetAt(l[g].start);c=s.getOffsetAt(l[g].end);if(d<c){r.push(d);r.push(c)}else if(c<d){r.push(c);r.push(d)}else{r.push(d)}}r.push(a.length);const h=r.slice(0,-1).map(((e,t)=>{const{cell_type:n,metadata:i}=o.model.sharedModel.toJSON();return{cell_type:n,metadata:i,source:a.slice(e,r[t+1]).replace(/^\n+/,"").replace(/\n+$/,"")}}));n.sharedModel.transact((()=>{n.sharedModel.deleteCell(i);n.sharedModel.insertCells(i,h)}));const u=d!==c?2:1;e.activeCellIndex=i+h.length-u;e.scrollToItem(e.activeCellIndex).then((()=>{var t;(t=e.activeCell)===null||t===void 0?void 0:t.editor.focus()})).catch((e=>{}));void C.handleState(e,t)}e.splitCell=t;function n(e,t=false){if(!e.model||!e.activeCell){return}const n=C.getState(e);const i=[];const s=[];const l=e.model;const a=l.cells;const r=e.activeCell;const d=e.activeCellIndex;const c={};e.widgets.forEach(((t,n)=>{if(e.isSelectedOrActive(t)){i.push(t.model.sharedModel.getSource());if(n!==d){s.push(n)}const e=t.model;if((0,o.isRawCellModel)(e)||(0,o.isMarkdownCellModel)(e)){for(const t of e.attachments.keys){c[t]=e.attachments.get(t).toJSON()}}}}));if(i.length===1){if(t===true){if(d===0){return}const e=a.get(d-1);i.unshift(e.sharedModel.getSource());s.push(d-1)}else if(t===false){if(d===a.length-1){return}const e=a.get(d+1);i.push(e.sharedModel.getSource());s.push(d+1)}}e.deselectAll();const h=r.model.sharedModel;const{cell_type:u,metadata:g}=h.toJSON();if(h.cell_type==="code"){g.trusted=true}const f={cell_type:u,metadata:g,source:i.join("\n\n"),attachments:h.cell_type==="markdown"||h.cell_type==="raw"?c:undefined};l.sharedModel.transact((()=>{l.sharedModel.deleteCell(d);l.sharedModel.insertCell(d,f);s.sort(((e,t)=>t-e)).forEach((e=>{l.sharedModel.deleteCell(e)}))}));if(r instanceof o.MarkdownCell){e.activeCell.rendered=false}void C.handleState(e,n)}e.mergeCells=n;function d(e){if(!e.model||!e.activeCell){return}const t=C.getState(e);C.deleteCells(e);void C.handleState(e,t,true)}e.deleteCells=d;function h(e){if(!e.model){return}const t=C.getState(e);const n=e.model;const i=e.activeCell?e.activeCellIndex:0;n.sharedModel.insertCell(i,{cell_type:e.notebookConfig.defaultCell,metadata:e.notebookConfig.defaultCell==="code"?{trusted:true}:{}});e.activeCellIndex=i;e.deselectAll();void C.handleState(e,t,true)}e.insertAbove=h;function g(e){if(!e.model){return}const t=C.getState(e);const n=e.model;const i=e.activeCell?e.activeCellIndex+1:0;n.sharedModel.insertCell(i,{cell_type:e.notebookConfig.defaultCell,metadata:e.notebookConfig.defaultCell==="code"?{trusted:true}:{}});e.activeCellIndex=i;e.deselectAll();void C.handleState(e,t,true)}e.insertBelow=g;function f(e,t){if(!e.model||!e.activeCell){return}const n=C.getState(e);const i=e.widgets.findIndex((t=>e.isSelectedOrActive(t)));let o=e.widgets.slice(i+1).findIndex((t=>!e.isSelectedOrActive(t)));if(o>=0){o+=i+1}else{o=e.model.cells.length}if(t>0){e.moveCell(i,o,o-i)}else{e.moveCell(i,i+t,o-i)}void C.handleState(e,n,true)}function v(e){f(e,1)}e.moveDown=v;function m(e){f(e,-1)}e.moveUp=m;function p(e,t){if(!e.model||!e.activeCell){return}const n=C.getState(e);C.changeCellType(e,t);void C.handleState(e,n)}e.changeCellType=p;function _(e,t,n,i){if(!e.model||!e.activeCell){return Promise.resolve(false)}const o=C.getState(e);const s=C.runSelected(e,t,n,i);void C.handleRunState(e,o);return s}e.run=_;function w(e,t,n,i,o){if(!e.model){return Promise.resolve(false)}const s=C.getState(e);const l=C.runCells(e,t,n,i,o);void C.handleRunState(e,s);return l}e.runCells=w;async function y(e,t,n,i){var o;if(!e.model||!e.activeCell){return Promise.resolve(false)}const l=C.getState(e);const a=C.runSelected(e,t,n,i);const r=e.model;if(e.activeCellIndex===e.widgets.length-1){r.sharedModel.insertCell(e.widgets.length,{cell_type:e.notebookConfig.defaultCell,metadata:e.notebookConfig.defaultCell==="code"?{trusted:true}:{}});e.activeCellIndex++;if(((o=e.activeCell)===null||o===void 0?void 0:o.inViewport)===false){await(0,s.signalToPromise)(e.activeCell.inViewportChanged,200).catch((()=>{}))}e.mode="edit"}else{e.activeCellIndex++}void C.handleRunState(e,l,"center");return a}e.runAndAdvance=y;async function b(e,t,n,i){var o;if(!e.model||!e.activeCell){return Promise.resolve(false)}const l=C.getState(e);const a=C.runSelected(e,t,n,i);const r=e.model;r.sharedModel.insertCell(e.activeCellIndex+1,{cell_type:e.notebookConfig.defaultCell,metadata:e.notebookConfig.defaultCell==="code"?{trusted:true}:{}});e.activeCellIndex++;if(((o=e.activeCell)===null||o===void 0?void 0:o.inViewport)===false){await(0,s.signalToPromise)(e.activeCell.inViewportChanged,200).catch((()=>{}))}e.mode="edit";void C.handleRunState(e,l,"center");return a}e.runAndInsert=b;function k(e,t,n,i){if(!e.model||!e.activeCell){return Promise.resolve(false)}const o=C.getState(e);const s=e.widgets.length;const l=C.runCells(e,e.widgets,t,n,i);e.activeCellIndex=s;e.deselectAll();void C.handleRunState(e,o);return l}e.runAll=k;function S(e){if(!e.model||!e.activeCell){return Promise.resolve(false)}const t=e.activeCellIndex;const n=C.getState(e);e.widgets.forEach(((t,n)=>{if(t.model.type==="markdown"){e.select(t);e.activeCellIndex=n}}));if(e.activeCell.model.type!=="markdown"){return Promise.resolve(true)}const i=C.runSelected(e);e.activeCellIndex=t;void C.handleRunState(e,n);return i}e.renderAllMarkdown=S;function x(e,t,n,i){const{activeCell:o,activeCellIndex:s,model:l}=e;if(!l||!o||s<1){return Promise.resolve(false)}const a=C.getState(e);const r=C.runCells(e,e.widgets.slice(0,e.activeCellIndex),t,n,i);e.deselectAll();void C.handleRunState(e,a);return r}e.runAllAbove=x;function M(e,t,n,i){if(!e.model||!e.activeCell){return Promise.resolve(false)}const o=C.getState(e);const s=e.widgets.length;const l=C.runCells(e,e.widgets.slice(e.activeCellIndex),t,n,i);e.activeCellIndex=s;e.deselectAll();void C.handleRunState(e,o);return l}e.runAllBelow=M;function I(e,t){var n,i,o;if(!e.model||!((n=e.activeCell)===null||n===void 0?void 0:n.editor)){return}(o=(i=e.activeCell.editor).replaceSelection)===null||o===void 0?void 0:o.call(i,t)}e.replaceSelection=I;function A(e){if(!e.model||!e.activeCell){return}const t=e.layout.footer;if(t&&document.activeElement===t.node){t.node.blur();e.mode="command";return}if(e.activeCellIndex===0){return}let n=e.activeCellIndex-1;while(n>=0){const t=e.widgets[n];if(!t.inputHidden&&!t.isHidden){break}n-=1}const i=C.getState(e);e.activeCellIndex=n;e.deselectAll();void C.handleState(e,i,true)}e.selectAbove=A;function E(e){if(!e.model||!e.activeCell){return}let t=e.widgets.length-1;while(e.widgets[t].isHidden||e.widgets[t].inputHidden){t-=1}if(e.activeCellIndex===t){const t=e.layout.footer;t===null||t===void 0?void 0:t.node.focus();return}let n=e.activeCellIndex+1;while(n<t){let t=e.widgets[n];if(!t.inputHidden&&!t.isHidden){break}n+=1}const i=C.getState(e);e.activeCellIndex=n;e.deselectAll();void C.handleState(e,i,true)}e.selectBelow=E;async function T(e){if(!e.model||!e.activeCell){return}let t=C.Headings.determineHeadingLevel(e.activeCell,e);if(t==-1){await C.Headings.insertHeadingAboveCellIndex(0,1,e)}else{await C.Headings.insertHeadingAboveCellIndex(e.activeCellIndex,t,e)}}e.insertSameLevelHeadingAbove=T;async function N(e){if(!e.model||!e.activeCell){return}let t=C.Headings.determineHeadingLevel(e.activeCell,e);t=t>-1?t:1;let n=C.Headings.findLowerEqualLevelHeadingBelow(e.activeCell,e,true);await C.Headings.insertHeadingAboveCellIndex(n==-1?e.model.cells.length:n,t,e)}e.insertSameLevelHeadingBelow=N;function P(e){if(!e.model||!e.activeCell){return}const t=C.getState(e);let n=ve(e.activeCell);if(n.isHeading&&!n.collapsed){ge(e.activeCell,true,e)}else{let t=C.Headings.findLowerEqualLevelParentHeadingAbove(e.activeCell,e,true);if(t>-1){e.activeCellIndex=t}}e.deselectAll();void C.handleState(e,t,true)}e.selectHeadingAboveOrCollapseHeading=P;function H(e){if(!e.model||!e.activeCell){return}const t=C.getState(e);let n=ve(e.activeCell);if(n.isHeading&&n.collapsed){ge(e.activeCell,false,e)}else{let t=C.Headings.findHeadingBelow(e.activeCell,e,true);if(t>-1){e.activeCellIndex=t}}e.deselectAll();void C.handleState(e,t,true)}e.selectHeadingBelowOrExpandHeading=H;function D(e,t=false){if(!e.model||!e.activeCell){return}if(e.activeCellIndex===0){return}const n=C.getState(e);e.mode="command";if(t){e.extendContiguousSelectionTo(0)}else{e.extendContiguousSelectionTo(e.activeCellIndex-1)}void C.handleState(e,n,true)}e.extendSelectionAbove=D;function L(e,t=false){if(!e.model||!e.activeCell){return}if(e.activeCellIndex===e.widgets.length-1){return}const n=C.getState(e);e.mode="command";if(t){e.extendContiguousSelectionTo(e.widgets.length-1)}else{e.extendContiguousSelectionTo(e.activeCellIndex+1)}void C.handleState(e,n,true)}e.extendSelectionBelow=L;function O(e){if(!e.model||!e.activeCell){return}e.widgets.forEach((t=>{e.select(t)}))}e.selectAll=O;function R(e){if(!e.model||!e.activeCell){return}e.deselectAll()}e.deselectAll=R;function B(e){C.copyOrCut(e,false)}e.copy=B;function F(e){C.copyOrCut(e,true)}e.cut=F;function V(e,t="below"){const n=i.Clipboard.getInstance();if(!n.hasData(u)){return}const o=n.getData(u);j(e,t,o,true);void pe(e)}e.paste=V;function W(e,t="below"){const n=C.selectedCells(e);if(!n||n.length===0){return}j(e,t,n,false)}e.duplicate=W;function j(e,t="below",n,i=false){if(!e.model||!e.activeCell){return}const o=C.getState(e);const s=e.model;e.mode="command";let l=0;const a=e.activeCellIndex;s.sharedModel.transact((()=>{switch(t){case"below":l=e.activeCellIndex+1;break;case"belowSelected":e.widgets.forEach(((t,n)=>{if(e.isSelectedOrActive(t)){l=n+1}}));break;case"above":l=e.activeCellIndex;break;case"replace":{const t=[];e.widgets.forEach(((n,i)=>{const o=n.model.sharedModel.getMetadata("deletable")!==false;if(e.isSelectedOrActive(n)&&o){t.push(i)}}));if(t.length>0){t.reverse().forEach((e=>{s.sharedModel.deleteCell(e)}))}l=t[0];break}default:break}s.sharedModel.insertCells(l,n.map((t=>{t.id=t.cell_type==="code"&&e.lastClipboardInteraction==="cut"&&typeof t.id==="string"?t.id:undefined;return t})))}));e.activeCellIndex=a+n.length;e.deselectAll();if(i){e.lastClipboardInteraction="paste"}void C.handleState(e,o,true)}function U(e){if(!e.model){return}const t=C.getState(e);e.mode="command";e.model.sharedModel.undo();e.deselectAll();void C.handleState(e,t)}e.undo=U;function q(e){if(!e.model||!e.activeCell){return}const t=C.getState(e);e.mode="command";e.model.sharedModel.redo();e.deselectAll();void C.handleState(e,t)}e.redo=q;function K(e){if(!e.model||!e.activeCell){return}const t=C.getState(e);const n=e.editorConfig;const i=!(n.code.lineNumbers&&n.markdown.lineNumbers&&n.raw.lineNumbers);const o={code:{...n.code,lineNumbers:i},markdown:{...n.markdown,lineNumbers:i},raw:{...n.raw,lineNumbers:i}};e.editorConfig=o;void C.handleState(e,t)}e.toggleAllLineNumbers=K;function z(e){if(!e.model||!e.activeCell){return}const t=C.getState(e);let n=-1;for(const i of e.model.cells){const t=e.widgets[++n];if(e.isSelectedOrActive(t)&&i.type==="code"){i.sharedModel.transact((()=>{i.clearExecution();t.outputHidden=false}),false);C.outputCleared.emit({notebook:e,cell:t})}}void C.handleState(e,t,true)}e.clearOutputs=z;function $(e){if(!e.model||!e.activeCell){return}const t=C.getState(e);let n=-1;for(const i of e.model.cells){const t=e.widgets[++n];if(i.type==="code"){i.sharedModel.transact((()=>{i.clearExecution();t.outputHidden=false}),false);C.outputCleared.emit({notebook:e,cell:t})}}void C.handleState(e,t,true)}e.clearAllOutputs=$;function J(e){if(!e.model||!e.activeCell){return}const t=C.getState(e);e.widgets.forEach((t=>{if(e.isSelectedOrActive(t)&&t.model.type==="code"){t.inputHidden=true}}));void C.handleState(e,t)}e.hideCode=J;function G(e){if(!e.model||!e.activeCell){return}const t=C.getState(e);e.widgets.forEach((t=>{if(e.isSelectedOrActive(t)&&t.model.type==="code"){t.inputHidden=false}}));void C.handleState(e,t)}e.showCode=G;function Y(e){if(!e.model||!e.activeCell){return}const t=C.getState(e);e.widgets.forEach((e=>{if(e.model.type==="code"){e.inputHidden=true}}));void C.handleState(e,t)}e.hideAllCode=Y;function Q(e){if(!e.model||!e.activeCell){return}const t=C.getState(e);e.widgets.forEach((e=>{if(e.model.type==="code"){e.inputHidden=false}}));void C.handleState(e,t)}e.showAllCode=Q;function X(e){if(!e.model||!e.activeCell){return}const t=C.getState(e);e.widgets.forEach((t=>{if(e.isSelectedOrActive(t)&&t.model.type==="code"){t.outputHidden=true}}));void C.handleState(e,t,true)}e.hideOutput=X;function Z(e){if(!e.model||!e.activeCell){return}const t=C.getState(e);e.widgets.forEach((t=>{if(e.isSelectedOrActive(t)&&t.model.type==="code"){t.outputHidden=false}}));void C.handleState(e,t)}e.showOutput=Z;function ee(e){if(!e.model||!e.activeCell){return}const t=C.getState(e);e.widgets.forEach((e=>{if(e.model.type==="code"){e.outputHidden=true}}));void C.handleState(e,t,true)}e.hideAllOutputs=ee;function te(e){e.renderingLayout="side-by-side"}e.renderSideBySide=te;function ne(e){e.renderingLayout="default"}e.renderDefault=ne;function ie(e){if(!e.model||!e.activeCell){return}const t=C.getState(e);e.widgets.forEach((e=>{if(e.model.type==="code"){e.outputHidden=false}}));void C.handleState(e,t)}e.showAllOutputs=ie;function oe(e){if(!e.model||!e.activeCell){return}const t=C.getState(e);e.widgets.forEach((t=>{if(e.isSelectedOrActive(t)&&t.model.type==="code"){t.outputsScrolled=true}}));void C.handleState(e,t,true)}e.enableOutputScrolling=oe;function se(e){if(!e.model||!e.activeCell){return}const t=C.getState(e);e.widgets.forEach((t=>{if(e.isSelectedOrActive(t)&&t.model.type==="code"){t.outputsScrolled=false}}));void C.handleState(e,t)}e.disableOutputScrolling=se;function le(e){let t=null;let n=null;e.widgets.forEach(((e,i)=>{if(e.model.type==="code"){const o=e.model.getMetadata("execution");if(o&&r.JSONExt.isObject(o)&&o["iopub.status.busy"]!==undefined){const e=o["iopub.status.busy"].toString();if(e){const o=new Date(e);if(!t||o>=t){t=o;n=i}}}}}));if(n!==null){e.activeCellIndex=n}}e.selectLastRunCell=le;function ae(e,t){if(!e.model||!e.activeCell){return}const n=C.getState(e);const i=e.model.cells;t=Math.min(Math.max(t,1),6);e.widgets.forEach(((n,o)=>{if(e.isSelectedOrActive(n)){C.setMarkdownHeader(i.get(o),t)}}));C.changeCellType(e,"markdown");void C.handleState(e,n)}e.setMarkdownHeader=ae;function re(t){const n=C.getState(t);for(const i of t.widgets){if(e.getHeadingInfo(i).isHeading){e.setHeadingCollapse(i,true,t);e.setCellCollapse(i,true)}}t.activeCellIndex=0;void C.handleState(t,n,true)}e.collapseAllHeadings=re;function de(t){for(const n of t.widgets){if(e.getHeadingInfo(n).isHeading){e.setHeadingCollapse(n,false,t);e.setCellCollapse(n,false)}}}e.expandAllHeadings=de;function ce(e,t){const n=(0,a.findIndex)(t.widgets,((t,n)=>e.model.id===t.model.id));if(n===-1){return}if(n>=t.widgets.length){return}let i=ve(t.widgets[n]);for(let o=n-1;o>=0;o--){if(o<t.widgets.length){let e=ve(t.widgets[o]);if(e.isHeading&&e.headingLevel<i.headingLevel){return t.widgets[o]}}}return}function he(e,t){let n=ce(e,t);if(!n){return}if(!ve(n).collapsed&&!n.isHidden){return}if(n.isHidden){he(n,t)}if(ve(n).collapsed){ge(n,false,t)}}e.expandParent=he;function ue(e,t){let n=(0,a.findIndex)(t.widgets,((t,n)=>e.model.id===t.model.id));if(n===-1){return-1}let i=ve(e);for(n=n+1;n<t.widgets.length;n++){let e=ve(t.widgets[n]);if(e.isHeading&&e.headingLevel<=i.headingLevel){return n}}return t.widgets.length}e.findNextParentHeading=ue;function ge(t,n,i){const s=(0,a.findIndex)(i.widgets,((e,n)=>t.model.id===e.model.id));if(s===-1){return-1}if(!i.widgets.length){return s+1}let l=e.getHeadingInfo(t);if(t.isHidden||!(t instanceof o.MarkdownCell)||!l.isHeading){return s+1}let r=false;let d=0;let c;for(c=s+1;c<i.widgets.length;c++){let t=i.widgets[c];let o=e.getHeadingInfo(t);if(o.isHeading&&o.headingLevel<=l.headingLevel){c-=1;break}if(r&&o.isHeading&&o.headingLevel<=d){r=false}if(n||r){t.setHidden(true);continue}if(o.collapsed&&o.isHeading){r=true;d=o.headingLevel}t.setHidden(false)}if(c===i.widgets.length){t.numberChildNodes=c-s-1}else{t.numberChildNodes=c-s}e.setCellCollapse(t,n);return c+1}e.setHeadingCollapse=ge;function fe(t){if(!t.activeCell||t.activeCellIndex===undefined){return}let n=e.getHeadingInfo(t.activeCell);if(n.isHeading){e.setHeadingCollapse(t.activeCell,!n.collapsed,t)}t.scrollToItem(t.activeCellIndex).catch((e=>{}))}e.toggleCurrentHeadingCollapse=fe;function Ce(e,t){if(e instanceof o.MarkdownCell){e.headingCollapsed=t}else{e.setHidden(t)}}e.setCellCollapse=Ce;function ve(e){if(!(e instanceof o.MarkdownCell)){return{isHeading:false,headingLevel:7}}let t=e.headingInfo.level;let n=e.headingCollapsed;return{isHeading:t>0,headingLevel:t,collapsed:n}}e.getHeadingInfo=ve;function me(e,t){t=t||l.nullTranslator;const n=t.load("jupyterlab");if(!e.model){return Promise.resolve()}const o=(0,a.every)(e.model.cells,(e=>e.trusted));const s=c.createElement("p",null,n.__("A trusted Jupyter notebook may execute hidden malicious code when you open it."),c.createElement("br",null),n.__('Selecting "Trust" will re-render this notebook in a trusted state.'),c.createElement("br",null),n.__("For more information, see")," ",c.createElement("a",{href:"https://jupyter-server.readthedocs.io/en/stable/operators/security.html",target:"_blank",rel:"noopener noreferrer"},n.__("the Jupyter security documentation")),".");if(o){return(0,i.showDialog)({body:n.__("Notebook is already trusted"),buttons:[i.Dialog.okButton()]}).then((()=>undefined))}return(0,i.showDialog)({body:s,title:n.__("Trust this notebook?"),buttons:[i.Dialog.cancelButton(),i.Dialog.warnButton({label:n.__("Trust"),ariaLabel:n.__("Confirm Trusting this notebook")})]}).then((t=>{if(t.button.accept){if(e.model){for(const t of e.model.cells){t.trusted=true}}}}))}e.trust=me;async function pe(e,t={waitUntilReady:true,preventScroll:false}){const{activeCell:n}=e;const{waitUntilReady:i,preventScroll:o}=t;if(!n){return}if(i){await n.ready}if(e.isDisposed||n.isDisposed){return}n.node.focus({preventScroll:o})}e.focusActiveCell=pe;async function _e(e){if(!e.notebookConfig.accessKernelHistory){return}const t=e.activeCell;if(t){if(e.kernelHistory){const n=await e.kernelHistory.back(t);e.kernelHistory.updateEditor(t,n)}}}e.accessPreviousHistory=_e;async function we(e){if(!e.notebookConfig.accessKernelHistory){return}const t=e.activeCell;if(t){if(e.kernelHistory){const n=await e.kernelHistory.forward(t);e.kernelHistory.updateEditor(t,n)}}}e.accessNextHistory=we})(f||(f={}));var C;(function(e){e.executed=new d.Signal({});e.executionScheduled=new d.Signal({});e.selectionExecuted=new d.Signal({});e.outputCleared=new d.Signal({});function t(e){var t,n;return{wasFocused:e.node.contains(document.activeElement),activeCellId:(n=(t=e.activeCell)===null||t===void 0?void 0:t.model.id)!==null&&n!==void 0?n:null}}e.getState=t;async function n(e,t,n=false){const{activeCell:i,activeCellIndex:o}=e;if(n&&i){await e.scrollToItem(o,"auto",0).catch((e=>{}))}if(t.wasFocused||e.mode==="edit"){e.activate()}}e.handleState=n;async function r(e,t,n){const{activeCell:i,activeCellIndex:o}=e;if(i){await e.scrollToItem(o,"smart",0,n).catch((e=>{}))}if(t.wasFocused||e.mode==="edit"){e.activate()}}e.handleRunState=r;function c(t,n,o,s,a){const r=n[-1];t.mode="command";let d=false;return Promise.all(n.map((e=>{if(e.model.type==="code"&&t.notebookConfig.enableKernelInitNotification&&o&&o.kernelDisplayStatus==="initializing"&&!d){d=true;a=a||l.nullTranslator;const e=a.load("jupyterlab");i.Notification.emit(e.__(`Kernel '${o.kernelDisplayName}' for '${o.path}' is still initializing. You can run code cells when the kernel has initialized.`),"warning",{autoClose:false});return Promise.resolve(false)}if(e.model.type==="code"&&t.notebookConfig.enableKernelInitNotification&&d){return Promise.resolve(false)}return C(t,e,o,s,a)}))).then((n=>{if(t.isDisposed){return false}e.selectionExecuted.emit({notebook:t,lastCell:r});t.update();return n.every((e=>e))})).catch((i=>{if(i.message.startsWith("KernelReplyNotOK")){n.map((e=>{if(e.model.type==="code"&&e.model.executionCount==null){e.setPrompt("")}}))}else{throw i}e.selectionExecuted.emit({notebook:t,lastCell:r});t.update();return false}))}e.runCells=c;function h(e,t,n,i){e.mode="command";let o=e.activeCellIndex;const s=e.widgets.filter(((t,n)=>{const i=e.isSelectedOrActive(t);if(i){o=n}return i}));e.activeCellIndex=o;e.deselectAll();return c(e,s,t,n,i)}e.runSelected=h;async function C(t,n,s,a,r){var d,c,h;r=r||l.nullTranslator;const u=r.load("jupyterlab");switch(n.model.type){case"markdown":n.rendered=true;n.inputHidden=false;e.executed.emit({notebook:t,cell:n,success:true});break;case"code":if(s){if(s.isTerminating){await(0,i.showDialog)({title:u.__("Kernel Terminating"),body:u.__("The kernel for %1 appears to be terminating. You can not run any cell for now.",(d=s.session)===null||d===void 0?void 0:d.path),buttons:[i.Dialog.okButton()]});break}if(s.pendingInput){await(0,i.showDialog)({title:u.__("Cell not executed due to pending input"),body:u.__("The cell has not been executed to avoid kernel deadlock as there is another pending input! Submit your pending input and try again."),buttons:[i.Dialog.okButton()]});return false}if(s.hasNoKernel){const e=await s.startKernel();if(e&&a){await a.selectKernel(s)}}if(s.hasNoKernel){n.model.sharedModel.transact((()=>{n.model.clearExecution()}));return true}const l=(h=(c=t.model)===null||c===void 0?void 0:c.deletedCells)!==null&&h!==void 0?h:[];e.executionScheduled.emit({notebook:t,cell:n});let r=false;try{const e=await o.CodeCell.execute(n,s,{deletedCells:l,recordTiming:t.notebookConfig.recordTiming});l.splice(0,l.length);r=(()=>{if(n.isDisposed){return false}if(!e){return true}if(e.content.status==="ok"){const i=e.content;if(i.payload&&i.payload.length){v(i,t,n)}return true}else{throw new g(e.content)}})()}catch(f){if(n.isDisposed||f.message.startsWith("Canceled")){r=false}else{e.executed.emit({notebook:t,cell:n,success:false,error:f});throw f}}if(r){e.executed.emit({notebook:t,cell:n,success:true})}return r}n.model.sharedModel.transact((()=>{n.model.clearExecution()}),false);break;default:break}return Promise.resolve(true)}function v(e,t,n){var i;const o=(i=e.payload)===null||i===void 0?void 0:i.filter((e=>e.source==="set_next_input"))[0];if(!o){return}const s=o.text;const l=o.replace;if(l){n.model.sharedModel.setSource(s);return}const r=t.model.sharedModel;const d=t.model.cells;const c=(0,a.findIndex)(d,(e=>e===n.model));if(c===-1){r.insertCell(r.cells.length,{cell_type:"code",source:s,metadata:{trusted:false}})}else{r.insertCell(c+1,{cell_type:"code",source:s,metadata:{trusted:false}})}}function m(e){return e.widgets.filter((t=>e.isSelectedOrActive(t))).map((e=>e.model.toJSON())).map((e=>{if(e.metadata.deletable!==undefined){delete e.metadata.deletable}return e}))}e.selectedCells=m;function p(o,s){if(!o.model||!o.activeCell){return}const l=t(o);const a=i.Clipboard.getInstance();o.mode="command";a.clear();const r=e.selectedCells(o);a.setData(u,r);if(s){w(o)}else{o.deselectAll()}if(s){o.lastClipboardInteraction="cut"}else{o.lastClipboardInteraction="copy"}void n(o,l)}e.copyOrCut=p;function _(e,t){const n=e.model.sharedModel;e.widgets.forEach(((i,o)=>{if(!e.isSelectedOrActive(i)){return}if(i.model.type!==t){const e=i.model.toJSON();n.transact((()=>{n.deleteCell(o);if(t==="code"){e.metadata.trusted=true}else{e.metadata.trusted=undefined}const i=n.insertCell(o,{cell_type:t,source:e.source,metadata:e.metadata});if(e.attachments&&["markdown","raw"].includes(t)){i.attachments=e.attachments}}))}if(t==="markdown"){i=e.widgets[o];i.rendered=false}}));e.deselectAll()}e.changeCellType=_;function w(e){const t=e.model;const n=t.sharedModel;const i=[];e.mode="command";e.widgets.forEach(((t,n)=>{var o;const s=t.model.getMetadata("deletable")!==false;if(e.isSelectedOrActive(t)&&s){i.push(n);(o=e.model)===null||o===void 0?void 0:o.deletedCells.push(t.model.id)}}));if(i.length>0){n.transact((()=>{i.reverse().forEach((e=>{n.deleteCell(e)}));if(n.cells.length==i.length){n.insertCell(0,{cell_type:e.notebookConfig.defaultCell,metadata:e.notebookConfig.defaultCell==="code"?{trusted:true}:{}})}}));e.activeCellIndex=i[0]-i.length+1}e.deselectAll()}e.deleteCells=w;function y(e,t){let n=e.sharedModel.getSource();const i=/^(#+\s*)|^(\s*)/;const o=Array(t+1).join("#")+" ";const s=i.exec(n);if(s){n=n.slice(s[0].length)}e.sharedModel.setSource(o+n)}e.setMarkdownHeader=y;let b;(function(t){function n(e,t,n=false,i=false){let o=t.widgets.indexOf(e)-(n?1:0);while(o>=0){let e=f.getHeadingInfo(t.widgets[o]);if(e.isHeading){return i?o:t.widgets[o]}o--}return i?-1:null}t.findParentHeading=n;function i(t,n,i=false){let o=e.Headings.determineHeadingLevel(t,n);if(o==-1){o=1}let s=n.widgets.indexOf(t)-1;while(s>=0){let e=n.widgets[s];let t=f.getHeadingInfo(e);if(t.isHeading&&t.headingLevel<=o){return i?s:e}s--}return i?-1:null}t.findLowerEqualLevelParentHeadingAbove=i;function o(t,n,i=false){let o=e.Headings.determineHeadingLevel(t,n);if(o==-1){o=1}let s=n.widgets.indexOf(t)+1;while(s<n.widgets.length){let e=n.widgets[s];let t=f.getHeadingInfo(e);if(t.isHeading&&t.headingLevel<=o){return i?s:e}s++}return i?-1:null}t.findLowerEqualLevelHeadingBelow=o;function l(e,t,n=false){let i=t.widgets.indexOf(e)+1;while(i<t.widgets.length){let e=t.widgets[i];let o=f.getHeadingInfo(e);if(o.isHeading){return n?i:e}i++}return n?-1:null}t.findHeadingBelow=l;function a(e,t){let i=f.getHeadingInfo(e);if(i.isHeading){return i.headingLevel}else{let i=n(e,t,true);if(i==null){return-1}return f.getHeadingInfo(i).headingLevel}}t.determineHeadingLevel=a;async function r(t,n,i){var o;n=Math.min(Math.max(n,1),6);const l=e.getState(i);const a=i.model;const r=a.sharedModel;r.insertCell(t,{cell_type:"markdown",source:"#".repeat(n)+" "});i.activeCellIndex=t;if(((o=i.activeCell)===null||o===void 0?void 0:o.inViewport)===false){await(0,s.signalToPromise)(i.activeCell.inViewportChanged,200).catch((()=>{}))}i.deselectAll();void e.handleState(i,l,true);i.mode="edit";i.widgets[t].setHidden(false)}t.insertHeadingAboveCellIndex=r})(b=e.Headings||(e.Headings={}))})(C||(C={}));class v{constructor(e){this.model=e;this._cellMap=new WeakMap;this._changed=new d.Signal(this);this._isDisposed=false;this._insertCells(0,this.model.cells);this.model.changed.connect(this._onSharedModelChanged,this)}get changed(){return this._changed}get isDisposed(){return this._isDisposed}get length(){return this.model.cells.length}*[Symbol.iterator](){for(const e of this.model.cells){yield this._cellMap.get(e)}}dispose(){var e;if(this._isDisposed){return}this._isDisposed=true;for(const t of this.model.cells){(e=this._cellMap.get(t))===null||e===void 0?void 0:e.dispose()}d.Signal.clearData(this)}get(e){return this._cellMap.get(this.model.cells[e])}_insertCells(e,t){t.forEach((e=>{let t;switch(e.cell_type){case"code":{t=new o.CodeCellModel({sharedModel:e});break}case"markdown":{t=new o.MarkdownCellModel({sharedModel:e});break}default:{t=new o.RawCellModel({sharedModel:e})}}this._cellMap.set(e,t);e.disposed.connect((()=>{t.dispose();this._cellMap.delete(e)}))}));return this.length}_onSharedModelChanged(e,t){var n;let i=0;const o=new Array;(n=t.cellsChange)===null||n===void 0?void 0:n.forEach((e=>{if(e.insert!=null){this._insertCells(i,e.insert);o.push({type:"add",newIndex:i,newValues:e.insert.map((e=>this._cellMap.get(e))),oldIndex:-2,oldValues:[]});i+=e.insert.length}else if(e.delete!=null){o.push({type:"remove",newIndex:-1,newValues:[],oldIndex:i,oldValues:new Array(e.delete).fill(undefined)})}else if(e.retain!=null){i+=e.retain}}));o.forEach((e=>this._changed.emit(e)))}}var m=n(27425);const p="jp-Notebook-toolbarCellType";const _="jp-Notebook-toolbarCellTypeDropdown";var w;(function(e){function t(e,t){const n=(t||l.nullTranslator).load("jupyterlab");function o(){if(e.context.model.readOnly){return(0,i.showDialog)({title:n.__("Cannot Save"),body:n.__("Document is read-only"),buttons:[i.Dialog.okButton()]})}void e.context.save().then((()=>{if(!e.isDisposed){return e.context.createCheckpoint()}}))}return(0,m.addToolbarButtonClass)(m.ReactWidget.create(c.createElement(m.UseSignal,{signal:e.context.fileChanged},(()=>c.createElement(m.ToolbarButtonComponent,{icon:m.saveIcon,onClick:o,tooltip:n.__("Save the notebook contents and create checkpoint"),enabled:!!(e&&e.context&&e.context.contentsModel&&e.context.contentsModel.writable)})))))}e.createSaveButton=t;function n(e,t){const n=(t||l.nullTranslator).load("jupyterlab");return new m.ToolbarButton({icon:m.addIcon,onClick:()=>{f.insertBelow(e.content)},tooltip:n.__("Insert a cell below")})}e.createInsertButton=n;function o(e,t){const n=(t||l.nullTranslator).load("jupyterlab");return new m.ToolbarButton({icon:m.cutIcon,onClick:()=>{f.cut(e.content)},tooltip:n.__("Cut the selected cells")})}e.createCutButton=o;function s(e,t){const n=(t||l.nullTranslator).load("jupyterlab");return new m.ToolbarButton({icon:m.copyIcon,onClick:()=>{f.copy(e.content)},tooltip:n.__("Copy the selected cells")})}e.createCopyButton=s;function a(e,t){const n=(t||l.nullTranslator).load("jupyterlab");return new m.ToolbarButton({icon:m.pasteIcon,onClick:()=>{f.paste(e.content)},tooltip:n.__("Paste cells from the clipboard")})}e.createPasteButton=a;function r(e,t,n){const i=(n!==null&&n!==void 0?n:l.nullTranslator).load("jupyterlab");return new m.ToolbarButton({icon:m.runIcon,onClick:()=>{void f.runAndAdvance(e.content,e.sessionContext,t,n)},tooltip:i.__("Run the selected cells and advance")})}e.createRunButton=r;function d(e,t,n){const o=(n!==null&&n!==void 0?n:l.nullTranslator).load("jupyterlab");return new m.ToolbarButton({icon:m.fastForwardIcon,onClick:()=>{const o=t!==null&&t!==void 0?t:new i.SessionContextDialogs({translator:n});void o.restart(e.sessionContext).then((t=>{if(t){void f.runAll(e.content,e.sessionContext,o,n)}return t}))},tooltip:o.__("Restart the kernel, then re-run the whole notebook")})}e.createRestartRunAllButton=d;function h(e,t){return new y(e.content,t)}e.createCellTypeItem=h;function u(e,l,c){return[{name:"save",widget:t(e,c)},{name:"insert",widget:n(e,c)},{name:"cut",widget:o(e,c)},{name:"copy",widget:s(e,c)},{name:"paste",widget:a(e,c)},{name:"run",widget:r(e,l,c)},{name:"interrupt",widget:i.Toolbar.createInterruptButton(e.sessionContext,c)},{name:"restart",widget:i.Toolbar.createRestartButton(e.sessionContext,l,c)},{name:"restart-and-run",widget:d(e,l,c)},{name:"cellType",widget:h(e,c)},{name:"spacer",widget:m.Toolbar.createSpacerItem()},{name:"kernelName",widget:i.Toolbar.createKernelNameItem(e.sessionContext,l,c)}]}e.getDefaultItems=u})(w||(w={}));class y extends m.ReactWidget{constructor(e,t){super();this.handleChange=e=>{if(e.target.value!=="-"){f.changeCellType(this._notebook,e.target.value);this._notebook.activate()}};this.handleKeyDown=e=>{if(e.keyCode===13){this._notebook.activate()}};this._trans=(t||l.nullTranslator).load("jupyterlab");this.addClass(p);this._notebook=e;if(e.model){this.update()}e.activeCellChanged.connect(this.update,this);e.selectionChanged.connect(this.update,this)}render(){let e="-";if(this._notebook.activeCell){e=this._notebook.activeCell.model.type}for(const t of this._notebook.widgets){if(this._notebook.isSelectedOrActive(t)){if(t.model.type!==e){e="-";break}}}return c.createElement(m.HTMLSelect,{className:_,onChange:this.handleChange,onKeyDown:this.handleKeyDown,value:e,"aria-label":this._trans.__("Cell type"),title:this._trans.__("Select the cell type")},c.createElement("option",{value:"-"},"-"),c.createElement("option",{value:"code"},this._trans.__("Code")),c.createElement("option",{value:"markdown"},this._trans.__("Markdown")),c.createElement("option",{value:"raw"},this._trans.__("Raw")))}}var b=n(53825);var k=n(4702);function S(e){const t=e.translator||l.nullTranslator;const n=(0,i.translateKernelStatuses)(t);const o=t.load("jupyterlab");const s=e.state;const a=e.displayOption.showOnToolBar;const r=e.displayOption.showProgress;const d=a?"down":"up";const c=h().createElement("div",null);if(!s){return c}const u=s.kernelStatus;const g={alignSelf:"normal",height:"24px"};const f=s.totalTime;const C=s.scheduledCellNumber||0;const v=s.scheduledCell.size||0;const p=C-v;let _=100*p/C;let w=r?"":"hidden";if(!r&&_<100){_=0}const y=e=>h().createElement(b.ProgressCircle,{progress:e,width:16,height:24,label:o.__("Kernel status")});const k=e=>o.__("Kernel status: %1",e);const S=(e,t,i)=>h().createElement("div",{className:"jp-Notebook-ExecutionIndicator",title:r?"":k(n[e]),"data-status":e},t,h().createElement("div",{className:`jp-Notebook-ExecutionIndicator-tooltip ${d} ${w}`},h().createElement("span",null," ",k(n[e])," "),i));if(s.kernelStatus==="connecting"||s.kernelStatus==="disconnected"||s.kernelStatus==="unknown"){return S(u,h().createElement(m.offlineBoltIcon.react,{...g}),[])}if(s.kernelStatus==="starting"||s.kernelStatus==="terminating"||s.kernelStatus==="restarting"||s.kernelStatus==="initializing"){return S(u,h().createElement(m.circleIcon.react,{...g}),[])}if(s.executionStatus==="busy"){return S("busy",y(_),[h().createElement("span",{key:0},o.__(`Executed ${p}/${C} cells`)),h().createElement("span",{key:1},o._n("Elapsed time: %1 second","Elapsed time: %1 seconds",f))])}else{const e=s.kernelStatus==="busy"?0:100;const t=s.kernelStatus==="busy"||f===0?[]:[h().createElement("span",{key:0},o._n("Executed %1 cell","Executed %1 cells",C)),h().createElement("span",{key:1},o._n("Elapsed time: %1 second","Elapsed time: %1 seconds",f))];return S(s.kernelStatus,y(e),t)}}class x extends m.VDomRenderer{constructor(e,t=true){super(new x.Model);this.translator=e||l.nullTranslator;this.addClass("jp-mod-highlighted")}render(){if(this.model===null||!this.model.renderFlag){return h().createElement("div",null)}else{const e=this.model.currentNotebook;if(!e){return h().createElement(S,{displayOption:this.model.displayOption,state:undefined,translator:this.translator})}return h().createElement(S,{displayOption:this.model.displayOption,state:this.model.executionState(e),translator:this.translator})}}}(function(e){class t extends m.VDomModel{constructor(){super();this._notebookExecutionProgress=new WeakMap;this._displayOption={showOnToolBar:true,showProgress:true};this._renderFlag=true}attachNotebook(e){var t,n,i,o;if(e&&e.content&&e.context){const s=e.content;const l=e.context;this._currentNotebook=s;if(!this._notebookExecutionProgress.has(s)){this._notebookExecutionProgress.set(s,{executionStatus:"idle",kernelStatus:"idle",totalTime:0,interval:0,timeout:0,scheduledCell:new Set,scheduledCellNumber:0,needReset:true});const e=this._notebookExecutionProgress.get(s);const a=t=>{if(e){e.kernelStatus=t.kernelDisplayStatus}this.stateChanged.emit(void 0)};l.statusChanged.connect(a,this);const r=t=>{if(e){e.kernelStatus=t.kernelDisplayStatus}this.stateChanged.emit(void 0)};l.connectionStatusChanged.connect(r,this);l.disposed.connect((e=>{e.connectionStatusChanged.disconnect(r,this);e.statusChanged.disconnect(a,this)}));const d=(e,t)=>{const n=t.msg;const i=n.header.msg_id;if(n.header.msg_type==="execute_request"){this._cellScheduledCallback(s,i)}else if(k.KernelMessage.isStatusMsg(n)&&n.content.execution_state==="idle"){const e=n.parent_header.msg_id;this._cellExecutedCallback(s,e)}else if(k.KernelMessage.isStatusMsg(n)&&n.content.execution_state==="restarting"){this._restartHandler(s)}else if(n.header.msg_type==="execute_input"){this._startTimer(s)}};(n=(t=l.session)===null||t===void 0?void 0:t.kernel)===null||n===void 0?void 0:n.anyMessage.connect(d);(o=(i=l.session)===null||i===void 0?void 0:i.kernel)===null||o===void 0?void 0:o.disposed.connect((e=>e.anyMessage.disconnect(d)));const c=(t,n)=>{if(e){this._resetTime(e);this.stateChanged.emit(void 0);if(n.newValue){n.newValue.anyMessage.connect(d)}}};l.kernelChanged.connect(c);l.disposed.connect((e=>e.kernelChanged.disconnect(c)))}}}get currentNotebook(){return this._currentNotebook}get displayOption(){return this._displayOption}set displayOption(e){this._displayOption=e}executionState(e){return this._notebookExecutionProgress.get(e)}_scheduleSwitchToIdle(e){window.setTimeout((()=>{e.executionStatus="idle";clearInterval(e.interval);this.stateChanged.emit(void 0)}),150);e.timeout=window.setTimeout((()=>{e.needReset=true}),1e3)}_cellExecutedCallback(e,t){const n=this._notebookExecutionProgress.get(e);if(n&&n.scheduledCell.has(t)){n.scheduledCell.delete(t);if(n.scheduledCell.size===0){this._scheduleSwitchToIdle(n)}}}_restartHandler(e){const t=this._notebookExecutionProgress.get(e);if(t){t.scheduledCell.clear();this._scheduleSwitchToIdle(t)}}_startTimer(e){const t=this._notebookExecutionProgress.get(e);if(!t){return}if(t.scheduledCell.size>0){if(t.executionStatus!=="busy"){t.executionStatus="busy";clearTimeout(t.timeout);this.stateChanged.emit(void 0);t.interval=window.setInterval((()=>{this._tick(t)}),1e3)}}else{this._resetTime(t)}}_cellScheduledCallback(e,t){const n=this._notebookExecutionProgress.get(e);if(n&&!n.scheduledCell.has(t)){if(n.needReset){this._resetTime(n)}n.scheduledCell.add(t);n.scheduledCellNumber+=1}}_tick(e){e.totalTime+=1;this.stateChanged.emit(void 0)}_resetTime(e){e.totalTime=0;e.scheduledCellNumber=0;e.executionStatus="idle";e.scheduledCell=new Set;clearTimeout(e.timeout);clearInterval(e.interval);e.needReset=false}get renderFlag(){return this._renderFlag}updateRenderOption(e){if(this.displayOption.showOnToolBar){if(!e.showOnToolBar){this._renderFlag=false}else{this._renderFlag=true}}this.displayOption.showProgress=e.showProgress;this.stateChanged.emit(void 0)}}e.Model=t;function n(t,n,o){const s=new e(n);s.model.displayOption={showOnToolBar:true,showProgress:true};s.model.attachNotebook({content:t.content,context:t.sessionContext});if(o){o.then((e=>{const t=e=>{s.model.updateRenderOption(i(e))};e.changed.connect(t);t(e);s.disposed.connect((()=>{e.changed.disconnect(t)}))})).catch((e=>{console.error(e.message)}))}return s}e.createExecutionIndicatorItem=n;function i(e){let t=true;let n=true;const i=e.get("kernelStatus").composite;if(i){t=!i.showOnStatusBar;n=i.showProgress}return{showOnToolBar:t,showProgress:n}}e.getSettingValue=i})(x||(x={}));var M=n(39130);var I=n(16735);class A{constructor(e={}){var t,n;this.standaloneModel=false;this._dirty=false;this._readOnly=false;this._contentChanged=new d.Signal(this);this._stateChanged=new d.Signal(this);this._isDisposed=false;this._metadataChanged=new d.Signal(this);this.standaloneModel=typeof e.sharedModel==="undefined";if(e.sharedModel){this.sharedModel=e.sharedModel}else{this.sharedModel=I.YNotebook.create({disableDocumentWideUndoRedo:(t=e.disableDocumentWideUndoRedo)!==null&&t!==void 0?t:true,data:{nbformat:M.MAJOR_VERSION,nbformat_minor:M.MINOR_VERSION,metadata:{kernelspec:{name:"",display_name:""},language_info:{name:(n=e.languagePreference)!==null&&n!==void 0?n:""}}}})}this._cells=new v(this.sharedModel);this._trans=(e.translator||l.nullTranslator).load("jupyterlab");this._deletedCells=[];this._collaborationEnabled=!!(e===null||e===void 0?void 0:e.collaborationEnabled);this._cells.changed.connect(this._onCellsChanged,this);this.sharedModel.changed.connect(this._onStateChanged,this);this.sharedModel.metadataChanged.connect(this._onMetadataChanged,this)}get contentChanged(){return this._contentChanged}get metadataChanged(){return this._metadataChanged}get stateChanged(){return this._stateChanged}get cells(){return this._cells}get dirty(){return this._dirty}set dirty(e){const t=this._dirty;if(e===t){return}this._dirty=e;this.triggerStateChange({name:"dirty",oldValue:t,newValue:e})}get readOnly(){return this._readOnly}set readOnly(e){if(e===this._readOnly){return}const t=this._readOnly;this._readOnly=e;this.triggerStateChange({name:"readOnly",oldValue:t,newValue:e})}get metadata(){return this.sharedModel.metadata}get nbformat(){return this.sharedModel.nbformat}get nbformatMinor(){return this.sharedModel.nbformat_minor}get defaultKernelName(){var e;const t=this.getMetadata("kernelspec");return(e=t===null||t===void 0?void 0:t.name)!==null&&e!==void 0?e:""}get deletedCells(){return this._deletedCells}get defaultKernelLanguage(){var e;const t=this.getMetadata("language_info");return(e=t===null||t===void 0?void 0:t.name)!==null&&e!==void 0?e:""}get collaborative(){return this._collaborationEnabled}dispose(){if(this.isDisposed){return}this._isDisposed=true;const e=this.cells;this._cells=null;e.dispose();if(this.standaloneModel){this.sharedModel.dispose()}d.Signal.clearData(this)}deleteMetadata(e){return this.sharedModel.deleteMetadata(e)}getMetadata(e){return this.sharedModel.getMetadata(e)}setMetadata(e,t){if(typeof t==="undefined"){this.sharedModel.deleteMetadata(e)}else{this.sharedModel.setMetadata(e,t)}}toString(){return JSON.stringify(this.toJSON())}fromString(e){this.fromJSON(JSON.parse(e))}toJSON(){this._ensureMetadata();return this.sharedModel.toJSON()}fromJSON(e){var t,n;const o=r.JSONExt.deepCopy(e);const s=e.metadata.orig_nbformat;o.nbformat=Math.max(e.nbformat,M.MAJOR_VERSION);if(o.nbformat!==e.nbformat||o.nbformat_minor<M.MINOR_VERSION){o.nbformat_minor=M.MINOR_VERSION}if(s!==undefined&&o.nbformat!==s){const e=o.nbformat>s;let t;if(e){t=this._trans.__(`This notebook has been converted from an older notebook format (v%1)\nto the current notebook format (v%2).\nThe next time you save this notebook, the current notebook format (v%2) will be used.\n'Older versions of Jupyter may not be able to read the new format.' To preserve the original format version,\nclose the notebook without saving it.`,s,o.nbformat)}else{t=this._trans.__(`This notebook has been converted from an newer notebook format (v%1)\nto the current notebook format (v%2).\nThe next time you save this notebook, the current notebook format (v%2) will be used.\nSome features of the original notebook may not be available.' To preserve the original format version,\nclose the notebook without saving it.`,s,o.nbformat)}void(0,i.showDialog)({title:this._trans.__("Notebook converted"),body:t,buttons:[i.Dialog.okButton({label:this._trans.__("Ok")})]})}if(((n=(t=o.cells)===null||t===void 0?void 0:t.length)!==null&&n!==void 0?n:0)===0){o["cells"]=[{cell_type:"code",source:"",metadata:{trusted:true}}]}this.sharedModel.fromJSON(o);this._ensureMetadata();this.dirty=true}_onCellsChanged(e,t){switch(t.type){case"add":t.newValues.forEach((e=>{e.contentChanged.connect(this.triggerContentChange,this)}));break;case"remove":break;case"set":t.newValues.forEach((e=>{e.contentChanged.connect(this.triggerContentChange,this)}));break;default:break}this.triggerContentChange()}_onMetadataChanged(e,t){this._metadataChanged.emit(t);this.triggerContentChange()}_onStateChanged(e,t){if(t.stateChange){t.stateChange.forEach((e=>{if(e.name==="dirty"){this.dirty=e.newValue}else if(e.oldValue!==e.newValue){this.triggerStateChange({newValue:undefined,oldValue:undefined,...e})}}))}}_ensureMetadata(e=""){if(!this.getMetadata("language_info")){this.sharedModel.setMetadata("language_info",{name:e})}if(!this.getMetadata("kernelspec")){this.sharedModel.setMetadata("kernelspec",{name:"",display_name:""})}}triggerStateChange(e){this._stateChanged.emit(e)}triggerContentChange(){this._contentChanged.emit(void 0);this.dirty=true}get isDisposed(){return this._isDisposed}}class E{constructor(e={}){var t,n;this._disposed=false;this._disableDocumentWideUndoRedo=(t=e.disableDocumentWideUndoRedo)!==null&&t!==void 0?t:true;this._collaborative=(n=e.collaborative)!==null&&n!==void 0?n:true}get disableDocumentWideUndoRedo(){return this._disableDocumentWideUndoRedo}set disableDocumentWideUndoRedo(e){this._disableDocumentWideUndoRedo=e}get name(){return"notebook"}get contentType(){return"notebook"}get fileFormat(){return"json"}get collaborative(){return this._collaborative}get isDisposed(){return this._disposed}dispose(){this._disposed=true}createNew(e={}){return new A({languagePreference:e.languagePreference,sharedModel:e.sharedModel,collaborationEnabled:e.collaborationEnabled&&this.collaborative,disableDocumentWideUndoRedo:this._disableDocumentWideUndoRedo})}preferredLanguage(e){return""}}function T(e){const t=(e.translator||l.nullTranslator).load("jupyterlab");return c.createElement(b.TextItem,{source:t.__("Mode: %1",e.modeNames[e.notebookMode])})}class N extends m.VDomRenderer{constructor(e){super(new N.Model);this.translator=e||l.nullTranslator;this._trans=this.translator.load("jupyterlab");this._modeNames={command:this._trans.__("Command"),edit:this._trans.__("Edit")}}render(){if(!this.model){return null}this.node.title=this._trans.__("Notebook is in %1 mode",this._modeNames[this.model.notebookMode]);return c.createElement(T,{notebookMode:this.model.notebookMode,translator:this.translator,modeNames:this._modeNames})}}(function(e){class t extends m.VDomModel{constructor(){super(...arguments);this._onChanged=e=>{const t=this._notebookMode;if(this._notebook){this._notebookMode=e.mode}else{this._notebookMode="command"}this._triggerChange(t,this._notebookMode)};this._notebookMode="command";this._notebook=null}get notebookMode(){return this._notebookMode}set notebook(e){const t=this._notebook;if(t!==null){t.stateChanged.disconnect(this._onChanged,this);t.activeCellChanged.disconnect(this._onChanged,this);t.modelContentChanged.disconnect(this._onChanged,this)}const n=this._notebookMode;this._notebook=e;if(this._notebook===null){this._notebookMode="command"}else{this._notebookMode=this._notebook.mode;this._notebook.stateChanged.connect(this._onChanged,this);this._notebook.activeCellChanged.connect(this._onChanged,this);this._notebook.modelContentChanged.connect(this._onChanged,this)}this._triggerChange(n,this._notebookMode)}_triggerChange(e,t){if(e!==t){this.stateChanged.emit(void 0)}}}e.Model=t})(N||(N={}));var P=n(52959);var H=n(97540);class D extends H.WidgetLSPAdapter{constructor(e,t){super(e,t);this.editorWidget=e;this.options=t;this._type="code";this._readyDelegate=new r.PromiseDelegate;this._editorToCell=new Map;this.editor=e.content;this._cellToEditor=new WeakMap;Promise.all([this.widget.context.sessionContext.ready,this.connectionManager.ready]).then((async()=>{await this.initOnceReady();this._readyDelegate.resolve()})).catch(console.error)}get documentPath(){return this.widget.context.path}get mimeType(){var e;let t;let n=this.language_info();if(!n||!n.mimetype){t=this.widget.content.codeMimetype}else{t=n.mimetype}return Array.isArray(t)?(e=t[0])!==null&&e!==void 0?e:P.IEditorMimeTypeService.defaultMimeType:t}get languageFileExtension(){let e=this.language_info();if(!e||!e.file_extension){return}return e.file_extension.replace(".","")}get wrapperElement(){return this.widget.node}get editors(){if(this.isDisposed){return[]}let e=this.widget.content;this._editorToCell.clear();if(e.isDisposed){return[]}return e.widgets.map((e=>({ceEditor:this._getCellEditor(e),type:e.model.type,value:e.model.sharedModel.getSource()})))}get activeEditor(){return this.editor.activeCell?this._getCellEditor(this.editor.activeCell):undefined}get ready(){return this._readyDelegate.promise}getEditorIndexAt(e){let t=this._getCellAt(e);let n=this.widget.content;return n.widgets.findIndex((e=>t===e))}getEditorIndex(e){let t=this._editorToCell.get(e);return this.editor.widgets.findIndex((e=>t===e))}getEditorWrapper(e){let t=this._editorToCell.get(e);return t.node}async onKernelChanged(e,t){if(!t.newValue){return}try{const e=this._languageInfo;await(0,H.untilReady)(this.isReady,-1);await this._updateLanguageInfo();const t=this._languageInfo;if((e===null||e===void 0?void 0:e.name)!=t.name||(e===null||e===void 0?void 0:e.mimetype)!=(t===null||t===void 0?void 0:t.mimetype)||(e===null||e===void 0?void 0:e.file_extension)!=(t===null||t===void 0?void 0:t.file_extension)){console.log(`Changed to ${this._languageInfo.name} kernel, reconnecting`);this.reloadConnection()}else{console.log("Keeping old LSP connection as the new kernel uses the same langauge")}}catch(n){console.warn(n);this.reloadConnection()}}dispose(){if(this.isDisposed){return}this.widget.context.sessionContext.kernelChanged.disconnect(this.onKernelChanged,this);this.widget.content.activeCellChanged.disconnect(this._activeCellChanged,this);super.dispose();this._editorToCell.clear();d.Signal.clearData(this)}isReady(){var e;return!this.widget.isDisposed&&this.widget.context.isReady&&this.widget.content.isVisible&&this.widget.content.widgets.length>0&&((e=this.widget.context.sessionContext.session)===null||e===void 0?void 0:e.kernel)!=null}async handleCellChange(e,t){let n=[];let i=[];const o=this._type;if(t.type==="set"){let e=[];let s=[];if(t.newValues.length===t.oldValues.length){for(let n=0;n<t.newValues.length;n++){if(t.oldValues[n].type===o&&t.newValues[n].type!==o){e.push(t.newValues[n])}else if(t.oldValues[n].type!==o&&t.newValues[n].type===o){s.push(t.newValues[n])}}n=s;i=e}}else if(t.type=="add"){n=t.newValues.filter((e=>e.type===o))}if(i.length||n.length||t.type==="set"||t.type==="move"||t.type==="remove"){await this.updateDocuments()}for(let s of n){let e=this.widget.content.widgets.find((e=>e.model.id===s.id));if(!e){console.warn(`Widget for added cell with ID: ${s.id} not found!`);continue}this._getCellEditor(e)}}createVirtualDocument(){return new H.VirtualDocument({language:this.language,foreignCodeExtractors:this.options.foreignCodeExtractorsManager,path:this.documentPath,fileExtension:this.languageFileExtension,standalone:false,hasLspSupportedFile:false})}language_info(){return this._languageInfo}async initOnceReady(){await(0,H.untilReady)(this.isReady.bind(this),-1);await this._updateLanguageInfo();this.initVirtual();this.connectDocument(this.virtualDocument,false).catch(console.warn);this.widget.context.sessionContext.kernelChanged.connect(this.onKernelChanged,this);this.widget.content.activeCellChanged.connect(this._activeCellChanged,this);this._connectModelSignals(this.widget);this.editor.modelChanged.connect((e=>{console.warn("Model changed, connecting cell change handler; this is not something we were expecting");this._connectModelSignals(e)}))}_connectModelSignals(e){if(e.model===null){console.warn(`Model is missing for notebook ${e}, cannot connect cell changed signal!`)}else{e.model.cells.changed.connect(this.handleCellChange,this)}}async _updateLanguageInfo(){var e,t,n,i;const o=(i=await((n=(t=(e=this.widget.context.sessionContext)===null||e===void 0?void 0:e.session)===null||t===void 0?void 0:t.kernel)===null||n===void 0?void 0:n.info))===null||i===void 0?void 0:i.language_info;if(o){this._languageInfo=o}else{throw new Error("Language info update failed (no session, kernel, or info available)")}}_activeCellChanged(e,t){if(!t||t.model.type!==this._type){return}this._activeEditorChanged.emit({editor:this._getCellEditor(t)})}_getCellAt(e){let t=this.virtualDocument.getEditorAtVirtualLine(e);return this._editorToCell.get(t)}_getCellEditor(e){if(!this._cellToEditor.has(e)){const t=Object.freeze({getEditor:()=>e.editor,ready:async()=>{await e.ready;return e.editor},reveal:async()=>{await this.editor.scrollToCell(e);return e.editor}});this._cellToEditor.set(e,t);this._editorToCell.set(t,e);e.disposed.connect((()=>{this._cellToEditor.delete(e);this._editorToCell.delete(t);this._editorRemoved.emit({editor:t})}));this._editorAdded.emit({editor:t})}return this._cellToEditor.get(e)}}var L=n(54999);var O=n(37917);var R=n(65178);class B extends R.Widget{constructor(){super();this._items=[];this.layout=new R.PanelLayout;this.addClass("jp-RankedPanel")}addWidget(e,t){const n={widget:e,rank:t};const i=a.ArrayExt.upperBound(this._items,n,V.itemCmp);a.ArrayExt.insert(this._items,i,n);const o=this.layout;o.insertWidget(i,e)}onChildRemoved(e){const t=a.ArrayExt.findFirstIndex(this._items,(t=>t.widget===e.child));if(t!==-1){a.ArrayExt.removeAt(this._items,t)}}}class F extends R.Widget{constructor(e){super();this.addClass("jp-NotebookTools");this.translator=e.translator||l.nullTranslator;this._tools=[];this.layout=new R.PanelLayout;this._tracker=e.tracker;this._tracker.currentChanged.connect(this._onActiveNotebookPanelChanged,this);this._tracker.activeCellChanged.connect(this._onActiveCellChanged,this);this._tracker.selectionChanged.connect(this._onSelectionChanged,this);this._onActiveNotebookPanelChanged();this._onActiveCellChanged();this._onSelectionChanged()}get activeCell(){return this._tracker.activeCell}get selectedCells(){const e=this._tracker.currentWidget;if(!e){return[]}const t=e.content;return t.widgets.filter((e=>t.isSelectedOrActive(e)))}get activeNotebookPanel(){return this._tracker.currentWidget}addItem(e){var t;const n=e.tool;const i=(t=e.rank)!==null&&t!==void 0?t:100;let o;const s=this._tools.find((t=>t.section===e.section));if(s)o=s.panel;else{throw new Error(`The section ${e.section} does not exist`)}n.addClass("jp-NotebookTools-tool");o.addWidget(n,i);n.notebookTools=this;O.MessageLoop.sendMessage(n,F.ActiveNotebookPanelMessage);O.MessageLoop.sendMessage(n,F.ActiveCellMessage)}addSection(e){var t;const n=e.sectionName;const i=e.label||e.sectionName;const o=e.tool;let s=(t=e.rank)!==null&&t!==void 0?t:null;const l=new B;l.title.label=i;if(o)l.addWidget(o,0);this._tools.push({section:n,panel:l,rank:s});if(s!=null)this.layout.insertWidget(s,new m.Collapser({widget:l}));else{let e=null;const t=this.layout;for(let n=0;n<t.widgets.length;n++){let i=t.widgets[n];if(i instanceof m.Collapser){if(i.widget.id==="advancedToolsSection"){e=n;break}}}if(e!==null)this.layout.insertWidget(e,new m.Collapser({widget:l}));else this.layout.addWidget(new m.Collapser({widget:l}))}}_onActiveNotebookPanelChanged(){if(this._prevActiveNotebookModel&&!this._prevActiveNotebookModel.isDisposed){this._prevActiveNotebookModel.metadataChanged.disconnect(this._onActiveNotebookPanelMetadataChanged,this)}const e=this.activeNotebookPanel&&this.activeNotebookPanel.content?this.activeNotebookPanel.content.model:null;this._prevActiveNotebookModel=e;if(e){e.metadataChanged.connect(this._onActiveNotebookPanelMetadataChanged,this)}for(const t of this._toolChildren()){O.MessageLoop.sendMessage(t,F.ActiveNotebookPanelMessage)}}_onActiveCellChanged(){if(this._prevActiveCell&&!this._prevActiveCell.isDisposed){this._prevActiveCell.metadataChanged.disconnect(this._onActiveCellMetadataChanged,this)}const e=this.activeCell?this.activeCell.model:null;this._prevActiveCell=e;if(e){e.metadataChanged.connect(this._onActiveCellMetadataChanged,this)}for(const t of this._toolChildren()){O.MessageLoop.sendMessage(t,F.ActiveCellMessage)}}_onSelectionChanged(){for(const e of this._toolChildren()){O.MessageLoop.sendMessage(e,F.SelectionMessage)}}_onActiveNotebookPanelMetadataChanged(e,t){const n=new L.ObservableJSON.ChangeMessage("activenotebookpanel-metadata-changed",{oldValue:undefined,newValue:undefined,...t});for(const i of this._toolChildren()){O.MessageLoop.sendMessage(i,n)}}_onActiveCellMetadataChanged(e,t){const n=new L.ObservableJSON.ChangeMessage("activecell-metadata-changed",{newValue:undefined,oldValue:undefined,...t});for(const i of this._toolChildren()){O.MessageLoop.sendMessage(i,n)}}*_toolChildren(){for(let e of this._tools){yield*e.panel.children()}}}(function(e){e.ActiveNotebookPanelMessage=new O.ConflatableMessage("activenotebookpanel-changed");e.ActiveCellMessage=new O.ConflatableMessage("activecell-changed");e.SelectionMessage=new O.ConflatableMessage("selection-changed");class t extends R.Widget{dispose(){super.dispose();if(this.notebookTools){this.notebookTools=null}}processMessage(e){super.processMessage(e);switch(e.type){case"activenotebookpanel-changed":this.onActiveNotebookPanelChanged(e);break;case"activecell-changed":this.onActiveCellChanged(e);break;case"selection-changed":this.onSelectionChanged(e);break;case"activecell-metadata-changed":this.onActiveCellMetadataChanged(e);break;case"activenotebookpanel-metadata-changed":this.onActiveNotebookPanelMetadataChanged(e);break;default:break}}onActiveNotebookPanelChanged(e){}onActiveCellChanged(e){}onSelectionChanged(e){}onActiveCellMetadataChanged(e){}onActiveNotebookPanelMetadataChanged(e){}}e.Tool=t;class n extends t{constructor(e){super();const{editorFactory:t}=e;this.addClass("jp-MetadataEditorTool");const n=this.layout=new R.PanelLayout;this._editorFactory=t;this._editorLabel=e.label||"Edit Metadata";this.createEditor();const i=new R.Widget({node:document.createElement("label")});i.node.textContent=e.label||"Edit Metadata";n.addWidget(i);n.addWidget(this.editor)}get editor(){return this._editor}onActiveNotebookPanelChanged(e){this.editor.dispose();if(this.notebookTools.activeNotebookPanel){this.createEditor()}}createEditor(){this._editor=new P.JSONEditor({editorFactory:this._editorFactory});this.editor.title.label=this._editorLabel;this.layout.addWidget(this.editor)}}e.MetadataEditorTool=n})(F||(F={}));var V;(function(e){function t(e,t){return e.rank-t.rank}e.itemCmp=t})(V||(V={}));var W=n(35627);var j=n(41252);var U=n(76838);var q=n(57807);var K=n(60796);var z=n(48130);const $="jp-mod-dropTarget";const J="jp-mod-dropSource";class G extends m.WindowedListModel{constructor(e,t){super(t);this.cells=e;this.estimateWidgetSize=e=>{const t=this.cells[e].model.sharedModel.getSource().split("\n").length;return G.DEFAULT_EDITOR_LINE_HEIGHT*t+G.DEFAULT_CELL_MARGIN};this.widgetRenderer=e=>this.cells[e];this.scrollDownThreshold=G.DEFAULT_CELL_MARGIN/2+G.DEFAULT_EDITOR_LINE_HEIGHT;this.scrollUpThreshold=G.DEFAULT_CELL_MARGIN/2;this._estimatedWidgetSize=G.DEFAULT_CELL_SIZE}}G.DEFAULT_CELL_SIZE=39;G.DEFAULT_EDITOR_LINE_HEIGHT=17;G.DEFAULT_CELL_MARGIN=22;class Y extends m.WindowedLayout{constructor(){super(...arguments);this._header=null;this._footer=null;this._willBeRemoved=null;this._topHiddenCodeCells=-1}get header(){return this._header}set header(e){var t;if(this._header&&this._header.isAttached){R.Widget.detach(this._header)}this._header=e;if(this._header&&((t=this.parent)===null||t===void 0?void 0:t.isAttached)){R.Widget.attach(this._header,this.parent.node)}}get footer(){return this._footer}set footer(e){var t;if(this._footer&&this._footer.isAttached){R.Widget.detach(this._footer)}this._footer=e;if(this._footer&&((t=this.parent)===null||t===void 0?void 0:t.isAttached)){R.Widget.attach(this._footer,this.parent.outerNode)}}get activeCell(){return this._activeCell}set activeCell(e){this._activeCell=e}dispose(){var e,t;if(this.isDisposed){return}(e=this._header)===null||e===void 0?void 0:e.dispose();(t=this._footer)===null||t===void 0?void 0:t.dispose();super.dispose()}removeWidget(e){const t=this.widgets.indexOf(e);if(t>=0){this.removeWidgetAt(t)}else if(e===this._willBeRemoved&&this.parent){this.detachWidget(t,e)}}attachWidget(e,t){const n=t.isPlaceholder();const i=this._isSoftHidden(t);if(this.parent.isAttached&&!i){O.MessageLoop.sendMessage(t,R.Widget.Msg.BeforeAttach)}if(i){this._toggleSoftVisibility(t,true)}if(!n&&t instanceof o.CodeCell&&t.node.parentElement){t.node.style.display="";this._topHiddenCodeCells=-1}else if(!i){const e=this._findNearestChildBinarySearch(this.parent.viewportNode.childElementCount-1,0,parseInt(t.dataset.windowedListIndex,10)+1);let n=this.parent.viewportNode.children[e];this.parent.viewportNode.insertBefore(t.node,n);if(this.parent.isAttached){O.MessageLoop.sendMessage(t,R.Widget.Msg.AfterAttach)}}t.inViewport=true}detachWidget(e,t){t.inViewport=false;if(t===this.activeCell){this._toggleSoftVisibility(t,false);return}if(t instanceof o.CodeCell&&!t.node.classList.contains(J)&&t!==this._willBeRemoved){t.node.style.display="none";this._topHiddenCodeCells=-1}else{if(this.parent.isAttached){O.MessageLoop.sendMessage(t,R.Widget.Msg.BeforeDetach)}this.parent.viewportNode.removeChild(t.node);t.node.classList.remove($)}if(this.parent.isAttached){O.MessageLoop.sendMessage(t,R.Widget.Msg.AfterDetach)}}moveWidget(e,t,n){if(this._topHiddenCodeCells<0){this._topHiddenCodeCells=0;for(let e=0;e<this.parent.viewportNode.children.length;e++){const t=this.parent.viewportNode.children[e];if(t.style.display=="none"){this._topHiddenCodeCells++}else{break}}}const i=this.parent.viewportNode.children[t+this._topHiddenCodeCells];if(e<t){i.insertAdjacentElement("afterend",n.node)}else{i.insertAdjacentElement("beforebegin",n.node)}}onAfterAttach(e){super.onAfterAttach(e);if(this._header&&!this._header.isAttached){R.Widget.attach(this._header,this.parent.node,this.parent.node.firstElementChild)}if(this._footer&&!this._footer.isAttached){R.Widget.attach(this._footer,this.parent.outerNode)}}onBeforeDetach(e){var t,n;if((t=this._header)===null||t===void 0?void 0:t.isAttached){R.Widget.detach(this._header)}if((n=this._footer)===null||n===void 0?void 0:n.isAttached){R.Widget.detach(this._footer)}super.onBeforeDetach(e)}onChildRemoved(e){this._willBeRemoved=e.child;super.onChildRemoved(e);this._willBeRemoved=null}_toggleSoftVisibility(e,t){if(t){e.node.style.opacity="";e.node.style.height="";e.node.style.padding=""}else{e.node.style.opacity="0";e.node.style.height="0";e.node.style.padding="0"}}_isSoftHidden(e){return e.node.style.opacity==="0"}_findNearestChildBinarySearch(e,t,n){while(t<=e){const i=t+Math.floor((e-t)/2);const o=parseInt(this.parent.viewportNode.children[i].dataset.windowedListIndex,10);if(o===n){return i}else if(o<n){t=i+1}else if(o>n){e=i-1}}if(t>0){return t}else{return 0}}}const Q="jp-Notebook-footer";class X extends R.Widget{constructor(e){super({node:document.createElement("button")});this.notebook=e;const t=e.translator.load("jupyterlab");this.addClass(Q);this.node.setAttribute("tabindex","-1");this.node.innerText=t.__("Click to add a cell.")}handleEvent(e){switch(e.type){case"click":this.onClick();break;case"keydown":if(e.key==="ArrowUp"){this.onArrowUp();break}}}onClick(){if(this.notebook.widgets.length>0){this.notebook.activeCellIndex=this.notebook.widgets.length-1}f.insertBelow(this.notebook);void f.focusActiveCell(this.notebook)}onArrowUp(){}onAfterAttach(e){super.onAfterAttach(e);this.node.addEventListener("click",this);this.node.addEventListener("keydown",this)}onBeforeDetach(e){this.node.removeEventListener("click",this);this.node.removeEventListener("keydown",this);super.onBeforeDetach(e)}}const Z="jpKernelUser";const ee="jpCodeRunner";const te="jpUndoer";const ne="jp-Notebook";const ie="jp-Notebook-cell";const oe="jp-mod-editMode";const se="jp-mod-commandMode";const le="jp-mod-active";const ae="jp-mod-selected";const re="jp-mod-multiSelected";const de="jp-mod-unconfined";const ce="jp-dragImage";const he="jp-dragImage-singlePrompt";const ue="jp-dragImage-content";const ge="jp-dragImage-prompt";const fe="jp-dragImage-multipleBack";const Ce="application/vnd.jupyter.cells";const ve=5;const me=50;const pe="jp-collapseHeadingButton";const _e="jp-mod-showHiddenCellsButton";const we="jp-mod-sideBySide";if(window.requestIdleCallback===undefined){window.requestIdleCallback=function(e){let t=Date.now();return setTimeout((function(){e({didTimeout:false,timeRemaining:function(){return Math.max(0,50-(Date.now()-t))}})}),1)};window.cancelIdleCallback=function(e){clearTimeout(e)}}class ye extends m.WindowedList{constructor(e){var t,n,i,o,s,a;const r=new Array;const c=((n=(t=e.notebookConfig)===null||t===void 0?void 0:t.windowingMode)!==null&&n!==void 0?n:ye.defaultNotebookConfig.windowingMode)==="full";super({model:new G(r,{overscanCount:(o=(i=e.notebookConfig)===null||i===void 0?void 0:i.overscanCount)!==null&&o!==void 0?o:ye.defaultNotebookConfig.overscanCount,windowingActive:c}),layout:new Y,renderer:(s=e.renderer)!==null&&s!==void 0?s:m.WindowedList.defaultRenderer,scrollbar:false});this._cellCollapsed=new d.Signal(this);this._cellInViewportChanged=new d.Signal(this);this._renderingLayoutChanged=new d.Signal(this);this.addClass(ne);this.cellsArray=r;this._idleCallBack=null;this._editorConfig=ye.defaultEditorConfig;this._notebookConfig=ye.defaultNotebookConfig;this._mimetype=P.IEditorMimeTypeService.defaultMimeType;this._notebookModel=null;this._modelChanged=new d.Signal(this);this._modelContentChanged=new d.Signal(this);this.node.dataset[Z]="true";this.node.dataset[te]="true";this.node.dataset[ee]="true";this.rendermime=e.rendermime;this.translator=e.translator||l.nullTranslator;this.contentFactory=e.contentFactory;this.editorConfig=e.editorConfig||ye.defaultEditorConfig;this.notebookConfig=e.notebookConfig||ye.defaultNotebookConfig;this._updateNotebookConfig();this._mimetypeService=e.mimeTypeService;this.renderingLayout=(a=e.notebookConfig)===null||a===void 0?void 0:a.renderingLayout;this.kernelHistory=e.kernelHistory}get cellCollapsed(){return this._cellCollapsed}get cellInViewportChanged(){return this._cellInViewportChanged}get modelChanged(){return this._modelChanged}get modelContentChanged(){return this._modelContentChanged}get renderingLayoutChanged(){return this._renderingLayoutChanged}get model(){return this._notebookModel}set model(e){var t;e=e||null;if(this._notebookModel===e){return}const n=this._notebookModel;this._notebookModel=e;this._onModelChanged(n,e);this.onModelChanged(n,e);this._modelChanged.emit(void 0);this.viewModel.itemsList=(t=e===null||e===void 0?void 0:e.cells)!==null&&t!==void 0?t:null}get codeMimetype(){return this._mimetype}get widgets(){return this.cellsArray}get editorConfig(){return this._editorConfig}set editorConfig(e){this._editorConfig=e;this._updateEditorConfig()}get notebookConfig(){return this._notebookConfig}set notebookConfig(e){this._notebookConfig=e;this._updateNotebookConfig()}get renderingLayout(){return this._renderingLayout}set renderingLayout(e){var t;this._renderingLayout=e;if(this._renderingLayout==="side-by-side"){this.node.classList.add(we)}else{this.node.classList.remove(we)}this._renderingLayoutChanged.emit((t=this._renderingLayout)!==null&&t!==void 0?t:"default")}dispose(){var e;if(this.isDisposed){return}this._notebookModel=null;(e=this.layout.header)===null||e===void 0?void 0:e.dispose();super.dispose()}moveCell(e,t,n=1){if(!this.model){return}const i=Math.min(this.model.cells.length-1,Math.max(0,t));if(i===e){return}const o=new Array(n);for(let s=0;s<n;s++){o[s]={};const t=this.widgets[e+s];if(t.model.type==="markdown"){for(const e of["rendered","headingCollapsed"]){o[s][e]=t[e]}}}this.model.sharedModel.moveCells(e,i,n);for(let s=0;s<n;s++){const e=this.widgets[t+s];const n=o[s];for(const t in n){e[t]=n[t]}}}renderCellOutputs(e){const t=this.viewModel.widgetRenderer(e);if(t instanceof o.CodeCell&&t.isPlaceholder()){t.dataset.windowedListIndex=`${e}`;this.layout.insertWidget(e,t);if(this.notebookConfig.windowingMode==="full"){requestAnimationFrame((()=>{this.layout.removeWidget(t)}))}}}addHeader(){const e=this.translator.load("jupyterlab");const t=new R.Widget;t.node.textContent=e.__("The notebook is empty. Click the + button on the toolbar to add a new cell.");this.layout.header=t}removeHeader(){var e;(e=this.layout.header)===null||e===void 0?void 0:e.dispose();this.layout.header=null}onModelChanged(e,t){}onModelContentChanged(e,t){this._modelContentChanged.emit(void 0)}onMetadataChanged(e,t){switch(t.key){case"language_info":this._updateMimetype();break;default:break}}onCellInserted(e,t){}onCellRemoved(e,t){}onUpdateRequest(e){if(this.notebookConfig.windowingMode==="defer"){void this._runOnIdleTime()}else{super.onUpdateRequest(e)}}_onModelChanged(e,t){var n;if(e){e.contentChanged.disconnect(this.onModelContentChanged,this);e.metadataChanged.disconnect(this.onMetadataChanged,this);e.cells.changed.disconnect(this._onCellsChanged,this);while(this.cellsArray.length){this._removeCell(0)}}if(!t){this._mimetype=P.IEditorMimeTypeService.defaultMimeType;return}this._updateMimetype();const i=t.cells;const o=(n=t.collaborative)!==null&&n!==void 0?n:false;if(!o&&!i.length){t.sharedModel.insertCell(0,{cell_type:this.notebookConfig.defaultCell,metadata:this.notebookConfig.defaultCell==="code"?{trusted:true}:{}})}let s=-1;for(const l of i){this._insertCell(++s,l)}t.cells.changed.connect(this._onCellsChanged,this);t.metadataChanged.connect(this.onMetadataChanged,this);t.contentChanged.connect(this.onModelContentChanged,this)}_onCellsChanged(e,t){this.removeHeader();switch(t.type){case"add":{let e=0;e=t.newIndex;for(const n of t.newValues){this._insertCell(e++,n)}this._updateDataWindowedListIndex(t.newIndex,this.model.cells.length,t.newValues.length);break}case"remove":for(let e=t.oldValues.length;e>0;e--){this._removeCell(t.oldIndex)}this._updateDataWindowedListIndex(t.oldIndex,this.model.cells.length+t.oldValues.length,-1*t.oldValues.length);if(!e.length){const e=this.model;requestAnimationFrame((()=>{if(e&&!e.isDisposed&&!e.sharedModel.cells.length){e.sharedModel.insertCell(0,{cell_type:this.notebookConfig.defaultCell,metadata:this.notebookConfig.defaultCell==="code"?{trusted:true}:{}})}}))}break;default:return}if(!this.model.sharedModel.cells.length){this.addHeader()}this.update()}_insertCell(e,t){let n;switch(t.type){case"code":n=this._createCodeCell(t);n.model.mimeType=this._mimetype;break;case"markdown":n=this._createMarkdownCell(t);if(t.sharedModel.getSource()===""){n.rendered=false}break;default:n=this._createRawCell(t)}n.inViewportChanged.connect(this._onCellInViewportChanged,this);n.addClass(ie);a.ArrayExt.insert(this.cellsArray,e,n);this.onCellInserted(e,n);this._scheduleCellRenderOnIdle()}_createCodeCell(e){const t=this.rendermime;const n=this.contentFactory;const i=this.editorConfig.code;const o={contentFactory:n,editorConfig:i,inputHistoryScope:this.notebookConfig.inputHistoryScope,maxNumberOutputs:this.notebookConfig.maxNumberOutputs,model:e,placeholder:this._notebookConfig.windowingMode!=="none",rendermime:t,translator:this.translator};const s=this.contentFactory.createCodeCell(o);s.syncCollapse=true;s.syncEditable=true;s.syncScrolled=true;s.outputArea.inputRequested.connect(((e,t)=>{this._onInputRequested(s).catch((e=>{console.error("Failed to scroll to cell requesting input.",e)}));t.disposed.connect((()=>{s.node.focus()}))}));return s}_createMarkdownCell(e){const t=this.rendermime;const n=this.contentFactory;const i=this.editorConfig.markdown;const o={contentFactory:n,editorConfig:i,model:e,placeholder:this._notebookConfig.windowingMode!=="none",rendermime:t,showEditorForReadOnlyMarkdown:this._notebookConfig.showEditorForReadOnlyMarkdown};const s=this.contentFactory.createMarkdownCell(o);s.syncCollapse=true;s.syncEditable=true;s.headingCollapsedChanged.connect(this._onCellCollapsed,this);return s}_createRawCell(e){const t=this.contentFactory;const n=this.editorConfig.raw;const i={editorConfig:n,model:e,contentFactory:t,placeholder:this._notebookConfig.windowingMode!=="none"};const o=this.contentFactory.createRawCell(i);o.syncCollapse=true;o.syncEditable=true;return o}_removeCell(e){const t=this.cellsArray[e];t.parent=null;a.ArrayExt.removeAt(this.cellsArray,e);this.onCellRemoved(e,t);t.dispose()}_updateMimetype(){var e;const t=(e=this._notebookModel)===null||e===void 0?void 0:e.getMetadata("language_info");if(!t){return}this._mimetype=this._mimetypeService.getMimeTypeByLanguage(t);for(const n of this.widgets){if(n.model.type==="code"){n.model.mimeType=this._mimetype}}}_onCellCollapsed(e,t){f.setHeadingCollapse(e,t,this);this._cellCollapsed.emit(e)}_onCellInViewportChanged(e){this._cellInViewportChanged.emit(e)}async _onInputRequested(e){if(!e.inViewport){const t=this.widgets.findIndex((t=>t===e));if(t>=0){await this.scrollToItem(t);const n=e.node.querySelector(".jp-Stdin");if(n){U.ElementExt.scrollIntoViewIfNeeded(this.node,n);n.focus()}}}}_scheduleCellRenderOnIdle(){if(this.notebookConfig.windowingMode!=="none"&&!this.isDisposed){if(!this._idleCallBack){this._idleCallBack=requestIdleCallback((e=>{this._idleCallBack=null;void this._runOnIdleTime(e.didTimeout?me:e.timeRemaining())}),{timeout:3e3})}}}_updateDataWindowedListIndex(e,t,n){for(let i=0;i<this.viewportNode.childElementCount;i++){const o=this.viewportNode.children[i];const s=parseInt(o.dataset.windowedListIndex,10);if(s>=e&&s<t){o.dataset.windowedListIndex=`${s+n}`}}}_updateEditorConfig(){for(let e=0;e<this.widgets.length;e++){const t=this.widgets[e];let n={};switch(t.model.type){case"code":n=this._editorConfig.code;break;case"markdown":n=this._editorConfig.markdown;break;default:n=this._editorConfig.raw;break}t.updateEditorConfig({...n})}}async _runOnIdleTime(e=me){const t=Date.now();let n=0;while(Date.now()-t<e&&n<this.cellsArray.length){const e=this.cellsArray[n];if(e.isPlaceholder()){switch(this.notebookConfig.windowingMode){case"defer":await this._updateForDeferMode(e,n);break;case"full":this._renderCSSAndJSOutputs(e,n);break}}n++}if(n<this.cellsArray.length){if(this.notebookConfig.windowingMode==="defer"&&this.viewportNode.clientHeight<this.node.clientHeight){await this._runOnIdleTime()}else{this._scheduleCellRenderOnIdle()}}else{if(this._idleCallBack){window.cancelIdleCallback(this._idleCallBack);this._idleCallBack=null}}}async _updateForDeferMode(e,t){e.dataset.windowedListIndex=`${t}`;this.layout.insertWidget(t,e);await e.ready}_renderCSSAndJSOutputs(e,t){var n,i,s;if(e instanceof o.CodeCell){for(let o=0;o<((i=(n=e.model.outputs)===null||n===void 0?void 0:n.length)!==null&&i!==void 0?i:0);o++){const n=e.model.outputs.get(o);const i=(s=n.data["text/html"])!==null&&s!==void 0?s:"";if(i.match(/(<style[^>]*>[^<]*<\/style[^>]*>|<script[^>]*>.*?<\/script[^>]*>)/gims)){this.renderCellOutputs(t);break}}}}_updateNotebookConfig(){this.toggleClass("jp-mod-scrollPastEnd",this._notebookConfig.scrollPastEnd);this.toggleClass(_e,this._notebookConfig.showHiddenCellsButton);const e=this._notebookConfig.showEditorForReadOnlyMarkdown;if(e!==undefined){for(const t of this.cellsArray){if(t.model.type==="markdown"){t.showEditorForReadOnly=e}}}this.viewModel.windowingActive=this._notebookConfig.windowingMode==="full"}}(function(e){e.defaultEditorConfig={code:{lineNumbers:false,lineWrap:false,matchBrackets:true,tabFocusable:false},markdown:{lineNumbers:false,lineWrap:true,matchBrackets:false,tabFocusable:false},raw:{lineNumbers:false,lineWrap:true,matchBrackets:false,tabFocusable:false}};e.defaultNotebookConfig={enableKernelInitNotification:false,showHiddenCellsButton:true,scrollPastEnd:true,defaultCell:"code",recordTiming:false,inputHistoryScope:"global",maxNumberOutputs:50,showEditorForReadOnlyMarkdown:true,disableDocumentWideUndoRedo:true,renderingLayout:"default",sideBySideLeftMarginOverride:"10px",sideBySideRightMarginOverride:"10px",sideBySideOutputRatio:1,overscanCount:1,windowingMode:"full",accessKernelHistory:false};class t extends o.Cell.ContentFactory{createCodeCell(e){return new o.CodeCell(e).initializeState()}createMarkdownCell(e){return new o.MarkdownCell(e).initializeState()}createRawCell(e){return new o.RawCell(e).initializeState()}}e.ContentFactory=t})(ye||(ye={}));class be extends ye{constructor(e){super({renderer:{createOuter(){return document.createElement("div")},createViewport(){const e=document.createElement("div");e.setAttribute("role","feed");e.setAttribute("aria-label","Cells");return e},createScrollbar(){return document.createElement("ol")},createScrollbarItem(e,t,n){const i=document.createElement("li");i.appendChild(document.createTextNode(`${t+1}`));if(e.activeCellIndex===t){i.classList.add("jp-mod-active")}if(e.selectedCells.some((e=>n===e.model))){i.classList.add("jp-mod-selected")}return i}},...e});this._activeCellIndex=-1;this._activeCell=null;this._mode="command";this._drag=null;this._dragData=null;this._mouseMode=null;this._activeCellChanged=new d.Signal(this);this._stateChanged=new d.Signal(this);this._selectionChanged=new d.Signal(this);this._checkCacheOnNextResize=false;this._lastClipboardInteraction=null;this._selectedCells=[];this.node.setAttribute("data-lm-dragscroll","true");this.activeCellChanged.connect(this._updateSelectedCells,this);this.jumped.connect(((e,t)=>this.activeCellIndex=t));this.selectionChanged.connect(this._updateSelectedCells,this);this.addFooter()}get selectedCells(){return this._selectedCells}addFooter(){const e=new X(this);this.layout.footer=e}_onCellsChanged(e,t){var n,i;const o=(n=this.activeCell)===null||n===void 0?void 0:n.model.id;super._onCellsChanged(e,t);if(o){const e=(i=this.model)===null||i===void 0?void 0:i.sharedModel.cells.findIndex((e=>e.getId()===o));if(e!=null){this.activeCellIndex=e}}}get activeCellChanged(){return this._activeCellChanged}get stateChanged(){return this._stateChanged}get selectionChanged(){return this._selectionChanged}get mode(){return this._mode}set mode(e){this.setMode(e)}setMode(e,t={}){var n;const i=(n=t.focus)!==null&&n!==void 0?n:true;const s=this.activeCell;if(!s){e="command"}if(e===this._mode){if(i){this._ensureFocus()}return}this.update();const l=this._mode;this._mode=e;if(e==="edit"){for(const e of this.widgets){this.deselect(e)}if(s instanceof o.MarkdownCell){s.rendered=false}s.inputHidden=false}else{if(i){void f.focusActiveCell(this,{waitUntilReady:false,preventScroll:true})}}this._stateChanged.emit({name:"mode",oldValue:l,newValue:e});if(i){this._ensureFocus()}}get activeCellIndex(){if(!this.model){return-1}return this.widgets.length?this._activeCellIndex:-1}set activeCellIndex(e){var t,n,i;const l=this._activeCellIndex;if(!this.model||!this.widgets.length){e=-1}else{e=Math.max(e,0);e=Math.min(e,this.widgets.length-1)}this._activeCellIndex=e;const a=(t=this.widgets[e])!==null&&t!==void 0?t:null;this.layout.activeCell=a;const r=a!==this._activeCell;if(r){this.update();this._activeCell=a}if(r||e!=l){this._activeCellChanged.emit(a)}if(this.mode==="edit"&&a instanceof o.MarkdownCell){a.rendered=false}this._ensureFocus();if(e===l){return}this._trimSelections();this._stateChanged.emit({name:"activeCellIndex",oldValue:l,newValue:e});console.log("this.mode",(n=this.model)===null||n===void 0?void 0:n.sharedModel);const d=s.PageConfig.getOption("disable_rtc")=="true"?false:true;console.log("collaborative",d);((i=this.model)===null||i===void 0?void 0:i.sharedModel).notifyActiveCellIndex(l,e)}get activeCell(){return this._activeCell}get lastClipboardInteraction(){return this._lastClipboardInteraction}set lastClipboardInteraction(e){this._lastClipboardInteraction=e}dispose(){if(this.isDisposed){return}this._activeCell=null;super.dispose()}moveCell(e,t,n=1){const i=e<=this.activeCellIndex&&this.activeCellIndex<e+n?this.activeCellIndex+t-e-(e>t?0:n-1):-1;const o=this.widgets.slice(e,e+n).map((e=>this.isSelected(e)));super.moveCell(e,t,n);if(i>=0){this.activeCellIndex=i}if(e>t){o.forEach(((e,n)=>{if(e){this.select(this.widgets[t+n])}}))}else{o.forEach(((e,i)=>{if(e){this.select(this.widgets[t-n+1+i])}}))}}select(e){if(ke.selectedProperty.get(e)){return}ke.selectedProperty.set(e,true);this._selectionChanged.emit(void 0);this.update()}deselect(e){if(!ke.selectedProperty.get(e)){return}ke.selectedProperty.set(e,false);this._selectionChanged.emit(void 0);this.update()}isSelected(e){return ke.selectedProperty.get(e)}isSelectedOrActive(e){if(e===this._activeCell){return true}return ke.selectedProperty.get(e)}deselectAll(){let e=false;for(const t of this.widgets){if(ke.selectedProperty.get(t)){e=true}ke.selectedProperty.set(t,false)}if(e){this._selectionChanged.emit(void 0)}this.activeCellIndex=this.activeCellIndex;this.update()}extendContiguousSelectionTo(e){let{head:t,anchor:n}=this.getContiguousSelection();let i;if(n===null||t===null){if(e===this.activeCellIndex){return}t=this.activeCellIndex;n=this.activeCellIndex}this.activeCellIndex=e;e=this.activeCellIndex;if(e===n){this.deselectAll();return}let o=false;if(t<e){if(t<n){ke.selectedProperty.set(this.widgets[t],false);o=true}for(i=t+1;i<e;i++){if(i!==n){ke.selectedProperty.set(this.widgets[i],!ke.selectedProperty.get(this.widgets[i]));o=true}}}else if(e<t){if(n<t){ke.selectedProperty.set(this.widgets[t],false);o=true}for(i=e+1;i<t;i++){if(i!==n){ke.selectedProperty.set(this.widgets[i],!ke.selectedProperty.get(this.widgets[i]));o=true}}}if(!ke.selectedProperty.get(this.widgets[n])){o=true}ke.selectedProperty.set(this.widgets[n],true);if(!ke.selectedProperty.get(this.widgets[e])){o=true}ke.selectedProperty.set(this.widgets[e],true);if(o){this._selectionChanged.emit(void 0)}}getContiguousSelection(){const e=this.widgets;const t=a.ArrayExt.findFirstIndex(e,(e=>this.isSelected(e)));if(t===-1){return{head:null,anchor:null}}const n=a.ArrayExt.findLastIndex(e,(e=>this.isSelected(e)),-1,t);for(let o=t;o<=n;o++){if(!this.isSelected(e[o])){throw new Error("Selection not contiguous")}}const i=this.activeCellIndex;if(t!==i&&n!==i){throw new Error("Active cell not at endpoint of selection")}if(t===i){return{head:t,anchor:n}}else{return{head:n,anchor:t}}}async scrollToCell(e,t="auto"){try{await this.scrollToItem(this.widgets.findIndex((t=>t===e)),t)}catch(n){}this.deselectAll();this.select(e);e.activate()}_parseFragment(e){const t=e.slice(1);if(!t){return}const n=t.split("=");if(n.length===1){return{kind:"heading",value:t}}return{kind:n[0],value:n.slice(1).join("=")}}async setFragment(e){const t=this._parseFragment(e);if(!t){return}let n;switch(t.kind){case"heading":n=await this._findHeading(t.value);break;case"cell-id":n=this._findCellById(t.value);break;default:console.warn(`Unknown target type for URI fragment ${e}, interpreting as a heading`);n=await this._findHeading(t.kind+"="+t.value);break}if(n==null){return}let{cell:i,element:o}=n;if(!i.inViewport){await this.scrollToCell(i,"center")}if(o==null){o=i.node}const s=this.node.getBoundingClientRect();const l=o.getBoundingClientRect();if(l.top>s.bottom||l.bottom<s.top){o.scrollIntoView({block:"center"})}}handleEvent(e){if(!this.model){return}switch(e.type){case"contextmenu":if(e.eventPhase===Event.CAPTURING_PHASE){this._evtContextMenuCapture(e)}break;case"mousedown":if(e.eventPhase===Event.CAPTURING_PHASE){this._evtMouseDownCapture(e)}else{if(!e.defaultPrevented){this._evtMouseDown(e)}}break;case"mouseup":if(e.currentTarget===document){this._evtDocumentMouseup(e)}break;case"mousemove":if(e.currentTarget===document){this._evtDocumentMousemove(e)}break;case"keydown":this._ensureFocus(true);break;case"dblclick":this._evtDblClick(e);break;case"focusin":this._evtFocusIn(e);break;case"focusout":this._evtFocusOut(e);break;case"lm-dragenter":this._evtDragEnter(e);break;case"lm-dragleave":this._evtDragLeave(e);break;case"lm-dragover":this._evtDragOver(e);break;case"lm-drop":this._evtDrop(e);break;default:super.handleEvent(e);break}}onAfterAttach(e){super.onAfterAttach(e);const t=this.node;t.addEventListener("contextmenu",this,true);t.addEventListener("mousedown",this,true);t.addEventListener("mousedown",this);t.addEventListener("keydown",this);t.addEventListener("dblclick",this);t.addEventListener("focusin",this);t.addEventListener("focusout",this);t.addEventListener("lm-dragenter",this,true);t.addEventListener("lm-dragleave",this,true);t.addEventListener("lm-dragover",this,true);t.addEventListener("lm-drop",this,true)}onBeforeDetach(e){const t=this.node;t.removeEventListener("contextmenu",this,true);t.removeEventListener("mousedown",this,true);t.removeEventListener("mousedown",this);t.removeEventListener("keydown",this);t.removeEventListener("dblclick",this);t.removeEventListener("focusin",this);t.removeEventListener("focusout",this);t.removeEventListener("lm-dragenter",this,true);t.removeEventListener("lm-dragleave",this,true);t.removeEventListener("lm-dragover",this,true);t.removeEventListener("lm-drop",this,true);document.removeEventListener("mousemove",this,true);document.removeEventListener("mouseup",this,true);super.onBeforeAttach(e)}onAfterShow(e){super.onAfterShow(e);this._checkCacheOnNextResize=true}onResize(e){var t;if(!this._checkCacheOnNextResize){return super.onResize(e)}super.onResize(e);this._checkCacheOnNextResize=false;const n=this._cellLayoutStateCache;const i=parseInt(this.node.style.width,10);if(n){if(i===n.width){return}}this._cellLayoutStateCache={width:i};for(const s of this.widgets){if(s instanceof o.Cell&&s.inViewport){(t=s.editorWidget)===null||t===void 0?void 0:t.update()}}}onBeforeHide(e){super.onBeforeHide(e);const t=parseInt(this.node.style.width,10);this._cellLayoutStateCache={width:t}}onActivateRequest(e){super.onActivateRequest(e);this._ensureFocus(true)}onUpdateRequest(e){super.onUpdateRequest(e);const t=this.activeCell;if(this.mode==="edit"){this.addClass(oe);this.removeClass(se)}else{this.addClass(se);this.removeClass(oe)}let n=0;for(const i of this.widgets){i.node.tabIndex=-1;i.removeClass(le);i.removeClass(re);if(this.isSelectedOrActive(i)){i.addClass(ae);n++}else{i.removeClass(ae)}}if(t){t.addClass(le);t.addClass(ae);t.node.tabIndex=0;if(n>1){t.addClass(re)}}}onCellInserted(e,t){void t.ready.then((()=>{if(!t.isDisposed){t.editor.edgeRequested.connect(this._onEdgeRequest,this)}}));this.activeCellIndex=e<=this.activeCellIndex?this.activeCellIndex+1:this.activeCellIndex}onCellRemoved(e,t){this.activeCellIndex=e<=this.activeCellIndex?this.activeCellIndex-1:this.activeCellIndex;if(this.isSelected(t)){this._selectionChanged.emit(void 0)}}onModelChanged(e,t){super.onModelChanged(e,t);this.activeCellIndex=0}_onEdgeRequest(e,t){const n=this.activeCellIndex;if(t==="top"){this.activeCellIndex--;if(this.activeCellIndex<n){const e=this.activeCell.editor;if(e){const t=e.lineCount-1;e.setCursorPosition({line:t,column:0})}}}else if(t==="bottom"){this.activeCellIndex++;if(this.activeCellIndex>n){const e=this.activeCell.editor;if(e){e.setCursorPosition({line:0,column:0})}}}this.mode="edit"}_ensureFocus(e=false){var t,n;const i=this.layout.footer;if(i&&document.activeElement===i.node){return}const o=this.activeCell;if(this.mode==="edit"&&o){if(((t=o.editor)===null||t===void 0?void 0:t.hasFocus())!==true||!o.inViewport){if(o.inViewport){(n=o.editor)===null||n===void 0?void 0:n.focus()}else{this.scrollToItem(this.activeCellIndex).then((()=>{void o.ready.then((()=>{var e;(e=o.editor)===null||e===void 0?void 0:e.focus()}))})).catch((e=>{}))}}}if(e&&o&&!o.node.contains(document.activeElement)){void f.focusActiveCell(this,{preventScroll:true})}}_findCell(e){let t=e;while(t&&t!==this.node){if(t.classList.contains(ie)){const e=a.ArrayExt.findFirstIndex(this.widgets,(e=>e.node===t));if(e!==-1){return e}break}t=t.parentElement}return-1}_findEventTargetAndCell(e){let t=e.target;let n=this._findCell(t);if(n===-1){t=document.elementFromPoint(e.clientX,e.clientY);n=this._findCell(t)}return[t,n]}async _findHeading(e){for(let t=0;t<this.widgets.length;t++){const n=this.widgets[t];if(n.model.type==="raw"||n.model.type==="markdown"&&!n.rendered){continue}for(const t of n.headings){let i="";switch(t.type){case o.Cell.HeadingType.HTML:i=t.id;break;case o.Cell.HeadingType.Markdown:{const e=t;i=await j.TableOfContentsUtils.Markdown.getHeadingId(this.rendermime.markdownParser,e.raw,e.level,this.rendermime.sanitizer)}break}if(i===e){const e=this.node.querySelector(`h${t.level}[id="${CSS.escape(i)}"]`);return{cell:n,element:e}}}}return null}_findCellById(e){for(let t=0;t<this.widgets.length;t++){const n=this.widgets[t];if(n.model.id===e){return{cell:n}}}return null}_evtContextMenuCapture(e){var t;if(e.shiftKey){return}const[n,i]=this._findEventTargetAndCell(e);const o=this.widgets[i];if(o&&((t=o.editorWidget)===null||t===void 0?void 0:t.node.contains(n))){e.preventDefault()}}_evtMouseDownCapture(e){var t;const{button:n,shiftKey:i}=e;const[o,s]=this._findEventTargetAndCell(e);const l=this.widgets[s];if(n===2&&!i&&l&&((t=l.editorWidget)===null||t===void 0?void 0:t.node.contains(o))){this.mode="command";e.preventDefault()}}_evtMouseDown(e){var t,n,i;const{button:o,shiftKey:s}=e;if(!(o===0||o===2)){return}if(s&&o===2){return}const[l,a]=this._findEventTargetAndCell(e);const r=this.widgets[a];let d;if(r){if((t=r.editorWidget)===null||t===void 0?void 0:t.node.contains(l)){d="input"}else if((n=r.promptNode)===null||n===void 0?void 0:n.contains(l)){d="prompt"}else{d="cell"}}else{d="notebook"}if(d!=="input"){this.mode="command"}if(d==="notebook"){this.deselectAll()}else if(d==="prompt"||d==="cell"){const t=((i=window.getSelection())!==null&&i!==void 0?i:"").toString()!=="";if(o===0&&s&&!t&&!["INPUT","OPTION"].includes(l.tagName)){e.preventDefault();try{this.extendContiguousSelectionTo(a)}catch(c){console.error(c);this.deselectAll();return}this._mouseMode="select";document.addEventListener("mouseup",this,true);document.addEventListener("mousemove",this,true)}else if(o===0&&!s){if(d==="prompt"){this._dragData={pressX:e.clientX,pressY:e.clientY,index:a};this._mouseMode="couldDrag";document.addEventListener("mouseup",this,true);document.addEventListener("mousemove",this,true);e.preventDefault()}if(!this.isSelectedOrActive(r)){this.deselectAll();this.activeCellIndex=a}}else if(o===2){if(!this.isSelectedOrActive(r)){this.deselectAll();this.activeCellIndex=a}e.preventDefault()}}else if(d==="input"){if(o===2&&!this.isSelectedOrActive(r)){this.deselectAll();this.activeCellIndex=a}}this._ensureFocus(true)}_evtDocumentMouseup(e){e.preventDefault();e.stopPropagation();document.removeEventListener("mousemove",this,true);document.removeEventListener("mouseup",this,true);if(this._mouseMode==="couldDrag"){const[,t]=this._findEventTargetAndCell(e);this.deselectAll();this.activeCellIndex=t;if(!this.activeCell.node.contains(document.activeElement)){void f.focusActiveCell(this)}}this._mouseMode=null}_evtDocumentMousemove(e){e.preventDefault();e.stopPropagation();switch(this._mouseMode){case"select":{const t=e.target;const n=this._findCell(t);if(n!==-1){this.extendContiguousSelectionTo(n)}break}case"couldDrag":{const t=this._dragData;const n=Math.abs(e.clientX-t.pressX);const i=Math.abs(e.clientY-t.pressY);if(n>=ve||i>=ve){this._mouseMode=null;this._startDrag(t.index,e.clientX,e.clientY)}break}default:break}}_evtDragEnter(e){if(!e.mimeData.hasData(Ce)){return}e.preventDefault();e.stopPropagation();const t=e.target;const n=this._findCell(t);if(n===-1){return}const i=this.cellsArray[n];i.node.classList.add($)}_evtDragLeave(e){if(!e.mimeData.hasData(Ce)){return}e.preventDefault();e.stopPropagation();const t=this.node.getElementsByClassName($);if(t.length){t[0].classList.remove($)}}_evtDragOver(e){if(!e.mimeData.hasData(Ce)){return}e.preventDefault();e.stopPropagation();e.dropAction=e.proposedAction;const t=this.node.getElementsByClassName($);if(t.length){t[0].classList.remove($)}const n=e.target;const i=this._findCell(n);if(i===-1){return}const o=this.cellsArray[i];o.node.classList.add($)}_evtDrop(e){if(!e.mimeData.hasData(Ce)){return}e.preventDefault();e.stopPropagation();if(e.proposedAction==="none"){e.dropAction="none";return}let t=e.target;while(t&&t.parentElement){if(t.classList.contains($)){t.classList.remove($);break}t=t.parentElement}const n=this.model;const i=e.source;if(i===this){e.dropAction="move";const n=e.mimeData.getData("internal:cells");const s=n[n.length-1];if(s instanceof o.MarkdownCell&&s.headingCollapsed){const e=f.findNextParentHeading(s,i);if(e>0){const t=(0,a.findIndex)(i.widgets,(e=>s.model.id===e.model.id));n.push(...i.widgets.slice(t+1,e))}}let l=a.ArrayExt.firstIndexOf(this.widgets,n[0]);let r=this._findCell(t);if(r!==-1&&r>l){r-=1}else if(r===-1){r=this.widgets.length-1}if(r>=l&&r<l+n.length){return}this.moveCell(l,r,n.length)}else{e.dropAction="copy";let i=this._findCell(t);if(i===-1){i=this.widgets.length}const o=i;const s=e.mimeData.getData(Ce);n.sharedModel.insertCells(i,s);this.deselectAll();this.activeCellIndex=o;this.extendContiguousSelectionTo(i-1)}void f.focusActiveCell(this)}_startDrag(e,t,n){var i;const o=this.model.cells;const s=[];const l=[];let a=-1;for(const r of this.widgets){const e=o.get(++a);if(this.isSelectedOrActive(r)){r.addClass(J);s.push(e.toJSON());l.push(r)}}const d=this.activeCell;let c=null;let h;if((d===null||d===void 0?void 0:d.model.type)==="code"){const e=d.model.executionCount;h=" ";if(e){h=e.toString()}}else{h=""}c=ke.createDragImage(s.length,h,(i=d===null||d===void 0?void 0:d.model.sharedModel.getSource().split("\n")[0].slice(0,26))!==null&&i!==void 0?i:"");this._drag=new q.Drag({mimeData:new r.MimeData,dragImage:c,supportedActions:"copy-move",proposedAction:"copy",source:this});this._drag.mimeData.setData(Ce,s);this._drag.mimeData.setData("internal:cells",l);const u=l.map((e=>e.model.sharedModel.getSource())).join("\n");this._drag.mimeData.setData("text/plain",u);document.removeEventListener("mousemove",this,true);document.removeEventListener("mouseup",this,true);this._mouseMode=null;void this._drag.start(t,n).then((e=>{if(this.isDisposed){return}this._drag=null;for(const t of l){t.removeClass(J)}}))}_evtFocusIn(e){var t,n;const i=e.target;const o=this._findCell(i);if(o!==-1){const e=this.widgets[o];if(e.editorWidget&&!e.editorWidget.node.contains(i)){this.setMode("command",{focus:false})}this.activeCellIndex=o;const n=(t=e.editorWidget)===null||t===void 0?void 0:t.node;if(n===null||n===void 0?void 0:n.contains(i)){this.setMode("edit",{focus:false})}}else{this.setMode("command",{focus:false});e.preventDefault();const t=e.relatedTarget;if(this._activeCell&&!this._activeCell.node.contains(t)){this._activeCell.ready.then((()=>{var e;(e=this._activeCell)===null||e===void 0?void 0:e.node.focus({preventScroll:true})})).catch((()=>{var e;(e=this.layout.footer)===null||e===void 0?void 0:e.node.focus({preventScroll:true})}))}else{(n=this.layout.footer)===null||n===void 0?void 0:n.node.focus({preventScroll:true})}}}_evtFocusOut(e){var t;const n=e.relatedTarget;if(!n){return}const i=this._findCell(n);if(i!==-1){const e=this.widgets[i];if((t=e.editorWidget)===null||t===void 0?void 0:t.node.contains(n)){return}}if(this.mode!=="command"){this.setMode("command",{focus:false})}}_evtDblClick(e){const t=this.model;if(!t){return}this.deselectAll();const[n,i]=this._findEventTargetAndCell(e);if(e.target.classList.contains(pe)){return}if(i===-1){return}this.activeCellIndex=i;if(t.cells.get(i).type==="markdown"){const e=this.widgets[i];e.rendered=false}else if(n.localName==="img"){n.classList.toggle(de)}}_trimSelections(){for(let e=0;e<this.widgets.length;e++){if(e!==this._activeCellIndex){const t=this.widgets[e];if(!t.model.isDisposed&&t.editor){t.model.selections.delete(t.editor.uuid)}}}}_updateSelectedCells(){this._selectedCells=this.widgets.filter((e=>this.isSelectedOrActive(e)));if(this.kernelHistory){this.kernelHistory.reset()}}}(function(e){class t extends ye.ContentFactory{}e.ContentFactory=t})(be||(be={}));var ke;(function(e){e.selectedProperty=new K.AttachedProperty({name:"selected",create:()=>false});class t extends R.PanelLayout{onUpdateRequest(e){}}e.NotebookPanelLayout=t;function n(e,t,n){if(e>1){if(t!==""){return z.VirtualDOM.realize(z.h.div(z.h.div({className:ce},z.h.span({className:ge},"["+t+"]:"),z.h.span({className:ue},n)),z.h.div({className:fe},"")))}else{return z.VirtualDOM.realize(z.h.div(z.h.div({className:ce},z.h.span({className:ge}),z.h.span({className:ue},n)),z.h.div({className:fe},"")))}}else{if(t!==""){return z.VirtualDOM.realize(z.h.div(z.h.div({className:`${ce} ${he}`},z.h.span({className:ge},"["+t+"]:"),z.h.span({className:ue},n))))}else{return z.VirtualDOM.realize(z.h.div(z.h.div({className:`${ce} ${he}`},z.h.span({className:ge}),z.h.span({className:ue},n))))}}}e.createDragImage=n})(ke||(ke={}));const Se="jp-NotebookPanel";const xe="jp-NotebookPanel-toolbar";const Me="jp-NotebookPanel-notebook";class Ie extends W.DocumentWidget{constructor(e){super(e);this._autorestarting=false;this.addClass(Se);this.toolbar.addClass(xe);this.content.addClass(Me);this.content.model=this.context.model;this.context.sessionContext.kernelChanged.connect(this._onKernelChanged,this);this.context.sessionContext.statusChanged.connect(this._onSessionStatusChanged,this);this.context.saveState.connect(this._onSave,this);void this.revealed.then((()=>{if(this.isDisposed){return}if(this.content.widgets.length===1){const e=this.content.widgets[0].model;if(e.type==="code"&&e.sharedModel.getSource()===""){this.content.mode="edit"}}}))}_onSave(e,t){if(t==="started"&&this.model){for(const e of this.model.cells){if((0,o.isMarkdownCellModel)(e)){for(const t of e.attachments.keys){if(!e.sharedModel.getSource().includes(t)){e.attachments.remove(t)}}}}}}get sessionContext(){return this.context.sessionContext}get model(){return this.content.model}setConfig(e){this.content.editorConfig=e.editorConfig;this.content.notebookConfig=e.notebookConfig;const t=this.context.sessionContext.kernelPreference;this.context.sessionContext.kernelPreference={...t,shutdownOnDispose:e.kernelShutdown,autoStartDefault:e.autoStartDefault}}setFragment(e){void this.context.ready.then((()=>{void this.content.setFragment(e)}))}dispose(){this.content.dispose();super.dispose()}[i.Printing.symbol](){return async()=>{if(this.context.model.dirty&&!this.context.model.readOnly){await this.context.save()}await i.Printing.printURL(s.PageConfig.getNBConvertURL({format:"html",download:false,path:this.context.path}))}}onBeforeHide(e){super.onBeforeHide(e);this.content.isParentHidden=true}onBeforeShow(e){this.content.isParentHidden=false;super.onBeforeShow(e)}_onKernelChanged(e,t){if(!this.model||!t.newValue){return}const{newValue:n}=t;void n.info.then((e=>{var t;if(this.model&&((t=this.context.sessionContext.session)===null||t===void 0?void 0:t.kernel)===n){this._updateLanguage(e.language_info)}}));void this._updateSpec(n)}_onSessionStatusChanged(e,t){var n;if(t==="autorestarting"&&!this._autorestarting){void(0,i.showDialog)({title:this._trans.__("Kernel Restarting"),body:this._trans.__("The kernel for %1 appears to have died. It will restart automatically.",(n=this.sessionContext.session)===null||n===void 0?void 0:n.path),buttons:[i.Dialog.okButton({label:this._trans.__("Ok")})]});this._autorestarting=true}else if(t==="restarting"){}else{this._autorestarting=false}}_updateLanguage(e){this.model.setMetadata("language_info",e)}async _updateSpec(e){const t=await e.spec;if(this.isDisposed){return}this.model.setMetadata("kernelspec",{name:e.name,display_name:t===null||t===void 0?void 0:t.display_name,language:t===null||t===void 0?void 0:t.language})}}(function(e){class t extends be.ContentFactory{createNotebook(e){return new be(e)}}e.ContentFactory=t;e.IContentFactory=new r.Token("@jupyterlab/notebook:IContentFactory",`A factory object that creates new notebooks.\n    Use this if you want to create and host notebooks in your own UI elements.`)})(Ie||(Ie={}));var Ae=n(80379);class Ee extends Ae.SearchProvider{constructor(e,t=l.nullTranslator){super(e);this.translator=t;this._textSelection=null;this._currentProviderIndex=null;this._delayedActiveCellChangeHandler=null;this._onSelection=false;this._selectedCells=1;this._selectedLines=0;this._query=null;this._searchProviders=[];this._editorSelectionsObservable=null;this._selectionSearchMode="cells";this._selectionLock=false;this._searchActive=false;this._handleHighlightsAfterActiveCellChange=this._handleHighlightsAfterActiveCellChange.bind(this);this.widget.model.cells.changed.connect(this._onCellsChanged,this);this.widget.content.activeCellChanged.connect(this._onActiveCellChanged,this);this.widget.content.selectionChanged.connect(this._onCellSelectionChanged,this);this.widget.content.stateChanged.connect(this._onNotebookStateChanged,this);this._observeActiveCell();this._filtersChanged.connect(this._setEnginesSelectionSearchMode,this)}_onNotebookStateChanged(e,t){if(t.name==="mode"){window.setTimeout((()=>{var e;if(t.newValue==="command"&&((e=document.activeElement)===null||e===void 0?void 0:e.closest(".jp-DocumentSearch-overlay"))){return}this._updateSelectionMode();this._filtersChanged.emit()}),0)}}static isApplicable(e){return e instanceof Ie}static createNew(e,t){return new Ee(e,t)}get currentMatchIndex(){let e=0;let t=false;for(let n=0;n<this._searchProviders.length;n++){const i=this._searchProviders[n];if(this._currentProviderIndex==n){const n=i.currentMatchIndex;if(n===null){return null}e+=n;t=true;break}else{e+=i.matchesCount}}return t?e:null}get matchesCount(){return this._searchProviders.reduce(((e,t)=>e+=t.matchesCount),0)}get isReadOnly(){var e,t,n;return(n=(t=(e=this.widget)===null||e===void 0?void 0:e.content.model)===null||t===void 0?void 0:t.readOnly)!==null&&n!==void 0?n:false}get replaceOptionsSupport(){return{preserveCase:true}}getSelectionState(){const e=this._selectionSearchMode==="cells";const t=e?this._selectedCells:this._selectedLines;return t>1?"multiple":t===1&&!e?"single":"none"}dispose(){var e;if(this.isDisposed){return}this.widget.content.activeCellChanged.disconnect(this._onActiveCellChanged,this);(e=this.widget.model)===null||e===void 0?void 0:e.cells.changed.disconnect(this._onCellsChanged,this);this.widget.content.stateChanged.disconnect(this._onNotebookStateChanged,this);this.widget.content.selectionChanged.disconnect(this._onCellSelectionChanged,this);this._stopObservingLastCell();super.dispose();const t=this.widget.content.activeCellIndex;this.endQuery().then((()=>{if(!this.widget.isDisposed){this.widget.content.activeCellIndex=t}})).catch((e=>{console.error(`Fail to end search query in notebook:\n${e}`)}))}getFilters(){const e=this.translator.load("jupyterlab");return{output:{title:e.__("Search Cell Outputs"),description:e.__("Search in the cell outputs."),default:false,supportReplace:false},selection:{title:this._selectionSearchMode==="cells"?e._n("Search in %1 Selected Cell","Search in %1 Selected Cells",this._selectedCells):e._n("Search in %1 Selected Line","Search in %1 Selected Lines",this._selectedLines),description:e.__("Search only in the selected cells or text (depending on edit/command mode)."),default:false,supportReplace:true}}}_updateSelectionMode(){if(this._selectionLock){return}this._selectionSearchMode=this._selectedCells===1&&this.widget.content.mode==="edit"&&this._selectedLines!==0?"text":"cells"}getInitialQuery(){const e=this.widget.content.activeCell;const t=e===null||e===void 0?void 0:e.editor;if(!t){return""}const n=t.state.sliceDoc(t.state.selection.main.from,t.state.selection.main.to);return n}async clearHighlight(){this._selectionLock=true;if(this._currentProviderIndex!==null&&this._currentProviderIndex<this._searchProviders.length){await this._searchProviders[this._currentProviderIndex].clearHighlight();this._currentProviderIndex=null}this._selectionLock=false}async highlightNext(e=true,t){const n=await this._stepNext(false,e,t);return n!==null&&n!==void 0?n:undefined}async highlightPrevious(e=true,t){const n=await this._stepNext(true,e,t);return n!==null&&n!==void 0?n:undefined}async startQuery(e,t){if(!this.widget){return}await this.endQuery();this._searchActive=true;let n=this.widget.content.widgets;this._query=e;this._filters={output:false,selection:false,...t!==null&&t!==void 0?t:{}};this._onSelection=this._filters.selection;const i=this.widget.content.activeCellIndex;this._searchProviders=await Promise.all(n.map((async(t,n)=>{const s=(0,o.createCellSearchProvider)(t);await s.setIsActive(!this._filters.selection||this.widget.content.isSelectedOrActive(t));if(this._onSelection&&this._selectionSearchMode==="text"&&n===i){if(this._textSelection){await s.setSearchSelection(this._textSelection)}}await s.startQuery(e,this._filters);return s})));this._currentProviderIndex=i;await this.highlightNext(true,{from:"selection-start",scroll:false,select:false});return Promise.resolve()}async endQuery(){await Promise.all(this._searchProviders.map((e=>e.endQuery().then((()=>{e.dispose()})))));this._searchActive=false;this._searchProviders.length=0;this._currentProviderIndex=null}async replaceCurrentMatch(e,t=true,n){let i=false;const o=async(e=false)=>{var n;const i=(n=this.widget)===null||n===void 0?void 0:n.content.activeCell;if((i===null||i===void 0?void 0:i.model.type)==="markdown"&&i.rendered){i.rendered=false;if(e){await this.highlightNext(t)}}};if(this._currentProviderIndex!==null){await o();const s=this._searchProviders[this._currentProviderIndex];i=await s.replaceCurrentMatch(e,false,n);if(s.currentMatchIndex===null){await this.highlightNext(t)}}await o(true);return i}async replaceAllMatches(e,t){const n=await Promise.all(this._searchProviders.map((n=>n.replaceAllMatches(e,t))));return n.includes(true)}async validateFilter(e,t){if(e!=="output"){return t}if(t&&this.widget.content.widgets.some((e=>e instanceof o.CodeCell&&e.isPlaceholder()))){const e=this.translator.load("jupyterlab");const t=await(0,i.showDialog)({title:e.__("Confirmation"),body:e.__("Searching outputs is expensive and requires to first rendered all outputs. Are you sure you want to search in the cell outputs?"),buttons:[i.Dialog.cancelButton({label:e.__("Cancel")}),i.Dialog.okButton({label:e.__("Ok")})]});if(t.button.accept){this.widget.content.widgets.forEach(((e,t)=>{if(e instanceof o.CodeCell&&e.isPlaceholder()){this.widget.content.renderCellOutputs(t)}}))}else{return false}}return t}_addCellProvider(e){var t,n;const i=this.widget.content.widgets[e];const s=(0,o.createCellSearchProvider)(i);a.ArrayExt.insert(this._searchProviders,e,s);void s.setIsActive(!((n=(t=this._filters)===null||t===void 0?void 0:t.selection)!==null&&n!==void 0?n:false)||this.widget.content.isSelectedOrActive(i)).then((()=>{if(this._searchActive){void s.startQuery(this._query,this._filters)}}))}_removeCellProvider(e){const t=a.ArrayExt.removeAt(this._searchProviders,e);t===null||t===void 0?void 0:t.dispose()}async _onCellsChanged(e,t){switch(t.type){case"add":t.newValues.forEach(((e,n)=>{this._addCellProvider(t.newIndex+n)}));break;case"move":a.ArrayExt.move(this._searchProviders,t.oldIndex,t.newIndex);break;case"remove":for(let e=0;e<t.oldValues.length;e++){this._removeCellProvider(t.oldIndex)}break;case"set":t.newValues.forEach(((e,n)=>{this._addCellProvider(t.newIndex+n);this._removeCellProvider(t.newIndex+n+1)}));break}this._stateChanged.emit()}async _stepNext(e=false,t=false,n){const i=async e=>{var t;const i=(t=n===null||n===void 0?void 0:n.scroll)!==null&&t!==void 0?t:true;if(!i){return}this._selectionLock=true;if(this.widget.content.activeCellIndex!==this._currentProviderIndex){this.widget.content.activeCellIndex=this._currentProviderIndex}if(this.widget.content.activeCellIndex===-1){console.warn("No active cell (no cells or no model), aborting search");this._selectionLock=false;return}const o=this.widget.content.activeCell;if(!o.inViewport){try{await this.widget.content.scrollToItem(this._currentProviderIndex)}catch(l){}}if(o.inputHidden){o.inputHidden=false}if(!o.inViewport){this._selectionLock=false;return}await o.ready;const s=o.editor;s.revealPosition(s.getPositionAt(e.position));this._selectionLock=false};if(this._currentProviderIndex===null){this._currentProviderIndex=this.widget.content.activeCellIndex}if(e&&this.widget.content.mode==="command"){const e=this._searchProviders[this._currentProviderIndex];const n=e.getCurrentMatch();if(!n){this._currentProviderIndex-=1}if(t){this._currentProviderIndex=(this._currentProviderIndex+this._searchProviders.length)%this._searchProviders.length}}const o=this._currentProviderIndex;do{const o=this._searchProviders[this._currentProviderIndex];const s=e?await o.highlightPrevious(false,n):await o.highlightNext(false,n);if(s){await i(s);return s}else{this._currentProviderIndex=this._currentProviderIndex+(e?-1:1);if(t){this._currentProviderIndex=(this._currentProviderIndex+this._searchProviders.length)%this._searchProviders.length}}}while(t?this._currentProviderIndex!==o:0<=this._currentProviderIndex&&this._currentProviderIndex<this._searchProviders.length);if(t){const t=this._searchProviders[o];const s=e?await t.highlightPrevious(false,n):await t.highlightNext(false,n);if(s){await i(s);return s}}this._currentProviderIndex=null;return null}async _onActiveCellChanged(){if(this._delayedActiveCellChangeHandler!==null){clearTimeout(this._delayedActiveCellChangeHandler);this._delayedActiveCellChangeHandler=null}if(this.widget.content.activeCellIndex!==this._currentProviderIndex){this._delayedActiveCellChangeHandler=window.setTimeout((()=>{this.delayedActiveCellChangeHandlerReady=this._handleHighlightsAfterActiveCellChange()}),0)}this._observeActiveCell()}async _handleHighlightsAfterActiveCellChange(){if(this._onSelection){const e=this._currentProviderIndex!==null&&this._currentProviderIndex<this.widget.content.widgets.length?this.widget.content.widgets[this._currentProviderIndex]:null;const t=e&&this.widget.content.isSelectedOrActive(e);if(!t){await this._updateCellSelection();await this.clearHighlight();this._currentProviderIndex=this.widget.content.activeCellIndex}}await this._ensureCurrentMatch()}async _ensureCurrentMatch(){if(this._currentProviderIndex!==null){const e=this._searchProviders[this._currentProviderIndex];if(!e){return}const t=e.getCurrentMatch();if(!t&&this.matchesCount){await this.highlightNext(true,{from:"start",scroll:false,select:false})}}}_observeActiveCell(){var e;const t=(e=this.widget.content.activeCell)===null||e===void 0?void 0:e.editor;if(!t){return}this._stopObservingLastCell();t.model.selections.changed.connect(this._setSelectedLines,this);this._editorSelectionsObservable=t.model.selections}_stopObservingLastCell(){if(this._editorSelectionsObservable){this._editorSelectionsObservable.changed.disconnect(this._setSelectedLines,this)}}_setSelectedLines(){var e;const t=(e=this.widget.content.activeCell)===null||e===void 0?void 0:e.editor;if(!t){return}const n=t.getSelection();const{start:i,end:o}=n;const s=o.line===i.line&&o.column===i.column?0:o.line-i.line+1;this._textSelection=n;if(s!==this._selectedLines){this._selectedLines=s;this._updateSelectionMode()}this._filtersChanged.emit()}async _setEnginesSelectionSearchMode(){let e;if(!this._onSelection){e=false}else{e=this._selectionSearchMode==="text"}if(this._selectionLock){return}await Promise.all(this._searchProviders.map(((t,n)=>{const i=this.widget.content.activeCellIndex===n;t.setProtectSelection(i&&this._onSelection);return t.setSearchSelection(i&&e?this._textSelection:null)})))}async _onCellSelectionChanged(){if(this._delayedActiveCellChangeHandler!==null){clearTimeout(this._delayedActiveCellChangeHandler);this._delayedActiveCellChangeHandler=null}await this._updateCellSelection();if(this._currentProviderIndex===null){const e=this.widget.content.widgets.findIndex((e=>this.widget.content.isSelectedOrActive(e)));this._currentProviderIndex=e}await this._ensureCurrentMatch()}async _updateCellSelection(){const e=this.widget.content.widgets;let t=0;await Promise.all(e.map((async(e,n)=>{const i=this._searchProviders[n];const o=this.widget.content.isSelectedOrActive(e);if(o){t+=1}if(i&&this._onSelection){await i.setIsActive(o)}})));if(t!==this._selectedCells){this._selectedCells=t;this._updateSelectionMode()}this._filtersChanged.emit()}}var Te;(function(e){e[e["Idle"]=-1]="Idle";e[e["Error"]=-.5]="Error";e[e["Scheduled"]=0]="Scheduled";e[e["Running"]=1]="Running"})(Te||(Te={}));class Ne extends j.TableOfContentsModel{constructor(e,t,n,i){super(e,i);this.parser=t;this.sanitizer=n;this.configMetadataMap={numberHeaders:["toc-autonumbering","toc/number_sections"],numberingH1:["!toc/skip_h1_title"],baseNumbering:["toc/base_numbering"]};this._runningCells=new Array;this._errorCells=new Array;this._cellToHeadingIndex=new WeakMap;void e.context.ready.then((()=>{this.setConfiguration({})}));this.widget.context.model.metadataChanged.connect(this.onMetadataChanged,this);this.widget.content.activeCellChanged.connect(this.onActiveCellChanged,this);f.executionScheduled.connect(this.onExecutionScheduled,this);f.executed.connect(this.onExecuted,this);f.outputCleared.connect(this.onOutputCleared,this);this.headingsChanged.connect(this.onHeadingsChanged,this)}get documentType(){return"notebook"}get isAlwaysActive(){return true}get supportedOptions(){return["baseNumbering","maximalDepth","numberingH1","numberHeaders","includeOutput","syncCollapseState"]}getCellHeadings(e){const t=new Array;let n=this._cellToHeadingIndex.get(e);if(n!==undefined){const e=this.headings[n];t.push(e);while(this.headings[n-1]&&this.headings[n-1].cellRef===e.cellRef){n--;t.unshift(this.headings[n])}}return t}dispose(){var e,t,n;if(this.isDisposed){return}this.headingsChanged.disconnect(this.onHeadingsChanged,this);(t=(e=this.widget.context)===null||e===void 0?void 0:e.model)===null||t===void 0?void 0:t.metadataChanged.disconnect(this.onMetadataChanged,this);(n=this.widget.content)===null||n===void 0?void 0:n.activeCellChanged.disconnect(this.onActiveCellChanged,this);f.executionScheduled.disconnect(this.onExecutionScheduled,this);f.executed.disconnect(this.onExecuted,this);f.outputCleared.disconnect(this.onOutputCleared,this);this._runningCells.length=0;this._errorCells.length=0;super.dispose()}setConfiguration(e){const t=this.loadConfigurationFromMetadata();super.setConfiguration({...this.configuration,...t,...e})}toggleCollapse(e){super.toggleCollapse(e);this.updateRunningStatus(this.headings)}getHeadings(){const e=this.widget.content.widgets;const t=[];const n=new Array;for(let i=0;i<e.length;i++){const o=e[i];const s=o.model;switch(s.type){case"code":{if(!this.configuration.syncCollapseState&&this.configuration.includeOutput){t.push(...j.TableOfContentsUtils.filterHeadings(o.headings,this.configuration,n).map((e=>({...e,cellRef:o,collapsed:false,isRunning:Te.Idle}))))}break}case"markdown":{const e=j.TableOfContentsUtils.filterHeadings(o.headings,this.configuration,n).map(((e,t)=>({...e,cellRef:o,collapsed:false,isRunning:Te.Idle})));if(this.configuration.syncCollapseState&&o.headingCollapsed){const t=Math.min(...e.map((e=>e.level)));const n=e.find((e=>e.level===t));n.collapsed=o.headingCollapsed}t.push(...e);break}}if(t.length>0){this._cellToHeadingIndex.set(o,t.length-1)}}this.updateRunningStatus(t);return Promise.resolve(t)}loadConfigurationFromMetadata(){const e=this.widget.content.model;const t={};if(e){for(const n in this.configMetadataMap){const i=this.configMetadataMap[n];for(const o of i){let i=o;const s=i[0]==="!";if(s){i=i.slice(1)}const l=i.split("/");let a=e.getMetadata(l[0]);for(let e=1;e<l.length;e++){a=(a!==null&&a!==void 0?a:{})[l[e]]}if(a!==undefined){if(typeof a==="boolean"&&s){a=!a}t[n]=a}}}}return t}onActiveCellChanged(e,t){const n=this.getCellHeadings(t)[0];this.setActiveHeading(n!==null&&n!==void 0?n:null,false)}onHeadingsChanged(){if(this.widget.content.activeCell){this.onActiveCellChanged(this.widget.content,this.widget.content.activeCell)}}onExecuted(e,t){this._runningCells.forEach(((e,n)=>{var i;if(e===t.cell){this._runningCells.splice(n,1);const o=this._cellToHeadingIndex.get(e);if(o!==undefined){const n=this.headings[o];if(t.success||((i=t.error)===null||i===void 0?void 0:i.errorName)===undefined){n.isRunning=Te.Idle;return}n.isRunning=Te.Error;if(!this._errorCells.includes(e)){this._errorCells.push(e)}}}}));this.updateRunningStatus(this.headings);this.stateChanged.emit()}onExecutionScheduled(e,t){if(!this._runningCells.includes(t.cell)){this._runningCells.push(t.cell)}this._errorCells.forEach(((e,n)=>{if(e===t.cell){this._errorCells.splice(n,1)}}));this.updateRunningStatus(this.headings);this.stateChanged.emit()}onOutputCleared(e,t){this._errorCells.forEach(((e,n)=>{if(e===t.cell){this._errorCells.splice(n,1);const t=this._cellToHeadingIndex.get(e);if(t!==undefined){const e=this.headings[t];e.isRunning=Te.Idle}}}));this.updateRunningStatus(this.headings);this.stateChanged.emit()}onMetadataChanged(){this.setConfiguration({})}updateRunningStatus(e){this._runningCells.forEach(((e,t)=>{const n=this._cellToHeadingIndex.get(e);if(n!==undefined){const e=this.headings[n];if(e.isRunning!==Te.Running){e.isRunning=t>0?Te.Scheduled:Te.Running}}}));this._errorCells.forEach(((e,t)=>{const n=this._cellToHeadingIndex.get(e);if(n!==undefined){const e=this.headings[n];if(e.isRunning===Te.Idle){e.isRunning=Te.Error}}}));let t=0;while(t<e.length){const i=e[t];t++;if(i.collapsed){const t=Math.max(i.isRunning,n(e,i.level));i.dataset={...i.dataset,"data-running":t.toString()}}else{i.dataset={...i.dataset,"data-running":i.isRunning.toString()}}}function n(e,i){let o=Te.Idle;while(t<e.length){const s=e[t];s.dataset={...s.dataset,"data-running":s.isRunning.toString()};if(s.level>i){t++;o=Math.max(s.isRunning,o);if(s.collapsed){o=Math.max(o,n(e,s.level));s.dataset={...s.dataset,"data-running":o.toString()}}}else{break}}return o}}}class Pe extends j.TableOfContentsFactory{constructor(e,t,n){super(e);this.parser=t;this.sanitizer=n;this._scrollToTop=true}get scrollToTop(){return this._scrollToTop}set scrollToTop(e){this._scrollToTop=e}_createNew(e,t){const n=new Ne(e,this.parser,this.sanitizer,t);let i=new WeakMap;const s=(t,n)=>{if(n){const t=async t=>{if(!t.inViewport){return}const o=i.get(n);if(o){if(this.scrollToTop){o.scrollIntoView({block:"start"})}else{const t=e.content.node.getBoundingClientRect();const n=o.getBoundingClientRect();if(n.top>t.bottom||n.bottom<t.top){o.scrollIntoView({block:"center"})}}}else{console.debug("scrolling to heading: using fallback strategy");await e.content.scrollToItem(e.content.activeCellIndex,this.scrollToTop?"start":undefined,0)}};const o=n.cellRef;const s=e.content.widgets;const l=s.indexOf(o);if(o.model.type=="markdown"&&e.content.mode!="command"){e.content.mode="command"}e.content.activeCellIndex=l;if(o.inViewport){t(o).catch((e=>{console.error(`Fail to scroll to cell to display the required heading (${e}).`)}))}else{e.content.scrollToItem(l,this.scrollToTop?"start":undefined).then((()=>t(o))).catch((e=>{console.error(`Fail to scroll to cell to display the required heading (${e}).`)}))}}};const l=e=>{n.getCellHeadings(e).forEach((async e=>{var t,n;const o=await He(e,this.parser,this.sanitizer);const s=o?`h${e.level}[id="${CSS.escape(o)}"]`:`h${e.level}`;if(e.outputIndex!==undefined){i.set(e,j.TableOfContentsUtils.addPrefix(e.cellRef.outputArea.widgets[e.outputIndex].node,s,(t=e.prefix)!==null&&t!==void 0?t:""))}else{i.set(e,j.TableOfContentsUtils.addPrefix(e.cellRef.node,s,(n=e.prefix)!==null&&n!==void 0?n:""))}}))};const a=t=>{if(!this.parser){return}j.TableOfContentsUtils.clearNumbering(e.content.node);i=new WeakMap;e.content.widgets.forEach((e=>{l(e)}))};const r=(t,i)=>{var s,l,a,r;if(n.configuration.syncCollapseState){if(i!==null){const e=i.cellRef;if(e.headingCollapsed!==((s=i.collapsed)!==null&&s!==void 0?s:false)){e.headingCollapsed=(l=i.collapsed)!==null&&l!==void 0?l:false}}else{const t=(r=(a=n.headings[0])===null||a===void 0?void 0:a.collapsed)!==null&&r!==void 0?r:false;e.content.widgets.forEach((e=>{if(e instanceof o.MarkdownCell){if(e.headingInfo.level>=0){e.headingCollapsed=t}}}))}}};const d=(e,t)=>{if(n.configuration.syncCollapseState){const e=n.getCellHeadings(t)[0];if(e){n.toggleCollapse({heading:e,collapsed:t.headingCollapsed})}}};const c=(e,t)=>{if(t.inViewport){l(t)}else{j.TableOfContentsUtils.clearNumbering(t.node)}};void e.context.ready.then((()=>{a(n);n.activeHeadingChanged.connect(s);n.headingsChanged.connect(a);n.collapseChanged.connect(r);e.content.cellCollapsed.connect(d);e.content.cellInViewportChanged.connect(c);e.disposed.connect((()=>{n.activeHeadingChanged.disconnect(s);n.headingsChanged.disconnect(a);n.collapseChanged.disconnect(r);e.content.cellCollapsed.disconnect(d);e.content.cellInViewportChanged.disconnect(c)}))}));return n}}async function He(e,t,n){let i=null;if(e.type===o.Cell.HeadingType.Markdown){i=await j.TableOfContentsUtils.Markdown.getHeadingId(t,e.raw,e.level,n)}else if(e.type===o.Cell.HeadingType.HTML){i=e.id}return i}const De=new r.Token("@jupyterlab/notebook:INotebookWidgetFactory","A service to create the notebook viewer.");const Le=new r.Token("@jupyterlab/notebook:INotebookTools",`A service for the "Notebook Tools" panel in the\n  right sidebar. Use this to add your own functionality to the panel.`);const Oe=new r.Token("@jupyterlab/notebook:INotebookTracker",`A widget tracker for notebooks.\n  Use this if you want to be able to iterate over and interact with notebooks\n  created by the application.`);class Re extends i.WidgetTracker{constructor(){super(...arguments);this._activeCell=null;this._activeCellChanged=new d.Signal(this);this._selectionChanged=new d.Signal(this)}get activeCell(){const e=this.currentWidget;if(!e){return null}return e.content.activeCell||null}get activeCellChanged(){return this._activeCellChanged}get selectionChanged(){return this._selectionChanged}add(e){const t=super.add(e);e.content.activeCellChanged.connect(this._onActiveCellChanged,this);e.content.selectionChanged.connect(this._onSelectionChanged,this);return t}dispose(){this._activeCell=null;super.dispose()}onCurrentChanged(e){const t=this.activeCell;if(t&&t===this._activeCell){return}this._activeCell=t;if(!e){return}this._activeCellChanged.emit(e.content.activeCell||null)}_onActiveCellChanged(e,t){if(this.currentWidget&&this.currentWidget.content===e){this._activeCell=t||null;this._activeCellChanged.emit(this._activeCell)}}_onSelectionChanged(e){if(this.currentWidget&&this.currentWidget.content===e){this._selectionChanged.emit(void 0)}}}const Be="jp-StatusItem-trust";function Fe(e,t){t=t||l.nullTranslator;const n=t.load("jupyterlab");if(e.trustedCells===e.totalCells){return n.__("Notebook trusted: %1 of %2 code cells trusted.",e.trustedCells,e.totalCells)}else if(e.activeCellTrusted){return n.__("Active cell trusted: %1 of %2 code cells trusted.",e.trustedCells,e.totalCells)}else{return n.__("Notebook not trusted: %1 of %2 code cells trusted.",e.trustedCells,e.totalCells)}}function Ve(e){if(e.allCellsTrusted){return h().createElement(m.trustedIcon.react,{top:"2px",stylesheet:"statusBar"})}else{return h().createElement(m.notTrustedIcon.react,{top:"2px",stylesheet:"statusBar"})}}class We extends m.VDomRenderer{constructor(e){super(new We.Model);this.translator=e||l.nullTranslator;this.node.classList.add(Be)}render(){if(!this.model){return null}const e=Fe(this.model,this.translator);if(e!==this.node.title){this.node.title=e}return h().createElement(Ve,{allCellsTrusted:this.model.trustedCells===this.model.totalCells,activeCellTrusted:this.model.activeCellTrusted,totalCells:this.model.totalCells,trustedCells:this.model.trustedCells})}}(function(e){class t extends m.VDomModel{constructor(){super(...arguments);this._trustedCells=0;this._totalCells=0;this._activeCellTrusted=false;this._notebook=null}get trustedCells(){return this._trustedCells}get totalCells(){return this._totalCells}get activeCellTrusted(){return this._activeCellTrusted}get notebook(){return this._notebook}set notebook(e){const t=this._notebook;if(t!==null){t.activeCellChanged.disconnect(this._onActiveCellChanged,this);t.modelContentChanged.disconnect(this._onModelChanged,this)}const n=this._getAllState();this._notebook=e;if(this._notebook===null){this._trustedCells=0;this._totalCells=0;this._activeCellTrusted=false}else{this._notebook.activeCellChanged.connect(this._onActiveCellChanged,this);this._notebook.modelContentChanged.connect(this._onModelChanged,this);if(this._notebook.activeCell){this._activeCellTrusted=this._notebook.activeCell.model.trusted}else{this._activeCellTrusted=false}const{total:e,trusted:t}=this._deriveCellTrustState(this._notebook.model);this._totalCells=e;this._trustedCells=t}this._triggerChange(n,this._getAllState())}_onModelChanged(e){const t=this._getAllState();const{total:n,trusted:i}=this._deriveCellTrustState(e.model);this._totalCells=n;this._trustedCells=i;this._triggerChange(t,this._getAllState())}_onActiveCellChanged(e,t){const n=this._getAllState();if(t){this._activeCellTrusted=t.model.trusted}else{this._activeCellTrusted=false}this._triggerChange(n,this._getAllState())}_deriveCellTrustState(e){if(e===null){return{total:0,trusted:0}}let t=0;let n=0;for(const i of e.cells){if(i.type!=="code"){continue}t++;if(i.trusted){n++}}return{total:t,trusted:n}}_getAllState(){return[this._trustedCells,this._totalCells,this.activeCellTrusted]}_triggerChange(e,t){if(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]){this.stateChanged.emit(void 0)}}}e.Model=t})(We||(We={}));class je{constructor(e){this._requestBatchSize=10;this._cursor=0;this._hasSession=false;this._history=[];this._placeholder="";this._kernelSession="";this._setByHistory=false;this._isDisposed=false;this._editor=null;this._filtered=[];this._kernel=null;this._sessionContext=e.sessionContext;this._trans=(e.translator||l.nullTranslator).load("jupyterlab");void this._handleKernel().then((()=>{this._sessionContext.kernelChanged.connect(this._handleKernel,this)}));this._toRequest=this._requestBatchSize}get editor(){return this._editor}set editor(e){if(this._editor===e){return}const t=this._editor;if(t){t.model.sharedModel.changed.disconnect(this.onTextChange,this)}this._editor=e;if(e){e.model.sharedModel.changed.connect(this.onTextChange,this)}}get placeholder(){return this._placeholder}get kernelSession(){return this._kernelSession}get isDisposed(){return this._isDisposed}dispose(){this._isDisposed=true;this._history.length=0;d.Signal.clearData(this)}async checkSession(e){var t;if(!this._hasSession){await this._retrieveHistory();this._hasSession=true;this.editor=e.editor;this._placeholder=((t=this._editor)===null||t===void 0?void 0:t.model.sharedModel.getSource())||"";this.setFilter(this._placeholder);this._cursor=this._filtered.length-1}}async back(e){await this.checkSession(e);--this._cursor;if(this._cursor<0){await this.fetchBatch()}this._cursor=Math.max(0,this._cursor);const t=this._filtered[this._cursor];return t}async forward(e){await this.checkSession(e);++this._cursor;this._cursor=Math.min(this._filtered.length-1,this._cursor);const t=this._filtered[this._cursor];return t}updateEditor(e,t){var n,i;if(e){const o=(n=e.editor)===null||n===void 0?void 0:n.model;const s=o===null||o===void 0?void 0:o.sharedModel.getSource();if(this.isDisposed||!t){return}if(s===t){return}this._setByHistory=true;o===null||o===void 0?void 0:o.sharedModel.setSource(t);let l=0;l=t.indexOf("\n");if(l<0){l=t.length}(i=e.editor)===null||i===void 0?void 0:i.setCursorPosition({line:0,column:l})}}reset(){this._hasSession=false;this._placeholder="";this._toRequest=this._requestBatchSize}async fetchBatch(){this._toRequest+=this._requestBatchSize;let e=this._filtered.slice().reverse();let t=this._history.slice();await this._retrieveHistory().then((()=>{this.setFilter(this._placeholder);let t=0;let n=this._filtered.slice().reverse();for(let i=0;i<e.length;i++){let o=e[i];for(let e=i+t;e<n.length;e++){if(o===n[e]){break}else{t+=1}}}this._cursor=this._filtered.length-(e.length+1)-t}));if(this._cursor<0){if(this._history.length>t.length){await this.fetchBatch()}}}onHistory(e,t){this._history.length=0;let n=["","",""];let i=["","",""];let o="";if(e.content.status==="ok"){for(let t=0;t<e.content.history.length;t++){i=e.content.history[t];if(i!==n){o=e.content.history[t][0];this._history.push(n=i)}}if(!this.kernelSession){if(i[2]==(t===null||t===void 0?void 0:t.model.sharedModel.getSource())){this._kernelSession=o}}}}onTextChange(){if(this._setByHistory){this._setByHistory=false;return}this.reset()}async _handleKernel(){var e;this._kernel=(e=this._sessionContext.session)===null||e===void 0?void 0:e.kernel;if(!this._kernel){this._history.length=0;return}await this._retrieveHistory().catch();return}async _retrieveHistory(e){var t;return await((t=this._kernel)===null||t===void 0?void 0:t.requestHistory(Ue(this._toRequest)).then((t=>{this.onHistory(t,e)})).catch((()=>{console.warn(this._trans.__("History was unable to be retrieved"))})))}setFilter(e=""){this._filtered.length=0;let t="";let n="";for(let i=0;i<this._history.length;i++){n=this._history[i][2];if(n!==t&&e!==n){this._filtered.push(t=n)}}this._filtered.push(e)}}function Ue(e){return{output:false,raw:true,hist_access_type:"tail",n:e}}class qe extends W.ABCWidgetFactory{constructor(e){super(e);this.rendermime=e.rendermime;this.contentFactory=e.contentFactory;this.mimeTypeService=e.mimeTypeService;this._editorConfig=e.editorConfig||ye.defaultEditorConfig;this._notebookConfig=e.notebookConfig||ye.defaultNotebookConfig}get editorConfig(){return this._editorConfig}set editorConfig(e){this._editorConfig=e}get notebookConfig(){return this._notebookConfig}set notebookConfig(e){this._notebookConfig=e}createNewWidget(e,t){const n=e.translator;const i=new je({sessionContext:e.sessionContext,translator:n});const o={rendermime:t?t.content.rendermime:this.rendermime.clone({resolver:e.urlResolver}),contentFactory:this.contentFactory,mimeTypeService:this.mimeTypeService,editorConfig:t?t.content.editorConfig:this._editorConfig,notebookConfig:t?t.content.notebookConfig:this._notebookConfig,translator:n,kernelHistory:i};const s=this.contentFactory.createNotebook(o);return new Ie({context:e,content:s})}}}}]);
//# sourceMappingURL=2762.eca1a73808092463be9d.js.map?v=eca1a73808092463be9d