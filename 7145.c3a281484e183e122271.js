/*! For license information please see 7145.c3a281484e183e122271.js.LICENSE.txt */
(self["webpackChunk_jupyterlab_application_top"]=self["webpackChunk_jupyterlab_application_top"]||[]).push([[7145],{87145:(e,t,r)=>{"use strict";var n=r(34406);Object.defineProperty(t,"__esModule",{value:true});function i(e){return e&&typeof e==="object"&&"default"in e?e["default"]:e}var o=i(r(99413));var s=r(5163);var a=r(71470);var l=r(13936);var u=r(56630);var h=function(){function e(e){this.domStorage_=e;this.prefix_="firebase:"}e.prototype.set=function(e,t){if(t==null){this.domStorage_.removeItem(this.prefixedName_(e))}else{this.domStorage_.setItem(this.prefixedName_(e),a.stringify(t))}};e.prototype.get=function(e){var t=this.domStorage_.getItem(this.prefixedName_(e));if(t==null){return null}else{return a.jsonEval(t)}};e.prototype.remove=function(e){this.domStorage_.removeItem(this.prefixedName_(e))};e.prototype.prefixedName_=function(e){return this.prefix_+e};e.prototype.toString=function(){return this.domStorage_.toString()};return e}();var c=function(){function e(){this.cache_={};this.isInMemoryStorage=true}e.prototype.set=function(e,t){if(t==null){delete this.cache_[e]}else{this.cache_[e]=t}};e.prototype.get=function(e){if(a.contains(this.cache_,e)){return this.cache_[e]}return null};e.prototype.remove=function(e){delete this.cache_[e]};return e}();var p=function(e){try{if(typeof window!=="undefined"&&typeof window[e]!=="undefined"){var t=window[e];t.setItem("firebase:sentinel","cache");t.removeItem("firebase:sentinel");return new h(t)}}catch(r){}return new c};var f=p("localStorage");var d=p("sessionStorage");var v=new l.Logger("@firebase/database");var _=function(){var e=1;return function(){return e++}}();var y=function(e){var t=a.stringToByteArray(e);var r=new a.Sha1;r.update(t);var n=r.digest();return a.base64.encodeByteArray(n)};var g=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}var r="";for(var n=0;n<e.length;n++){var i=e[n];if(Array.isArray(i)||i&&typeof i==="object"&&typeof i.length==="number"){r+=g.apply(null,i)}else if(typeof i==="object"){r+=a.stringify(i)}else{r+=i}r+=" "}return r};var m=null;var C=true;var E=function(e,t){a.assert(!t||e===true||e===false,"Can't turn on custom loggers persistently.");if(e===true){v.logLevel=l.LogLevel.VERBOSE;m=v.log.bind(v);if(t){d.set("logging_enabled",true)}}else if(typeof e==="function"){m=e}else{m=null;d.remove("logging_enabled")}};var w=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}if(C===true){C=false;if(m===null&&d.get("logging_enabled")===true){E(true)}}if(m){var r=g.apply(null,e);m(r)}};var T=function(e){return function(){var t=[];for(var r=0;r<arguments.length;r++){t[r]=arguments[r]}w.apply(void 0,s.__spread([e],t))}};var b=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}var r="FIREBASE INTERNAL ERROR: "+g.apply(void 0,s.__spread(e));v.error(r)};var S=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}var r="FIREBASE FATAL ERROR: "+g.apply(void 0,s.__spread(e));v.error(r);throw new Error(r)};var I=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}var r="FIREBASE WARNING: "+g.apply(void 0,s.__spread(e));v.warn(r)};var N=function(){if(typeof window!=="undefined"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1){I("Insecure Firebase access from a secure page. "+"Please use https in calls to new Firebase().")}};var P=function(e){return typeof e==="number"&&(e!==e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)};var R=function(e){if(a.isNodeSdk()||document.readyState==="complete"){e()}else{var t=false;var r=function(){if(!document.body){setTimeout(r,Math.floor(10));return}if(!t){t=true;e()}};if(document.addEventListener){document.addEventListener("DOMContentLoaded",r,false);window.addEventListener("load",r,false)}else if(document.attachEvent){document.attachEvent("onreadystatechange",(function(){if(document.readyState==="complete"){r()}}));window.attachEvent("onload",r)}}};var D="[MIN_NAME]";var x="[MAX_NAME]";var k=function(e,t){if(e===t){return 0}else if(e===D||t===x){return-1}else if(t===D||e===x){return 1}else{var r=H(e),n=H(t);if(r!==null){if(n!==null){return r-n===0?e.length-t.length:r-n}else{return-1}}else if(n!==null){return 1}else{return e<t?-1:1}}};var O=function(e,t){if(e===t){return 0}else if(e<t){return-1}else{return 1}};var F=function(e,t){if(t&&e in t){return t[e]}else{throw new Error("Missing required key ("+e+") in object: "+a.stringify(t))}};var A=function(e){if(typeof e!=="object"||e===null){return a.stringify(e)}var t=[];for(var r in e){t.push(r)}t.sort();var n="{";for(var i=0;i<t.length;i++){if(i!==0){n+=","}n+=a.stringify(t[i]);n+=":";n+=A(e[t[i]])}n+="}";return n};var L=function(e,t){var r=e.length;if(r<=t){return[e]}var n=[];for(var i=0;i<r;i+=t){if(i+t>r){n.push(e.substring(i,r))}else{n.push(e.substring(i,i+t))}}return n};function M(e,t){for(var r in e){if(e.hasOwnProperty(r)){t(r,e[r])}}}var W=function(e){a.assert(!P(e),"Invalid JSON number");var t=11,r=52;var n=(1<<t-1)-1;var i,o,s,l,u;if(e===0){o=0;s=0;i=1/e===-Infinity?1:0}else{i=e<0;e=Math.abs(e);if(e>=Math.pow(2,1-n)){l=Math.min(Math.floor(Math.log(e)/Math.LN2),n);o=l+n;s=Math.round(e*Math.pow(2,r-l)-Math.pow(2,r))}else{o=0;s=Math.round(e/Math.pow(2,1-n-r))}}var h=[];for(u=r;u;u-=1){h.push(s%2?1:0);s=Math.floor(s/2)}for(u=t;u;u-=1){h.push(o%2?1:0);o=Math.floor(o/2)}h.push(i?1:0);h.reverse();var c=h.join("");var p="";for(u=0;u<64;u+=8){var f=parseInt(c.substr(u,8),2).toString(16);if(f.length===1){f="0"+f}p=p+f}return p.toLowerCase()};var Q=function(){return!!(typeof window==="object"&&window["chrome"]&&window["chrome"]["extension"]&&!/^chrome/.test(window.location.href))};var q=function(){return typeof Windows==="object"&&typeof Windows.UI==="object"};var U=function(e,t){var r="Unknown Error";if(e==="too_big"){r="The data requested exceeds the maximum size "+"that can be accessed with a single request."}else if(e==="permission_denied"){r="Client doesn't have permission to access the desired data."}else if(e==="unavailable"){r="The service is unavailable"}var n=new Error(e+" at "+t.path.toString()+": "+r);n.code=e.toUpperCase();return n};var V=new RegExp("^-?(0*)\\d{1,10}$");var H=function(e){if(V.test(e)){var t=Number(e);if(t>=-2147483648&&t<=2147483647){return t}}return null};var j=function(e){try{e()}catch(t){setTimeout((function(){var e=t.stack||"";I("Exception was thrown by user callback.",e);throw t}),Math.floor(0))}};var B=function(){var e=typeof window==="object"&&window["navigator"]&&window["navigator"]["userAgent"]||"";return e.search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0};var Y=function(e,t){var r=setTimeout(e,t);if(typeof r==="object"&&r["unref"]){r["unref"]()}return r};var K=function(){function e(e,t){if(t===void 0){this.pieces_=e.split("/");var r=0;for(var n=0;n<this.pieces_.length;n++){if(this.pieces_[n].length>0){this.pieces_[r]=this.pieces_[n];r++}}this.pieces_.length=r;this.pieceNum_=0}else{this.pieces_=e;this.pieceNum_=t}}Object.defineProperty(e,"Empty",{get:function(){return new e("")},enumerable:true,configurable:true});e.prototype.getFront=function(){if(this.pieceNum_>=this.pieces_.length){return null}return this.pieces_[this.pieceNum_]};e.prototype.getLength=function(){return this.pieces_.length-this.pieceNum_};e.prototype.popFront=function(){var t=this.pieceNum_;if(t<this.pieces_.length){t++}return new e(this.pieces_,t)};e.prototype.getBack=function(){if(this.pieceNum_<this.pieces_.length){return this.pieces_[this.pieces_.length-1]}return null};e.prototype.toString=function(){var e="";for(var t=this.pieceNum_;t<this.pieces_.length;t++){if(this.pieces_[t]!==""){e+="/"+this.pieces_[t]}}return e||"/"};e.prototype.toUrlEncodedString=function(){var e="";for(var t=this.pieceNum_;t<this.pieces_.length;t++){if(this.pieces_[t]!==""){e+="/"+encodeURIComponent(String(this.pieces_[t]))}}return e||"/"};e.prototype.slice=function(e){if(e===void 0){e=0}return this.pieces_.slice(this.pieceNum_+e)};e.prototype.parent=function(){if(this.pieceNum_>=this.pieces_.length){return null}var t=[];for(var r=this.pieceNum_;r<this.pieces_.length-1;r++){t.push(this.pieces_[r])}return new e(t,0)};e.prototype.child=function(t){var r=[];for(var n=this.pieceNum_;n<this.pieces_.length;n++){r.push(this.pieces_[n])}if(t instanceof e){for(var n=t.pieceNum_;n<t.pieces_.length;n++){r.push(t.pieces_[n])}}else{var i=t.split("/");for(var n=0;n<i.length;n++){if(i[n].length>0){r.push(i[n])}}}return new e(r,0)};e.prototype.isEmpty=function(){return this.pieceNum_>=this.pieces_.length};e.relativePath=function(t,r){var n=t.getFront(),i=r.getFront();if(n===null){return r}else if(n===i){return e.relativePath(t.popFront(),r.popFront())}else{throw new Error("INTERNAL ERROR: innerPath ("+r+") is not within "+"outerPath ("+t+")")}};e.comparePaths=function(e,t){var r=e.slice();var n=t.slice();for(var i=0;i<r.length&&i<n.length;i++){var o=k(r[i],n[i]);if(o!==0){return o}}if(r.length===n.length){return 0}return r.length<n.length?-1:1};e.prototype.equals=function(e){if(this.getLength()!==e.getLength()){return false}for(var t=this.pieceNum_,r=e.pieceNum_;t<=this.pieces_.length;t++,r++){if(this.pieces_[t]!==e.pieces_[r]){return false}}return true};e.prototype.contains=function(e){var t=this.pieceNum_;var r=e.pieceNum_;if(this.getLength()>e.getLength()){return false}while(t<this.pieces_.length){if(this.pieces_[t]!==e.pieces_[r]){return false}++t;++r}return true};return e}();var z=function(){function e(e,t){this.errorPrefix_=t;this.parts_=e.slice();this.byteLength_=Math.max(1,this.parts_.length);for(var r=0;r<this.parts_.length;r++){this.byteLength_+=a.stringLength(this.parts_[r])}this.checkValid_()}Object.defineProperty(e,"MAX_PATH_DEPTH",{get:function(){return 32},enumerable:true,configurable:true});Object.defineProperty(e,"MAX_PATH_LENGTH_BYTES",{get:function(){return 768},enumerable:true,configurable:true});e.prototype.push=function(e){if(this.parts_.length>0){this.byteLength_+=1}this.parts_.push(e);this.byteLength_+=a.stringLength(e);this.checkValid_()};e.prototype.pop=function(){var e=this.parts_.pop();this.byteLength_-=a.stringLength(e);if(this.parts_.length>0){this.byteLength_-=1}};e.prototype.checkValid_=function(){if(this.byteLength_>e.MAX_PATH_LENGTH_BYTES){throw new Error(this.errorPrefix_+"has a key path longer than "+e.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").")}if(this.parts_.length>e.MAX_PATH_DEPTH){throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+e.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())}};e.prototype.toErrorString=function(){if(this.parts_.length===0){return""}return"in property '"+this.parts_.join(".")+"'"};return e}();var G="5";var X="v";var $="s";var J="r";var Z="f";var ee="firebaseio.com";var te="ls";var re="websocket";var ne="long_polling";var ie=function(){function e(e,t,r,n,i,o){if(i===void 0){i=""}if(o===void 0){o=false}this.secure=t;this.namespace=r;this.webSocketOnly=n;this.persistenceKey=i;this.includeNamespaceInQueryParams=o;this.host=e.toLowerCase();this.domain=this.host.substr(this.host.indexOf(".")+1);this.internalHost=f.get("host:"+e)||this.host}e.prototype.needsQueryParam=function(){return this.host!==this.internalHost||this.isCustomHost()||this.includeNamespaceInQueryParams};e.prototype.isCacheableHost=function(){return this.internalHost.substr(0,2)==="s-"};e.prototype.isDemoHost=function(){return this.domain==="firebaseio-demo.com"};e.prototype.isCustomHost=function(){return this.domain!=="firebaseio.com"&&this.domain!=="firebaseio-demo.com"};e.prototype.updateHost=function(e){if(e!==this.internalHost){this.internalHost=e;if(this.isCacheableHost()){f.set("host:"+this.host,this.internalHost)}}};e.prototype.connectionURL=function(e,t){a.assert(typeof e==="string","typeof type must == string");a.assert(typeof t==="object","typeof params must == object");var r;if(e===re){r=(this.secure?"wss://":"ws://")+this.internalHost+"/.ws?"}else if(e===ne){r=(this.secure?"https://":"http://")+this.internalHost+"/.lp?"}else{throw new Error("Unknown connection type: "+e)}if(this.needsQueryParam()){t["ns"]=this.namespace}var n=[];M(t,(function(e,t){n.push(e+"="+t)}));return r+n.join("&")};e.prototype.toString=function(){var e=this.toURLString();if(this.persistenceKey){e+="<"+this.persistenceKey+">"}return e};e.prototype.toURLString=function(){return(this.secure?"https://":"http://")+this.host};return e}();function oe(e){var t="";var r=e.split("/");for(var n=0;n<r.length;n++){if(r[n].length>0){var i=r[n];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(o){}t+="/"+i}}return t}function se(e){var t,r;var n={};if(e.charAt(0)==="?"){e=e.substring(1)}try{for(var i=s.__values(e.split("&")),o=i.next();!o.done;o=i.next()){var a=o.value;if(a.length===0){continue}var l=a.split("=");if(l.length===2){n[decodeURIComponent(l[0])]=decodeURIComponent(l[1])}else{I("Invalid query segment '"+a+"' in query '"+e+"'")}}}catch(u){t={error:u}}finally{try{if(o&&!o.done&&(r=i.return))r.call(i)}finally{if(t)throw t.error}}return n}var ae=function(e){var t=le(e),r=t.namespace;if(t.domain==="firebase"){S(t.host+" is no longer supported. "+"Please use <YOUR FIREBASE>.firebaseio.com instead")}if((!r||r==="undefined")&&t.domain!=="localhost"){S("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com")}if(!t.secure){N()}var n=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new ie(t.host,t.secure,r,n,"",r!==t.subdomain),path:new K(t.pathString)}};var le=function(e){var t="",r="",n="",i="",o="";var s=true,a="https",l=443;if(typeof e==="string"){var u=e.indexOf("//");if(u>=0){a=e.substring(0,u-1);e=e.substring(u+2)}var h=e.indexOf("/");if(h===-1){h=e.length}var c=e.indexOf("?");if(c===-1){c=e.length}t=e.substring(0,Math.min(h,c));if(h<c){i=oe(e.substring(h,c))}var p=se(e.substring(Math.min(e.length,c)));u=t.indexOf(":");if(u>=0){s=a==="https"||a==="wss";l=parseInt(t.substring(u+1),10)}else{u=e.length}var f=t.split(".");if(f.length===3){r=f[1];n=f[0].toLowerCase();o=n}else if(f.length===2){r=f[0]}else if(f[0].slice(0,u).toLowerCase()==="localhost"){r="localhost"}if("ns"in p){o=p["ns"]}}return{host:t,port:l,domain:r,subdomain:n,secure:s,scheme:a,pathString:i,namespace:o}};var ue=/[\[\].#$\/\u0000-\u001F\u007F]/;var he=/[\[\].#$\u0000-\u001F\u007F]/;var ce=10*1024*1024;var pe=function(e){return typeof e==="string"&&e.length!==0&&!ue.test(e)};var fe=function(e){return typeof e==="string"&&e.length!==0&&!he.test(e)};var de=function(e){if(e){e=e.replace(/^\/*\.info(\/|$)/,"/")}return fe(e)};var ve=function(e){return e===null||typeof e==="string"||typeof e==="number"&&!P(e)||e&&typeof e==="object"&&a.contains(e,".sv")};var _e=function(e,t,r,n,i){if(i&&r===undefined){return}ye(a.errorPrefix(e,t,i),r,n)};var ye=function(e,t,r){var n=r instanceof K?new z(r,e):r;if(t===undefined){throw new Error(e+"contains undefined "+n.toErrorString())}if(typeof t==="function"){throw new Error(e+"contains a function "+n.toErrorString()+" with contents = "+t.toString())}if(P(t)){throw new Error(e+"contains "+t.toString()+" "+n.toErrorString())}if(typeof t==="string"&&t.length>ce/3&&a.stringLength(t)>ce){throw new Error(e+"contains a string greater than "+ce+" utf8 bytes "+n.toErrorString()+" ('"+t.substring(0,50)+"...')")}if(t&&typeof t==="object"){var i=false;var o=false;M(t,(function(t,r){if(t===".value"){i=true}else if(t!==".priority"&&t!==".sv"){o=true;if(!pe(t)){throw new Error(e+" contains an invalid key ("+t+") "+n.toErrorString()+".  Keys must be non-empty strings "+'and can\'t contain ".", "#", "$", "/", "[", or "]"')}}n.push(t);ye(e,r,n);n.pop()}));if(i&&o){throw new Error(e+' contains ".value" child '+n.toErrorString()+" in addition to actual children.")}}};var ge=function(e,t){var r,n;for(r=0;r<t.length;r++){n=t[r];var i=n.slice();for(var o=0;o<i.length;o++){if(i[o]===".priority"&&o===i.length-1);else if(!pe(i[o])){throw new Error(e+"contains an invalid key ("+i[o]+") in path "+n.toString()+". Keys must be non-empty strings "+'and can\'t contain ".", "#", "$", "/", "[", or "]"')}}}t.sort(K.comparePaths);var s=null;for(r=0;r<t.length;r++){n=t[r];if(s!==null&&s.contains(n)){throw new Error(e+"contains a path "+s.toString()+" that is ancestor of another path "+n.toString())}s=n}};var me=function(e,t,r,n,i){if(i&&r===undefined){return}var o=a.errorPrefix(e,t,i);if(!(r&&typeof r==="object")||Array.isArray(r)){throw new Error(o+" must be an object containing the children to replace.")}var s=[];M(r,(function(e,t){var r=new K(e);ye(o,t,n.child(r));if(r.getBack()===".priority"){if(!ve(t)){throw new Error(o+"contains an invalid value for '"+r.toString()+"', which must be a valid "+"Firebase priority (a string, finite number, server value, or null).")}}s.push(r)}));ge(o,s)};var Ce=function(e,t,r,n){if(n&&r===undefined){return}if(P(r)){throw new Error(a.errorPrefix(e,t,n)+"is "+r.toString()+", but must be a valid Firebase priority (a string, finite number, "+"server value, or null).")}if(!ve(r)){throw new Error(a.errorPrefix(e,t,n)+"must be a valid Firebase priority "+"(a string, finite number, server value, or null).")}};var Ee=function(e,t,r,n){if(n&&r===undefined){return}switch(r){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(a.errorPrefix(e,t,n)+'must be a valid event type = "value", "child_added", "child_removed", '+'"child_changed", or "child_moved".')}};var we=function(e,t,r,n){if(n&&r===undefined){return}if(!pe(r)){throw new Error(a.errorPrefix(e,t,n)+'was an invalid key = "'+r+'".  Firebase keys must be non-empty strings and '+'can\'t contain ".", "#", "$", "/", "[", or "]").')}};var Te=function(e,t,r,n){if(n&&r===undefined){return}if(!fe(r)){throw new Error(a.errorPrefix(e,t,n)+'was an invalid path = "'+r+'". Paths must be non-empty strings and '+'can\'t contain ".", "#", "$", "[", or "]"')}};var be=function(e,t,r,n){if(r){r=r.replace(/^\/*\.info(\/|$)/,"/")}Te(e,t,r,n)};var Se=function(e,t){if(t.getFront()===".info"){throw new Error(e+" failed = Can't modify data under /.info/")}};var Ie=function(e,t,r){var n=r.path.toString();if(!(typeof r.repoInfo.host==="string")||r.repoInfo.host.length===0||!pe(r.repoInfo.namespace)&&r.repoInfo.host.split(":")[0]!=="localhost"||n.length!==0&&!de(n)){throw new Error(a.errorPrefix(e,t,false)+"must be a valid firebase URL and "+'the path can\'t contain ".", "#", "$", "[", or "]".')}};var Ne=function(e,t,r,n){if(n&&r===undefined){return}if(typeof r!=="boolean"){throw new Error(a.errorPrefix(e,t,n)+"must be a boolean.")}};var Pe=function(){function e(e,t){this.repo_=e;this.path_=t}e.prototype.cancel=function(e){a.validateArgCount("OnDisconnect.cancel",0,1,arguments.length);a.validateCallback("OnDisconnect.cancel",1,e,true);var t=new a.Deferred;this.repo_.onDisconnectCancel(this.path_,t.wrapCallback(e));return t.promise};e.prototype.remove=function(e){a.validateArgCount("OnDisconnect.remove",0,1,arguments.length);Se("OnDisconnect.remove",this.path_);a.validateCallback("OnDisconnect.remove",1,e,true);var t=new a.Deferred;this.repo_.onDisconnectSet(this.path_,null,t.wrapCallback(e));return t.promise};e.prototype.set=function(e,t){a.validateArgCount("OnDisconnect.set",1,2,arguments.length);Se("OnDisconnect.set",this.path_);_e("OnDisconnect.set",1,e,this.path_,false);a.validateCallback("OnDisconnect.set",2,t,true);var r=new a.Deferred;this.repo_.onDisconnectSet(this.path_,e,r.wrapCallback(t));return r.promise};e.prototype.setWithPriority=function(e,t,r){a.validateArgCount("OnDisconnect.setWithPriority",2,3,arguments.length);Se("OnDisconnect.setWithPriority",this.path_);_e("OnDisconnect.setWithPriority",1,e,this.path_,false);Ce("OnDisconnect.setWithPriority",2,t,false);a.validateCallback("OnDisconnect.setWithPriority",3,r,true);var n=new a.Deferred;this.repo_.onDisconnectSetWithPriority(this.path_,e,t,n.wrapCallback(r));return n.promise};e.prototype.update=function(e,t){a.validateArgCount("OnDisconnect.update",1,2,arguments.length);Se("OnDisconnect.update",this.path_);if(Array.isArray(e)){var r={};for(var n=0;n<e.length;++n){r[""+n]=e[n]}e=r;I("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the "+"existing data, or an Object with integer keys if you really do want to only update some of the children.")}me("OnDisconnect.update",1,e,this.path_,false);a.validateCallback("OnDisconnect.update",2,t,true);var i=new a.Deferred;this.repo_.onDisconnectUpdate(this.path_,e,i.wrapCallback(t));return i.promise};return e}();var Re=function(){function e(e,t){this.committed=e;this.snapshot=t}e.prototype.toJSON=function(){a.validateArgCount("TransactionResult.toJSON",0,1,arguments.length);return{committed:this.committed,snapshot:this.snapshot.toJSON()}};return e}();var De=function(){var e="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz";var t=0;var r=[];return function(n){var i=n===t;t=n;var o;var s=new Array(8);for(o=7;o>=0;o--){s[o]=e.charAt(n%64);n=Math.floor(n/64)}a.assert(n===0,"Cannot push at time == 0");var l=s.join("");if(!i){for(o=0;o<12;o++){r[o]=Math.floor(Math.random()*64)}}else{for(o=11;o>=0&&r[o]===63;o--){r[o]=0}r[o]++}for(o=0;o<12;o++){l+=e.charAt(r[o])}a.assert(l.length===20,"nextPushId: Length should be 20.");return l}}();var xe=function(){function e(e,t){this.name=e;this.node=t}e.Wrap=function(t,r){return new e(t,r)};return e}();var ke=function(){function e(){}e.prototype.getCompare=function(){return this.compare.bind(this)};e.prototype.indexedValueChanged=function(e,t){var r=new xe(D,e);var n=new xe(D,t);return this.compare(r,n)!==0};e.prototype.minPost=function(){return xe.MIN};return e}();var Oe;var Fe=function(e){s.__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}Object.defineProperty(t,"__EMPTY_NODE",{get:function(){return Oe},set:function(e){Oe=e},enumerable:true,configurable:true});t.prototype.compare=function(e,t){return k(e.name,t.name)};t.prototype.isDefinedOn=function(e){throw a.assertionError("KeyIndex.isDefinedOn not expected to be called.")};t.prototype.indexedValueChanged=function(e,t){return false};t.prototype.minPost=function(){return xe.MIN};t.prototype.maxPost=function(){return new xe(x,Oe)};t.prototype.makePost=function(e,t){a.assert(typeof e==="string","KeyIndex indexValue must always be a string.");return new xe(e,Oe)};t.prototype.toString=function(){return".key"};return t}(ke);var Ae=new Fe;var Le;function Me(e){Le=e}var We=function(e){if(typeof e==="number"){return"number:"+W(e)}else{return"string:"+e}};var Qe=function(e){if(e.isLeafNode()){var t=e.val();a.assert(typeof t==="string"||typeof t==="number"||typeof t==="object"&&a.contains(t,".sv"),"Priority must be a string or number.")}else{a.assert(e===Le||e.isEmpty(),"priority of unexpected type.")}a.assert(e===Le||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var qe;var Ue=function(){function e(t,r){if(r===void 0){r=e.__childrenNodeConstructor.EMPTY_NODE}this.value_=t;this.priorityNode_=r;this.lazyHash_=null;a.assert(this.value_!==undefined&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value.");Qe(this.priorityNode_)}Object.defineProperty(e,"__childrenNodeConstructor",{get:function(){return qe},set:function(e){qe=e},enumerable:true,configurable:true});e.prototype.isLeafNode=function(){return true};e.prototype.getPriority=function(){return this.priorityNode_};e.prototype.updatePriority=function(t){return new e(this.value_,t)};e.prototype.getImmediateChild=function(t){if(t===".priority"){return this.priorityNode_}else{return e.__childrenNodeConstructor.EMPTY_NODE}};e.prototype.getChild=function(t){if(t.isEmpty()){return this}else if(t.getFront()===".priority"){return this.priorityNode_}else{return e.__childrenNodeConstructor.EMPTY_NODE}};e.prototype.hasChild=function(){return false};e.prototype.getPredecessorChildName=function(e,t){return null};e.prototype.updateImmediateChild=function(t,r){if(t===".priority"){return this.updatePriority(r)}else if(r.isEmpty()&&t!==".priority"){return this}else{return e.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,r).updatePriority(this.priorityNode_)}};e.prototype.updateChild=function(t,r){var n=t.getFront();if(n===null){return r}else if(r.isEmpty()&&n!==".priority"){return this}else{a.assert(n!==".priority"||t.getLength()===1,".priority must be the last token in a path");return this.updateImmediateChild(n,e.__childrenNodeConstructor.EMPTY_NODE.updateChild(t.popFront(),r))}};e.prototype.isEmpty=function(){return false};e.prototype.numChildren=function(){return 0};e.prototype.forEachChild=function(e,t){return false};e.prototype.val=function(e){if(e&&!this.getPriority().isEmpty()){return{".value":this.getValue(),".priority":this.getPriority().val()}}else{return this.getValue()}};e.prototype.hash=function(){if(this.lazyHash_===null){var e="";if(!this.priorityNode_.isEmpty()){e+="priority:"+We(this.priorityNode_.val())+":"}var t=typeof this.value_;e+=t+":";if(t==="number"){e+=W(this.value_)}else{e+=this.value_}this.lazyHash_=y(e)}return this.lazyHash_};e.prototype.getValue=function(){return this.value_};e.prototype.compareTo=function(t){if(t===e.__childrenNodeConstructor.EMPTY_NODE){return 1}else if(t instanceof e.__childrenNodeConstructor){return-1}else{a.assert(t.isLeafNode(),"Unknown node type");return this.compareToLeafNode_(t)}};e.prototype.compareToLeafNode_=function(t){var r=typeof t.value_;var n=typeof this.value_;var i=e.VALUE_TYPE_ORDER.indexOf(r);var o=e.VALUE_TYPE_ORDER.indexOf(n);a.assert(i>=0,"Unknown leaf type: "+r);a.assert(o>=0,"Unknown leaf type: "+n);if(i===o){if(n==="object"){return 0}else{if(this.value_<t.value_){return-1}else if(this.value_===t.value_){return 0}else{return 1}}}else{return o-i}};e.prototype.withIndex=function(){return this};e.prototype.isIndexed=function(){return true};e.prototype.equals=function(e){if(e===this){return true}else if(e.isLeafNode()){var t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else{return false}};e.VALUE_TYPE_ORDER=["object","boolean","number","string"];return e}();var Ve;var He;function je(e){Ve=e}function Be(e){He=e}var Ye=function(e){s.__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.compare=function(e,t){var r=e.node.getPriority();var n=t.node.getPriority();var i=r.compareTo(n);if(i===0){return k(e.name,t.name)}else{return i}};t.prototype.isDefinedOn=function(e){return!e.getPriority().isEmpty()};t.prototype.indexedValueChanged=function(e,t){return!e.getPriority().equals(t.getPriority())};t.prototype.minPost=function(){return xe.MIN};t.prototype.maxPost=function(){return new xe(x,new Ue("[PRIORITY-POST]",He))};t.prototype.makePost=function(e,t){var r=Ve(e);return new xe(t,new Ue("[PRIORITY-POST]",r))};t.prototype.toString=function(){return".priority"};return t}(ke);var Ke=new Ye;var ze=function(){function e(e,t,r,n,i){if(i===void 0){i=null}this.isReverse_=n;this.resultGenerator_=i;this.nodeStack_=[];var o=1;while(!e.isEmpty()){e=e;o=t?r(e.key,t):1;if(n){o*=-1}if(o<0){if(this.isReverse_){e=e.left}else{e=e.right}}else if(o===0){this.nodeStack_.push(e);break}else{this.nodeStack_.push(e);if(this.isReverse_){e=e.right}else{e=e.left}}}}e.prototype.getNext=function(){if(this.nodeStack_.length===0){return null}var e=this.nodeStack_.pop();var t;if(this.resultGenerator_){t=this.resultGenerator_(e.key,e.value)}else{t={key:e.key,value:e.value}}if(this.isReverse_){e=e.left;while(!e.isEmpty()){this.nodeStack_.push(e);e=e.right}}else{e=e.right;while(!e.isEmpty()){this.nodeStack_.push(e);e=e.left}}return t};e.prototype.hasNext=function(){return this.nodeStack_.length>0};e.prototype.peek=function(){if(this.nodeStack_.length===0){return null}var e=this.nodeStack_[this.nodeStack_.length-1];if(this.resultGenerator_){return this.resultGenerator_(e.key,e.value)}else{return{key:e.key,value:e.value}}};return e}();var Ge=function(){function e(t,r,n,i,o){this.key=t;this.value=r;this.color=n!=null?n:e.RED;this.left=i!=null?i:$e.EMPTY_NODE;this.right=o!=null?o:$e.EMPTY_NODE}e.prototype.copy=function(t,r,n,i,o){return new e(t!=null?t:this.key,r!=null?r:this.value,n!=null?n:this.color,i!=null?i:this.left,o!=null?o:this.right)};e.prototype.count=function(){return this.left.count()+1+this.right.count()};e.prototype.isEmpty=function(){return false};e.prototype.inorderTraversal=function(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)};e.prototype.reverseTraversal=function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)};e.prototype.min_=function(){if(this.left.isEmpty()){return this}else{return this.left.min_()}};e.prototype.minKey=function(){return this.min_().key};e.prototype.maxKey=function(){if(this.right.isEmpty()){return this.key}else{return this.right.maxKey()}};e.prototype.insert=function(e,t,r){var n=this;var i=r(e,n.key);if(i<0){n=n.copy(null,null,null,n.left.insert(e,t,r),null)}else if(i===0){n=n.copy(null,t,null,null,null)}else{n=n.copy(null,null,null,null,n.right.insert(e,t,r))}return n.fixUp_()};e.prototype.removeMin_=function(){if(this.left.isEmpty()){return $e.EMPTY_NODE}var e=this;if(!e.left.isRed_()&&!e.left.left.isRed_()){e=e.moveRedLeft_()}e=e.copy(null,null,null,e.left.removeMin_(),null);return e.fixUp_()};e.prototype.remove=function(e,t){var r,n;r=this;if(t(e,r.key)<0){if(!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()){r=r.moveRedLeft_()}r=r.copy(null,null,null,r.left.remove(e,t),null)}else{if(r.left.isRed_()){r=r.rotateRight_()}if(!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()){r=r.moveRedRight_()}if(t(e,r.key)===0){if(r.right.isEmpty()){return $e.EMPTY_NODE}else{n=r.right.min_();r=r.copy(n.key,n.value,null,null,r.right.removeMin_())}}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp_()};e.prototype.isRed_=function(){return this.color};e.prototype.fixUp_=function(){var e=this;if(e.right.isRed_()&&!e.left.isRed_()){e=e.rotateLeft_()}if(e.left.isRed_()&&e.left.left.isRed_()){e=e.rotateRight_()}if(e.left.isRed_()&&e.right.isRed_()){e=e.colorFlip_()}return e};e.prototype.moveRedLeft_=function(){var e=this.colorFlip_();if(e.right.left.isRed_()){e=e.copy(null,null,null,null,e.right.rotateRight_());e=e.rotateLeft_();e=e.colorFlip_()}return e};e.prototype.moveRedRight_=function(){var e=this.colorFlip_();if(e.left.left.isRed_()){e=e.rotateRight_();e=e.colorFlip_()}return e};e.prototype.rotateLeft_=function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)};e.prototype.rotateRight_=function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)};e.prototype.colorFlip_=function(){var e=this.left.copy(null,null,!this.left.color,null,null);var t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)};e.prototype.checkMaxDepth_=function(){var e=this.check_();return Math.pow(2,e)<=this.count()+1};e.prototype.check_=function(){if(this.isRed_()&&this.left.isRed_()){throw new Error("Red node has red child("+this.key+","+this.value+")")}if(this.right.isRed_()){throw new Error("Right child of ("+this.key+","+this.value+") is red")}var e=this.left.check_();if(e!==this.right.check_()){throw new Error("Black depths differ")}else{return e+(this.isRed_()?0:1)}};e.RED=true;e.BLACK=false;return e}();var Xe=function(){function e(){}e.prototype.copy=function(e,t,r,n,i){return this};e.prototype.insert=function(e,t,r){return new Ge(e,t,null)};e.prototype.remove=function(e,t){return this};e.prototype.count=function(){return 0};e.prototype.isEmpty=function(){return true};e.prototype.inorderTraversal=function(e){return false};e.prototype.reverseTraversal=function(e){return false};e.prototype.minKey=function(){return null};e.prototype.maxKey=function(){return null};e.prototype.check_=function(){return 0};e.prototype.isRed_=function(){return false};return e}();var $e=function(){function e(t,r){if(r===void 0){r=e.EMPTY_NODE}this.comparator_=t;this.root_=r}e.prototype.insert=function(t,r){return new e(this.comparator_,this.root_.insert(t,r,this.comparator_).copy(null,null,Ge.BLACK,null,null))};e.prototype.remove=function(t){return new e(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,Ge.BLACK,null,null))};e.prototype.get=function(e){var t;var r=this.root_;while(!r.isEmpty()){t=this.comparator_(e,r.key);if(t===0){return r.value}else if(t<0){r=r.left}else if(t>0){r=r.right}}return null};e.prototype.getPredecessorKey=function(e){var t,r=this.root_,n=null;while(!r.isEmpty()){t=this.comparator_(e,r.key);if(t===0){if(!r.left.isEmpty()){r=r.left;while(!r.right.isEmpty()){r=r.right}return r.key}else if(n){return n.key}else{return null}}else if(t<0){r=r.left}else if(t>0){n=r;r=r.right}}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")};e.prototype.isEmpty=function(){return this.root_.isEmpty()};e.prototype.count=function(){return this.root_.count()};e.prototype.minKey=function(){return this.root_.minKey()};e.prototype.maxKey=function(){return this.root_.maxKey()};e.prototype.inorderTraversal=function(e){return this.root_.inorderTraversal(e)};e.prototype.reverseTraversal=function(e){return this.root_.reverseTraversal(e)};e.prototype.getIterator=function(e){return new ze(this.root_,null,this.comparator_,false,e)};e.prototype.getIteratorFrom=function(e,t){return new ze(this.root_,e,this.comparator_,false,t)};e.prototype.getReverseIteratorFrom=function(e,t){return new ze(this.root_,e,this.comparator_,true,t)};e.prototype.getReverseIterator=function(e){return new ze(this.root_,null,this.comparator_,true,e)};e.EMPTY_NODE=new Xe;return e}();var Je=Math.log(2);var Ze=function(){function e(e){var t=function(e){return parseInt(Math.log(e)/Je,10)};var r=function(e){return parseInt(Array(e+1).join("1"),2)};this.count=t(e+1);this.current_=this.count-1;var n=r(this.count);this.bits_=e+1&n}e.prototype.nextBitIsOne=function(){var e=!(this.bits_&1<<this.current_);this.current_--;return e};return e}();var et=function(e,t,r,n){e.sort(t);var i=function(t,n){var o=n-t;var s;var a;if(o===0){return null}else if(o===1){s=e[t];a=r?r(s):s;return new Ge(a,s.node,Ge.BLACK,null,null)}else{var l=parseInt(o/2,10)+t;var u=i(t,l);var h=i(l+1,n);s=e[l];a=r?r(s):s;return new Ge(a,s.node,Ge.BLACK,u,h)}};var o=function(t){var n=null;var o=null;var s=e.length;var a=function(t,n){var o=s-t;var a=s;s-=t;var u=i(o+1,a);var h=e[o];var c=r?r(h):h;l(new Ge(c,h.node,n,null,u))};var l=function(e){if(n){n.left=e;n=e}else{o=e;n=e}};for(var u=0;u<t.count;++u){var h=t.nextBitIsOne();var c=Math.pow(2,t.count-(u+1));if(h){a(c,Ge.BLACK)}else{a(c,Ge.BLACK);a(c,Ge.RED)}}return o};var s=new Ze(e.length);var a=o(s);return new $e(n||t,a)};var tt;var rt={};var nt=function(){function e(e,t){this.indexes_=e;this.indexSet_=t}Object.defineProperty(e,"Default",{get:function(){a.assert(rt&&Ke,"ChildrenNode.ts has not been loaded");tt=tt||new e({".priority":rt},{".priority":Ke});return tt},enumerable:true,configurable:true});e.prototype.get=function(e){var t=a.safeGet(this.indexes_,e);if(!t){throw new Error("No index defined for "+e)}if(t instanceof $e){return t}else{return null}};e.prototype.hasIndex=function(e){return a.contains(this.indexSet_,e.toString())};e.prototype.addIndex=function(t,r){a.assert(t!==Ae,"KeyIndex always exists and isn't meant to be added to the IndexMap.");var n=[];var i=false;var o=r.getIterator(xe.Wrap);var l=o.getNext();while(l){i=i||t.isDefinedOn(l.node);n.push(l);l=o.getNext()}var u;if(i){u=et(n,t.getCompare())}else{u=rt}var h=t.toString();var c=s.__assign({},this.indexSet_);c[h]=t;var p=s.__assign({},this.indexes_);p[h]=u;return new e(p,c)};e.prototype.addToIndexes=function(t,r){var n=this;var i=a.map(this.indexes_,(function(e,i){var o=a.safeGet(n.indexSet_,i);a.assert(o,"Missing index implementation for "+i);if(e===rt){if(o.isDefinedOn(t.node)){var s=[];var l=r.getIterator(xe.Wrap);var u=l.getNext();while(u){if(u.name!==t.name){s.push(u)}u=l.getNext()}s.push(t);return et(s,o.getCompare())}else{return rt}}else{var h=r.get(t.name);var c=e;if(h){c=c.remove(new xe(t.name,h))}return c.insert(t,t.node)}}));return new e(i,this.indexSet_)};e.prototype.removeFromIndexes=function(t,r){var n=a.map(this.indexes_,(function(e){if(e===rt){return e}else{var n=r.get(t.name);if(n){return e.remove(new xe(t.name,n))}else{return e}}}));return new e(n,this.indexSet_)};return e}();function it(e,t){return k(e.name,t.name)}function ot(e,t){return k(e,t)}var st;var at=function(){function e(e,t,r){this.children_=e;this.priorityNode_=t;this.indexMap_=r;this.lazyHash_=null;if(this.priorityNode_){Qe(this.priorityNode_)}if(this.children_.isEmpty()){a.assert(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}}Object.defineProperty(e,"EMPTY_NODE",{get:function(){return st||(st=new e(new $e(ot),null,nt.Default))},enumerable:true,configurable:true});e.prototype.isLeafNode=function(){return false};e.prototype.getPriority=function(){return this.priorityNode_||st};e.prototype.updatePriority=function(t){if(this.children_.isEmpty()){return this}else{return new e(this.children_,t,this.indexMap_)}};e.prototype.getImmediateChild=function(e){if(e===".priority"){return this.getPriority()}else{var t=this.children_.get(e);return t===null?st:t}};e.prototype.getChild=function(e){var t=e.getFront();if(t===null){return this}return this.getImmediateChild(t).getChild(e.popFront())};e.prototype.hasChild=function(e){return this.children_.get(e)!==null};e.prototype.updateImmediateChild=function(t,r){a.assert(r,"We should always be passing snapshot nodes");if(t===".priority"){return this.updatePriority(r)}else{var n=new xe(t,r);var i=void 0,o=void 0;if(r.isEmpty()){i=this.children_.remove(t);o=this.indexMap_.removeFromIndexes(n,this.children_)}else{i=this.children_.insert(t,r);o=this.indexMap_.addToIndexes(n,this.children_)}var s=i.isEmpty()?st:this.priorityNode_;return new e(i,s,o)}};e.prototype.updateChild=function(e,t){var r=e.getFront();if(r===null){return t}else{a.assert(e.getFront()!==".priority"||e.getLength()===1,".priority must be the last token in a path");var n=this.getImmediateChild(r).updateChild(e.popFront(),t);return this.updateImmediateChild(r,n)}};e.prototype.isEmpty=function(){return this.children_.isEmpty()};e.prototype.numChildren=function(){return this.children_.count()};e.prototype.val=function(t){if(this.isEmpty()){return null}var r={};var n=0,i=0,o=true;this.forEachChild(Ke,(function(s,a){r[s]=a.val(t);n++;if(o&&e.INTEGER_REGEXP_.test(s)){i=Math.max(i,Number(s))}else{o=false}}));if(!t&&o&&i<2*n){var s=[];for(var a in r){s[a]=r[a]}return s}else{if(t&&!this.getPriority().isEmpty()){r[".priority"]=this.getPriority().val()}return r}};e.prototype.hash=function(){if(this.lazyHash_===null){var e="";if(!this.getPriority().isEmpty()){e+="priority:"+We(this.getPriority().val())+":"}this.forEachChild(Ke,(function(t,r){var n=r.hash();if(n!==""){e+=":"+t+":"+n}}));this.lazyHash_=e===""?"":y(e)}return this.lazyHash_};e.prototype.getPredecessorChildName=function(e,t,r){var n=this.resolveIndex_(r);if(n){var i=n.getPredecessorKey(new xe(e,t));return i?i.name:null}else{return this.children_.getPredecessorKey(e)}};e.prototype.getFirstChildName=function(e){var t=this.resolveIndex_(e);if(t){var r=t.minKey();return r&&r.name}else{return this.children_.minKey()}};e.prototype.getFirstChild=function(e){var t=this.getFirstChildName(e);if(t){return new xe(t,this.children_.get(t))}else{return null}};e.prototype.getLastChildName=function(e){var t=this.resolveIndex_(e);if(t){var r=t.maxKey();return r&&r.name}else{return this.children_.maxKey()}};e.prototype.getLastChild=function(e){var t=this.getLastChildName(e);if(t){return new xe(t,this.children_.get(t))}else{return null}};e.prototype.forEachChild=function(e,t){var r=this.resolveIndex_(e);if(r){return r.inorderTraversal((function(e){return t(e.name,e.node)}))}else{return this.children_.inorderTraversal(t)}};e.prototype.getIterator=function(e){return this.getIteratorFrom(e.minPost(),e)};e.prototype.getIteratorFrom=function(e,t){var r=this.resolveIndex_(t);if(r){return r.getIteratorFrom(e,(function(e){return e}))}else{var n=this.children_.getIteratorFrom(e.name,xe.Wrap);var i=n.peek();while(i!=null&&t.compare(i,e)<0){n.getNext();i=n.peek()}return n}};e.prototype.getReverseIterator=function(e){return this.getReverseIteratorFrom(e.maxPost(),e)};e.prototype.getReverseIteratorFrom=function(e,t){var r=this.resolveIndex_(t);if(r){return r.getReverseIteratorFrom(e,(function(e){return e}))}else{var n=this.children_.getReverseIteratorFrom(e.name,xe.Wrap);var i=n.peek();while(i!=null&&t.compare(i,e)>0){n.getNext();i=n.peek()}return n}};e.prototype.compareTo=function(e){if(this.isEmpty()){if(e.isEmpty()){return 0}else{return-1}}else if(e.isLeafNode()||e.isEmpty()){return 1}else if(e===ut){return-1}else{return 0}};e.prototype.withIndex=function(t){if(t===Ae||this.indexMap_.hasIndex(t)){return this}else{var r=this.indexMap_.addIndex(t,this.children_);return new e(this.children_,this.priorityNode_,r)}};e.prototype.isIndexed=function(e){return e===Ae||this.indexMap_.hasIndex(e)};e.prototype.equals=function(e){if(e===this){return true}else if(e.isLeafNode()){return false}else{var t=e;if(!this.getPriority().equals(t.getPriority())){return false}else if(this.children_.count()===t.children_.count()){var r=this.getIterator(Ke);var n=t.getIterator(Ke);var i=r.getNext();var o=n.getNext();while(i&&o){if(i.name!==o.name||!i.node.equals(o.node)){return false}i=r.getNext();o=n.getNext()}return i===null&&o===null}else{return false}}};e.prototype.resolveIndex_=function(e){if(e===Ae){return null}else{return this.indexMap_.get(e.toString())}};e.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;return e}();var lt=function(e){s.__extends(t,e);function t(){return e.call(this,new $e(ot),at.EMPTY_NODE,nt.Default)||this}t.prototype.compareTo=function(e){if(e===this){return 0}else{return 1}};t.prototype.equals=function(e){return e===this};t.prototype.getPriority=function(){return this};t.prototype.getImmediateChild=function(e){return at.EMPTY_NODE};t.prototype.isEmpty=function(){return false};return t}(at);var ut=new lt;Object.defineProperties(xe,{MIN:{value:new xe(D,at.EMPTY_NODE)},MAX:{value:new xe(x,ut)}});Fe.__EMPTY_NODE=at.EMPTY_NODE;Ue.__childrenNodeConstructor=at;Me(ut);Be(ut);var ht=true;function ct(e,t){if(t===void 0){t=null}if(e===null){return at.EMPTY_NODE}if(typeof e==="object"&&".priority"in e){t=e[".priority"]}a.assert(t===null||typeof t==="string"||typeof t==="number"||typeof t==="object"&&".sv"in t,"Invalid priority type found: "+typeof t);if(typeof e==="object"&&".value"in e&&e[".value"]!==null){e=e[".value"]}if(typeof e!=="object"||".sv"in e){var r=e;return new Ue(r,ct(t))}if(!(e instanceof Array)&&ht){var n=[];var i=false;var o=e;M(o,(function(e,t){if(e.substring(0,1)!=="."){var r=ct(t);if(!r.isEmpty()){i=i||!r.getPriority().isEmpty();n.push(new xe(e,r))}}}));if(n.length===0){return at.EMPTY_NODE}var s=et(n,it,(function(e){return e.name}),ot);if(i){var l=et(n,Ke.getCompare());return new at(s,ct(t),new nt({".priority":l},{".priority":Ke}))}else{return new at(s,ct(t),nt.Default)}}else{var u=at.EMPTY_NODE;M(e,(function(t,r){if(a.contains(e,t)){if(t.substring(0,1)!=="."){var n=ct(r);if(n.isLeafNode()||!n.isEmpty()){u=u.updateImmediateChild(t,n)}}}}));return u.updatePriority(ct(t))}}je(ct);var pt=function(e){s.__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.compare=function(e,t){var r=e.node.compareTo(t.node);if(r===0){return k(e.name,t.name)}else{return r}};t.prototype.isDefinedOn=function(e){return true};t.prototype.indexedValueChanged=function(e,t){return!e.equals(t)};t.prototype.minPost=function(){return xe.MIN};t.prototype.maxPost=function(){return xe.MAX};t.prototype.makePost=function(e,t){var r=ct(e);return new xe(t,r)};t.prototype.toString=function(){return".value"};return t}(ke);var ft=new pt;var dt=function(e){s.__extends(t,e);function t(t){var r=e.call(this)||this;r.indexPath_=t;a.assert(!t.isEmpty()&&t.getFront()!==".priority","Can't create PathIndex with empty path or .priority key");return r}t.prototype.extractChild=function(e){return e.getChild(this.indexPath_)};t.prototype.isDefinedOn=function(e){return!e.getChild(this.indexPath_).isEmpty()};t.prototype.compare=function(e,t){var r=this.extractChild(e.node);var n=this.extractChild(t.node);var i=r.compareTo(n);if(i===0){return k(e.name,t.name)}else{return i}};t.prototype.makePost=function(e,t){var r=ct(e);var n=at.EMPTY_NODE.updateChild(this.indexPath_,r);return new xe(t,n)};t.prototype.maxPost=function(){var e=at.EMPTY_NODE.updateChild(this.indexPath_,ut);return new xe(x,e)};t.prototype.toString=function(){return this.indexPath_.slice().join("/")};return t}(ke);var vt=function(){function e(e,t,r){this.node_=e;this.ref_=t;this.index_=r}e.prototype.val=function(){a.validateArgCount("DataSnapshot.val",0,0,arguments.length);return this.node_.val()};e.prototype.exportVal=function(){a.validateArgCount("DataSnapshot.exportVal",0,0,arguments.length);return this.node_.val(true)};e.prototype.toJSON=function(){a.validateArgCount("DataSnapshot.toJSON",0,1,arguments.length);return this.exportVal()};e.prototype.exists=function(){a.validateArgCount("DataSnapshot.exists",0,0,arguments.length);return!this.node_.isEmpty()};e.prototype.child=function(t){a.validateArgCount("DataSnapshot.child",0,1,arguments.length);t=String(t);Te("DataSnapshot.child",1,t,false);var r=new K(t);var n=this.ref_.child(r);return new e(this.node_.getChild(r),n,Ke)};e.prototype.hasChild=function(e){a.validateArgCount("DataSnapshot.hasChild",1,1,arguments.length);Te("DataSnapshot.hasChild",1,e,false);var t=new K(e);return!this.node_.getChild(t).isEmpty()};e.prototype.getPriority=function(){a.validateArgCount("DataSnapshot.getPriority",0,0,arguments.length);return this.node_.getPriority().val()};e.prototype.forEach=function(t){var r=this;a.validateArgCount("DataSnapshot.forEach",1,1,arguments.length);a.validateCallback("DataSnapshot.forEach",1,t,false);if(this.node_.isLeafNode()){return false}var n=this.node_;return!!n.forEachChild(this.index_,(function(n,i){return t(new e(i,r.ref_.child(n),Ke))}))};e.prototype.hasChildren=function(){a.validateArgCount("DataSnapshot.hasChildren",0,0,arguments.length);if(this.node_.isLeafNode()){return false}else{return!this.node_.isEmpty()}};Object.defineProperty(e.prototype,"key",{get:function(){return this.ref_.getKey()},enumerable:true,configurable:true});e.prototype.numChildren=function(){a.validateArgCount("DataSnapshot.numChildren",0,0,arguments.length);return this.node_.numChildren()};e.prototype.getRef=function(){a.validateArgCount("DataSnapshot.ref",0,0,arguments.length);return this.ref_};Object.defineProperty(e.prototype,"ref",{get:function(){return this.getRef()},enumerable:true,configurable:true});return e}();var _t=function(){function e(e,t,r,n){this.eventType=e;this.eventRegistration=t;this.snapshot=r;this.prevName=n}e.prototype.getPath=function(){var e=this.snapshot.getRef();if(this.eventType==="value"){return e.path}else{return e.getParent().path}};e.prototype.getEventType=function(){return this.eventType};e.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)};e.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+a.stringify(this.snapshot.exportVal())};return e}();var yt=function(){function e(e,t,r){this.eventRegistration=e;this.error=t;this.path=r}e.prototype.getPath=function(){return this.path};e.prototype.getEventType=function(){return"cancel"};e.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)};e.prototype.toString=function(){return this.path.toString()+":cancel"};return e}();var gt=function(){function e(e,t,r){this.callback_=e;this.cancelCallback_=t;this.context_=r}e.prototype.respondsTo=function(e){return e==="value"};e.prototype.createEvent=function(e,t){var r=t.getQueryParams().getIndex();return new _t("value",this,new vt(e.snapshotNode,t.getRef(),r))};e.prototype.getEventRunner=function(e){var t=this.context_;if(e.getEventType()==="cancel"){a.assert(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var r=this.cancelCallback_;return function(){r.call(t,e.error)}}else{var n=this.callback_;return function(){n.call(t,e.snapshot)}}};e.prototype.createCancelEvent=function(e,t){if(this.cancelCallback_){return new yt(this,e,t)}else{return null}};e.prototype.matches=function(t){if(!(t instanceof e)){return false}else if(!t.callback_||!this.callback_){return true}else{return t.callback_===this.callback_&&t.context_===this.context_}};e.prototype.hasAnyCallback=function(){return this.callback_!==null};return e}();var mt=function(){function e(e,t,r){this.callbacks_=e;this.cancelCallback_=t;this.context_=r}e.prototype.respondsTo=function(e){var t=e==="children_added"?"child_added":e;t=t==="children_removed"?"child_removed":t;return a.contains(this.callbacks_,t)};e.prototype.createCancelEvent=function(e,t){if(this.cancelCallback_){return new yt(this,e,t)}else{return null}};e.prototype.createEvent=function(e,t){a.assert(e.childName!=null,"Child events should have a childName.");var r=t.getRef().child(e.childName);var n=t.getQueryParams().getIndex();return new _t(e.type,this,new vt(e.snapshotNode,r,n),e.prevName)};e.prototype.getEventRunner=function(e){var t=this.context_;if(e.getEventType()==="cancel"){a.assert(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var r=this.cancelCallback_;return function(){r.call(t,e.error)}}else{var n=this.callbacks_[e.eventType];return function(){n.call(t,e.snapshot,e.prevName)}}};e.prototype.matches=function(t){var r=this;if(t instanceof e){if(!this.callbacks_||!t.callbacks_){return true}else if(this.context_===t.context_){var n=Object.keys(t.callbacks_);var i=Object.keys(this.callbacks_);var o=n.length;var s=i.length;if(o===s){if(o===1){var a=n[0];var l=i[0];return l===a&&(!t.callbacks_[a]||!this.callbacks_[l]||t.callbacks_[a]===this.callbacks_[l])}else{return i.every((function(e){return t.callbacks_[e]===r.callbacks_[e]}))}}}}return false};e.prototype.hasAnyCallback=function(){return this.callbacks_!==null};return e}();var Ct;var Et=function(){function e(e,t,r,n){this.repo=e;this.path=t;this.queryParams_=r;this.orderByCalled_=n}Object.defineProperty(e,"__referenceConstructor",{get:function(){a.assert(Ct,"Reference.ts has not been loaded");return Ct},set:function(e){Ct=e},enumerable:true,configurable:true});e.validateQueryEndpoints_=function(e){var t=null;var r=null;if(e.hasStart()){t=e.getIndexStartValue()}if(e.hasEnd()){r=e.getIndexEndValue()}if(e.getIndex()===Ae){var n="Query: When ordering by key, you may only pass one argument to "+"startAt(), endAt(), or equalTo().";var i="Query: When ordering by key, the argument passed to startAt(), endAt(),"+"or equalTo() must be a string.";if(e.hasStart()){var o=e.getIndexStartName();if(o!==D){throw new Error(n)}else if(typeof t!=="string"){throw new Error(i)}}if(e.hasEnd()){var s=e.getIndexEndName();if(s!==x){throw new Error(n)}else if(typeof r!=="string"){throw new Error(i)}}}else if(e.getIndex()===Ke){if(t!=null&&!ve(t)||r!=null&&!ve(r)){throw new Error("Query: When ordering by priority, the first argument passed to startAt(), "+"endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}}else{a.assert(e.getIndex()instanceof dt||e.getIndex()===ft,"unknown index type.");if(t!=null&&typeof t==="object"||r!=null&&typeof r==="object"){throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be "+"an object.")}}};e.validateLimit_=function(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit()){throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")}};e.prototype.validateNoPreviousOrderByCall_=function(e){if(this.orderByCalled_===true){throw new Error(e+": You can't combine multiple orderBy calls.")}};e.prototype.getQueryParams=function(){return this.queryParams_};e.prototype.getRef=function(){a.validateArgCount("Query.ref",0,0,arguments.length);return new e.__referenceConstructor(this.repo,this.path)};e.prototype.on=function(t,r,n,i){a.validateArgCount("Query.on",2,4,arguments.length);Ee("Query.on",1,t,false);a.validateCallback("Query.on",2,r,false);var o=e.getCancelAndContextArgs_("Query.on",n,i);if(t==="value"){this.onValueEvent(r,o.cancel,o.context)}else{var s={};s[t]=r;this.onChildEvent(s,o.cancel,o.context)}return r};e.prototype.onValueEvent=function(e,t,r){var n=new gt(e,t||null,r||null);this.repo.addEventCallbackForQuery(this,n)};e.prototype.onChildEvent=function(e,t,r){var n=new mt(e,t,r);this.repo.addEventCallbackForQuery(this,n)};e.prototype.off=function(e,t,r){a.validateArgCount("Query.off",0,3,arguments.length);Ee("Query.off",1,e,true);a.validateCallback("Query.off",2,t,true);a.validateContextObject("Query.off",3,r,true);var n=null;var i=null;if(e==="value"){var o=t||null;n=new gt(o,null,r||null)}else if(e){if(t){i={};i[e]=t}n=new mt(i,null,r||null)}this.repo.removeEventCallbackForQuery(this,n)};e.prototype.once=function(t,r,n,i){var o=this;a.validateArgCount("Query.once",1,4,arguments.length);Ee("Query.once",1,t,false);a.validateCallback("Query.once",2,r,true);var s=e.getCancelAndContextArgs_("Query.once",n,i);var l=true;var u=new a.Deferred;u.promise.catch((function(){}));var h=function(e){if(l){l=false;o.off(t,h);if(r){r.bind(s.context)(e)}u.resolve(e)}};this.on(t,h,(function(e){o.off(t,h);if(s.cancel){s.cancel.bind(s.context)(e)}u.reject(e)}));return u.promise};e.prototype.limitToFirst=function(t){a.validateArgCount("Query.limitToFirst",1,1,arguments.length);if(typeof t!=="number"||Math.floor(t)!==t||t<=0){throw new Error("Query.limitToFirst: First argument must be a positive integer.")}if(this.queryParams_.hasLimit()){throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, "+"limitToFirst, or limitToLast).")}return new e(this.repo,this.path,this.queryParams_.limitToFirst(t),this.orderByCalled_)};e.prototype.limitToLast=function(t){a.validateArgCount("Query.limitToLast",1,1,arguments.length);if(typeof t!=="number"||Math.floor(t)!==t||t<=0){throw new Error("Query.limitToLast: First argument must be a positive integer.")}if(this.queryParams_.hasLimit()){throw new Error("Query.limitToLast: Limit was already set (by another call to limit, "+"limitToFirst, or limitToLast).")}return new e(this.repo,this.path,this.queryParams_.limitToLast(t),this.orderByCalled_)};e.prototype.orderByChild=function(t){a.validateArgCount("Query.orderByChild",1,1,arguments.length);if(t==="$key"){throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.')}else if(t==="$priority"){throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.')}else if(t==="$value"){throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.')}Te("Query.orderByChild",1,t,false);this.validateNoPreviousOrderByCall_("Query.orderByChild");var r=new K(t);if(r.isEmpty()){throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.")}var n=new dt(r);var i=this.queryParams_.orderBy(n);e.validateQueryEndpoints_(i);return new e(this.repo,this.path,i,true)};e.prototype.orderByKey=function(){a.validateArgCount("Query.orderByKey",0,0,arguments.length);this.validateNoPreviousOrderByCall_("Query.orderByKey");var t=this.queryParams_.orderBy(Ae);e.validateQueryEndpoints_(t);return new e(this.repo,this.path,t,true)};e.prototype.orderByPriority=function(){a.validateArgCount("Query.orderByPriority",0,0,arguments.length);this.validateNoPreviousOrderByCall_("Query.orderByPriority");var t=this.queryParams_.orderBy(Ke);e.validateQueryEndpoints_(t);return new e(this.repo,this.path,t,true)};e.prototype.orderByValue=function(){a.validateArgCount("Query.orderByValue",0,0,arguments.length);this.validateNoPreviousOrderByCall_("Query.orderByValue");var t=this.queryParams_.orderBy(ft);e.validateQueryEndpoints_(t);return new e(this.repo,this.path,t,true)};e.prototype.startAt=function(t,r){if(t===void 0){t=null}a.validateArgCount("Query.startAt",0,2,arguments.length);_e("Query.startAt",1,t,this.path,true);we("Query.startAt",2,r,true);var n=this.queryParams_.startAt(t,r);e.validateLimit_(n);e.validateQueryEndpoints_(n);if(this.queryParams_.hasStart()){throw new Error("Query.startAt: Starting point was already set (by another call to startAt "+"or equalTo).")}if(t===undefined){t=null;r=null}return new e(this.repo,this.path,n,this.orderByCalled_)};e.prototype.endAt=function(t,r){if(t===void 0){t=null}a.validateArgCount("Query.endAt",0,2,arguments.length);_e("Query.endAt",1,t,this.path,true);we("Query.endAt",2,r,true);var n=this.queryParams_.endAt(t,r);e.validateLimit_(n);e.validateQueryEndpoints_(n);if(this.queryParams_.hasEnd()){throw new Error("Query.endAt: Ending point was already set (by another call to endAt or "+"equalTo).")}return new e(this.repo,this.path,n,this.orderByCalled_)};e.prototype.equalTo=function(e,t){a.validateArgCount("Query.equalTo",1,2,arguments.length);_e("Query.equalTo",1,e,this.path,false);we("Query.equalTo",2,t,true);if(this.queryParams_.hasStart()){throw new Error("Query.equalTo: Starting point was already set (by another call to startAt or "+"equalTo).")}if(this.queryParams_.hasEnd()){throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or "+"equalTo).")}return this.startAt(e,t).endAt(e,t)};e.prototype.toString=function(){a.validateArgCount("Query.toString",0,0,arguments.length);return this.repo.toString()+this.path.toUrlEncodedString()};e.prototype.toJSON=function(){a.validateArgCount("Query.toJSON",0,1,arguments.length);return this.toString()};e.prototype.queryObject=function(){return this.queryParams_.getQueryObject()};e.prototype.queryIdentifier=function(){var e=this.queryObject();var t=A(e);return t==="{}"?"default":t};e.prototype.isEqual=function(t){a.validateArgCount("Query.isEqual",1,1,arguments.length);if(!(t instanceof e)){var r="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(r)}var n=this.repo===t.repo;var i=this.path.equals(t.path);var o=this.queryIdentifier()===t.queryIdentifier();return n&&i&&o};e.getCancelAndContextArgs_=function(e,t,r){var n={cancel:null,context:null};if(t&&r){n.cancel=t;a.validateCallback(e,3,n.cancel,true);n.context=r;a.validateContextObject(e,4,n.context,true)}else if(t){if(typeof t==="object"&&t!==null){n.context=t}else if(typeof t==="function"){n.cancel=t}else{throw new Error(a.errorPrefix(e,3,true)+" must either be a cancel callback or a context object.")}}return n};Object.defineProperty(e.prototype,"ref",{get:function(){return this.getRef()},enumerable:true,configurable:true});return e}();var wt=function(){function e(){this.value=null;this.children=new Map}e.prototype.find=function(e){if(this.value!=null){return this.value.getChild(e)}else if(!e.isEmpty()&&this.children.size>0){var t=e.getFront();e=e.popFront();if(this.children.has(t)){var r=this.children.get(t);return r.find(e)}else{return null}}else{return null}};e.prototype.remember=function(t,r){if(t.isEmpty()){this.value=r;this.children.clear()}else if(this.value!==null){this.value=this.value.updateChild(t,r)}else{var n=t.getFront();if(!this.children.has(n)){this.children.set(n,new e)}var i=this.children.get(n);t=t.popFront();i.remember(t,r)}};e.prototype.forget=function(e){if(e.isEmpty()){this.value=null;this.children.clear();return true}else{if(this.value!==null){if(this.value.isLeafNode()){return false}else{var t=this.value;this.value=null;var r=this;t.forEachChild(Ke,(function(e,t){r.remember(new K(e),t)}));return this.forget(e)}}else if(this.children.size>0){var n=e.getFront();e=e.popFront();if(this.children.has(n)){var i=this.children.get(n).forget(e);if(i){this.children.delete(n)}}return this.children.size===0}else{return true}}};e.prototype.forEachTree=function(e,t){if(this.value!==null){t(e,this.value)}else{this.forEachChild((function(r,n){var i=new K(e.toString()+"/"+r);n.forEachTree(i,t)}))}};e.prototype.forEachChild=function(e){this.children.forEach((function(t,r){e(r,t)}))};return e}();var Tt=function(e){e=e||{};e["timestamp"]=e["timestamp"]||(new Date).getTime();return e};var bt=function(e,t){if(!e||typeof e!=="object"){return e}else{a.assert(".sv"in e,"Unexpected leaf node or priority contents");return t[e[".sv"]]}};var St=function(e,t){var r=new wt;e.forEachTree(new K(""),(function(e,n){r.remember(e,It(n,t))}));return r};var It=function(e,t){var r=e.getPriority().val();var n=bt(r,t);var i;if(e.isLeafNode()){var o=e;var s=bt(o.getValue(),t);if(s!==o.getValue()||n!==o.getPriority().val()){return new Ue(s,ct(n))}else{return e}}else{var a=e;i=a;if(n!==a.getPriority().val()){i=i.updatePriority(new Ue(n))}a.forEachChild(Ke,(function(e,r){var n=It(r,t);if(n!==r){i=i.updateImmediateChild(e,n)}}));return i}};var Nt;(function(e){e[e["OVERWRITE"]=0]="OVERWRITE";e[e["MERGE"]=1]="MERGE";e[e["ACK_USER_WRITE"]=2]="ACK_USER_WRITE";e[e["LISTEN_COMPLETE"]=3]="LISTEN_COMPLETE"})(Nt||(Nt={}));var Pt=function(){function e(e,t,r,n){this.fromUser=e;this.fromServer=t;this.queryId=r;this.tagged=n;a.assert(!n||t,"Tagged queries must be from server.")}e.User=new e(true,false,null,false);e.Server=new e(false,true,null,false);e.forServerTaggedQuery=function(t){return new e(false,true,t,true)};return e}();var Rt=function(){function e(e,t,r){this.path=e;this.affectedTree=t;this.revert=r;this.type=Nt.ACK_USER_WRITE;this.source=Pt.User}e.prototype.operationForChild=function(t){if(!this.path.isEmpty()){a.assert(this.path.getFront()===t,"operationForChild called for unrelated child.");return new e(this.path.popFront(),this.affectedTree,this.revert)}else if(this.affectedTree.value!=null){a.assert(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths.");return this}else{var r=this.affectedTree.subtree(new K(t));return new e(K.Empty,r,this.revert)}};return e}();var Dt;var xt=function(){if(!Dt){Dt=new $e(O)}return Dt};var kt=function(){function e(e,t){if(t===void 0){t=xt()}this.value=e;this.children=t}e.fromObject=function(t){var r=e.Empty;M(t,(function(e,t){r=r.set(new K(e),t)}));return r};e.prototype.isEmpty=function(){return this.value===null&&this.children.isEmpty()};e.prototype.findRootMostMatchingPathAndValue=function(e,t){if(this.value!=null&&t(this.value)){return{path:K.Empty,value:this.value}}else{if(e.isEmpty()){return null}else{var r=e.getFront();var n=this.children.get(r);if(n!==null){var i=n.findRootMostMatchingPathAndValue(e.popFront(),t);if(i!=null){var o=new K(r).child(i.path);return{path:o,value:i.value}}else{return null}}else{return null}}}};e.prototype.findRootMostValueAndPath=function(e){return this.findRootMostMatchingPathAndValue(e,(function(){return true}))};e.prototype.subtree=function(t){if(t.isEmpty()){return this}else{var r=t.getFront();var n=this.children.get(r);if(n!==null){return n.subtree(t.popFront())}else{return e.Empty}}};e.prototype.set=function(t,r){if(t.isEmpty()){return new e(r,this.children)}else{var n=t.getFront();var i=this.children.get(n)||e.Empty;var o=i.set(t.popFront(),r);var s=this.children.insert(n,o);return new e(this.value,s)}};e.prototype.remove=function(t){if(t.isEmpty()){if(this.children.isEmpty()){return e.Empty}else{return new e(null,this.children)}}else{var r=t.getFront();var n=this.children.get(r);if(n){var i=n.remove(t.popFront());var o=void 0;if(i.isEmpty()){o=this.children.remove(r)}else{o=this.children.insert(r,i)}if(this.value===null&&o.isEmpty()){return e.Empty}else{return new e(this.value,o)}}else{return this}}};e.prototype.get=function(e){if(e.isEmpty()){return this.value}else{var t=e.getFront();var r=this.children.get(t);if(r){return r.get(e.popFront())}else{return null}}};e.prototype.setTree=function(t,r){if(t.isEmpty()){return r}else{var n=t.getFront();var i=this.children.get(n)||e.Empty;var o=i.setTree(t.popFront(),r);var s=void 0;if(o.isEmpty()){s=this.children.remove(n)}else{s=this.children.insert(n,o)}return new e(this.value,s)}};e.prototype.fold=function(e){return this.fold_(K.Empty,e)};e.prototype.fold_=function(e,t){var r={};this.children.inorderTraversal((function(n,i){r[n]=i.fold_(e.child(n),t)}));return t(e,this.value,r)};e.prototype.findOnPath=function(e,t){return this.findOnPath_(e,K.Empty,t)};e.prototype.findOnPath_=function(e,t,r){var n=this.value?r(t,this.value):false;if(n){return n}else{if(e.isEmpty()){return null}else{var i=e.getFront();var o=this.children.get(i);if(o){return o.findOnPath_(e.popFront(),t.child(i),r)}else{return null}}}};e.prototype.foreachOnPath=function(e,t){return this.foreachOnPath_(e,K.Empty,t)};e.prototype.foreachOnPath_=function(t,r,n){if(t.isEmpty()){return this}else{if(this.value){n(r,this.value)}var i=t.getFront();var o=this.children.get(i);if(o){return o.foreachOnPath_(t.popFront(),r.child(i),n)}else{return e.Empty}}};e.prototype.foreach=function(e){this.foreach_(K.Empty,e)};e.prototype.foreach_=function(e,t){this.children.inorderTraversal((function(r,n){n.foreach_(e.child(r),t)}));if(this.value){t(e,this.value)}};e.prototype.foreachChild=function(e){this.children.inorderTraversal((function(t,r){if(r.value){e(t,r.value)}}))};e.Empty=new e(null);return e}();var Ot=function(){function e(e,t){this.source=e;this.path=t;this.type=Nt.LISTEN_COMPLETE}e.prototype.operationForChild=function(t){if(this.path.isEmpty()){return new e(this.source,K.Empty)}else{return new e(this.source,this.path.popFront())}};return e}();var Ft=function(){function e(e,t,r){this.source=e;this.path=t;this.snap=r;this.type=Nt.OVERWRITE}e.prototype.operationForChild=function(t){if(this.path.isEmpty()){return new e(this.source,K.Empty,this.snap.getImmediateChild(t))}else{return new e(this.source,this.path.popFront(),this.snap)}};return e}();var At=function(){function e(e,t,r){this.source=e;this.path=t;this.children=r;this.type=Nt.MERGE}e.prototype.operationForChild=function(t){if(this.path.isEmpty()){var r=this.children.subtree(new K(t));if(r.isEmpty()){return null}else if(r.value){return new Ft(this.source,K.Empty,r.value)}else{return new e(this.source,K.Empty,r)}}else{a.assert(this.path.getFront()===t,"Can't get a merge for a child not on the path of the operation");return new e(this.source,this.path.popFront(),this.children)}};e.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"};return e}();var Lt=function(){function e(e,t,r){this.node_=e;this.fullyInitialized_=t;this.filtered_=r}e.prototype.isFullyInitialized=function(){return this.fullyInitialized_};e.prototype.isFiltered=function(){return this.filtered_};e.prototype.isCompleteForPath=function(e){if(e.isEmpty()){return this.isFullyInitialized()&&!this.filtered_}var t=e.getFront();return this.isCompleteForChild(t)};e.prototype.isCompleteForChild=function(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)};e.prototype.getNode=function(){return this.node_};return e}();var Mt=function(){function e(e,t){this.eventCache_=e;this.serverCache_=t}e.prototype.updateEventSnap=function(t,r,n){return new e(new Lt(t,r,n),this.serverCache_)};e.prototype.updateServerSnap=function(t,r,n){return new e(this.eventCache_,new Lt(t,r,n))};e.prototype.getEventCache=function(){return this.eventCache_};e.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null};e.prototype.getServerCache=function(){return this.serverCache_};e.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null};e.Empty=new e(new Lt(at.EMPTY_NODE,false,false),new Lt(at.EMPTY_NODE,false,false));return e}();var Wt=function(){function e(e,t,r,n,i){this.type=e;this.snapshotNode=t;this.childName=r;this.oldSnap=n;this.prevName=i}e.valueChange=function(t){return new e(e.VALUE,t)};e.childAddedChange=function(t,r){return new e(e.CHILD_ADDED,r,t)};e.childRemovedChange=function(t,r){return new e(e.CHILD_REMOVED,r,t)};e.childChangedChange=function(t,r,n){return new e(e.CHILD_CHANGED,r,t,n)};e.childMovedChange=function(t,r){return new e(e.CHILD_MOVED,r,t)};e.CHILD_ADDED="child_added";e.CHILD_REMOVED="child_removed";e.CHILD_CHANGED="child_changed";e.CHILD_MOVED="child_moved";e.VALUE="value";return e}();var Qt=function(){function e(e){this.index_=e}e.prototype.updateChild=function(e,t,r,n,i,o){a.assert(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");var s=e.getImmediateChild(t);if(s.getChild(n).equals(r.getChild(n))){if(s.isEmpty()===r.isEmpty()){return e}}if(o!=null){if(r.isEmpty()){if(e.hasChild(t)){o.trackChildChange(Wt.childRemovedChange(t,s))}else{a.assert(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node")}}else if(s.isEmpty()){o.trackChildChange(Wt.childAddedChange(t,r))}else{o.trackChildChange(Wt.childChangedChange(t,r,s))}}if(e.isLeafNode()&&r.isEmpty()){return e}else{return e.updateImmediateChild(t,r).withIndex(this.index_)}};e.prototype.updateFullNode=function(e,t,r){if(r!=null){if(!e.isLeafNode()){e.forEachChild(Ke,(function(e,n){if(!t.hasChild(e)){r.trackChildChange(Wt.childRemovedChange(e,n))}}))}if(!t.isLeafNode()){t.forEachChild(Ke,(function(t,n){if(e.hasChild(t)){var i=e.getImmediateChild(t);if(!i.equals(n)){r.trackChildChange(Wt.childChangedChange(t,n,i))}}else{r.trackChildChange(Wt.childAddedChange(t,n))}}))}}return t.withIndex(this.index_)};e.prototype.updatePriority=function(e,t){if(e.isEmpty()){return at.EMPTY_NODE}else{return e.updatePriority(t)}};e.prototype.filtersNodes=function(){return false};e.prototype.getIndexedFilter=function(){return this};e.prototype.getIndex=function(){return this.index_};return e}();var qt=function(){function e(){this.changeMap=new Map}e.prototype.trackChildChange=function(e){var t=e.type;var r=e.childName;a.assert(t===Wt.CHILD_ADDED||t===Wt.CHILD_CHANGED||t===Wt.CHILD_REMOVED,"Only child changes supported for tracking");a.assert(r!==".priority","Only non-priority child changes can be tracked.");var n=this.changeMap.get(r);if(n){var i=n.type;if(t===Wt.CHILD_ADDED&&i===Wt.CHILD_REMOVED){this.changeMap.set(r,Wt.childChangedChange(r,e.snapshotNode,n.snapshotNode))}else if(t===Wt.CHILD_REMOVED&&i===Wt.CHILD_ADDED){this.changeMap.delete(r)}else if(t===Wt.CHILD_REMOVED&&i===Wt.CHILD_CHANGED){this.changeMap.set(r,Wt.childRemovedChange(r,n.oldSnap))}else if(t===Wt.CHILD_CHANGED&&i===Wt.CHILD_ADDED){this.changeMap.set(r,Wt.childAddedChange(r,e.snapshotNode))}else if(t===Wt.CHILD_CHANGED&&i===Wt.CHILD_CHANGED){this.changeMap.set(r,Wt.childChangedChange(r,e.snapshotNode,n.oldSnap))}else{throw a.assertionError("Illegal combination of changes: "+e+" occurred after "+n)}}else{this.changeMap.set(r,e)}};e.prototype.getChanges=function(){return Array.from(this.changeMap.values())};return e}();var Ut=function(){function e(){}e.prototype.getCompleteChild=function(e){return null};e.prototype.getChildAfterChild=function(e,t,r){return null};return e}();var Vt=new Ut;var Ht=function(){function e(e,t,r){if(r===void 0){r=null}this.writes_=e;this.viewCache_=t;this.optCompleteServerCache_=r}e.prototype.getCompleteChild=function(e){var t=this.viewCache_.getEventCache();if(t.isCompleteForChild(e)){return t.getNode().getImmediateChild(e)}else{var r=this.optCompleteServerCache_!=null?new Lt(this.optCompleteServerCache_,true,false):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(e,r)}};e.prototype.getChildAfterChild=function(e,t,r){var n=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap();var i=this.writes_.calcIndexedSlice(n,t,1,r,e);if(i.length===0){return null}else{return i[0]}};return e}();var jt=function(){function e(e,t){this.viewCache=e;this.changes=t}return e}();var Bt=function(){function e(e){this.filter_=e}e.prototype.assertIndexed=function(e){a.assert(e.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed");a.assert(e.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")};e.prototype.applyOperation=function(t,r,n,i){var o=new qt;var s,l;if(r.type===Nt.OVERWRITE){var u=r;if(u.source.fromUser){s=this.applyUserOverwrite_(t,u.path,u.snap,n,i,o)}else{a.assert(u.source.fromServer,"Unknown source.");l=u.source.tagged||t.getServerCache().isFiltered()&&!u.path.isEmpty();s=this.applyServerOverwrite_(t,u.path,u.snap,n,i,l,o)}}else if(r.type===Nt.MERGE){var h=r;if(h.source.fromUser){s=this.applyUserMerge_(t,h.path,h.children,n,i,o)}else{a.assert(h.source.fromServer,"Unknown source.");l=h.source.tagged||t.getServerCache().isFiltered();s=this.applyServerMerge_(t,h.path,h.children,n,i,l,o)}}else if(r.type===Nt.ACK_USER_WRITE){var c=r;if(!c.revert){s=this.ackUserWrite_(t,c.path,c.affectedTree,n,i,o)}else{s=this.revertUserWrite_(t,c.path,n,i,o)}}else if(r.type===Nt.LISTEN_COMPLETE){s=this.listenComplete_(t,r.path,n,o)}else{throw a.assertionError("Unknown operation type: "+r.type)}var p=o.getChanges();e.maybeAddValueEvent_(t,s,p);return new jt(s,p)};e.maybeAddValueEvent_=function(e,t,r){var n=t.getEventCache();if(n.isFullyInitialized()){var i=n.getNode().isLeafNode()||n.getNode().isEmpty();var o=e.getCompleteEventSnap();if(r.length>0||!e.getEventCache().isFullyInitialized()||i&&!n.getNode().equals(o)||!n.getNode().getPriority().equals(o.getPriority())){r.push(Wt.valueChange(t.getCompleteEventSnap()))}}};e.prototype.generateEventCacheAfterServerEvent_=function(e,t,r,n,i){var o=e.getEventCache();if(r.shadowingWrite(t)!=null){return e}else{var s=void 0,l=void 0;if(t.isEmpty()){a.assert(e.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data");if(e.getServerCache().isFiltered()){var u=e.getCompleteServerSnap();var h=u instanceof at?u:at.EMPTY_NODE;var c=r.calcCompleteEventChildren(h);s=this.filter_.updateFullNode(e.getEventCache().getNode(),c,i)}else{var p=r.calcCompleteEventCache(e.getCompleteServerSnap());s=this.filter_.updateFullNode(e.getEventCache().getNode(),p,i)}}else{var f=t.getFront();if(f===".priority"){a.assert(t.getLength()===1,"Can't have a priority with additional path components");var d=o.getNode();l=e.getServerCache().getNode();var v=r.calcEventCacheAfterServerOverwrite(t,d,l);if(v!=null){s=this.filter_.updatePriority(d,v)}else{s=o.getNode()}}else{var _=t.popFront();var y=void 0;if(o.isCompleteForChild(f)){l=e.getServerCache().getNode();var g=r.calcEventCacheAfterServerOverwrite(t,o.getNode(),l);if(g!=null){y=o.getNode().getImmediateChild(f).updateChild(_,g)}else{y=o.getNode().getImmediateChild(f)}}else{y=r.calcCompleteChild(f,e.getServerCache())}if(y!=null){s=this.filter_.updateChild(o.getNode(),f,y,_,n,i)}else{s=o.getNode()}}}return e.updateEventSnap(s,o.isFullyInitialized()||t.isEmpty(),this.filter_.filtersNodes())}};e.prototype.applyServerOverwrite_=function(e,t,r,n,i,o,s){var a=e.getServerCache();var l;var u=o?this.filter_:this.filter_.getIndexedFilter();if(t.isEmpty()){l=u.updateFullNode(a.getNode(),r,null)}else if(u.filtersNodes()&&!a.isFiltered()){var h=a.getNode().updateChild(t,r);l=u.updateFullNode(a.getNode(),h,null)}else{var c=t.getFront();if(!a.isCompleteForPath(t)&&t.getLength()>1){return e}var p=t.popFront();var f=a.getNode().getImmediateChild(c);var d=f.updateChild(p,r);if(c===".priority"){l=u.updatePriority(a.getNode(),d)}else{l=u.updateChild(a.getNode(),c,d,p,Vt,null)}}var v=e.updateServerSnap(l,a.isFullyInitialized()||t.isEmpty(),u.filtersNodes());var _=new Ht(n,v,i);return this.generateEventCacheAfterServerEvent_(v,t,n,_,s)};e.prototype.applyUserOverwrite_=function(e,t,r,n,i,o){var s=e.getEventCache();var a,l;var u=new Ht(n,e,i);if(t.isEmpty()){l=this.filter_.updateFullNode(e.getEventCache().getNode(),r,o);a=e.updateEventSnap(l,true,this.filter_.filtersNodes())}else{var h=t.getFront();if(h===".priority"){l=this.filter_.updatePriority(e.getEventCache().getNode(),r);a=e.updateEventSnap(l,s.isFullyInitialized(),s.isFiltered())}else{var c=t.popFront();var p=s.getNode().getImmediateChild(h);var f=void 0;if(c.isEmpty()){f=r}else{var d=u.getCompleteChild(h);if(d!=null){if(c.getBack()===".priority"&&d.getChild(c.parent()).isEmpty()){f=d}else{f=d.updateChild(c,r)}}else{f=at.EMPTY_NODE}}if(!p.equals(f)){var v=this.filter_.updateChild(s.getNode(),h,f,c,u,o);a=e.updateEventSnap(v,s.isFullyInitialized(),this.filter_.filtersNodes())}else{a=e}}}return a};e.cacheHasChild_=function(e,t){return e.getEventCache().isCompleteForChild(t)};e.prototype.applyUserMerge_=function(t,r,n,i,o,s){var a=this;var l=t;n.foreach((function(n,u){var h=r.child(n);if(e.cacheHasChild_(t,h.getFront())){l=a.applyUserOverwrite_(l,h,u,i,o,s)}}));n.foreach((function(n,u){var h=r.child(n);if(!e.cacheHasChild_(t,h.getFront())){l=a.applyUserOverwrite_(l,h,u,i,o,s)}}));return l};e.prototype.applyMerge_=function(e,t){t.foreach((function(t,r){e=e.updateChild(t,r)}));return e};e.prototype.applyServerMerge_=function(e,t,r,n,i,o,s){var a=this;if(e.getServerCache().getNode().isEmpty()&&!e.getServerCache().isFullyInitialized()){return e}var l=e;var u;if(t.isEmpty()){u=r}else{u=kt.Empty.setTree(t,r)}var h=e.getServerCache().getNode();u.children.inorderTraversal((function(t,r){if(h.hasChild(t)){var u=e.getServerCache().getNode().getImmediateChild(t);var c=a.applyMerge_(u,r);l=a.applyServerOverwrite_(l,new K(t),c,n,i,o,s)}}));u.children.inorderTraversal((function(t,r){var u=!e.getServerCache().isCompleteForChild(t)&&r.value==null;if(!h.hasChild(t)&&!u){var c=e.getServerCache().getNode().getImmediateChild(t);var p=a.applyMerge_(c,r);l=a.applyServerOverwrite_(l,new K(t),p,n,i,o,s)}}));return l};e.prototype.ackUserWrite_=function(e,t,r,n,i,o){if(n.shadowingWrite(t)!=null){return e}var s=e.getServerCache().isFiltered();var a=e.getServerCache();if(r.value!=null){if(t.isEmpty()&&a.isFullyInitialized()||a.isCompleteForPath(t)){return this.applyServerOverwrite_(e,t,a.getNode().getChild(t),n,i,s,o)}else if(t.isEmpty()){var l=kt.Empty;a.getNode().forEachChild(Ae,(function(e,t){l=l.set(new K(e),t)}));return this.applyServerMerge_(e,t,l,n,i,s,o)}else{return e}}else{var u=kt.Empty;r.foreach((function(e,r){var n=t.child(e);if(a.isCompleteForPath(n)){u=u.set(e,a.getNode().getChild(n))}}));return this.applyServerMerge_(e,t,u,n,i,s,o)}};e.prototype.listenComplete_=function(e,t,r,n){var i=e.getServerCache();var o=e.updateServerSnap(i.getNode(),i.isFullyInitialized()||t.isEmpty(),i.isFiltered());return this.generateEventCacheAfterServerEvent_(o,t,r,Vt,n)};e.prototype.revertUserWrite_=function(e,t,r,n,i){var o;if(r.shadowingWrite(t)!=null){return e}else{var s=new Ht(r,e,n);var l=e.getEventCache().getNode();var u=void 0;if(t.isEmpty()||t.getFront()===".priority"){var h=void 0;if(e.getServerCache().isFullyInitialized()){h=r.calcCompleteEventCache(e.getCompleteServerSnap())}else{var c=e.getServerCache().getNode();a.assert(c instanceof at,"serverChildren would be complete if leaf node");h=r.calcCompleteEventChildren(c)}h=h;u=this.filter_.updateFullNode(l,h,i)}else{var p=t.getFront();var f=r.calcCompleteChild(p,e.getServerCache());if(f==null&&e.getServerCache().isCompleteForChild(p)){f=l.getImmediateChild(p)}if(f!=null){u=this.filter_.updateChild(l,p,f,t.popFront(),s,i)}else if(e.getEventCache().getNode().hasChild(p)){u=this.filter_.updateChild(l,p,at.EMPTY_NODE,t.popFront(),s,i)}else{u=l}if(u.isEmpty()&&e.getServerCache().isFullyInitialized()){o=r.calcCompleteEventCache(e.getCompleteServerSnap());if(o.isLeafNode()){u=this.filter_.updateFullNode(u,o,i)}}}o=e.getServerCache().isFullyInitialized()||r.shadowingWrite(K.Empty)!=null;return e.updateEventSnap(u,o,this.filter_.filtersNodes())}};return e}();var Yt=function(){function e(e){this.query_=e;this.index_=this.query_.getQueryParams().getIndex()}e.prototype.generateEventsForChanges=function(e,t,r){var n=this;var i=[];var o=[];e.forEach((function(e){if(e.type===Wt.CHILD_CHANGED&&n.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)){o.push(Wt.childMovedChange(e.childName,e.snapshotNode))}}));this.generateEventsForType_(i,Wt.CHILD_REMOVED,e,r,t);this.generateEventsForType_(i,Wt.CHILD_ADDED,e,r,t);this.generateEventsForType_(i,Wt.CHILD_MOVED,o,r,t);this.generateEventsForType_(i,Wt.CHILD_CHANGED,e,r,t);this.generateEventsForType_(i,Wt.VALUE,e,r,t);return i};e.prototype.generateEventsForType_=function(e,t,r,n,i){var o=this;var s=r.filter((function(e){return e.type===t}));s.sort(this.compareChanges_.bind(this));s.forEach((function(t){var r=o.materializeSingleChange_(t,i);n.forEach((function(n){if(n.respondsTo(t.type)){e.push(n.createEvent(r,o.query_))}}))}))};e.prototype.materializeSingleChange_=function(e,t){if(e.type==="value"||e.type==="child_removed"){return e}else{e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,this.index_);return e}};e.prototype.compareChanges_=function(e,t){if(e.childName==null||t.childName==null){throw a.assertionError("Should only compare child_ events.")}var r=new xe(e.childName,e.snapshotNode);var n=new xe(t.childName,t.snapshotNode);return this.index_.compare(r,n)};return e}();var Kt=function(){function e(e,t){this.query_=e;this.eventRegistrations_=[];var r=this.query_.getQueryParams();var n=new Qt(r.getIndex());var i=r.getNodeFilter();this.processor_=new Bt(i);var o=t.getServerCache();var s=t.getEventCache();var a=n.updateFullNode(at.EMPTY_NODE,o.getNode(),null);var l=i.updateFullNode(at.EMPTY_NODE,s.getNode(),null);var u=new Lt(a,o.isFullyInitialized(),n.filtersNodes());var h=new Lt(l,s.isFullyInitialized(),i.filtersNodes());this.viewCache_=new Mt(h,u);this.eventGenerator_=new Yt(this.query_)}e.prototype.getQuery=function(){return this.query_};e.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()};e.prototype.getCompleteServerCache=function(e){var t=this.viewCache_.getCompleteServerSnap();if(t){if(this.query_.getQueryParams().loadsAllData()||!e.isEmpty()&&!t.getImmediateChild(e.getFront()).isEmpty()){return t.getChild(e)}}return null};e.prototype.isEmpty=function(){return this.eventRegistrations_.length===0};e.prototype.addEventRegistration=function(e){this.eventRegistrations_.push(e)};e.prototype.removeEventRegistration=function(e,t){var r=[];if(t){a.assert(e==null,"A cancel should cancel all event registrations.");var n=this.query_.path;this.eventRegistrations_.forEach((function(e){t=t;var i=e.createCancelEvent(t,n);if(i){r.push(i)}}))}if(e){var i=[];for(var o=0;o<this.eventRegistrations_.length;++o){var s=this.eventRegistrations_[o];if(!s.matches(e)){i.push(s)}else if(e.hasAnyCallback()){i=i.concat(this.eventRegistrations_.slice(o+1));break}}this.eventRegistrations_=i}else{this.eventRegistrations_=[]}return r};e.prototype.applyOperation=function(e,t,r){if(e.type===Nt.MERGE&&e.source.queryId!==null){a.assert(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges");a.assert(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache")}var n=this.viewCache_;var i=this.processor_.applyOperation(n,e,t,r);this.processor_.assertIndexed(i.viewCache);a.assert(i.viewCache.getServerCache().isFullyInitialized()||!n.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back");this.viewCache_=i.viewCache;return this.generateEventsForChanges_(i.changes,i.viewCache.getEventCache().getNode(),null)};e.prototype.getInitialEvents=function(e){var t=this.viewCache_.getEventCache();var r=[];if(!t.getNode().isLeafNode()){var n=t.getNode();n.forEachChild(Ke,(function(e,t){r.push(Wt.childAddedChange(e,t))}))}if(t.isFullyInitialized()){r.push(Wt.valueChange(t.getNode()))}return this.generateEventsForChanges_(r,t.getNode(),e)};e.prototype.generateEventsForChanges_=function(e,t,r){var n=r?[r]:this.eventRegistrations_;return this.eventGenerator_.generateEventsForChanges(e,t,n)};return e}();var zt;var Gt=function(){function e(){this.views=new Map}Object.defineProperty(e,"__referenceConstructor",{get:function(){a.assert(zt,"Reference.ts has not been loaded");return zt},set:function(e){a.assert(!zt,"__referenceConstructor has already been defined");zt=e},enumerable:true,configurable:true});e.prototype.isEmpty=function(){return this.views.size===0};e.prototype.applyOperation=function(e,t,r){var n,i;var o=e.source.queryId;if(o!==null){var l=this.views.get(o);a.assert(l!=null,"SyncTree gave us an op for an invalid query.");return l.applyOperation(e,t,r)}else{var u=[];try{for(var h=s.__values(this.views.values()),c=h.next();!c.done;c=h.next()){var l=c.value;u=u.concat(l.applyOperation(e,t,r))}}catch(p){n={error:p}}finally{try{if(c&&!c.done&&(i=h.return))i.call(h)}finally{if(n)throw n.error}}return u}};e.prototype.addEventRegistration=function(e,t,r,n,i){var o=e.queryIdentifier();var s=this.views.get(o);if(!s){var a=r.calcCompleteEventCache(i?n:null);var l=false;if(a){l=true}else if(n instanceof at){a=r.calcCompleteEventChildren(n);l=false}else{a=at.EMPTY_NODE;l=false}var u=new Mt(new Lt(a,l,false),new Lt(n,i,false));s=new Kt(e,u);this.views.set(o,s)}s.addEventRegistration(t);return s.getInitialEvents(t)};e.prototype.removeEventRegistration=function(t,r,n){var i,o;var a=t.queryIdentifier();var l=[];var u=[];var h=this.hasCompleteView();if(a==="default"){try{for(var c=s.__values(this.views.entries()),p=c.next();!p.done;p=c.next()){var f=s.__read(p.value,2),d=f[0],v=f[1];u=u.concat(v.removeEventRegistration(r,n));if(v.isEmpty()){this.views.delete(d);if(!v.getQuery().getQueryParams().loadsAllData()){l.push(v.getQuery())}}}}catch(_){i={error:_}}finally{try{if(p&&!p.done&&(o=c.return))o.call(c)}finally{if(i)throw i.error}}}else{var v=this.views.get(a);if(v){u=u.concat(v.removeEventRegistration(r,n));if(v.isEmpty()){this.views.delete(a);if(!v.getQuery().getQueryParams().loadsAllData()){l.push(v.getQuery())}}}}if(h&&!this.hasCompleteView()){l.push(new e.__referenceConstructor(t.repo,t.path))}return{removed:l,events:u}};e.prototype.getQueryViews=function(){var e,t;var r=[];try{for(var n=s.__values(this.views.values()),i=n.next();!i.done;i=n.next()){var o=i.value;if(!o.getQuery().getQueryParams().loadsAllData()){r.push(o)}}}catch(a){e={error:a}}finally{try{if(i&&!i.done&&(t=n.return))t.call(n)}finally{if(e)throw e.error}}return r};e.prototype.getCompleteServerCache=function(e){var t,r;var n=null;try{for(var i=s.__values(this.views.values()),o=i.next();!o.done;o=i.next()){var a=o.value;n=n||a.getCompleteServerCache(e)}}catch(l){t={error:l}}finally{try{if(o&&!o.done&&(r=i.return))r.call(i)}finally{if(t)throw t.error}}return n};e.prototype.viewForQuery=function(e){var t=e.getQueryParams();if(t.loadsAllData()){return this.getCompleteView()}else{var r=e.queryIdentifier();return this.views.get(r)}};e.prototype.viewExistsForQuery=function(e){return this.viewForQuery(e)!=null};e.prototype.hasCompleteView=function(){return this.getCompleteView()!=null};e.prototype.getCompleteView=function(){var e,t;try{for(var r=s.__values(this.views.values()),n=r.next();!n.done;n=r.next()){var i=n.value;if(i.getQuery().getQueryParams().loadsAllData()){return i}}}catch(o){e={error:o}}finally{try{if(n&&!n.done&&(t=r.return))t.call(r)}finally{if(e)throw e.error}}return null};return e}();var Xt=function(){function e(e){this.writeTree_=e}e.prototype.addWrite=function(t,r){if(t.isEmpty()){return new e(new kt(r))}else{var n=this.writeTree_.findRootMostValueAndPath(t);if(n!=null){var i=n.path;var o=n.value;var s=K.relativePath(i,t);o=o.updateChild(s,r);return new e(this.writeTree_.set(i,o))}else{var a=new kt(r);var l=this.writeTree_.setTree(t,a);return new e(l)}}};e.prototype.addWrites=function(e,t){var r=this;M(t,(function(t,n){r=r.addWrite(e.child(t),n)}));return r};e.prototype.removeWrite=function(t){if(t.isEmpty()){return e.Empty}else{var r=this.writeTree_.setTree(t,kt.Empty);return new e(r)}};e.prototype.hasCompleteWrite=function(e){return this.getCompleteNode(e)!=null};e.prototype.getCompleteNode=function(e){var t=this.writeTree_.findRootMostValueAndPath(e);if(t!=null){return this.writeTree_.get(t.path).getChild(K.relativePath(t.path,e))}else{return null}};e.prototype.getCompleteChildren=function(){var e=[];var t=this.writeTree_.value;if(t!=null){if(!t.isLeafNode()){t.forEachChild(Ke,(function(t,r){e.push(new xe(t,r))}))}}else{this.writeTree_.children.inorderTraversal((function(t,r){if(r.value!=null){e.push(new xe(t,r.value))}}))}return e};e.prototype.childCompoundWrite=function(t){if(t.isEmpty()){return this}else{var r=this.getCompleteNode(t);if(r!=null){return new e(new kt(r))}else{return new e(this.writeTree_.subtree(t))}}};e.prototype.isEmpty=function(){return this.writeTree_.isEmpty()};e.prototype.apply=function(e){return $t(K.Empty,this.writeTree_,e)};e.Empty=new e(new kt(null));return e}();function $t(e,t,r){if(t.value!=null){return r.updateChild(e,t.value)}else{var n=null;t.children.inorderTraversal((function(t,i){if(t===".priority"){a.assert(i.value!==null,"Priority writes must always be leaf nodes");n=i.value}else{r=$t(e.child(t),i,r)}}));if(!r.getChild(e).isEmpty()&&n!==null){r=r.updateChild(e.child(".priority"),n)}return r}}var Jt=function(){function e(){this.visibleWrites_=Xt.Empty;this.allWrites_=[];this.lastWriteId_=-1}e.prototype.childWrites=function(e){return new Zt(e,this)};e.prototype.addOverwrite=function(e,t,r,n){a.assert(r>this.lastWriteId_,"Stacking an older write on top of newer ones");if(n===undefined){n=true}this.allWrites_.push({path:e,snap:t,writeId:r,visible:n});if(n){this.visibleWrites_=this.visibleWrites_.addWrite(e,t)}this.lastWriteId_=r};e.prototype.addMerge=function(e,t,r){a.assert(r>this.lastWriteId_,"Stacking an older merge on top of newer ones");this.allWrites_.push({path:e,children:t,writeId:r,visible:true});this.visibleWrites_=this.visibleWrites_.addWrites(e,t);this.lastWriteId_=r};e.prototype.getWrite=function(e){for(var t=0;t<this.allWrites_.length;t++){var r=this.allWrites_[t];if(r.writeId===e){return r}}return null};e.prototype.removeWrite=function(e){var t=this;var r=this.allWrites_.findIndex((function(t){return t.writeId===e}));a.assert(r>=0,"removeWrite called with nonexistent writeId.");var n=this.allWrites_[r];this.allWrites_.splice(r,1);var i=n.visible;var o=false;var s=this.allWrites_.length-1;while(i&&s>=0){var l=this.allWrites_[s];if(l.visible){if(s>=r&&this.recordContainsPath_(l,n.path)){i=false}else if(n.path.contains(l.path)){o=true}}s--}if(!i){return false}else if(o){this.resetTree_();return true}else{if(n.snap){this.visibleWrites_=this.visibleWrites_.removeWrite(n.path)}else{var u=n.children;M(u,(function(e){t.visibleWrites_=t.visibleWrites_.removeWrite(n.path.child(e))}))}return true}};e.prototype.getCompleteWriteData=function(e){return this.visibleWrites_.getCompleteNode(e)};e.prototype.calcCompleteEventCache=function(t,r,n,i){if(!n&&!i){var o=this.visibleWrites_.getCompleteNode(t);if(o!=null){return o}else{var s=this.visibleWrites_.childCompoundWrite(t);if(s.isEmpty()){return r}else if(r==null&&!s.hasCompleteWrite(K.Empty)){return null}else{var a=r||at.EMPTY_NODE;return s.apply(a)}}}else{var l=this.visibleWrites_.childCompoundWrite(t);if(!i&&l.isEmpty()){return r}else{if(!i&&r==null&&!l.hasCompleteWrite(K.Empty)){return null}else{var u=function(e){return(e.visible||i)&&(!n||!~n.indexOf(e.writeId))&&(e.path.contains(t)||t.contains(e.path))};var h=e.layerTree_(this.allWrites_,u,t);var a=r||at.EMPTY_NODE;return h.apply(a)}}}};e.prototype.calcCompleteEventChildren=function(e,t){var r=at.EMPTY_NODE;var n=this.visibleWrites_.getCompleteNode(e);if(n){if(!n.isLeafNode()){n.forEachChild(Ke,(function(e,t){r=r.updateImmediateChild(e,t)}))}return r}else if(t){var i=this.visibleWrites_.childCompoundWrite(e);t.forEachChild(Ke,(function(e,t){var n=i.childCompoundWrite(new K(e)).apply(t);r=r.updateImmediateChild(e,n)}));i.getCompleteChildren().forEach((function(e){r=r.updateImmediateChild(e.name,e.node)}));return r}else{var o=this.visibleWrites_.childCompoundWrite(e);o.getCompleteChildren().forEach((function(e){r=r.updateImmediateChild(e.name,e.node)}));return r}};e.prototype.calcEventCacheAfterServerOverwrite=function(e,t,r,n){a.assert(r||n,"Either existingEventSnap or existingServerSnap must exist");var i=e.child(t);if(this.visibleWrites_.hasCompleteWrite(i)){return null}else{var o=this.visibleWrites_.childCompoundWrite(i);if(o.isEmpty()){return n.getChild(t)}else{return o.apply(n.getChild(t))}}};e.prototype.calcCompleteChild=function(e,t,r){var n=e.child(t);var i=this.visibleWrites_.getCompleteNode(n);if(i!=null){return i}else{if(r.isCompleteForChild(t)){var o=this.visibleWrites_.childCompoundWrite(n);return o.apply(r.getNode().getImmediateChild(t))}else{return null}}};e.prototype.shadowingWrite=function(e){return this.visibleWrites_.getCompleteNode(e)};e.prototype.calcIndexedSlice=function(e,t,r,n,i,o){var s;var a=this.visibleWrites_.childCompoundWrite(e);var l=a.getCompleteNode(K.Empty);if(l!=null){s=l}else if(t!=null){s=a.apply(t)}else{return[]}s=s.withIndex(o);if(!s.isEmpty()&&!s.isLeafNode()){var u=[];var h=o.getCompare();var c=i?s.getReverseIteratorFrom(r,o):s.getIteratorFrom(r,o);var p=c.getNext();while(p&&u.length<n){if(h(p,r)!==0){u.push(p)}p=c.getNext()}return u}else{return[]}};e.prototype.recordContainsPath_=function(e,t){if(e.snap){return e.path.contains(t)}else{for(var r in e.children){if(e.children.hasOwnProperty(r)&&e.path.child(r).contains(t)){return true}}return false}};e.prototype.resetTree_=function(){this.visibleWrites_=e.layerTree_(this.allWrites_,e.DefaultFilter_,K.Empty);if(this.allWrites_.length>0){this.lastWriteId_=this.allWrites_[this.allWrites_.length-1].writeId}else{this.lastWriteId_=-1}};e.DefaultFilter_=function(e){return e.visible};e.layerTree_=function(e,t,r){var n=Xt.Empty;for(var i=0;i<e.length;++i){var o=e[i];if(t(o)){var s=o.path;var l=void 0;if(o.snap){if(r.contains(s)){l=K.relativePath(r,s);n=n.addWrite(l,o.snap)}else if(s.contains(r)){l=K.relativePath(s,r);n=n.addWrite(K.Empty,o.snap.getChild(l))}}else if(o.children){if(r.contains(s)){l=K.relativePath(r,s);n=n.addWrites(l,o.children)}else if(s.contains(r)){l=K.relativePath(s,r);if(l.isEmpty()){n=n.addWrites(K.Empty,o.children)}else{var u=a.safeGet(o.children,l.getFront());if(u){var h=u.getChild(l.popFront());n=n.addWrite(K.Empty,h)}}}}else{throw a.assertionError("WriteRecord should have .snap or .children")}}}return n};return e}();var Zt=function(){function e(e,t){this.treePath_=e;this.writeTree_=t}e.prototype.calcCompleteEventCache=function(e,t,r){return this.writeTree_.calcCompleteEventCache(this.treePath_,e,t,r)};e.prototype.calcCompleteEventChildren=function(e){return this.writeTree_.calcCompleteEventChildren(this.treePath_,e)};e.prototype.calcEventCacheAfterServerOverwrite=function(e,t,r){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,e,t,r)};e.prototype.shadowingWrite=function(e){return this.writeTree_.shadowingWrite(this.treePath_.child(e))};e.prototype.calcIndexedSlice=function(e,t,r,n,i){return this.writeTree_.calcIndexedSlice(this.treePath_,e,t,r,n,i)};e.prototype.calcCompleteChild=function(e,t){return this.writeTree_.calcCompleteChild(this.treePath_,e,t)};e.prototype.child=function(t){return new e(this.treePath_.child(t),this.writeTree_)};return e}();var er=function(){function e(e){this.listenProvider_=e;this.syncPointTree_=kt.Empty;this.pendingWriteTree_=new Jt;this.tagToQueryMap=new Map;this.queryToTagMap=new Map}e.prototype.applyUserOverwrite=function(e,t,r,n){this.pendingWriteTree_.addOverwrite(e,t,r,n);if(!n){return[]}else{return this.applyOperationToSyncPoints_(new Ft(Pt.User,e,t))}};e.prototype.applyUserMerge=function(e,t,r){this.pendingWriteTree_.addMerge(e,t,r);var n=kt.fromObject(t);return this.applyOperationToSyncPoints_(new At(Pt.User,e,n))};e.prototype.ackUserWrite=function(e,t){if(t===void 0){t=false}var r=this.pendingWriteTree_.getWrite(e);var n=this.pendingWriteTree_.removeWrite(e);if(!n){return[]}else{var i=kt.Empty;if(r.snap!=null){i=i.set(K.Empty,true)}else{M(r.children,(function(e,t){i=i.set(new K(e),t)}))}return this.applyOperationToSyncPoints_(new Rt(r.path,i,t))}};e.prototype.applyServerOverwrite=function(e,t){return this.applyOperationToSyncPoints_(new Ft(Pt.Server,e,t))};e.prototype.applyServerMerge=function(e,t){var r=kt.fromObject(t);return this.applyOperationToSyncPoints_(new At(Pt.Server,e,r))};e.prototype.applyListenComplete=function(e){return this.applyOperationToSyncPoints_(new Ot(Pt.Server,e))};e.prototype.applyTaggedQueryOverwrite=function(t,r,n){var i=this.queryKeyForTag_(n);if(i!=null){var o=e.parseQueryKey_(i);var s=o.path,a=o.queryId;var l=K.relativePath(s,t);var u=new Ft(Pt.forServerTaggedQuery(a),l,r);return this.applyTaggedOperation_(s,u)}else{return[]}};e.prototype.applyTaggedQueryMerge=function(t,r,n){var i=this.queryKeyForTag_(n);if(i){var o=e.parseQueryKey_(i);var s=o.path,a=o.queryId;var l=K.relativePath(s,t);var u=kt.fromObject(r);var h=new At(Pt.forServerTaggedQuery(a),l,u);return this.applyTaggedOperation_(s,h)}else{return[]}};e.prototype.applyTaggedListenComplete=function(t,r){var n=this.queryKeyForTag_(r);if(n){var i=e.parseQueryKey_(n);var o=i.path,s=i.queryId;var a=K.relativePath(o,t);var l=new Ot(Pt.forServerTaggedQuery(s),a);return this.applyTaggedOperation_(o,l)}else{return[]}};e.prototype.addEventRegistration=function(t,r){var n=t.path;var i=null;var o=false;this.syncPointTree_.foreachOnPath(n,(function(e,t){var r=K.relativePath(e,n);i=i||t.getCompleteServerCache(r);o=o||t.hasCompleteView()}));var s=this.syncPointTree_.get(n);if(!s){s=new Gt;this.syncPointTree_=this.syncPointTree_.set(n,s)}else{o=o||s.hasCompleteView();i=i||s.getCompleteServerCache(K.Empty)}var l;if(i!=null){l=true}else{l=false;i=at.EMPTY_NODE;var u=this.syncPointTree_.subtree(n);u.foreachChild((function(e,t){var r=t.getCompleteServerCache(K.Empty);if(r){i=i.updateImmediateChild(e,r)}}))}var h=s.viewExistsForQuery(t);if(!h&&!t.getQueryParams().loadsAllData()){var c=e.makeQueryKey_(t);a.assert(!this.queryToTagMap.has(c),"View does not exist, but we have a tag");var p=e.getNextQueryTag_();this.queryToTagMap.set(c,p);this.tagToQueryMap.set(p,c)}var f=this.pendingWriteTree_.childWrites(n);var d=s.addEventRegistration(t,r,f,i,l);if(!h&&!o){var v=s.viewForQuery(t);d=d.concat(this.setupListener_(t,v))}return d};e.prototype.removeEventRegistration=function(t,r,n){var i=this;var o=t.path;var s=this.syncPointTree_.get(o);var a=[];if(s&&(t.queryIdentifier()==="default"||s.viewExistsForQuery(t))){var l=s.removeEventRegistration(t,r,n);if(s.isEmpty()){this.syncPointTree_=this.syncPointTree_.remove(o)}var u=l.removed;a=l.events;var h=-1!==u.findIndex((function(e){return e.getQueryParams().loadsAllData()}));var c=this.syncPointTree_.findOnPath(o,(function(e,t){return t.hasCompleteView()}));if(h&&!c){var p=this.syncPointTree_.subtree(o);if(!p.isEmpty()){var f=this.collectDistinctViewsForSubTree_(p);for(var d=0;d<f.length;++d){var v=f[d],_=v.getQuery();var y=this.createListenerForView_(v);this.listenProvider_.startListening(e.queryForListening_(_),this.tagForQuery_(_),y.hashFn,y.onComplete)}}}if(!c&&u.length>0&&!n){if(h){var g=null;this.listenProvider_.stopListening(e.queryForListening_(t),g)}else{u.forEach((function(t){var r=i.queryToTagMap.get(e.makeQueryKey_(t));i.listenProvider_.stopListening(e.queryForListening_(t),r)}))}}this.removeTags_(u)}return a};e.prototype.calcCompleteEventCache=function(e,t){var r=true;var n=this.pendingWriteTree_;var i=this.syncPointTree_.findOnPath(e,(function(t,r){var n=K.relativePath(t,e);var i=r.getCompleteServerCache(n);if(i){return i}}));return n.calcCompleteEventCache(e,i,t,r)};e.prototype.collectDistinctViewsForSubTree_=function(e){return e.fold((function(e,t,r){if(t&&t.hasCompleteView()){var n=t.getCompleteView();return[n]}else{var i=[];if(t){i=t.getQueryViews()}M(r,(function(e,t){i=i.concat(t)}));return i}}))};e.prototype.removeTags_=function(t){for(var r=0;r<t.length;++r){var n=t[r];if(!n.getQueryParams().loadsAllData()){var i=e.makeQueryKey_(n);var o=this.queryToTagMap.get(i);this.queryToTagMap.delete(i);this.tagToQueryMap.delete(o)}}};e.queryForListening_=function(e){if(e.getQueryParams().loadsAllData()&&!e.getQueryParams().isDefault()){return e.getRef()}else{return e}};e.prototype.setupListener_=function(t,r){var n=t.path;var i=this.tagForQuery_(t);var o=this.createListenerForView_(r);var s=this.listenProvider_.startListening(e.queryForListening_(t),i,o.hashFn,o.onComplete);var l=this.syncPointTree_.subtree(n);if(i){a.assert(!l.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed")}else{var u=l.fold((function(e,t,r){if(!e.isEmpty()&&t&&t.hasCompleteView()){return[t.getCompleteView().getQuery()]}else{var n=[];if(t){n=n.concat(t.getQueryViews().map((function(e){return e.getQuery()})))}M(r,(function(e,t){n=n.concat(t)}));return n}}));for(var h=0;h<u.length;++h){var c=u[h];this.listenProvider_.stopListening(e.queryForListening_(c),this.tagForQuery_(c))}}return s};e.prototype.createListenerForView_=function(e){var t=this;var r=e.getQuery();var n=this.tagForQuery_(r);return{hashFn:function(){var t=e.getServerCache()||at.EMPTY_NODE;return t.hash()},onComplete:function(e){if(e==="ok"){if(n){return t.applyTaggedListenComplete(r.path,n)}else{return t.applyListenComplete(r.path)}}else{var i=U(e,r);return t.removeEventRegistration(r,null,i)}}}};e.makeQueryKey_=function(e){return e.path.toString()+"$"+e.queryIdentifier()};e.parseQueryKey_=function(e){var t=e.indexOf("$");a.assert(t!==-1&&t<e.length-1,"Bad queryKey.");return{queryId:e.substr(t+1),path:new K(e.substr(0,t))}};e.prototype.queryKeyForTag_=function(e){return this.tagToQueryMap.get(e)};e.prototype.tagForQuery_=function(t){var r=e.makeQueryKey_(t);return this.queryToTagMap.get(r)};e.getNextQueryTag_=function(){return e.nextQueryTag_++};e.prototype.applyTaggedOperation_=function(e,t){var r=this.syncPointTree_.get(e);a.assert(r,"Missing sync point for query tag that we're tracking");var n=this.pendingWriteTree_.childWrites(e);return r.applyOperation(t,n,null)};e.prototype.applyOperationToSyncPoints_=function(e){return this.applyOperationHelper_(e,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(K.Empty))};e.prototype.applyOperationHelper_=function(e,t,r,n){if(e.path.isEmpty()){return this.applyOperationDescendantsHelper_(e,t,r,n)}else{var i=t.get(K.Empty);if(r==null&&i!=null){r=i.getCompleteServerCache(K.Empty)}var o=[];var s=e.path.getFront();var a=e.operationForChild(s);var l=t.children.get(s);if(l&&a){var u=r?r.getImmediateChild(s):null;var h=n.child(s);o=o.concat(this.applyOperationHelper_(a,l,u,h))}if(i){o=o.concat(i.applyOperation(e,n,r))}return o}};e.prototype.applyOperationDescendantsHelper_=function(e,t,r,n){var i=this;var o=t.get(K.Empty);if(r==null&&o!=null){r=o.getCompleteServerCache(K.Empty)}var s=[];t.children.inorderTraversal((function(t,o){var a=r?r.getImmediateChild(t):null;var l=n.child(t);var u=e.operationForChild(t);if(u){s=s.concat(i.applyOperationDescendantsHelper_(u,o,a,l))}}));if(o){s=s.concat(o.applyOperation(e,n,r))}return s};e.nextQueryTag_=1;return e}();var tr=function(){function e(){this.rootNode_=at.EMPTY_NODE}e.prototype.getNode=function(e){return this.rootNode_.getChild(e)};e.prototype.updateSnapshot=function(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)};return e}();var rr=function(){function e(e,t){var r=this;this.app_=e;this.authProvider_=t;this.auth_=null;this.auth_=t.getImmediate({optional:true});if(!this.auth_){t.get().then((function(e){return r.auth_=e}))}}e.prototype.getToken=function(e){if(!this.auth_){return Promise.resolve(null)}return this.auth_.getToken(e).catch((function(e){if(e&&e.code==="auth/token-not-initialized"){w("Got auth/token-not-initialized error.  Treating as null token.");return null}else{return Promise.reject(e)}}))};e.prototype.addTokenChangeListener=function(e){if(this.auth_){this.auth_.addAuthTokenListener(e)}else{setTimeout((function(){return e(null)}),0);this.authProvider_.get().then((function(t){return t.addAuthTokenListener(e)}))}};e.prototype.removeTokenChangeListener=function(e){this.authProvider_.get().then((function(t){return t.removeAuthTokenListener(e)}))};e.prototype.notifyForInvalidToken=function(){var e='Provided authentication credentials for the app named "'+this.app_.name+'" are invalid. This usually indicates your app was not '+"initialized correctly. ";if("credential"in this.app_.options){e+='Make sure the "credential" property provided to initializeApp() '+'is authorized to access the specified "databaseURL" and is from the correct '+"project."}else if("serviceAccount"in this.app_.options){e+='Make sure the "serviceAccount" property provided to initializeApp() '+'is authorized to access the specified "databaseURL" and is from the correct '+"project."}else{e+='Make sure the "apiKey" and "databaseURL" properties provided to '+"initializeApp() match the values provided for your app at "+"https://console.firebase.google.com/."}I(e)};return e}();var nr=function(){function e(){this.counters_={}}e.prototype.incrementCounter=function(e,t){if(t===void 0){t=1}if(!a.contains(this.counters_,e)){this.counters_[e]=0}this.counters_[e]+=t};e.prototype.get=function(){return a.deepCopy(this.counters_)};return e}();var ir=function(){function e(){}e.getCollection=function(e){var t=e.toString();if(!this.collections_[t]){this.collections_[t]=new nr}return this.collections_[t]};e.getOrCreateReporter=function(e,t){var r=e.toString();if(!this.reporters_[r]){this.reporters_[r]=t()}return this.reporters_[r]};e.collections_={};e.reporters_={};return e}();var or=function(){function e(e){this.collection_=e;this.last_=null}e.prototype.get=function(){var e=this.collection_.get();var t=s.__assign({},e);if(this.last_){M(this.last_,(function(e,r){t[e]=t[e]-r}))}this.last_=e;return t};return e}();var sr=10*1e3;var ar=30*1e3;var lr=5*60*1e3;var ur=function(){function e(e,t){this.server_=t;this.statsToReport_={};this.statsListener_=new or(e);var r=sr+(ar-sr)*Math.random();Y(this.reportStats_.bind(this),Math.floor(r))}e.prototype.includeStat=function(e){this.statsToReport_[e]=true};e.prototype.reportStats_=function(){var e=this;var t=this.statsListener_.get();var r={};var n=false;M(t,(function(t,i){if(i>0&&a.contains(e.statsToReport_,t)){r[t]=i;n=true}}));if(n){this.server_.reportStats(r)}Y(this.reportStats_.bind(this),Math.floor(Math.random()*2*lr))};return e}();var hr=function(){function e(){this.eventLists_=[];this.recursionDepth_=0}e.prototype.queueEvents=function(e){var t=null;for(var r=0;r<e.length;r++){var n=e[r];var i=n.getPath();if(t!==null&&!i.equals(t.getPath())){this.eventLists_.push(t);t=null}if(t===null){t=new cr(i)}t.add(n)}if(t){this.eventLists_.push(t)}};e.prototype.raiseEventsAtPath=function(e,t){this.queueEvents(t);this.raiseQueuedEventsMatchingPredicate_((function(t){return t.equals(e)}))};e.prototype.raiseEventsForChangedPath=function(e,t){this.queueEvents(t);this.raiseQueuedEventsMatchingPredicate_((function(t){return t.contains(e)||e.contains(t)}))};e.prototype.raiseQueuedEventsMatchingPredicate_=function(e){this.recursionDepth_++;var t=true;for(var r=0;r<this.eventLists_.length;r++){var n=this.eventLists_[r];if(n){var i=n.getPath();if(e(i)){this.eventLists_[r].raise();this.eventLists_[r]=null}else{t=false}}}if(t){this.eventLists_=[]}this.recursionDepth_--};return e}();var cr=function(){function e(e){this.path_=e;this.events_=[]}e.prototype.add=function(e){this.events_.push(e)};e.prototype.raise=function(){for(var e=0;e<this.events_.length;e++){var t=this.events_[e];if(t!==null){this.events_[e]=null;var r=t.getEventRunner();if(m){w("event: "+t.toString())}j(r)}}};e.prototype.getPath=function(){return this.path_};return e}();var pr=function(){function e(e){this.allowedEvents_=e;this.listeners_={};a.assert(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}e.prototype.trigger=function(e){var t=[];for(var r=1;r<arguments.length;r++){t[r-1]=arguments[r]}if(Array.isArray(this.listeners_[e])){var n=s.__spread(this.listeners_[e]);for(var i=0;i<n.length;i++){n[i].callback.apply(n[i].context,t)}}};e.prototype.on=function(e,t,r){this.validateEventType_(e);this.listeners_[e]=this.listeners_[e]||[];this.listeners_[e].push({callback:t,context:r});var n=this.getInitialEvent(e);if(n){t.apply(r,n)}};e.prototype.off=function(e,t,r){this.validateEventType_(e);var n=this.listeners_[e]||[];for(var i=0;i<n.length;i++){if(n[i].callback===t&&(!r||r===n[i].context)){n.splice(i,1);return}}};e.prototype.validateEventType_=function(e){a.assert(this.allowedEvents_.find((function(t){return t===e})),"Unknown event: "+e)};return e}();var fr=function(e){s.__extends(t,e);function t(){var t=e.call(this,["visible"])||this;var r;var n;if(typeof document!=="undefined"&&typeof document.addEventListener!=="undefined"){if(typeof document["hidden"]!=="undefined"){n="visibilitychange";r="hidden"}else if(typeof document["mozHidden"]!=="undefined"){n="mozvisibilitychange";r="mozHidden"}else if(typeof document["msHidden"]!=="undefined"){n="msvisibilitychange";r="msHidden"}else if(typeof document["webkitHidden"]!=="undefined"){n="webkitvisibilitychange";r="webkitHidden"}}t.visible_=true;if(n){document.addEventListener(n,(function(){var e=!document[r];if(e!==t.visible_){t.visible_=e;t.trigger("visible",e)}}),false)}return t}t.getInstance=function(){return new t};t.prototype.getInitialEvent=function(e){a.assert(e==="visible","Unknown event type: "+e);return[this.visible_]};return t}(pr);var dr=function(e){s.__extends(t,e);function t(){var t=e.call(this,["online"])||this;t.online_=true;if(typeof window!=="undefined"&&typeof window.addEventListener!=="undefined"&&!a.isMobileCordova()){window.addEventListener("online",(function(){if(!t.online_){t.online_=true;t.trigger("online",true)}}),false);window.addEventListener("offline",(function(){if(t.online_){t.online_=false;t.trigger("online",false)}}),false)}return t}t.getInstance=function(){return new t};t.prototype.getInitialEvent=function(e){a.assert(e==="online","Unknown event type: "+e);return[this.online_]};t.prototype.currentlyOnline=function(){return this.online_};return t}(pr);var vr=function(){function e(e){this.onMessage_=e;this.pendingResponses=[];this.currentResponseNum=0;this.closeAfterResponse=-1;this.onClose=null}e.prototype.closeAfter=function(e,t){this.closeAfterResponse=e;this.onClose=t;if(this.closeAfterResponse<this.currentResponseNum){this.onClose();this.onClose=null}};e.prototype.handleResponse=function(e,t){var r=this;this.pendingResponses[e]=t;var n=function(){var e=i.pendingResponses[i.currentResponseNum];delete i.pendingResponses[i.currentResponseNum];var t=function(t){if(e[t]){j((function(){r.onMessage_(e[t])}))}};for(var n=0;n<e.length;++n){t(n)}if(i.currentResponseNum===i.closeAfterResponse){if(i.onClose){i.onClose();i.onClose=null}return"break"}i.currentResponseNum++};var i=this;while(this.pendingResponses[this.currentResponseNum]){var o=n();if(o==="break")break}};return e}();var _r="start";var yr="close";var gr="pLPCommand";var mr="pRTLPCB";var Cr="id";var Er="pw";var wr="ser";var Tr="cb";var br="seg";var Sr="ts";var Ir="d";var Nr="dframe";var Pr=1870;var Rr=30;var Dr=Pr-Rr;var xr=25e3;var kr=3e4;var Or=function(){function e(e,t,r,n){this.connId=e;this.repoInfo=t;this.transportSessionId=r;this.lastSessionId=n;this.bytesSent=0;this.bytesReceived=0;this.everConnected_=false;this.log_=T(e);this.stats_=ir.getCollection(t);this.urlFn=function(e){return t.connectionURL(ne,e)}}e.prototype.open=function(e,t){var r=this;this.curSegmentNum=0;this.onDisconnect_=t;this.myPacketOrderer=new vr(e);this.isClosed_=false;this.connectTimeoutTimer_=setTimeout((function(){r.log_("Timed out trying to connect.");r.onClosed_();r.connectTimeoutTimer_=null}),Math.floor(kr));R((function(){if(r.isClosed_){return}r.scriptTagHolder=new Fr((function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}var n=s.__read(e,5),i=n[0],o=n[1],a=n[2],l=n[3],u=n[4];r.incrementIncomingBytes_(e);if(!r.scriptTagHolder){return}if(r.connectTimeoutTimer_){clearTimeout(r.connectTimeoutTimer_);r.connectTimeoutTimer_=null}r.everConnected_=true;if(i===_r){r.id=o;r.password=a}else if(i===yr){if(o){r.scriptTagHolder.sendNewPolls=false;r.myPacketOrderer.closeAfter(o,(function(){r.onClosed_()}))}else{r.onClosed_()}}else{throw new Error("Unrecognized command received: "+i)}}),(function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}var n=s.__read(e,2),i=n[0],o=n[1];r.incrementIncomingBytes_(e);r.myPacketOrderer.handleResponse(i,o)}),(function(){r.onClosed_()}),r.urlFn);var e={};e[_r]="t";e[wr]=Math.floor(Math.random()*1e8);if(r.scriptTagHolder.uniqueCallbackIdentifier){e[Tr]=r.scriptTagHolder.uniqueCallbackIdentifier}e[X]=G;if(r.transportSessionId){e[$]=r.transportSessionId}if(r.lastSessionId){e[te]=r.lastSessionId}if(typeof location!=="undefined"&&location.href&&location.href.indexOf(ee)!==-1){e[J]=Z}var t=r.urlFn(e);r.log_("Connecting via long-poll to "+t);r.scriptTagHolder.addTag(t,(function(){}))}))};e.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password);this.addDisconnectPingFrame(this.id,this.password)};e.forceAllow=function(){e.forceAllow_=true};e.forceDisallow=function(){e.forceDisallow_=true};e.isAvailable=function(){if(a.isNodeSdk()){return false}else if(e.forceAllow_){return true}else{return!e.forceDisallow_&&typeof document!=="undefined"&&document.createElement!=null&&!Q()&&!q()}};e.prototype.markConnectionHealthy=function(){};e.prototype.shutdown_=function(){this.isClosed_=true;if(this.scriptTagHolder){this.scriptTagHolder.close();this.scriptTagHolder=null}if(this.myDisconnFrame){document.body.removeChild(this.myDisconnFrame);this.myDisconnFrame=null}if(this.connectTimeoutTimer_){clearTimeout(this.connectTimeoutTimer_);this.connectTimeoutTimer_=null}};e.prototype.onClosed_=function(){if(!this.isClosed_){this.log_("Longpoll is closing itself");this.shutdown_();if(this.onDisconnect_){this.onDisconnect_(this.everConnected_);this.onDisconnect_=null}}};e.prototype.close=function(){if(!this.isClosed_){this.log_("Longpoll is being closed.");this.shutdown_()}};e.prototype.send=function(e){var t=a.stringify(e);this.bytesSent+=t.length;this.stats_.incrementCounter("bytes_sent",t.length);var r=a.base64Encode(t);var n=L(r,Dr);for(var i=0;i<n.length;i++){this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[i]);this.curSegmentNum++}};e.prototype.addDisconnectPingFrame=function(e,t){if(a.isNodeSdk()){return}this.myDisconnFrame=document.createElement("iframe");var r={};r[Nr]="t";r[Cr]=e;r[Er]=t;this.myDisconnFrame.src=this.urlFn(r);this.myDisconnFrame.style.display="none";document.body.appendChild(this.myDisconnFrame)};e.prototype.incrementIncomingBytes_=function(e){var t=a.stringify(e).length;this.bytesReceived+=t;this.stats_.incrementCounter("bytes_received",t)};return e}();var Fr=function(){function e(t,r,n,i){this.onDisconnect=n;this.urlFn=i;this.outstandingRequests=new Set;this.pendingSegs=[];this.currentSerial=Math.floor(Math.random()*1e8);this.sendNewPolls=true;if(!a.isNodeSdk()){this.uniqueCallbackIdentifier=_();window[gr+this.uniqueCallbackIdentifier]=t;window[mr+this.uniqueCallbackIdentifier]=r;this.myIFrame=e.createIFrame_();var o="";if(this.myIFrame.src&&this.myIFrame.src.substr(0,"javascript:".length)==="javascript:"){var s=document.domain;o='<script>document.domain="'+s+'";<\/script>'}var l="<html><body>"+o+"</body></html>";try{this.myIFrame.doc.open();this.myIFrame.doc.write(l);this.myIFrame.doc.close()}catch(u){w("frame writing exception");if(u.stack){w(u.stack)}w(u)}}else{this.commandCB=t;this.onMessageCB=r}}e.createIFrame_=function(){var e=document.createElement("iframe");e.style.display="none";if(document.body){document.body.appendChild(e);try{var t=e.contentWindow.document;if(!t){w("No IE domain setting required")}}catch(n){var r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else{throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready."}if(e.contentDocument){e.doc=e.contentDocument}else if(e.contentWindow){e.doc=e.contentWindow.document}else if(e.document){e.doc=e.document}return e};e.prototype.close=function(){var e=this;this.alive=false;if(this.myIFrame){this.myIFrame.doc.body.innerHTML="";setTimeout((function(){if(e.myIFrame!==null){document.body.removeChild(e.myIFrame);e.myIFrame=null}}),Math.floor(0))}var t=this.onDisconnect;if(t){this.onDisconnect=null;t()}};e.prototype.startLongPoll=function(e,t){this.myID=e;this.myPW=t;this.alive=true;while(this.newRequest_()){}};e.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;var e={};e[Cr]=this.myID;e[Er]=this.myPW;e[wr]=this.currentSerial;var t=this.urlFn(e);var r="";var n=0;while(this.pendingSegs.length>0){var i=this.pendingSegs[0];if(i.d.length+Rr+r.length<=Pr){var o=this.pendingSegs.shift();r=r+"&"+br+n+"="+o.seg+"&"+Sr+n+"="+o.ts+"&"+Ir+n+"="+o.d;n++}else{break}}t=t+r;this.addLongPollTag_(t,this.currentSerial);return true}else{return false}};e.prototype.enqueueSegment=function(e,t,r){this.pendingSegs.push({seg:e,ts:t,d:r});if(this.alive){this.newRequest_()}};e.prototype.addLongPollTag_=function(e,t){var r=this;this.outstandingRequests.add(t);var n=function(){r.outstandingRequests.delete(t);r.newRequest_()};var i=setTimeout(n,Math.floor(xr));var o=function(){clearTimeout(i);n()};this.addTag(e,o)};e.prototype.addTag=function(e,t){var r=this;if(a.isNodeSdk()){this.doNodeLongPoll(e,t)}else{setTimeout((function(){try{if(!r.sendNewPolls){return}var n=r.myIFrame.doc.createElement("script");n.type="text/javascript";n.async=true;n.src=e;n.onload=n.onreadystatechange=function(){var e=n.readyState;if(!e||e==="loaded"||e==="complete"){n.onload=n.onreadystatechange=null;if(n.parentNode){n.parentNode.removeChild(n)}t()}};n.onerror=function(){w("Long-poll script failed to load: "+e);r.sendNewPolls=false;r.close()};r.myIFrame.doc.body.appendChild(n)}catch(i){}}),Math.floor(1))}};return e}();var Ar="";function Lr(e){Ar=e}var Mr=16384;var Wr=45e3;var Qr=null;if(typeof MozWebSocket!=="undefined"){Qr=MozWebSocket}else if(typeof WebSocket!=="undefined"){Qr=WebSocket}var qr=function(){function e(t,r,n,i){this.connId=t;this.keepaliveTimer=null;this.frames=null;this.totalFrames=0;this.bytesSent=0;this.bytesReceived=0;this.log_=T(this.connId);this.stats_=ir.getCollection(r);this.connURL=e.connectionURL_(r,n,i)}e.connectionURL_=function(e,t,r){var n={};n[X]=G;if(!a.isNodeSdk()&&typeof location!=="undefined"&&location.href&&location.href.indexOf(ee)!==-1){n[J]=Z}if(t){n[$]=t}if(r){n[te]=r}return e.connectionURL(re,n)};e.prototype.open=function(e,t){var r=this;this.onDisconnect=t;this.onMessage=e;this.log_("Websocket connecting to "+this.connURL);this.everConnected_=false;f.set("previous_websocket_failure",true);try{if(a.isNodeSdk()){var i=a.CONSTANTS.NODE_ADMIN?"AdminNode":"Node";var o={headers:{"User-Agent":"Firebase/"+G+"/"+Ar+"/"+n.platform+"/"+i}};var s=n["env"];var l=this.connURL.indexOf("wss://")===0?s["HTTPS_PROXY"]||s["https_proxy"]:s["HTTP_PROXY"]||s["http_proxy"];if(l){o["proxy"]={origin:l}}this.mySock=new Qr(this.connURL,[],o)}else{this.mySock=new Qr(this.connURL)}}catch(h){this.log_("Error instantiating WebSocket.");var u=h.message||h.data;if(u){this.log_(u)}this.onClosed_();return}this.mySock.onopen=function(){r.log_("Websocket connected.");r.everConnected_=true};this.mySock.onclose=function(){r.log_("Websocket connection was disconnected.");r.mySock=null;r.onClosed_()};this.mySock.onmessage=function(e){r.handleIncomingFrame(e)};this.mySock.onerror=function(e){r.log_("WebSocket error.  Closing connection.");var t=e.message||e.data;if(t){r.log_(t)}r.onClosed_()}};e.prototype.start=function(){};e.forceDisallow=function(){e.forceDisallow_=true};e.isAvailable=function(){var t=false;if(typeof navigator!=="undefined"&&navigator.userAgent){var r=/Android ([0-9]{0,}\.[0-9]{0,})/;var n=navigator.userAgent.match(r);if(n&&n.length>1){if(parseFloat(n[1])<4.4){t=true}}}return!t&&Qr!==null&&!e.forceDisallow_};e.previouslyFailed=function(){return f.isInMemoryStorage||f.get("previous_websocket_failure")===true};e.prototype.markConnectionHealthy=function(){f.remove("previous_websocket_failure")};e.prototype.appendFrame_=function(e){this.frames.push(e);if(this.frames.length===this.totalFrames){var t=this.frames.join("");this.frames=null;var r=a.jsonEval(t);this.onMessage(r)}};e.prototype.handleNewFrameCount_=function(e){this.totalFrames=e;this.frames=[]};e.prototype.extractFrameCount_=function(e){a.assert(this.frames===null,"We already have a frame buffer");if(e.length<=6){var t=Number(e);if(!isNaN(t)){this.handleNewFrameCount_(t);return null}}this.handleNewFrameCount_(1);return e};e.prototype.handleIncomingFrame=function(e){if(this.mySock===null){return}var t=e["data"];this.bytesReceived+=t.length;this.stats_.incrementCounter("bytes_received",t.length);this.resetKeepAlive();if(this.frames!==null){this.appendFrame_(t)}else{var r=this.extractFrameCount_(t);if(r!==null){this.appendFrame_(r)}}};e.prototype.send=function(e){this.resetKeepAlive();var t=a.stringify(e);this.bytesSent+=t.length;this.stats_.incrementCounter("bytes_sent",t.length);var r=L(t,Mr);if(r.length>1){this.sendString_(String(r.length))}for(var n=0;n<r.length;n++){this.sendString_(r[n])}};e.prototype.shutdown_=function(){this.isClosed_=true;if(this.keepaliveTimer){clearInterval(this.keepaliveTimer);this.keepaliveTimer=null}if(this.mySock){this.mySock.close();this.mySock=null}};e.prototype.onClosed_=function(){if(!this.isClosed_){this.log_("WebSocket is closing itself");this.shutdown_();if(this.onDisconnect){this.onDisconnect(this.everConnected_);this.onDisconnect=null}}};e.prototype.close=function(){if(!this.isClosed_){this.log_("WebSocket is being closed");this.shutdown_()}};e.prototype.resetKeepAlive=function(){var e=this;clearInterval(this.keepaliveTimer);this.keepaliveTimer=setInterval((function(){if(e.mySock){e.sendString_("0")}e.resetKeepAlive()}),Math.floor(Wr))};e.prototype.sendString_=function(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection.");setTimeout(this.onClosed_.bind(this),0)}};e.responsesRequiredToBeHealthy=2;e.healthyTimeout=3e4;return e}();var Ur=function(){function e(e){this.initTransports_(e)}Object.defineProperty(e,"ALL_TRANSPORTS",{get:function(){return[Or,qr]},enumerable:true,configurable:true});e.prototype.initTransports_=function(t){var r,n;var i=qr&&qr["isAvailable"]();var o=i&&!qr.previouslyFailed();if(t.webSocketOnly){if(!i){I("wss:// URL used, but browser isn't known to support websockets.  Trying anyway.")}o=true}if(o){this.transports_=[qr]}else{var a=this.transports_=[];try{for(var l=s.__values(e.ALL_TRANSPORTS),u=l.next();!u.done;u=l.next()){var h=u.value;if(h&&h["isAvailable"]()){a.push(h)}}}catch(c){r={error:c}}finally{try{if(u&&!u.done&&(n=l.return))n.call(l)}finally{if(r)throw r.error}}}};e.prototype.initialTransport=function(){if(this.transports_.length>0){return this.transports_[0]}else{throw new Error("No transports available")}};e.prototype.upgradeTransport=function(){if(this.transports_.length>1){return this.transports_[1]}else{return null}};return e}();var Vr=6e4;var Hr=5e3;var jr=10*1024;var Br=100*1024;var Yr="t";var Kr="d";var zr="s";var Gr="r";var Xr="e";var $r="o";var Jr="a";var Zr="n";var en="p";var tn="h";var rn=function(){function e(e,t,r,n,i,o,s){this.id=e;this.repoInfo_=t;this.onMessage_=r;this.onReady_=n;this.onDisconnect_=i;this.onKill_=o;this.lastSessionId=s;this.connectionCount=0;this.pendingDataMessages=[];this.state_=0;this.log_=T("c:"+this.id+":");this.transportManager_=new Ur(t);this.log_("Connection created");this.start_()}e.prototype.start_=function(){var e=this;var t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,undefined,this.lastSessionId);this.primaryResponsesRequired_=t["responsesRequiredToBeHealthy"]||0;var r=this.connReceiver_(this.conn_);var n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_;this.rx_=this.conn_;this.secondaryConn_=null;this.isHealthy_=false;setTimeout((function(){e.conn_&&e.conn_.open(r,n)}),Math.floor(0));var i=t["healthyTimeout"]||0;if(i>0){this.healthyTimeout_=Y((function(){e.healthyTimeout_=null;if(!e.isHealthy_){if(e.conn_&&e.conn_.bytesReceived>Br){e.log_("Connection exceeded healthy timeout but has received "+e.conn_.bytesReceived+" bytes.  Marking connection healthy.");e.isHealthy_=true;e.conn_.markConnectionHealthy()}else if(e.conn_&&e.conn_.bytesSent>jr){e.log_("Connection exceeded healthy timeout but has sent "+e.conn_.bytesSent+" bytes.  Leaving connection alive.")}else{e.log_("Closing unhealthy connection after timeout.");e.close()}}}),Math.floor(i))}};e.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++};e.prototype.disconnReceiver_=function(e){var t=this;return function(r){if(e===t.conn_){t.onConnectionLost_(r)}else if(e===t.secondaryConn_){t.log_("Secondary connection lost.");t.onSecondaryConnectionLost_()}else{t.log_("closing an old connection")}}};e.prototype.connReceiver_=function(e){var t=this;return function(r){if(t.state_!==2){if(e===t.rx_){t.onPrimaryMessageReceived_(r)}else if(e===t.secondaryConn_){t.onSecondaryMessageReceived_(r)}else{t.log_("message on old connection")}}}};e.prototype.sendRequest=function(e){var t={t:"d",d:e};this.sendData_(t)};e.prototype.tryCleanupConnection=function(){if(this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_){this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId);this.conn_=this.secondaryConn_;this.secondaryConn_=null}};e.prototype.onSecondaryControl_=function(e){if(Yr in e){var t=e[Yr];if(t===Jr){this.upgradeIfSecondaryHealthy_()}else if(t===Gr){this.log_("Got a reset on secondary, closing it");this.secondaryConn_.close();if(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_){this.close()}}else if(t===$r){this.log_("got pong on secondary.");this.secondaryResponsesRequired_--;this.upgradeIfSecondaryHealthy_()}}};e.prototype.onSecondaryMessageReceived_=function(e){var t=F("t",e);var r=F("d",e);if(t==="c"){this.onSecondaryControl_(r)}else if(t==="d"){this.pendingDataMessages.push(r)}else{throw new Error("Unknown protocol layer: "+t)}};e.prototype.upgradeIfSecondaryHealthy_=function(){if(this.secondaryResponsesRequired_<=0){this.log_("Secondary connection is healthy.");this.isHealthy_=true;this.secondaryConn_.markConnectionHealthy();this.proceedWithUpgrade_()}else{this.log_("sending ping on secondary.");this.secondaryConn_.send({t:"c",d:{t:en,d:{}}})}};e.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start();this.log_("sending client ack on secondary");this.secondaryConn_.send({t:"c",d:{t:Jr,d:{}}});this.log_("Ending transmission on primary");this.conn_.send({t:"c",d:{t:Zr,d:{}}});this.tx_=this.secondaryConn_;this.tryCleanupConnection()};e.prototype.onPrimaryMessageReceived_=function(e){var t=F("t",e);var r=F("d",e);if(t==="c"){this.onControl_(r)}else if(t==="d"){this.onDataMessage_(r)}};e.prototype.onDataMessage_=function(e){this.onPrimaryResponse_();this.onMessage_(e)};e.prototype.onPrimaryResponse_=function(){if(!this.isHealthy_){this.primaryResponsesRequired_--;if(this.primaryResponsesRequired_<=0){this.log_("Primary connection is healthy.");this.isHealthy_=true;this.conn_.markConnectionHealthy()}}};e.prototype.onControl_=function(e){var t=F(Yr,e);if(Kr in e){var r=e[Kr];if(t===tn){this.onHandshake_(r)}else if(t===Zr){this.log_("recvd end transmission on primary");this.rx_=this.secondaryConn_;for(var n=0;n<this.pendingDataMessages.length;++n){this.onDataMessage_(this.pendingDataMessages[n])}this.pendingDataMessages=[];this.tryCleanupConnection()}else if(t===zr){this.onConnectionShutdown_(r)}else if(t===Gr){this.onReset_(r)}else if(t===Xr){b("Server Error: "+r)}else if(t===$r){this.log_("got pong on primary.");this.onPrimaryResponse_();this.sendPingOnPrimaryIfNecessary_()}else{b("Unknown control packet command: "+t)}}};e.prototype.onHandshake_=function(e){var t=e.ts;var r=e.v;var n=e.h;this.sessionId=e.s;this.repoInfo_.updateHost(n);if(this.state_===0){this.conn_.start();this.onConnectionEstablished_(this.conn_,t);if(G!==r){I("Protocol version mismatch detected")}this.tryStartUpgrade_()}};e.prototype.tryStartUpgrade_=function(){var e=this.transportManager_.upgradeTransport();if(e){this.startUpgrade_(e)}};e.prototype.startUpgrade_=function(e){var t=this;this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.sessionId);this.secondaryResponsesRequired_=e["responsesRequiredToBeHealthy"]||0;var r=this.connReceiver_(this.secondaryConn_);var n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(r,n);Y((function(){if(t.secondaryConn_){t.log_("Timed out trying to upgrade.");t.secondaryConn_.close()}}),Math.floor(Vr))};e.prototype.onReset_=function(e){this.log_("Reset packet received.  New host: "+e);this.repoInfo_.updateHost(e);if(this.state_===1){this.close()}else{this.closeConnections_();this.start_()}};e.prototype.onConnectionEstablished_=function(e,t){var r=this;this.log_("Realtime connection established.");this.conn_=e;this.state_=1;if(this.onReady_){this.onReady_(t,this.sessionId);this.onReady_=null}if(this.primaryResponsesRequired_===0){this.log_("Primary connection is healthy.");this.isHealthy_=true}else{Y((function(){r.sendPingOnPrimaryIfNecessary_()}),Math.floor(Hr))}};e.prototype.sendPingOnPrimaryIfNecessary_=function(){if(!this.isHealthy_&&this.state_===1){this.log_("sending ping on primary.");this.sendData_({t:"c",d:{t:en,d:{}}})}};e.prototype.onSecondaryConnectionLost_=function(){var e=this.secondaryConn_;this.secondaryConn_=null;if(this.tx_===e||this.rx_===e){this.close()}};e.prototype.onConnectionLost_=function(e){this.conn_=null;if(!e&&this.state_===0){this.log_("Realtime connection failed.");if(this.repoInfo_.isCacheableHost()){f.remove("host:"+this.repoInfo_.host);this.repoInfo_.internalHost=this.repoInfo_.host}}else if(this.state_===1){this.log_("Realtime connection lost.")}this.close()};e.prototype.onConnectionShutdown_=function(e){this.log_("Connection shutdown command received. Shutting down...");if(this.onKill_){this.onKill_(e);this.onKill_=null}this.onDisconnect_=null;this.close()};e.prototype.sendData_=function(e){if(this.state_!==1){throw"Connection is not connected"}else{this.tx_.send(e)}};e.prototype.close=function(){if(this.state_!==2){this.log_("Closing realtime connection.");this.state_=2;this.closeConnections_();if(this.onDisconnect_){this.onDisconnect_();this.onDisconnect_=null}}};e.prototype.closeConnections_=function(){this.log_("Shutting down all connections");if(this.conn_){this.conn_.close();this.conn_=null}if(this.secondaryConn_){this.secondaryConn_.close();this.secondaryConn_=null}if(this.healthyTimeout_){clearTimeout(this.healthyTimeout_);this.healthyTimeout_=null}};return e}();var nn=function(){function e(){}e.prototype.put=function(e,t,r,n){};e.prototype.merge=function(e,t,r,n){};e.prototype.refreshAuthToken=function(e){};e.prototype.onDisconnectPut=function(e,t,r){};e.prototype.onDisconnectMerge=function(e,t,r){};e.prototype.onDisconnectCancel=function(e,t){};e.prototype.reportStats=function(e){};return e}();var on=1e3;var sn=60*5*1e3;var an=30*1e3;var ln=1.3;var un=3e4;var hn="server_kill";var cn=3;var pn=function(e){s.__extends(t,e);function t(r,n,i,o,s,l){var u=e.call(this)||this;u.repoInfo_=r;u.onDataUpdate_=n;u.onConnectStatus_=i;u.onServerInfoUpdate_=o;u.authTokenProvider_=s;u.authOverride_=l;u.id=t.nextPersistentConnectionId_++;u.log_=T("p:"+u.id+":");u.interruptReasons_={};u.listens=new Map;u.outstandingPuts_=[];u.outstandingPutCount_=0;u.onDisconnectRequestQueue_=[];u.connected_=false;u.reconnectDelay_=on;u.maxReconnectDelay_=sn;u.securityDebugCallback_=null;u.lastSessionId=null;u.establishConnectionTimer_=null;u.visible_=false;u.requestCBHash_={};u.requestNumber_=0;u.realtime_=null;u.authToken_=null;u.forceTokenRefresh_=false;u.invalidAuthTokenCount_=0;u.firstConnection_=true;u.lastConnectionAttemptTime_=null;u.lastConnectionEstablishedTime_=null;if(l&&!a.isNodeSdk()){throw new Error("Auth override specified in options, but not supported on non Node.js platforms")}u.scheduleConnect_(0);fr.getInstance().on("visible",u.onVisible_,u);if(r.host.indexOf("fblocal")===-1){dr.getInstance().on("online",u.onOnline_,u)}return u}t.prototype.sendRequest=function(e,t,r){var n=++this.requestNumber_;var i={r:n,a:e,b:t};this.log_(a.stringify(i));a.assert(this.connected_,"sendRequest call when we're not connected not allowed.");this.realtime_.sendRequest(i);if(r){this.requestCBHash_[n]=r}};t.prototype.listen=function(e,t,r,n){var i=e.queryIdentifier();var o=e.path.toString();this.log_("Listen called for "+o+" "+i);if(!this.listens.has(o)){this.listens.set(o,new Map)}a.assert(e.getQueryParams().isDefault()||!e.getQueryParams().loadsAllData(),"listen() called for non-default but complete query");a.assert(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");var s={onComplete:n,hashFn:t,query:e,tag:r};this.listens.get(o).set(i,s);if(this.connected_){this.sendListen_(s)}};t.prototype.sendListen_=function(e){var r=this;var n=e.query;var i=n.path.toString();var o=n.queryIdentifier();this.log_("Listen on "+i+" for "+o);var s={p:i};var a="q";if(e.tag){s["q"]=n.queryObject();s["t"]=e.tag}s["h"]=e.hashFn();this.sendRequest(a,s,(function(s){var a=s["d"];var l=s["s"];t.warnOnListenWarnings_(a,n);var u=r.listens.get(i)&&r.listens.get(i).get(o);if(u===e){r.log_("listen response",s);if(l!=="ok"){r.removeListen_(i,o)}if(e.onComplete){e.onComplete(l,a)}}}))};t.warnOnListenWarnings_=function(e,t){if(e&&typeof e==="object"&&a.contains(e,"w")){var r=a.safeGet(e,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){var n='".indexOn": "'+t.getQueryParams().getIndex().toString()+'"';var i=t.path.toString();I("Using an unspecified index. Your data will be downloaded and "+("filtered on the client. Consider adding "+n+" at ")+(i+" to your security rules for better performance."))}}};t.prototype.refreshAuthToken=function(e){this.authToken_=e;this.log_("Auth token refreshed");if(this.authToken_){this.tryAuth()}else{if(this.connected_){this.sendRequest("unauth",{},(function(){}))}}this.reduceReconnectDelayIfAdminCredential_(e)};t.prototype.reduceReconnectDelayIfAdminCredential_=function(e){var t=e&&e.length===40;if(t||a.isAdmin(e)){this.log_("Admin auth credential detected.  Reducing max reconnect time.");this.maxReconnectDelay_=an}};t.prototype.tryAuth=function(){var e=this;if(this.connected_&&this.authToken_){var t=this.authToken_;var r=a.isValidFormat(t)?"auth":"gauth";var n={cred:t};if(this.authOverride_===null){n["noauth"]=true}else if(typeof this.authOverride_==="object"){n["authvar"]=this.authOverride_}this.sendRequest(r,n,(function(r){var n=r["s"];var i=r["d"]||"error";if(e.authToken_===t){if(n==="ok"){e.invalidAuthTokenCount_=0}else{e.onAuthRevoked_(n,i)}}}))}};t.prototype.unlisten=function(e,t){var r=e.path.toString();var n=e.queryIdentifier();this.log_("Unlisten called for "+r+" "+n);a.assert(e.getQueryParams().isDefault()||!e.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query");var i=this.removeListen_(r,n);if(i&&this.connected_){this.sendUnlisten_(r,n,e.queryObject(),t)}};t.prototype.sendUnlisten_=function(e,t,r,n){this.log_("Unlisten on "+e+" for "+t);var i={p:e};var o="n";if(n){i["q"]=r;i["t"]=n}this.sendRequest(o,i)};t.prototype.onDisconnectPut=function(e,t,r){if(this.connected_){this.sendOnDisconnect_("o",e,t,r)}else{this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:r})}};t.prototype.onDisconnectMerge=function(e,t,r){if(this.connected_){this.sendOnDisconnect_("om",e,t,r)}else{this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:r})}};t.prototype.onDisconnectCancel=function(e,t){if(this.connected_){this.sendOnDisconnect_("oc",e,null,t)}else{this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}};t.prototype.sendOnDisconnect_=function(e,t,r,n){var i={p:t,d:r};this.log_("onDisconnect "+e,i);this.sendRequest(e,i,(function(e){if(n){setTimeout((function(){n(e["s"],e["d"])}),Math.floor(0))}}))};t.prototype.put=function(e,t,r,n){this.putInternal("p",e,t,r,n)};t.prototype.merge=function(e,t,r,n){this.putInternal("m",e,t,r,n)};t.prototype.putInternal=function(e,t,r,n,i){var o={p:t,d:r};if(i!==undefined){o["h"]=i}this.outstandingPuts_.push({action:e,request:o,onComplete:n});this.outstandingPutCount_++;var s=this.outstandingPuts_.length-1;if(this.connected_){this.sendPut_(s)}else{this.log_("Buffering put: "+t)}};t.prototype.sendPut_=function(e){var t=this;var r=this.outstandingPuts_[e].action;var n=this.outstandingPuts_[e].request;var i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_;this.sendRequest(r,n,(function(n){t.log_(r+" response",n);delete t.outstandingPuts_[e];t.outstandingPutCount_--;if(t.outstandingPutCount_===0){t.outstandingPuts_=[]}if(i){i(n["s"],n["d"])}}))};t.prototype.reportStats=function(e){var t=this;if(this.connected_){var r={c:e};this.log_("reportStats",r);this.sendRequest("s",r,(function(e){var r=e["s"];if(r!=="ok"){var n=e["d"];t.log_("reportStats","Error sending stats: "+n)}}))}};t.prototype.onDataMessage_=function(e){if("r"in e){this.log_("from server: "+a.stringify(e));var t=e["r"];var r=this.requestCBHash_[t];if(r){delete this.requestCBHash_[t];r(e["b"])}}else if("error"in e){throw"A server-side error has occurred: "+e["error"]}else if("a"in e){this.onDataPush_(e["a"],e["b"])}};t.prototype.onDataPush_=function(e,t){this.log_("handleServerMessage",e,t);if(e==="d"){this.onDataUpdate_(t["p"],t["d"],false,t["t"])}else if(e==="m"){this.onDataUpdate_(t["p"],t["d"],true,t["t"])}else if(e==="c"){this.onListenRevoked_(t["p"],t["q"])}else if(e==="ac"){this.onAuthRevoked_(t["s"],t["d"])}else if(e==="sd"){this.onSecurityDebugPacket_(t)}else{b("Unrecognized action received from server: "+a.stringify(e)+"\nAre you using the latest client?")}};t.prototype.onReady_=function(e,t){this.log_("connection ready");this.connected_=true;this.lastConnectionEstablishedTime_=(new Date).getTime();this.handleTimestamp_(e);this.lastSessionId=t;if(this.firstConnection_){this.sendConnectStats_()}this.restoreState_();this.firstConnection_=false;this.onConnectStatus_(true)};t.prototype.scheduleConnect_=function(e){var t=this;a.assert(!this.realtime_,"Scheduling a connect when we're already connected/ing?");if(this.establishConnectionTimer_){clearTimeout(this.establishConnectionTimer_)}this.establishConnectionTimer_=setTimeout((function(){t.establishConnectionTimer_=null;t.establishConnection_()}),Math.floor(e))};t.prototype.onVisible_=function(e){if(e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_){this.log_("Window became visible.  Reducing delay.");this.reconnectDelay_=on;if(!this.realtime_){this.scheduleConnect_(0)}}this.visible_=e};t.prototype.onOnline_=function(e){if(e){this.log_("Browser went online.");this.reconnectDelay_=on;if(!this.realtime_){this.scheduleConnect_(0)}}else{this.log_("Browser went offline.  Killing connection.");if(this.realtime_){this.realtime_.close()}}};t.prototype.onRealtimeDisconnect_=function(){this.log_("data client disconnected");this.connected_=false;this.realtime_=null;this.cancelSentTransactions_();this.requestCBHash_={};if(this.shouldReconnect_()){if(!this.visible_){this.log_("Window isn't visible.  Delaying reconnect.");this.reconnectDelay_=this.maxReconnectDelay_;this.lastConnectionAttemptTime_=(new Date).getTime()}else if(this.lastConnectionEstablishedTime_){var e=(new Date).getTime()-this.lastConnectionEstablishedTime_;if(e>un){this.reconnectDelay_=on}this.lastConnectionEstablishedTime_=null}var t=(new Date).getTime()-this.lastConnectionAttemptTime_;var r=Math.max(0,this.reconnectDelay_-t);r=Math.random()*r;this.log_("Trying to reconnect in "+r+"ms");this.scheduleConnect_(r);this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*ln)}this.onConnectStatus_(false)};t.prototype.establishConnection_=function(){if(this.shouldReconnect_()){this.log_("Making a connection attempt");this.lastConnectionAttemptTime_=(new Date).getTime();this.lastConnectionEstablishedTime_=null;var e=this.onDataMessage_.bind(this);var r=this.onReady_.bind(this);var n=this.onRealtimeDisconnect_.bind(this);var i=this.id+":"+t.nextConnectionId_++;var o=this;var s=this.lastSessionId;var l=false;var u=null;var h=function(){if(u){u.close()}else{l=true;n()}};var c=function(e){a.assert(u,"sendRequest call when we're not connected not allowed.");u.sendRequest(e)};this.realtime_={close:h,sendRequest:c};var p=this.forceTokenRefresh_;this.forceTokenRefresh_=false;this.authTokenProvider_.getToken(p).then((function(t){if(!l){w("getToken() completed. Creating connection.");o.authToken_=t&&t.accessToken;u=new rn(i,o.repoInfo_,e,r,n,(function(e){I(e+" ("+o.repoInfo_.toString()+")");o.interrupt(hn)}),s)}else{w("getToken() completed but was canceled")}})).then(null,(function(e){o.log_("Failed to get token: "+e);if(!l){if(a.CONSTANTS.NODE_ADMIN){I(e)}h()}}))}};t.prototype.interrupt=function(e){w("Interrupting connection for reason: "+e);this.interruptReasons_[e]=true;if(this.realtime_){this.realtime_.close()}else{if(this.establishConnectionTimer_){clearTimeout(this.establishConnectionTimer_);this.establishConnectionTimer_=null}if(this.connected_){this.onRealtimeDisconnect_()}}};t.prototype.resume=function(e){w("Resuming connection for reason: "+e);delete this.interruptReasons_[e];if(a.isEmpty(this.interruptReasons_)){this.reconnectDelay_=on;if(!this.realtime_){this.scheduleConnect_(0)}}};t.prototype.handleTimestamp_=function(e){var t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})};t.prototype.cancelSentTransactions_=function(){for(var e=0;e<this.outstandingPuts_.length;e++){var t=this.outstandingPuts_[e];if(t&&"h"in t.request&&t.queued){if(t.onComplete){t.onComplete("disconnect")}delete this.outstandingPuts_[e];this.outstandingPutCount_--}}if(this.outstandingPutCount_===0){this.outstandingPuts_=[]}};t.prototype.onListenRevoked_=function(e,t){var r;if(!t){r="default"}else{r=t.map((function(e){return A(e)})).join("$")}var n=this.removeListen_(e,r);if(n&&n.onComplete){n.onComplete("permission_denied")}};t.prototype.removeListen_=function(e,t){var r=new K(e).toString();var n;if(this.listens.has(r)){var i=this.listens.get(r);n=i.get(t);i.delete(t);if(i.size===0){this.listens.delete(r)}}else{n=undefined}return n};t.prototype.onAuthRevoked_=function(e,t){w("Auth token revoked: "+e+"/"+t);this.authToken_=null;this.forceTokenRefresh_=true;this.realtime_.close();if(e==="invalid_token"||e==="permission_denied"){this.invalidAuthTokenCount_++;if(this.invalidAuthTokenCount_>=cn){this.reconnectDelay_=an;this.authTokenProvider_.notifyForInvalidToken()}}};t.prototype.onSecurityDebugPacket_=function(e){if(this.securityDebugCallback_){this.securityDebugCallback_(e)}else{if("msg"in e){console.log("FIREBASE: "+e["msg"].replace("\n","\nFIREBASE: "))}}};t.prototype.restoreState_=function(){var e,t,r,n;this.tryAuth();try{for(var i=s.__values(this.listens.values()),o=i.next();!o.done;o=i.next()){var a=o.value;try{for(var l=(r=void 0,s.__values(a.values())),u=l.next();!u.done;u=l.next()){var h=u.value;this.sendListen_(h)}}catch(f){r={error:f}}finally{try{if(u&&!u.done&&(n=l.return))n.call(l)}finally{if(r)throw r.error}}}}catch(d){e={error:d}}finally{try{if(o&&!o.done&&(t=i.return))t.call(i)}finally{if(e)throw e.error}}for(var c=0;c<this.outstandingPuts_.length;c++){if(this.outstandingPuts_[c]){this.sendPut_(c)}}while(this.onDisconnectRequestQueue_.length){var p=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(p.action,p.pathString,p.data,p.onComplete)}};t.prototype.sendConnectStats_=function(){var e={};var t="js";if(a.CONSTANTS.NODE_ADMIN){t="admin_node"}else if(a.CONSTANTS.NODE_CLIENT){t="node"}e["sdk."+t+"."+Ar.replace(/\./g,"-")]=1;if(a.isMobileCordova()){e["framework.cordova"]=1}else if(a.isReactNative()){e["framework.reactnative"]=1}this.reportStats(e)};t.prototype.shouldReconnect_=function(){var e=dr.getInstance().currentlyOnline();return a.isEmpty(this.interruptReasons_)&&e};t.nextPersistentConnectionId_=0;t.nextConnectionId_=0;return t}(nn);var fn=function(e){s.__extends(t,e);function t(t,r,n){var i=e.call(this)||this;i.repoInfo_=t;i.onDataUpdate_=r;i.authTokenProvider_=n;i.log_=T("p:rest:");i.listens_={};return i}t.prototype.reportStats=function(e){throw new Error("Method not implemented.")};t.getListenId_=function(e,t){if(t!==undefined){return"tag$"+t}else{a.assert(e.getQueryParams().isDefault(),"should have a tag if it's not a default query.");return e.path.toString()}};t.prototype.listen=function(e,r,n,i){var o=this;var s=e.path.toString();this.log_("Listen called for "+s+" "+e.queryIdentifier());var l=t.getListenId_(e,n);var u={};this.listens_[l]=u;var h=e.getQueryParams().toRestQueryStringParameters();this.restRequest_(s+".json",h,(function(e,t){var r=t;if(e===404){r=null;e=null}if(e===null){o.onDataUpdate_(s,r,false,n)}if(a.safeGet(o.listens_,l)===u){var h;if(!e){h="ok"}else if(e===401){h="permission_denied"}else{h="rest_error:"+e}i(h,null)}}))};t.prototype.unlisten=function(e,r){var n=t.getListenId_(e,r);delete this.listens_[n]};t.prototype.refreshAuthToken=function(e){};t.prototype.restRequest_=function(e,t,r){var n=this;if(t===void 0){t={}}t["format"]="export";this.authTokenProvider_.getToken(false).then((function(i){var o=i&&i.accessToken;if(o){t["auth"]=o}var s=(n.repoInfo_.secure?"https://":"http://")+n.repoInfo_.host+e+"?"+"ns="+n.repoInfo_.namespace+a.querystring(t);n.log_("Sending REST request for "+s);var l=new XMLHttpRequest;l.onreadystatechange=function(){if(r&&l.readyState===4){n.log_("REST Response for "+s+" received. status:",l.status,"response:",l.responseText);var e=null;if(l.status>=200&&l.status<300){try{e=a.jsonEval(l.responseText)}catch(t){I("Failed to parse JSON response for "+s+": "+l.responseText)}r(null,e)}else{if(l.status!==401&&l.status!==404){I("Got unsuccessful REST response for "+s+" Status: "+l.status)}r(l.status)}r=null}};l.open("GET",s,true);l.send()}))};return t}(nn);var dn="repo_interrupt";var vn=function(){function e(e,t,r,n){var i=this;this.repoInfo_=e;this.app=r;this.dataUpdateCount=0;this.statsListener_=null;this.eventQueue_=new hr;this.nextWriteId_=1;this.interceptServerDataCallback_=null;this.onDisconnect_=new wt;this.persistentConnection_=null;var o=new rr(r,n);this.stats_=ir.getCollection(e);if(t||B()){this.server_=new fn(this.repoInfo_,this.onDataUpdate_.bind(this),o);setTimeout(this.onConnectStatus_.bind(this,true),0)}else{var s=r.options["databaseAuthVariableOverride"];if(typeof s!=="undefined"&&s!==null){if(typeof s!=="object"){throw new Error("Only objects are supported for option databaseAuthVariableOverride")}try{a.stringify(s)}catch(l){throw new Error("Invalid authOverride provided: "+l)}}this.persistentConnection_=new pn(this.repoInfo_,this.onDataUpdate_.bind(this),this.onConnectStatus_.bind(this),this.onServerInfoUpdate_.bind(this),o,s);this.server_=this.persistentConnection_}o.addTokenChangeListener((function(e){i.server_.refreshAuthToken(e)}));this.statsReporter_=ir.getOrCreateReporter(e,(function(){return new ur(i.stats_,i.server_)}));this.transactionsInit_();this.infoData_=new tr;this.infoSyncTree_=new er({startListening:function(e,t,r,n){var o=[];var s=i.infoData_.getNode(e.path);if(!s.isEmpty()){o=i.infoSyncTree_.applyServerOverwrite(e.path,s);setTimeout((function(){n("ok")}),0)}return o},stopListening:function(){}});this.updateInfo_("connected",false);this.serverSyncTree_=new er({startListening:function(e,t,r,n){i.server_.listen(e,r,t,(function(t,r){var o=n(t,r);i.eventQueue_.raiseEventsForChangedPath(e.path,o)}));return[]},stopListening:function(e,t){i.server_.unlisten(e,t)}})}e.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host};e.prototype.name=function(){return this.repoInfo_.namespace};e.prototype.serverTime=function(){var e=this.infoData_.getNode(new K(".info/serverTimeOffset"));var t=e.val()||0;return(new Date).getTime()+t};e.prototype.generateServerValues=function(){return Tt({timestamp:this.serverTime()})};e.prototype.onDataUpdate_=function(e,t,r,n){this.dataUpdateCount++;var i=new K(e);t=this.interceptServerDataCallback_?this.interceptServerDataCallback_(e,t):t;var o=[];if(n){if(r){var s=a.map(t,(function(e){return ct(e)}));o=this.serverSyncTree_.applyTaggedQueryMerge(i,s,n)}else{var l=ct(t);o=this.serverSyncTree_.applyTaggedQueryOverwrite(i,l,n)}}else if(r){var u=a.map(t,(function(e){return ct(e)}));o=this.serverSyncTree_.applyServerMerge(i,u)}else{var h=ct(t);o=this.serverSyncTree_.applyServerOverwrite(i,h)}var c=i;if(o.length>0){c=this.rerunTransactions_(i)}this.eventQueue_.raiseEventsForChangedPath(c,o)};e.prototype.interceptServerData_=function(e){this.interceptServerDataCallback_=e};e.prototype.onConnectStatus_=function(e){this.updateInfo_("connected",e);if(e===false){this.runOnDisconnectEvents_()}};e.prototype.onServerInfoUpdate_=function(e){var t=this;M(e,(function(e,r){t.updateInfo_(e,r)}))};e.prototype.updateInfo_=function(e,t){var r=new K("/.info/"+e);var n=ct(t);this.infoData_.updateSnapshot(r,n);var i=this.infoSyncTree_.applyServerOverwrite(r,n);this.eventQueue_.raiseEventsForChangedPath(r,i)};e.prototype.getNextWriteId_=function(){return this.nextWriteId_++};e.prototype.setWithPriority=function(e,t,r,n){var i=this;this.log_("set",{path:e.toString(),value:t,priority:r});var o=this.generateServerValues();var s=ct(t,r);var a=It(s,o);var l=this.getNextWriteId_();var u=this.serverSyncTree_.applyUserOverwrite(e,a,l,true);this.eventQueue_.queueEvents(u);this.server_.put(e.toString(),s.val(true),(function(t,r){var o=t==="ok";if(!o){I("set at "+e+" failed: "+t)}var s=i.serverSyncTree_.ackUserWrite(l,!o);i.eventQueue_.raiseEventsForChangedPath(e,s);i.callOnCompleteCallback(n,t,r)}));var h=this.abortTransactions_(e);this.rerunTransactions_(h);this.eventQueue_.raiseEventsForChangedPath(h,[])};e.prototype.update=function(e,t,r){var n=this;this.log_("update",{path:e.toString(),value:t});var i=true;var o=this.generateServerValues();var s={};M(t,(function(e,t){i=false;var r=ct(t);s[e]=It(r,o)}));if(!i){var a=this.getNextWriteId_();var l=this.serverSyncTree_.applyUserMerge(e,s,a);this.eventQueue_.queueEvents(l);this.server_.merge(e.toString(),t,(function(t,i){var o=t==="ok";if(!o){I("update at "+e+" failed: "+t)}var s=n.serverSyncTree_.ackUserWrite(a,!o);var l=s.length>0?n.rerunTransactions_(e):e;n.eventQueue_.raiseEventsForChangedPath(l,s);n.callOnCompleteCallback(r,t,i)}));M(t,(function(t){var r=n.abortTransactions_(e.child(t));n.rerunTransactions_(r)}));this.eventQueue_.raiseEventsForChangedPath(e,[])}else{w("update() called with empty data.  Don't do anything.");this.callOnCompleteCallback(r,"ok")}};e.prototype.runOnDisconnectEvents_=function(){var e=this;this.log_("onDisconnectEvents");var t=this.generateServerValues();var r=St(this.onDisconnect_,t);var n=[];r.forEachTree(K.Empty,(function(t,r){n=n.concat(e.serverSyncTree_.applyServerOverwrite(t,r));var i=e.abortTransactions_(t);e.rerunTransactions_(i)}));this.onDisconnect_=new wt;this.eventQueue_.raiseEventsForChangedPath(K.Empty,n)};e.prototype.onDisconnectCancel=function(e,t){var r=this;this.server_.onDisconnectCancel(e.toString(),(function(n,i){if(n==="ok"){r.onDisconnect_.forget(e)}r.callOnCompleteCallback(t,n,i)}))};e.prototype.onDisconnectSet=function(e,t,r){var n=this;var i=ct(t);this.server_.onDisconnectPut(e.toString(),i.val(true),(function(t,o){if(t==="ok"){n.onDisconnect_.remember(e,i)}n.callOnCompleteCallback(r,t,o)}))};e.prototype.onDisconnectSetWithPriority=function(e,t,r,n){var i=this;var o=ct(t,r);this.server_.onDisconnectPut(e.toString(),o.val(true),(function(t,r){if(t==="ok"){i.onDisconnect_.remember(e,o)}i.callOnCompleteCallback(n,t,r)}))};e.prototype.onDisconnectUpdate=function(e,t,r){var n=this;if(a.isEmpty(t)){w("onDisconnect().update() called with empty data.  Don't do anything.");this.callOnCompleteCallback(r,"ok");return}this.server_.onDisconnectMerge(e.toString(),t,(function(i,o){if(i==="ok"){M(t,(function(t,r){var i=ct(r);n.onDisconnect_.remember(e.child(t),i)}))}n.callOnCompleteCallback(r,i,o)}))};e.prototype.addEventCallbackForQuery=function(e,t){var r;if(e.path.getFront()===".info"){r=this.infoSyncTree_.addEventRegistration(e,t)}else{r=this.serverSyncTree_.addEventRegistration(e,t)}this.eventQueue_.raiseEventsAtPath(e.path,r)};e.prototype.removeEventCallbackForQuery=function(e,t){var r;if(e.path.getFront()===".info"){r=this.infoSyncTree_.removeEventRegistration(e,t)}else{r=this.serverSyncTree_.removeEventRegistration(e,t)}this.eventQueue_.raiseEventsAtPath(e.path,r)};e.prototype.interrupt=function(){if(this.persistentConnection_){this.persistentConnection_.interrupt(dn)}};e.prototype.resume=function(){if(this.persistentConnection_){this.persistentConnection_.resume(dn)}};e.prototype.stats=function(e){if(e===void 0){e=false}if(typeof console==="undefined"){return}var t;if(e){if(!this.statsListener_){this.statsListener_=new or(this.stats_)}t=this.statsListener_.get()}else{t=this.stats_.get()}var r=Object.keys(t).reduce((function(e,t){return Math.max(t.length,e)}),0);M(t,(function(e,t){var n=e;for(var i=e.length;i<r+2;i++){n+=" "}console.log(n+t)}))};e.prototype.statsIncrementCounter=function(e){this.stats_.incrementCounter(e);this.statsReporter_.includeStat(e)};e.prototype.log_=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}var r="";if(this.persistentConnection_){r=this.persistentConnection_.id+":"}w.apply(void 0,s.__spread([r],e))};e.prototype.callOnCompleteCallback=function(e,t,r){if(e){j((function(){if(t==="ok"){e(null)}else{var n=(t||"error").toUpperCase();var i=n;if(r){i+=": "+r}var o=new Error(i);o.code=n;e(o)}}))}};Object.defineProperty(e.prototype,"database",{get:function(){return this.__database||(this.__database=new Nn(this))},enumerable:true,configurable:true});return e}();var _n=function(){function e(t){this.indexedFilter_=new Qt(t.getIndex());this.index_=t.getIndex();this.startPost_=e.getStartPost_(t);this.endPost_=e.getEndPost_(t)}e.prototype.getStartPost=function(){return this.startPost_};e.prototype.getEndPost=function(){return this.endPost_};e.prototype.matches=function(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0};e.prototype.updateChild=function(e,t,r,n,i,o){if(!this.matches(new xe(t,r))){r=at.EMPTY_NODE}return this.indexedFilter_.updateChild(e,t,r,n,i,o)};e.prototype.updateFullNode=function(e,t,r){if(t.isLeafNode()){t=at.EMPTY_NODE}var n=t.withIndex(this.index_);n=n.updatePriority(at.EMPTY_NODE);var i=this;t.forEachChild(Ke,(function(e,t){if(!i.matches(new xe(e,t))){n=n.updateImmediateChild(e,at.EMPTY_NODE)}}));return this.indexedFilter_.updateFullNode(e,n,r)};e.prototype.updatePriority=function(e,t){return e};e.prototype.filtersNodes=function(){return true};e.prototype.getIndexedFilter=function(){return this.indexedFilter_};e.prototype.getIndex=function(){return this.index_};e.getStartPost_=function(e){if(e.hasStart()){var t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else{return e.getIndex().minPost()}};e.getEndPost_=function(e){if(e.hasEnd()){var t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else{return e.getIndex().maxPost()}};return e}();var yn=function(){function e(e){this.rangedFilter_=new _n(e);this.index_=e.getIndex();this.limit_=e.getLimit();this.reverse_=!e.isViewFromLeft()}e.prototype.updateChild=function(e,t,r,n,i,o){if(!this.rangedFilter_.matches(new xe(t,r))){r=at.EMPTY_NODE}if(e.getImmediateChild(t).equals(r)){return e}else if(e.numChildren()<this.limit_){return this.rangedFilter_.getIndexedFilter().updateChild(e,t,r,n,i,o)}else{return this.fullLimitUpdateChild_(e,t,r,i,o)}};e.prototype.updateFullNode=function(e,t,r){var n;if(t.isLeafNode()||t.isEmpty()){n=at.EMPTY_NODE.withIndex(this.index_)}else{if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){n=at.EMPTY_NODE.withIndex(this.index_);var i=void 0;if(this.reverse_){i=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_)}else{i=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_)}var o=0;while(i.hasNext()&&o<this.limit_){var s=i.getNext();var a=void 0;if(this.reverse_){a=this.index_.compare(this.rangedFilter_.getStartPost(),s)<=0}else{a=this.index_.compare(s,this.rangedFilter_.getEndPost())<=0}if(a){n=n.updateImmediateChild(s.name,s.node);o++}else{break}}}else{n=t.withIndex(this.index_);n=n.updatePriority(at.EMPTY_NODE);var l=void 0;var u=void 0;var h=void 0;var i=void 0;if(this.reverse_){i=n.getReverseIterator(this.index_);l=this.rangedFilter_.getEndPost();u=this.rangedFilter_.getStartPost();var c=this.index_.getCompare();h=function(e,t){return c(t,e)}}else{i=n.getIterator(this.index_);l=this.rangedFilter_.getStartPost();u=this.rangedFilter_.getEndPost();h=this.index_.getCompare()}var o=0;var p=false;while(i.hasNext()){var s=i.getNext();if(!p&&h(l,s)<=0){p=true}var a=p&&o<this.limit_&&h(s,u)<=0;if(a){o++}else{n=n.updateImmediateChild(s.name,at.EMPTY_NODE)}}}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,n,r)};e.prototype.updatePriority=function(e,t){return e};e.prototype.filtersNodes=function(){return true};e.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()};e.prototype.getIndex=function(){return this.index_};e.prototype.fullLimitUpdateChild_=function(e,t,r,n,i){var o;if(this.reverse_){var s=this.index_.getCompare();o=function(e,t){return s(t,e)}}else{o=this.index_.getCompare()}var l=e;a.assert(l.numChildren()===this.limit_,"");var u=new xe(t,r);var h=this.reverse_?l.getFirstChild(this.index_):l.getLastChild(this.index_);var c=this.rangedFilter_.matches(u);if(l.hasChild(t)){var p=l.getImmediateChild(t);var f=n.getChildAfterChild(this.index_,h,this.reverse_);while(f!=null&&(f.name===t||l.hasChild(f.name))){f=n.getChildAfterChild(this.index_,f,this.reverse_)}var d=f==null?1:o(f,u);var v=c&&!r.isEmpty()&&d>=0;if(v){if(i!=null){i.trackChildChange(Wt.childChangedChange(t,r,p))}return l.updateImmediateChild(t,r)}else{if(i!=null){i.trackChildChange(Wt.childRemovedChange(t,p))}var _=l.updateImmediateChild(t,at.EMPTY_NODE);var y=f!=null&&this.rangedFilter_.matches(f);if(y){if(i!=null){i.trackChildChange(Wt.childAddedChange(f.name,f.node))}return _.updateImmediateChild(f.name,f.node)}else{return _}}}else if(r.isEmpty()){return e}else if(c){if(o(h,u)>=0){if(i!=null){i.trackChildChange(Wt.childRemovedChange(h.name,h.node));i.trackChildChange(Wt.childAddedChange(t,r))}return l.updateImmediateChild(t,r).updateImmediateChild(h.name,at.EMPTY_NODE)}else{return e}}else{return e}};return e}();var gn=function(){function e(){this.limitSet_=false;this.startSet_=false;this.startNameSet_=false;this.endSet_=false;this.endNameSet_=false;this.limit_=0;this.viewFrom_="";this.indexStartValue_=null;this.indexStartName_="";this.indexEndValue_=null;this.indexEndName_="";this.index_=Ke}e.prototype.hasStart=function(){return this.startSet_};e.prototype.isViewFromLeft=function(){if(this.viewFrom_===""){return this.startSet_}else{return this.viewFrom_===e.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT}};e.prototype.getIndexStartValue=function(){a.assert(this.startSet_,"Only valid if start has been set");return this.indexStartValue_};e.prototype.getIndexStartName=function(){a.assert(this.startSet_,"Only valid if start has been set");if(this.startNameSet_){return this.indexStartName_}else{return D}};e.prototype.hasEnd=function(){return this.endSet_};e.prototype.getIndexEndValue=function(){a.assert(this.endSet_,"Only valid if end has been set");return this.indexEndValue_};e.prototype.getIndexEndName=function(){a.assert(this.endSet_,"Only valid if end has been set");if(this.endNameSet_){return this.indexEndName_}else{return x}};e.prototype.hasLimit=function(){return this.limitSet_};e.prototype.hasAnchoredLimit=function(){return this.limitSet_&&this.viewFrom_!==""};e.prototype.getLimit=function(){a.assert(this.limitSet_,"Only valid if limit has been set");return this.limit_};e.prototype.getIndex=function(){return this.index_};e.prototype.copy_=function(){var t=new e;t.limitSet_=this.limitSet_;t.limit_=this.limit_;t.startSet_=this.startSet_;t.indexStartValue_=this.indexStartValue_;t.startNameSet_=this.startNameSet_;t.indexStartName_=this.indexStartName_;t.endSet_=this.endSet_;t.indexEndValue_=this.indexEndValue_;t.endNameSet_=this.endNameSet_;t.indexEndName_=this.indexEndName_;t.index_=this.index_;t.viewFrom_=this.viewFrom_;return t};e.prototype.limit=function(e){var t=this.copy_();t.limitSet_=true;t.limit_=e;t.viewFrom_="";return t};e.prototype.limitToFirst=function(t){var r=this.copy_();r.limitSet_=true;r.limit_=t;r.viewFrom_=e.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT;return r};e.prototype.limitToLast=function(t){var r=this.copy_();r.limitSet_=true;r.limit_=t;r.viewFrom_=e.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT;return r};e.prototype.startAt=function(e,t){var r=this.copy_();r.startSet_=true;if(e===undefined){e=null}r.indexStartValue_=e;if(t!=null){r.startNameSet_=true;r.indexStartName_=t}else{r.startNameSet_=false;r.indexStartName_=""}return r};e.prototype.endAt=function(e,t){var r=this.copy_();r.endSet_=true;if(e===undefined){e=null}r.indexEndValue_=e;if(t!==undefined){r.endNameSet_=true;r.indexEndName_=t}else{r.endNameSet_=false;r.indexEndName_=""}return r};e.prototype.orderBy=function(e){var t=this.copy_();t.index_=e;return t};e.prototype.getQueryObject=function(){var t=e.WIRE_PROTOCOL_CONSTANTS_;var r={};if(this.startSet_){r[t.INDEX_START_VALUE]=this.indexStartValue_;if(this.startNameSet_){r[t.INDEX_START_NAME]=this.indexStartName_}}if(this.endSet_){r[t.INDEX_END_VALUE]=this.indexEndValue_;if(this.endNameSet_){r[t.INDEX_END_NAME]=this.indexEndName_}}if(this.limitSet_){r[t.LIMIT]=this.limit_;var n=this.viewFrom_;if(n===""){if(this.isViewFromLeft()){n=t.VIEW_FROM_LEFT}else{n=t.VIEW_FROM_RIGHT}}r[t.VIEW_FROM]=n}if(this.index_!==Ke){r[t.INDEX]=this.index_.toString()}return r};e.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)};e.prototype.isDefault=function(){return this.loadsAllData()&&this.index_===Ke};e.prototype.getNodeFilter=function(){if(this.loadsAllData()){return new Qt(this.getIndex())}else if(this.hasLimit()){return new yn(this)}else{return new _n(this)}};e.prototype.toRestQueryStringParameters=function(){var t=e.REST_QUERY_CONSTANTS_;var r={};if(this.isDefault()){return r}var n;if(this.index_===Ke){n=t.PRIORITY_INDEX}else if(this.index_===ft){n=t.VALUE_INDEX}else if(this.index_===Ae){n=t.KEY_INDEX}else{a.assert(this.index_ instanceof dt,"Unrecognized index type!");n=this.index_.toString()}r[t.ORDER_BY]=a.stringify(n);if(this.startSet_){r[t.START_AT]=a.stringify(this.indexStartValue_);if(this.startNameSet_){r[t.START_AT]+=","+a.stringify(this.indexStartName_)}}if(this.endSet_){r[t.END_AT]=a.stringify(this.indexEndValue_);if(this.endNameSet_){r[t.END_AT]+=","+a.stringify(this.indexEndName_)}}if(this.limitSet_){if(this.isViewFromLeft()){r[t.LIMIT_TO_FIRST]=this.limit_}else{r[t.LIMIT_TO_LAST]=this.limit_}}return r};e.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:"sp",INDEX_START_NAME:"sn",INDEX_END_VALUE:"ep",INDEX_END_NAME:"en",LIMIT:"l",VIEW_FROM:"vf",VIEW_FROM_LEFT:"l",VIEW_FROM_RIGHT:"r",INDEX:"i"};e.REST_QUERY_CONSTANTS_={ORDER_BY:"orderBy",PRIORITY_INDEX:"$priority",VALUE_INDEX:"$value",KEY_INDEX:"$key",START_AT:"startAt",END_AT:"endAt",LIMIT_TO_FIRST:"limitToFirst",LIMIT_TO_LAST:"limitToLast"};e.DEFAULT=new e;return e}();var mn=function(e){s.__extends(t,e);function t(t,r){var n=this;if(!(t instanceof vn)){throw new Error("new Reference() no longer supported - use app.database().")}n=e.call(this,t,r,gn.DEFAULT,false)||this;return n}t.prototype.getKey=function(){a.validateArgCount("Reference.key",0,0,arguments.length);if(this.path.isEmpty()){return null}else{return this.path.getBack()}};t.prototype.child=function(e){a.validateArgCount("Reference.child",1,1,arguments.length);if(typeof e==="number"){e=String(e)}else if(!(e instanceof K)){if(this.path.getFront()===null){be("Reference.child",1,e,false)}else{Te("Reference.child",1,e,false)}}return new t(this.repo,this.path.child(e))};t.prototype.getParent=function(){a.validateArgCount("Reference.parent",0,0,arguments.length);var e=this.path.parent();return e===null?null:new t(this.repo,e)};t.prototype.getRoot=function(){a.validateArgCount("Reference.root",0,0,arguments.length);var e=this;while(e.getParent()!==null){e=e.getParent()}return e};t.prototype.databaseProp=function(){return this.repo.database};t.prototype.set=function(e,t){a.validateArgCount("Reference.set",1,2,arguments.length);Se("Reference.set",this.path);_e("Reference.set",1,e,this.path,false);a.validateCallback("Reference.set",2,t,true);var r=new a.Deferred;this.repo.setWithPriority(this.path,e,null,r.wrapCallback(t));return r.promise};t.prototype.update=function(e,t){a.validateArgCount("Reference.update",1,2,arguments.length);Se("Reference.update",this.path);if(Array.isArray(e)){var r={};for(var n=0;n<e.length;++n){r[""+n]=e[n]}e=r;I("Passing an Array to Firebase.update() is deprecated. "+"Use set() if you want to overwrite the existing data, or "+"an Object with integer keys if you really do want to "+"only update some of the children.")}me("Reference.update",1,e,this.path,false);a.validateCallback("Reference.update",2,t,true);var i=new a.Deferred;this.repo.update(this.path,e,i.wrapCallback(t));return i.promise};t.prototype.setWithPriority=function(e,t,r){a.validateArgCount("Reference.setWithPriority",2,3,arguments.length);Se("Reference.setWithPriority",this.path);_e("Reference.setWithPriority",1,e,this.path,false);Ce("Reference.setWithPriority",2,t,false);a.validateCallback("Reference.setWithPriority",3,r,true);if(this.getKey()===".length"||this.getKey()===".keys"){throw"Reference.setWithPriority failed: "+this.getKey()+" is a read-only object."}var n=new a.Deferred;this.repo.setWithPriority(this.path,e,t,n.wrapCallback(r));return n.promise};t.prototype.remove=function(e){a.validateArgCount("Reference.remove",0,1,arguments.length);Se("Reference.remove",this.path);a.validateCallback("Reference.remove",1,e,true);return this.set(null,e)};t.prototype.transaction=function(e,t,r){a.validateArgCount("Reference.transaction",1,3,arguments.length);Se("Reference.transaction",this.path);a.validateCallback("Reference.transaction",1,e,false);a.validateCallback("Reference.transaction",2,t,true);Ne("Reference.transaction",3,r,true);if(this.getKey()===".length"||this.getKey()===".keys"){throw"Reference.transaction failed: "+this.getKey()+" is a read-only object."}if(r===undefined){r=true}var n=new a.Deferred;if(typeof t==="function"){n.promise.catch((function(){}))}var i=function(e,r,i){if(e){n.reject(e)}else{n.resolve(new Re(r,i))}if(typeof t==="function"){t(e,r,i)}};this.repo.startTransaction(this.path,e,i,r);return n.promise};t.prototype.setPriority=function(e,t){a.validateArgCount("Reference.setPriority",1,2,arguments.length);Se("Reference.setPriority",this.path);Ce("Reference.setPriority",1,e,false);a.validateCallback("Reference.setPriority",2,t,true);var r=new a.Deferred;this.repo.setWithPriority(this.path.child(".priority"),e,null,r.wrapCallback(t));return r.promise};t.prototype.push=function(e,t){a.validateArgCount("Reference.push",0,2,arguments.length);Se("Reference.push",this.path);_e("Reference.push",1,e,this.path,true);a.validateCallback("Reference.push",2,t,true);var r=this.repo.serverTime();var n=De(r);var i=this.child(n);var o=this.child(n);var s;if(e!=null){s=i.set(e,t).then((function(){return o}))}else{s=Promise.resolve(o)}i.then=s.then.bind(s);i.catch=s.then.bind(s,undefined);if(typeof t==="function"){s.catch((function(){}))}return i};t.prototype.onDisconnect=function(){Se("Reference.onDisconnect",this.path);return new Pe(this.repo,this.path)};Object.defineProperty(t.prototype,"database",{get:function(){return this.databaseProp()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"key",{get:function(){return this.getKey()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"parent",{get:function(){return this.getParent()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"root",{get:function(){return this.getRoot()},enumerable:true,configurable:true});return t}(Et);Et.__referenceConstructor=mn;Gt.__referenceConstructor=mn;var Cn=function(){function e(){this.children={};this.childCount=0;this.value=null}return e}();var En=function(){function e(e,t,r){if(e===void 0){e=""}if(t===void 0){t=null}if(r===void 0){r=new Cn}this.name_=e;this.parent_=t;this.node_=r}e.prototype.subTree=function(t){var r=t instanceof K?t:new K(t);var n=this,i=r.getFront();while(i!==null){var o=a.safeGet(n.node_.children,i)||new Cn;n=new e(i,n,o);r=r.popFront();i=r.getFront()}return n};e.prototype.getValue=function(){return this.node_.value};e.prototype.setValue=function(e){a.assert(typeof e!=="undefined","Cannot set value to undefined");this.node_.value=e;this.updateParents_()};e.prototype.clear=function(){this.node_.value=null;this.node_.children={};this.node_.childCount=0;this.updateParents_()};e.prototype.hasChildren=function(){return this.node_.childCount>0};e.prototype.isEmpty=function(){return this.getValue()===null&&!this.hasChildren()};e.prototype.forEachChild=function(t){var r=this;M(this.node_.children,(function(n,i){t(new e(n,r,i))}))};e.prototype.forEachDescendant=function(e,t,r){if(t&&!r){e(this)}this.forEachChild((function(t){t.forEachDescendant(e,true,r)}));if(t&&r){e(this)}};e.prototype.forEachAncestor=function(e,t){var r=t?this:this.parent();while(r!==null){if(e(r)){return true}r=r.parent()}return false};e.prototype.forEachImmediateDescendantWithValue=function(e){this.forEachChild((function(t){if(t.getValue()!==null){e(t)}else{t.forEachImmediateDescendantWithValue(e)}}))};e.prototype.path=function(){return new K(this.parent_===null?this.name_:this.parent_.path()+"/"+this.name_)};e.prototype.name=function(){return this.name_};e.prototype.parent=function(){return this.parent_};e.prototype.updateParents_=function(){if(this.parent_!==null){this.parent_.updateChild_(this.name_,this)}};e.prototype.updateChild_=function(e,t){var r=t.isEmpty();var n=a.contains(this.node_.children,e);if(r&&n){delete this.node_.children[e];this.node_.childCount--;this.updateParents_()}else if(!r&&!n){this.node_.children[e]=t.node_;this.node_.childCount++;this.updateParents_()}};return e}();var wn;(function(e){e[e["RUN"]=0]="RUN";e[e["SENT"]=1]="SENT";e[e["COMPLETED"]=2]="COMPLETED";e[e["SENT_NEEDS_ABORT"]=3]="SENT_NEEDS_ABORT";e[e["NEEDS_ABORT"]=4]="NEEDS_ABORT"})(wn||(wn={}));vn.MAX_TRANSACTION_RETRIES_=25;vn.prototype.transactionsInit_=function(){this.transactionQueueTree_=new En};vn.prototype.startTransaction=function(e,t,r,n){this.log_("transaction on "+e);var i=function(){};var o=new mn(this,e);o.on("value",i);var s=function(){o.off("value",i)};var l={path:e,update:t,onComplete:r,status:null,order:_(),applyLocally:n,retryCount:0,unwatcher:s,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null};var u=this.getLatestState_(e);l.currentInputSnapshot=u;var h=l.update(u.val());if(h===undefined){l.unwatcher();l.currentOutputSnapshotRaw=null;l.currentOutputSnapshotResolved=null;if(l.onComplete){var c=new vt(l.currentInputSnapshot,new mn(this,l.path),Ke);l.onComplete(null,false,c)}}else{ye("transaction failed: Data returned ",h,l.path);l.status=wn.RUN;var p=this.transactionQueueTree_.subTree(e);var f=p.getValue()||[];f.push(l);p.setValue(f);var d=void 0;if(typeof h==="object"&&h!==null&&a.contains(h,".priority")){d=a.safeGet(h,".priority");a.assert(ve(d),"Invalid priority returned by transaction. "+"Priority must be a valid string, finite number, server value, or null.")}else{var v=this.serverSyncTree_.calcCompleteEventCache(e)||at.EMPTY_NODE;d=v.getPriority().val()}d=d;var y=this.generateServerValues();var g=ct(h,d);var m=It(g,y);l.currentOutputSnapshotRaw=g;l.currentOutputSnapshotResolved=m;l.currentWriteId=this.getNextWriteId_();var C=this.serverSyncTree_.applyUserOverwrite(e,m,l.currentWriteId,l.applyLocally);this.eventQueue_.raiseEventsForChangedPath(e,C);this.sendReadyTransactions_()}};vn.prototype.getLatestState_=function(e,t){return this.serverSyncTree_.calcCompleteEventCache(e,t)||at.EMPTY_NODE};vn.prototype.sendReadyTransactions_=function(e){var t=this;if(e===void 0){e=this.transactionQueueTree_}if(!e){this.pruneCompletedTransactionsBelowNode_(e)}if(e.getValue()!==null){var r=this.buildTransactionQueue_(e);a.assert(r.length>0,"Sending zero length transaction queue");var n=r.every((function(e){return e.status===wn.RUN}));if(n){this.sendTransactionQueue_(e.path(),r)}}else if(e.hasChildren()){e.forEachChild((function(e){t.sendReadyTransactions_(e)}))}};vn.prototype.sendTransactionQueue_=function(e,t){var r=this;var n=t.map((function(e){return e.currentWriteId}));var i=this.getLatestState_(e,n);var o=i;var s=i.hash();for(var l=0;l<t.length;l++){var u=t[l];a.assert(u.status===wn.RUN,"tryToSendTransactionQueue_: items in queue should all be run.");u.status=wn.SENT;u.retryCount++;var h=K.relativePath(e,u.path);o=o.updateChild(h,u.currentOutputSnapshotRaw)}var c=o.val(true);var p=e;this.server_.put(p.toString(),c,(function(n){r.log_("transaction put response",{path:p.toString(),status:n});var i=[];if(n==="ok"){var o=[];for(var s=0;s<t.length;s++){t[s].status=wn.COMPLETED;i=i.concat(r.serverSyncTree_.ackUserWrite(t[s].currentWriteId));if(t[s].onComplete){var a=t[s].currentOutputSnapshotResolved;var l=new mn(r,t[s].path);var u=new vt(a,l,Ke);o.push(t[s].onComplete.bind(null,null,true,u))}t[s].unwatcher()}r.pruneCompletedTransactionsBelowNode_(r.transactionQueueTree_.subTree(e));r.sendReadyTransactions_();r.eventQueue_.raiseEventsForChangedPath(e,i);for(var s=0;s<o.length;s++){j(o[s])}}else{if(n==="datastale"){for(var s=0;s<t.length;s++){if(t[s].status===wn.SENT_NEEDS_ABORT){t[s].status=wn.NEEDS_ABORT}else{t[s].status=wn.RUN}}}else{I("transaction at "+p.toString()+" failed: "+n);for(var s=0;s<t.length;s++){t[s].status=wn.NEEDS_ABORT;t[s].abortReason=n}}r.rerunTransactions_(e)}}),s)};vn.prototype.rerunTransactions_=function(e){var t=this.getAncestorTransactionNode_(e);var r=t.path();var n=this.buildTransactionQueue_(t);this.rerunTransactionQueue_(n,r);return r};vn.prototype.rerunTransactionQueue_=function(e,t){if(e.length===0){return}var r=[];var n=[];var i=e.filter((function(e){return e.status===wn.RUN}));var o=i.map((function(e){return e.currentWriteId}));for(var s=0;s<e.length;s++){var l=e[s];var u=K.relativePath(t,l.path);var h=false,c=void 0;a.assert(u!==null,"rerunTransactionsUnderNode_: relativePath should not be null.");if(l.status===wn.NEEDS_ABORT){h=true;c=l.abortReason;n=n.concat(this.serverSyncTree_.ackUserWrite(l.currentWriteId,true))}else if(l.status===wn.RUN){if(l.retryCount>=vn.MAX_TRANSACTION_RETRIES_){h=true;c="maxretry";n=n.concat(this.serverSyncTree_.ackUserWrite(l.currentWriteId,true))}else{var p=this.getLatestState_(l.path,o);l.currentInputSnapshot=p;var f=e[s].update(p.val());if(f!==undefined){ye("transaction failed: Data returned ",f,l.path);var d=ct(f);var v=typeof f==="object"&&f!=null&&a.contains(f,".priority");if(!v){d=d.updatePriority(p.getPriority())}var _=l.currentWriteId;var y=this.generateServerValues();var g=It(d,y);l.currentOutputSnapshotRaw=d;l.currentOutputSnapshotResolved=g;l.currentWriteId=this.getNextWriteId_();o.splice(o.indexOf(_),1);n=n.concat(this.serverSyncTree_.applyUserOverwrite(l.path,g,l.currentWriteId,l.applyLocally));n=n.concat(this.serverSyncTree_.ackUserWrite(_,true))}else{h=true;c="nodata";n=n.concat(this.serverSyncTree_.ackUserWrite(l.currentWriteId,true))}}}this.eventQueue_.raiseEventsForChangedPath(t,n);n=[];if(h){e[s].status=wn.COMPLETED;(function(e){setTimeout(e,Math.floor(0))})(e[s].unwatcher);if(e[s].onComplete){if(c==="nodata"){var m=new mn(this,e[s].path);var C=e[s].currentInputSnapshot;var E=new vt(C,m,Ke);r.push(e[s].onComplete.bind(null,null,false,E))}else{r.push(e[s].onComplete.bind(null,new Error(c),false,null))}}}}this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_);for(var s=0;s<r.length;s++){j(r[s])}this.sendReadyTransactions_()};vn.prototype.getAncestorTransactionNode_=function(e){var t;var r=this.transactionQueueTree_;t=e.getFront();while(t!==null&&r.getValue()===null){r=r.subTree(t);e=e.popFront();t=e.getFront()}return r};vn.prototype.buildTransactionQueue_=function(e){var t=[];this.aggregateTransactionQueuesForNode_(e,t);t.sort((function(e,t){return e.order-t.order}));return t};vn.prototype.aggregateTransactionQueuesForNode_=function(e,t){var r=this;var n=e.getValue();if(n!==null){for(var i=0;i<n.length;i++){t.push(n[i])}}e.forEachChild((function(e){r.aggregateTransactionQueuesForNode_(e,t)}))};vn.prototype.pruneCompletedTransactionsBelowNode_=function(e){var t=this;var r=e.getValue();if(r){var n=0;for(var i=0;i<r.length;i++){if(r[i].status!==wn.COMPLETED){r[n]=r[i];n++}}r.length=n;e.setValue(r.length>0?r:null)}e.forEachChild((function(e){t.pruneCompletedTransactionsBelowNode_(e)}))};vn.prototype.abortTransactions_=function(e){var t=this;var r=this.getAncestorTransactionNode_(e).path();var n=this.transactionQueueTree_.subTree(e);n.forEachAncestor((function(e){t.abortTransactionsOnNode_(e)}));this.abortTransactionsOnNode_(n);n.forEachDescendant((function(e){t.abortTransactionsOnNode_(e)}));return r};vn.prototype.abortTransactionsOnNode_=function(e){var t=e.getValue();if(t!==null){var r=[];var n=[];var i=-1;for(var o=0;o<t.length;o++){if(t[o].status===wn.SENT_NEEDS_ABORT);else if(t[o].status===wn.SENT){a.assert(i===o-1,"All SENT items should be at beginning of queue.");i=o;t[o].status=wn.SENT_NEEDS_ABORT;t[o].abortReason="set"}else{a.assert(t[o].status===wn.RUN,"Unexpected transaction status in abort");t[o].unwatcher();n=n.concat(this.serverSyncTree_.ackUserWrite(t[o].currentWriteId,true));if(t[o].onComplete){var s=null;r.push(t[o].onComplete.bind(null,new Error("set"),false,s))}}}if(i===-1){e.setValue(null)}else{t.length=i+1}this.eventQueue_.raiseEventsForChangedPath(e.path(),n);for(var o=0;o<r.length;o++){j(r[o])}}};var Tn="databaseURL";var bn="FIREBASE_DATABASE_EMULATOR_HOST";var Sn;var In=function(){function e(){this.repos_={};this.useRestClient_=false}e.getInstance=function(){if(!Sn){Sn=new e}return Sn};e.prototype.interrupt=function(){var e,t,r,n;try{for(var i=s.__values(Object.keys(this.repos_)),o=i.next();!o.done;o=i.next()){var a=o.value;try{for(var l=(r=void 0,s.__values(Object.keys(this.repos_[a]))),u=l.next();!u.done;u=l.next()){var h=u.value;this.repos_[a][h].interrupt()}}catch(c){r={error:c}}finally{try{if(u&&!u.done&&(n=l.return))n.call(l)}finally{if(r)throw r.error}}}}catch(p){e={error:p}}finally{try{if(o&&!o.done&&(t=i.return))t.call(i)}finally{if(e)throw e.error}}};e.prototype.resume=function(){var e,t,r,n;try{for(var i=s.__values(Object.keys(this.repos_)),o=i.next();!o.done;o=i.next()){var a=o.value;try{for(var l=(r=void 0,s.__values(Object.keys(this.repos_[a]))),u=l.next();!u.done;u=l.next()){var h=u.value;this.repos_[a][h].resume()}}catch(c){r={error:c}}finally{try{if(u&&!u.done&&(n=l.return))n.call(l)}finally{if(r)throw r.error}}}}catch(p){e={error:p}}finally{try{if(o&&!o.done&&(t=i.return))t.call(i)}finally{if(e)throw e.error}}};e.prototype.databaseFromApp=function(e,t,r){var i=r||e.options[Tn];if(i===undefined){S("Can't determine Firebase Database URL.  Be sure to include "+Tn+" option when calling firebase.initializeApp().")}var o=ae(i);var s=o.repoInfo;var a=undefined;if(typeof n!=="undefined"){a=n.env[bn]}if(a){i="http://"+a+"?ns="+s.namespace;o=ae(i);s=o.repoInfo}Ie("Invalid Firebase Database URL",1,o);if(!o.path.isEmpty()){S("Database URL must point to the root of a Firebase Database "+"(not including a child path).")}var l=this.createRepo(s,e,t);return l.database};e.prototype.deleteRepo=function(e){var t=a.safeGet(this.repos_,e.app.name);if(!t||a.safeGet(t,e.repoInfo_.toURLString())!==e){S("Database "+e.app.name+"("+e.repoInfo_+") has already been deleted.")}e.interrupt();delete t[e.repoInfo_.toURLString()]};e.prototype.createRepo=function(e,t,r){var n=a.safeGet(this.repos_,t.name);if(!n){n={};this.repos_[t.name]=n}var i=a.safeGet(n,e.toURLString());if(i){S("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.")}i=new vn(e,this.useRestClient_,t,r);n[e.toURLString()]=i;return i};e.prototype.forceRestClient=function(e){this.useRestClient_=e};return e}();var Nn=function(){function e(e){this.repo_=e;if(!(e instanceof vn)){S("Don't call new Database() directly - please use firebase.database().")}this.root_=new mn(e,K.Empty);this.INTERNAL=new Pn(this)}Object.defineProperty(e.prototype,"app",{get:function(){return this.repo_.app},enumerable:true,configurable:true});e.prototype.ref=function(e){this.checkDeleted_("ref");a.validateArgCount("database.ref",0,1,arguments.length);if(e instanceof mn){return this.refFromURL(e.toString())}return e!==undefined?this.root_.child(e):this.root_};e.prototype.refFromURL=function(e){var t="database.refFromURL";this.checkDeleted_(t);a.validateArgCount(t,1,1,arguments.length);var r=ae(e);Ie(t,1,r);var n=r.repoInfo;if(n.host!==this.repo_.repoInfo_.host){S(t+": Host name does not match the current database: "+"(found "+n.host+" but expected "+this.repo_.repoInfo_.host+")")}return this.ref(r.path.toString())};e.prototype.checkDeleted_=function(e){if(this.repo_===null){S("Cannot call "+e+" on a deleted database.")}};e.prototype.goOffline=function(){a.validateArgCount("database.goOffline",0,0,arguments.length);this.checkDeleted_("goOffline");this.repo_.interrupt()};e.prototype.goOnline=function(){a.validateArgCount("database.goOnline",0,0,arguments.length);this.checkDeleted_("goOnline");this.repo_.resume()};e.ServerValue={TIMESTAMP:{".sv":"timestamp"}};return e}();var Pn=function(){function e(e){this.database=e}e.prototype.delete=function(){return s.__awaiter(this,void 0,void 0,(function(){return s.__generator(this,(function(e){this.database.checkDeleted_("delete");In.getInstance().deleteRepo(this.database.repo_);this.database.repo_=null;this.database.root_=null;this.database.INTERNAL=null;this.database=null;return[2]}))}))};return e}();var Rn=function(){qr.forceDisallow();Or.forceAllow()};var Dn=function(){Or.forceDisallow()};var xn=function(){return qr["isAvailable"]()};var kn=function(e,t){e.repo.persistentConnection_.securityDebugCallback_=t};var On=function(e,t){e.repo.stats(t)};var Fn=function(e,t){e.repo.statsIncrementCounter(t)};var An=function(e){return e.repo.dataUpdateCount};var Ln=function(e,t){return e.repo.interceptServerData_(t)};var Mn=Object.freeze({__proto__:null,forceLongPolling:Rn,forceWebSockets:Dn,isWebSocketsAvailable:xn,setSecurityDebugCallback:kn,stats:On,statsIncrementCounter:Fn,dataUpdateCount:An,interceptServerData:Ln});var Wn=pn;pn.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)};pn.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)};var Qn=rn;var qn=function(e){var t=pn.prototype.put;pn.prototype.put=function(r,n,i,o){if(o!==undefined){o=e()}t.call(this,r,n,i,o)};return function(){pn.prototype.put=t}};var Un=ie;var Vn=function(e){return e.queryIdentifier()};var Hn=function(e){In.getInstance().forceRestClient(e)};var jn=Object.freeze({__proto__:null,DataConnection:Wn,RealTimeConnection:Qn,hijackHash:qn,ConnectionTarget:Un,queryIdentifier:Vn,forceRestClient:Hn});var Bn="@firebase/database";var Yn="0.5.24";var Kn=Nn.ServerValue;function zn(t){Lr(t.SDK_VERSION);var r=t.INTERNAL.registerComponent(new u.Component("database",(function(e,t){var r=e.getProvider("app").getImmediate();var n=e.getProvider("auth-internal");return In.getInstance().databaseFromApp(r,n,t)}),"PUBLIC").setServiceProps({Reference:mn,Query:Et,Database:Nn,DataSnapshot:vt,enableLogging:E,INTERNAL:Mn,ServerValue:Kn,TEST_ACCESS:jn}).setMultipleInstances(true));t.registerVersion(Bn,Yn);if(a.isNodeSdk()){e.exports=r}}zn(o);t.DataSnapshot=vt;t.Database=Nn;t.OnDisconnect=Pe;t.Query=Et;t.Reference=mn;t.ServerValue=Kn;t.enableLogging=E;t.registerDatabase=zn},34406:e=>{var t=e.exports={};var r;var n;function i(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){r=setTimeout}else{r=i}}catch(e){r=i}try{if(typeof clearTimeout==="function"){n=clearTimeout}else{n=o}}catch(e){n=o}})();function s(e){if(r===setTimeout){return setTimeout(e,0)}if((r===i||!r)&&setTimeout){r=setTimeout;return setTimeout(e,0)}try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}function a(e){if(n===clearTimeout){return clearTimeout(e)}if((n===o||!n)&&clearTimeout){n=clearTimeout;return clearTimeout(e)}try{return n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}var l=[];var u=false;var h;var c=-1;function p(){if(!u||!h){return}u=false;if(h.length){l=h.concat(l)}else{c=-1}if(l.length){f()}}function f(){if(u){return}var e=s(p);u=true;var t=l.length;while(t){h=l;l=[];while(++c<t){if(h){h[c].run()}}c=-1;t=l.length}h=null;u=false;a(e)}t.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1){for(var r=1;r<arguments.length;r++){t[r-1]=arguments[r]}}l.push(new d(e,t));if(l.length===1&&!u){s(f)}};function d(e,t){this.fun=e;this.array=t}d.prototype.run=function(){this.fun.apply(null,this.array)};t.title="browser";t.browser=true;t.env={};t.argv=[];t.version="";t.versions={};function v(){}t.on=v;t.addListener=v;t.once=v;t.off=v;t.removeListener=v;t.removeAllListeners=v;t.emit=v;t.prependListener=v;t.prependOnceListener=v;t.listeners=function(e){return[]};t.binding=function(e){throw new Error("process.binding is not supported")};t.cwd=function(){return"/"};t.chdir=function(e){throw new Error("process.chdir is not supported")};t.umask=function(){return 0}}}]);
//# sourceMappingURL=7145.c3a281484e183e122271.js.map?v=c3a281484e183e122271