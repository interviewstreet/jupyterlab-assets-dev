(self["webpackChunk_jupyterlab_application_top"]=self["webpackChunk_jupyterlab_application_top"]||[]).push([[1072],{6493:(e,t,s)=>{"use strict";s.d(t,{GL:()=>u,Ag:()=>f,xq:()=>p,oy:()=>m});var n=s(3260);var o=s(94072);var c=s(40870);var i=s(21332);var a=s(75736);var r=s(1872);var l=s(11038);var h=s.n(l);const d=3e4;class u extends a.y{constructor(e){super();this.doc=e;this.clientID=e.clientID;this.states=new Map;this.meta=new Map;this._checkInterval=setInterval((()=>{const e=c.ZG();if(this.getLocalState()!==null&&d/2<=e-this.meta.get(this.clientID).lastUpdated){this.setLocalState(this.getLocalState())}const t=[];this.meta.forEach(((s,n)=>{if(n!==this.clientID&&d<=e-s.lastUpdated&&this.states.has(n)){t.push(n)}}));if(t.length>0){f(this,t,"timeout")}}),i.GW(d/10));e.on("destroy",(()=>{this.destroy()}));this.setLocalState({})}destroy(){this.emit("destroy",[this]);this.setLocalState(null);super.destroy();clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){const t=this.clientID;const s=this.meta.get(t);const n=s===undefined?0:s.clock+1;const o=this.states.get(t);if(e===null){this.states.delete(t)}else{this.states.set(t,e)}this.meta.set(t,{clock:n,lastUpdated:c.ZG()});const i=[];const a=[];const l=[];const h=[];if(e===null){h.push(t)}else if(o==null){if(e!=null){i.push(t)}}else{a.push(t);if(!r.Hi(o,e)){l.push(t)}}if(i.length>0||l.length>0||h.length>0){this.emit("change",[{added:i,updated:l,removed:h},"local"])}this.emit("update",[{added:i,updated:a,removed:h},"local"])}setLocalStateField(e,t){const s=this.getLocalState();if(s!==null){this.setLocalState({...s,[e]:t})}}getStates(){return this.states}}const f=(e,t,s)=>{const n=[];for(let o=0;o<t.length;o++){const s=t[o];if(e.states.has(s)){e.states.delete(s);if(s===e.clientID){const t=e.meta.get(s);e.meta.set(s,{clock:t.clock+1,lastUpdated:c.ZG()})}n.push(s)}}if(n.length>0){e.emit("change",[{added:[],updated:[],removed:n},s]);e.emit("update",[{added:[],updated:[],removed:n},s])}};const p=(e,t,s=e.states)=>{const o=t.length;const c=n.Mf();n.uE(c,o);for(let i=0;i<o;i++){const o=t[i];const a=s.get(o)||null;const r=e.meta.get(o).clock;n.uE(c,o);n.uE(c,r);n.uw(c,JSON.stringify(a))}return n._f(c)};const g=(e,t)=>{const s=decoding.createDecoder(e);const n=encoding.createEncoder();const o=decoding.readVarUint(s);encoding.writeVarUint(n,o);for(let c=0;c<o;c++){const e=decoding.readVarUint(s);const o=decoding.readVarUint(s);const c=JSON.parse(decoding.readVarString(s));const i=t(c);encoding.writeVarUint(n,e);encoding.writeVarUint(n,o);encoding.writeVarString(n,JSON.stringify(i))}return encoding.toUint8Array(n)};const m=(e,t,s)=>{const n=o.l1(t);const i=c.ZG();const a=[];const l=[];const h=[];const d=[];const u=o.yg(n);for(let c=0;c<u;c++){const t=o.yg(n);let s=o.yg(n);const c=JSON.parse(o.kf(n));const u=e.meta.get(t);const f=e.states.get(t);const p=u===undefined?0:u.clock;if(p<s||p===s&&c===null&&e.states.has(t)){if(c===null){if(t===e.clientID&&e.getLocalState()!=null){s++}else{e.states.delete(t)}}else{e.states.set(t,c)}e.meta.set(t,{clock:s,lastUpdated:i});if(u===undefined&&c!==null){a.push(t)}else if(u!==undefined&&c===null){d.push(t)}else if(c!==null){if(!r.Hi(c,f)){h.push(t)}l.push(t)}}}if(a.length>0||h.length>0||d.length>0){e.emit("change",[{added:a,updated:h,removed:d},s])}if(a.length>0||l.length>0||d.length>0){e.emit("update",[{added:a,updated:l,removed:d},s])}}},21072:(e,t,s)=>{"use strict";s.r(t);s.d(t,{IDocumentProviderFactory:()=>l,ProviderMock:()=>a,WebSocketProviderWithLocks:()=>ne,getAnonymousUserName:()=>o,getRandomColor:()=>i,moonsOfJupyter:()=>n,userColors:()=>c});const n=["Metis","Adrastea","Amalthea","Thebe","Io","Europa","Ganymede","Callisto","Themisto","Leda","Ersa","Pandia","Himalia","Lysithea","Elara","Dia","Carpo","Valetudo","Euporie","Eupheme","Helike","Euanthe","Hermippe","Praxidike","Thyone","Thelxinoe","Ananke","Mneme","Orthosie","Harpalyke","Iocaste","Erinome","Aitne","Herse","Taygete","Eukelade","Carme","Isonoe","Autonoe","Philophrosyne","Cyllene","Pasithee","Pasiphae","Sponde","Eurydome","Kalyke","Hegemone","Kale","Kallichore","Chaldene","Arche","Eirene","Kore","Megaclite","Aoede","Callirrhoe","Sinope"];const o=()=>"Anonymous "+n[Math.floor(Math.random()*n.length)];const c=["#12A0D3","#17AB30","#CC8500","#A79011","#ee6352","#609DA9","#4BA749","#00A1B3"];const i=()=>c[Math.floor(Math.random()*c.length)];class a{requestInitialContent(){return Promise.resolve(false)}putInitializedState(){}acquireLock(){return Promise.resolve(0)}releaseLock(e){}destroy(){}setPath(e){}}var r=s(98034);const l=new r.Token("@jupyterlab/docprovider:IDocumentProviderFactory");var h=s(94072);var d=s(3260);var u=s(11038);var f=s(23205);var p=s(24803);var g=s(55852);const m=new Map;class w{constructor(e){this.room=e;this.onmessage=null;g.z((t=>t.key===e&&this.onmessage!==null&&this.onmessage({data:p.Gh(t.newValue||"")})))}postMessage(e){g.X.setItem(this.room,p.s3(p.eh(e)))}}const y=typeof BroadcastChannel==="undefined"?w:BroadcastChannel;const _=e=>f.Yu(m,e,(()=>{const t=new Set;const s=new y(e);s.onmessage=e=>t.forEach((t=>t(e.data)));return{bc:s,subs:t}}));const v=(e,t)=>_(e).subs.add(t);const I=(e,t)=>_(e).subs.delete(t);const k=(e,t)=>{const s=_(e);s.bc.postMessage(t);s.subs.forEach((e=>e(t)))};var b=s(40870);const C=0;const S=1;const L=2;const U=(e,t)=>{d.uE(e,C);const s=u.encodeStateVector(t);d.mP(e,s)};const M=(e,t,s)=>{d.uE(e,S);d.mP(e,u.encodeStateAsUpdate(t,s))};const E=(e,t,s)=>M(t,s,h.HN(e));const q=(e,t,s)=>{try{u.applyUpdate(t,h.HN(e),s)}catch(n){console.error("Caught error while handling a Yjs update",n)}};const A=(e,t)=>{d.uE(e,L);d.mP(e,t)};const R=q;const P=(e,t,s,n)=>{const o=h.yg(e);switch(o){case C:E(e,t,s);break;case S:q(e,s,n);break;case L:R(e,s,n);break;default:throw new Error("Unknown message type")}return o};const H=0;const D=(e,t)=>{encoding.writeVarUint(e,H);encoding.writeVarString(e,t)};const x=(e,t,s)=>{switch(h.yg(e)){case H:s(t,h.kf(e))}};var T=s(6493);const V=()=>{let e=true;return(t,s)=>{if(e){e=false;try{t()}finally{e=true}}else if(s!==undefined){s()}}};var G=s(75736);var B=s(21332);var W=s(69600);const N=e=>{const t={};const s=e.split("?");const n=s[s.length-1].split("&");for(var o=0;o<n.length;o++){const e=n[o];if(e.length>0){const s=e.split("=");t[decodeURIComponent(s[0])]=decodeURIComponent(s[1]||"")}}return t};const z=e=>W.UI(e,((e,t)=>`${encodeURIComponent(t)}=${encodeURIComponent(e)}`)).join("&");const Z=0;const j=3;const J=1;const O=2;const K=[];K[Z]=(e,t,s,n,o)=>{d.uE(e,Z);const c=P(t,e,s.doc,s);if(n&&c===S&&!s.synced){s.synced=true}};K[j]=(e,t,s,n,o)=>{d.uE(e,J);d.mP(e,T.xq(s.awareness,Array.from(s.awareness.getStates().keys())))};K[J]=(e,t,s,n,o)=>{T.oy(s.awareness,h.HN(t),s)};K[O]=(e,t,s,n,o)=>{x(t,s.doc,X)};const F=1200;const $=2500;const Y=3e4;const X=(e,t)=>console.warn(`Permission denied to access ${e.url}.\n${t}`);const Q=(e,t,s)=>{const n=h.l1(t);const o=d.Mf();const c=h.yg(n);const i=e.messageHandlers[c];if(i){i(o,n,e,s,c)}else{console.error("Unable to compute message")}return o};const ee=e=>{if(e.shouldConnect&&e.ws===null){const t=new e._WS(e.url);t.binaryType="arraybuffer";e.ws=t;e.wsconnecting=true;e.wsconnected=false;e.synced=false;t.onmessage=s=>{e.wsLastMessageReceived=b.ZG();const n=Q(e,new Uint8Array(s.data),true);if(d.kE(n)>1){t.send(d._f(n))}};t.onclose=()=>{e.ws=null;e.wsconnecting=false;if(e.wsconnected){e.wsconnected=false;e.synced=false;T.Ag(e.awareness,Array.from(e.awareness.getStates().keys()).filter((t=>t!==e.doc.clientID)),e);e.emit("status",[{status:"disconnected"}])}else{e.wsUnsuccessfulReconnects++}setTimeout(ee,B.VV(B.mv(e.wsUnsuccessfulReconnects+1)*F,$),e)};t.onopen=()=>{e.wsLastMessageReceived=b.ZG();e.wsconnecting=false;e.wsconnected=true;e.wsUnsuccessfulReconnects=0;e.emit("status",[{status:"connected"}]);const s=d.Mf();d.uE(s,Z);U(s,e.doc);t.send(d._f(s));const n=d.Mf();d.uE(n,j);t.send(d._f(n));if(e.awareness.getLocalState()!==null){const s=d.Mf();d.uE(s,J);d.mP(s,T.xq(e.awareness,[e.doc.clientID]));t.send(d._f(s))}};e.emit("status",[{status:"connecting"}])}};const te=(e,t)=>{if(e.wsconnected){e.ws.send(t)}if(e.bcconnected){e.mux((()=>{k(e.bcChannel,t)}))}};class se extends G.y{constructor(e,t,s,{connect:n=true,awareness:o=new T.GL(s),params:c={},WebSocketPolyfill:i=WebSocket,resyncInterval:a=-1}={}){super();while(e[e.length-1]==="/"){e=e.slice(0,e.length-1)}const r=z(c);this.bcChannel=e+"/"+t;this.url=e+"/"+t+(r.length===0?"":"?"+r);this.roomname=t;this.doc=s;this._WS=i;this.awareness=o;this.wsconnected=false;this.wsconnecting=false;this.bcconnected=false;this.wsUnsuccessfulReconnects=0;this.messageHandlers=K.slice();this.mux=V();this._synced=false;this.ws=null;this.wsLastMessageReceived=0;this.shouldConnect=n;this._resyncInterval=0;if(a>0){this._resyncInterval=setInterval((()=>{if(this.ws){const e=d.Mf();d.uE(e,Z);U(e,s);this.ws.send(d._f(e))}}),a)}this._bcSubscriber=e=>{this.mux((()=>{const t=Q(this,new Uint8Array(e),false);if(d.kE(t)>1){k(this.bcChannel,d._f(t))}}))};this._updateHandler=(e,t)=>{if(t!==this){const t=d.Mf();d.uE(t,Z);A(t,e);te(this,d._f(t))}};this.doc.on("update",this._updateHandler);this._awarenessUpdateHandler=({added:e,updated:t,removed:s},n)=>{const c=e.concat(t).concat(s);const i=d.Mf();d.uE(i,J);d.mP(i,T.xq(o,c));te(this,d._f(i))};if(typeof window!=="undefined"){window.addEventListener("beforeunload",(()=>{T.Ag(this.awareness,[s.clientID],"window unload")}))}o.on("update",this._awarenessUpdateHandler);this._checkInterval=setInterval((()=>{if(this.wsconnected&&Y<b.ZG()-this.wsLastMessageReceived){this.ws.close()}}),Y/10);if(n){this.connect()}}get synced(){return this._synced}set synced(e){if(this._synced!==e){this._synced=e;this.emit("synced",[e]);this.emit("sync",[e])}}destroy(){if(this._resyncInterval!==0){clearInterval(this._resyncInterval)}clearInterval(this._checkInterval);this.disconnect();this.awareness.off("update",this._awarenessUpdateHandler);this.doc.off("update",this._updateHandler);super.destroy()}connectBc(){if(!this.bcconnected){v(this.bcChannel,this._bcSubscriber);this.bcconnected=true}this.mux((()=>{const e=d.Mf();d.uE(e,Z);U(e,this.doc);k(this.bcChannel,d._f(e));const t=d.Mf();d.uE(t,Z);M(t,this.doc);k(this.bcChannel,d._f(t));const s=d.Mf();d.uE(s,j);k(this.bcChannel,d._f(s));const n=d.Mf();d.uE(n,J);d.mP(n,T.xq(this.awareness,[this.doc.clientID]));k(this.bcChannel,d._f(n))}))}disconnectBc(){const e=d.Mf();d.uE(e,J);d.mP(e,T.xq(this.awareness,[this.doc.clientID],new Map));te(this,d._f(e));if(this.bcconnected){I(this.bcChannel,this._bcSubscriber);this.bcconnected=false}}disconnect(){this.shouldConnect=false;this.disconnectBc();if(this.ws!==null){this.ws.close()}}connect(){this.shouldConnect=true;if(!this.wsconnected&&this.ws===null){ee(this);this.connectBc()}}}class ne extends se{constructor(e){var t,s,n;super(e.url,e.contentType+":"+e.path,e.ymodel.ydoc,{awareness:e.ymodel.awareness});this._currentLockRequest=null;this._initialContentRequest=null;this._path=e.path;this._contentType=e.contentType;this._serverUrl=e.url;const c=new URL(window.location.href).searchParams;const a=(t="#"+c.get("usercolor"))!==null&&t!==void 0?t:i().slice(1);const r=(s=c.get("username"))!==null&&s!==void 0?s:o();const l=e.ymodel.awareness;const d=l.getLocalState();if(d&&((n=d.user)===null||n===void 0?void 0:n.name)==null){e.ymodel.awareness.setLocalStateField("user",{name:r,color:a})}this.messageHandlers[127]=(e,t,s,n,o)=>{const c=h.Jl(t);const i=this._currentLockRequest;this._currentLockRequest=null;if(i){i.resolve(c)}};this.messageHandlers[125]=(e,t,s,n,o)=>{const c=h.iU(t);if(c.byteLength>0){u.applyUpdate(this.doc,c)}const i=this._initialContentRequest;this._initialContentRequest=null;if(i){i.resolve(c.byteLength>0)}};this._isInitialized=false;this._onConnectionStatus=this._onConnectionStatus.bind(this);this.on("status",this._onConnectionStatus)}setPath(e){if(e!==this._path){this._path=e;const t=d.Mf();d.cW(t,123);const s=unescape(encodeURIComponent(this._contentType+":"+e));for(let e=0;e<s.length;e++){d.cW(t,s.codePointAt(e))}this._sendMessage(d._f(t));this.disconnectBc();this.bcChannel=this._serverUrl+"/"+this._contentType+":"+this._path;this.url=this.bcChannel;this.connectBc()}}requestInitialContent(){if(this._initialContentRequest){return this._initialContentRequest.promise}this._initialContentRequest=new r.PromiseDelegate;this._sendMessage(new Uint8Array([125]));setTimeout((()=>{var e;return(e=this._initialContentRequest)===null||e===void 0?void 0:e.resolve(false)}),1e3);return this._initialContentRequest.promise}putInitializedState(){const e=d.Mf();d.uE(e,124);d.HK(e,u.encodeStateAsUpdate(this.doc));this._sendMessage(d._f(e));this._isInitialized=true}acquireLock(){if(this._currentLockRequest){return this._currentLockRequest.promise}this._sendMessage(new Uint8Array([127]));if(this._requestLockInterval){clearInterval(this._requestLockInterval)}this._requestLockInterval=setInterval((()=>{if(this.wsconnected){this._sendMessage(new Uint8Array([127]))}}),500);let e,t;const s=new Promise(((s,n)=>{e=s;t=n}));this._currentLockRequest={promise:s,resolve:e,reject:t};return s}releaseLock(e){const t=d.Mf();d.uE(t,126);d.Ep(t,e);this._sendMessage(d._f(t));if(this._requestLockInterval){clearInterval(this._requestLockInterval)}}_sendMessage(e){const t=()=>{setTimeout((()=>{if(this.wsconnected){this.ws.send(e)}else{this.once("status",t)}}),0)};t()}async _onConnectionStatus(e){if(this._isInitialized&&e.status==="connected"){const e=await this.acquireLock();const t=await this.requestInitialContent();if(!t){this.putInitializedState()}this.releaseLock(e)}}}}}]);
//# sourceMappingURL=1072.34043cc42f0bb5c78e02.js.map?v=34043cc42f0bb5c78e02