"use strict";(self["webpackChunk_jupyterlab_application_top"]=self["webpackChunk_jupyterlab_application_top"]||[]).push([[6462,9602],{36462:(e,t,o)=>{o.r(t);o.d(t,{CellBarExtension:()=>_,CellToolbarTracker:()=>h});var l=o(87447);var n=o(54999);var i=o(27425);var a=o(10535);var s=o(19289);const r=["text/plain","application/vnd.jupyter.stdout","application/vnd.jupyter.stderr"];const d="jp-cell-toolbar";const c="jp-cell-menu";const u="jp-toolbar-overlap";class h{constructor(e,t,o){this._isDisposed=false;this._toolbar=null;this._toolbarItems=null;this._toolbarFactory=null;this._panel=e;this._previousActiveCell=this._panel.content.activeCell;this._toolbarItems=t!==null&&t!==void 0?t:null;this._toolbarFactory=o!==null&&o!==void 0?o:null;if(this._toolbarItems===null&&this._toolbarFactory===null){throw Error("You must provide the toolbarFactory or the toolbar items.")}if(!this._toolbarFactory&&this._toolbarItems){this._onToolbarChanged();this._toolbarItems.changed.connect(this._onToolbarChanged,this)}void e.revealed.then((()=>{requestAnimationFrame((()=>{const t=e.content;this._onActiveCellChanged(t);t.activeCellChanged.connect(this._onActiveCellChanged,this);t.renderingLayoutChanged.connect(this._onActiveCellChanged,this);t.disposed.connect((()=>{t.activeCellChanged.disconnect(this._onActiveCellChanged)}))}))}))}_onMetadataChanged(e,t){if(t.key==="jupyter"){if(typeof t.newValue==="object"&&t.newValue.source_hidden===true&&(t.type==="add"||t.type==="change")){this._removeToolbar(e)}else if(typeof t.oldValue==="object"&&t.oldValue.source_hidden===true){this._addToolbar(e)}}}_onActiveCellChanged(e){if(this._previousActiveCell&&!this._previousActiveCell.isDisposed){this._removeToolbar(this._previousActiveCell.model);this._previousActiveCell.model.metadataChanged.disconnect(this._onMetadataChanged)}const t=e.activeCell;this._previousActiveCell=t;if(t===null||t.inputHidden){return}t.model.metadataChanged.connect(this._onMetadataChanged,this);this._addToolbar(t.model)}get isDisposed(){return this._isDisposed}dispose(){var e,t;if(this.isDisposed){return}this._isDisposed=true;(e=this._toolbarItems)===null||e===void 0?void 0:e.changed.disconnect(this._onToolbarChanged,this);(t=this._toolbar)===null||t===void 0?void 0:t.dispose();this._panel=null;s.Signal.clearData(this)}_addToolbar(e){const t=this._getCell(e);if(t&&!t.isDisposed){const e=this._toolbar=new i.Toolbar;e.addClass(c);e.addClass(d);const o=[t.ready];if(this._toolbarFactory){(0,l.setToolbar)(t,this._toolbarFactory,e);e.layout.widgets.forEach((e=>{e.update()}))}else{for(const{name:t,widget:l}of this._toolbarItems){e.addItem(t,l);if(l instanceof i.ReactWidget&&l.renderPromise!==undefined){l.update();o.push(l.renderPromise)}}}Promise.all(o).then((()=>{var o;if(t.isDisposed||((o=this._panel)===null||o===void 0?void 0:o.content.activeCell)!==t){e.dispose();return}t.layout.insertWidget(0,e);t.displayChanged.connect(this._resizeEventCallback,this);t.model.contentChanged.connect(this._changedEventCallback,this);this._updateCellForToolbarOverlap(t)})).catch((e=>{console.error("Error rendering buttons of the cell toolbar: ",e)}))}}_getCell(e){var t;return(t=this._panel)===null||t===void 0?void 0:t.content.widgets.find((t=>t.model===e))}_removeToolbar(e){var t,o;const l=this._getCell(e);if(l&&!l.isDisposed){l.displayChanged.disconnect(this._resizeEventCallback,this)}e.contentChanged.disconnect(this._changedEventCallback,this);if(((t=this._toolbar)===null||t===void 0?void 0:t.parent)===l&&((o=this._toolbar)===null||o===void 0?void 0:o.isDisposed)===false){this._toolbar.dispose()}}_onToolbarChanged(){var e;const t=(e=this._panel)===null||e===void 0?void 0:e.content.activeCell;if(t){this._removeToolbar(t.model);this._addToolbar(t.model)}}_changedEventCallback(){var e;const t=(e=this._panel)===null||e===void 0?void 0:e.content.activeCell;if(t===null||t===undefined){return}this._updateCellForToolbarOverlap(t)}_resizeEventCallback(){var e;const t=(e=this._panel)===null||e===void 0?void 0:e.content.activeCell;if(t===null||t===undefined){return}this._updateCellForToolbarOverlap(t)}_updateCellForToolbarOverlap(e){requestAnimationFrame((()=>{const t=e.node;t.classList.remove(u);if(this._cellToolbarOverlapsContents(e)){t.classList.add(u)}}))}_cellToolbarOverlapsContents(e){var t,o,l,n;const i=e.model.type;const a=(t=e.editorWidget)===null||t===void 0?void 0:t.node.getBoundingClientRect();const s=(o=a===null||a===void 0?void 0:a.left)!==null&&o!==void 0?o:0;const r=(l=a===null||a===void 0?void 0:a.right)!==null&&l!==void 0?l:0;const d=this._cellToolbarLeft(e);if(d===null){return false}if((s+r)/2>d){return true}if(i==="markdown"&&e.rendered){return this._markdownOverlapsToolbar(e)}if(((n=this._panel)===null||n===void 0?void 0:n.content.renderingLayout)==="default"){return this._codeOverlapsToolbar(e)}else{return this._outputOverlapsToolbar(e)}}_markdownOverlapsToolbar(e){const t=e.inputArea;if(!t){return false}const o=t.renderedInput;const l=o.node;const n=l.firstElementChild;if(n===null){return false}const i=n.style.maxWidth;n.style.maxWidth="max-content";const a=n.getBoundingClientRect().right;n.style.maxWidth=i;const s=this._cellToolbarLeft(e);return s===null?false:a>s}_outputOverlapsToolbar(e){const t=e.outputArea.node;if(t){const o=t.querySelectorAll("[data-mime-type]");const l=this._cellToolbarRect(e);if(l){const{left:e,bottom:t}=l;return(0,a.some)(o,(o=>{const l=o.firstElementChild;if(l){const n=new Range;if(r.includes(o.getAttribute("data-mime-type")||"")){n.selectNodeContents(l)}else{n.selectNode(l)}const{right:i,top:a}=n.getBoundingClientRect();return i>e&&a<t}return false}))}}return false}_codeOverlapsToolbar(e){const t=e.editorWidget;const o=e.editor;if(!t||!o){return false}if(o.lineCount<1){return false}const l=t.node.getElementsByClassName("cm-line");if(l.length<1){return false}let n=l[0].getBoundingClientRect().left;const i=document.createRange();i.selectNodeContents(l[0]);n+=i.getBoundingClientRect().width;const a=this._cellToolbarLeft(e);return a===null?false:n>a}_cellToolbarRect(e){var t;if(((t=this._toolbar)===null||t===void 0?void 0:t.parent)!==e){return null}const o=this._toolbar.node;return o.getBoundingClientRect()}_cellToolbarLeft(e){var t;return((t=this._cellToolbarRect(e))===null||t===void 0?void 0:t.left)||null}}const v=[{command:"notebook:duplicate-below",name:"duplicate-cell"},{command:"notebook:move-cell-up",name:"move-cell-up"},{command:"notebook:move-cell-down",name:"move-cell-down"},{command:"notebook:insert-cell-above",name:"insert-cell-above"},{command:"notebook:insert-cell-below",name:"insert-cell-below"},{command:"notebook:delete-cell",name:"delete-cell"}];class _{constructor(e,t){this._commands=e;this._toolbarFactory=t!==null&&t!==void 0?t:this.defaultToolbarFactory}get defaultToolbarFactory(){const e=(0,l.createDefaultFactory)(this._commands);return t=>new n.ObservableList({values:v.map((o=>({name:o.name,widget:e(_.FACTORY_NAME,t,o)})))})}createNew(e){return new h(e,undefined,this._toolbarFactory)}}_.FACTORY_NAME="Cell"}}]);
//# sourceMappingURL=6462.14fc165d2d77b894bbc9.js.map?v=14fc165d2d77b894bbc9