"use strict";(self["webpackChunk_jupyterlab_application_top"]=self["webpackChunk_jupyterlab_application_top"]||[]).push([[1854],{81854:(t,e,s)=>{s.r(e);s.d(e,{OutputArea:()=>k,OutputAreaModel:()=>h,OutputPrompt:()=>A,SimplifiedOutputArea:()=>M,Stdin:()=>E});var i=s(39130);var n=s(54999);var r=s(59238);var a=s(10535);var o=s(55172);var u=s(19289);class h{constructor(t={}){this.clearNext=false;this._lastStream="";this._trusted=false;this._isDisposed=false;this._stateChanged=new u.Signal(this);this._changed=new u.Signal(this);this._trusted=!!t.trusted;this.contentFactory=t.contentFactory||h.defaultContentFactory;this.list=new n.ObservableList;if(t.values){for(const e of t.values){const t=this._add(e)-1;const s=this.list.get(t);s.changed.connect(this._onGenericChange,this)}}this.list.changed.connect(this._onListChanged,this)}get stateChanged(){return this._stateChanged}get changed(){return this._changed}get length(){return this.list?this.list.length:0}get trusted(){return this._trusted}set trusted(t){if(t===this._trusted){return}const e=this._trusted=t;for(let s=0;s<this.list.length;s++){const t=this.list.get(s);const i=t.toJSON();const n=this._createItem({value:i,trusted:e});this.list.set(s,n);t.dispose()}}get isDisposed(){return this._isDisposed}dispose(){if(this.isDisposed){return}this._isDisposed=true;this.list.dispose();u.Signal.clearData(this)}get(t){return this.list.get(t)}set(t,e){e=o.JSONExt.deepCopy(e);d.normalize(e);const s=this._createItem({value:e,trusted:this._trusted});this.list.set(t,s)}add(t){if(this.clearNext){this.clear();this.clearNext=false}return this._add(t)}clear(t=false){this._lastStream="";if(t){this.clearNext=true;return}for(const e of this.list){e.dispose()}this.list.clear()}fromJSON(t){this.clear();for(const e of t){this._add(e)}}toJSON(){return Array.from((0,a.map)(this.list,(t=>t.toJSON())))}_add(t){const e=this._trusted;t=o.JSONExt.deepCopy(t);d.normalize(t);if(i.isStream(t)&&this._lastStream&&t.name===this._lastName&&this.shouldCombine({value:t,lastModel:this.list.get(this.length-1)})){this._lastStream+=t.text;this._lastStream=d.removeOverwrittenChars(this._lastStream);t.text=this._lastStream;const s=this._createItem({value:t,trusted:e});const i=this.length-1;const n=this.list.get(i);this.list.set(i,s);n.dispose();return this.length}if(i.isStream(t)){t.text=d.removeOverwrittenChars(t.text)}const s=this._createItem({value:t,trusted:e});if(i.isStream(t)){this._lastStream=t.text;this._lastName=t.name}else{this._lastStream=""}return this.list.push(s)}shouldCombine(t){return true}_createItem(t){const e=this.contentFactory;const s=e.createOutputModel(t);return s}_onListChanged(t,e){switch(e.type){case"add":e.newValues.forEach((t=>{t.changed.connect(this._onGenericChange,this)}));break;case"remove":e.oldValues.forEach((t=>{t.changed.disconnect(this._onGenericChange,this)}));break;case"set":e.newValues.forEach((t=>{t.changed.connect(this._onGenericChange,this)}));e.oldValues.forEach((t=>{t.changed.disconnect(this._onGenericChange,this)}));break}this._changed.emit(e)}_onGenericChange(t){let e;let s=null;for(e=0;e<this.list.length;e++){s=this.list.get(e);if(s===t){break}}if(s!=null){this._stateChanged.emit(e);this._changed.emit({type:"set",newIndex:e,oldIndex:e,oldValues:[s],newValues:[s]})}}}(function(t){class e{createOutputModel(t){return new r.OutputModel(t)}}t.ContentFactory=e;t.defaultContentFactory=new e})(h||(h={}));var d;(function(t){function e(t){if(i.isStream(t)){if(Array.isArray(t.text)){t.text=t.text.join("\n")}}}t.normalize=e;function s(t){let e=t;do{t=e;e=t.replace(/[^\n]\x08/gm,"")}while(e.length<t.length);return t}function n(t){t=t.replace(/\r+\n/gm,"\n");while(t.search(/\r[^$]/g)>-1){const e=t.match(/^(.*)\r+/m)[1];let s=t.match(/\r+(.*)$/m)[1];s=s+e.slice(s.length,e.length);t=t.replace(/\r+.*$/m,"\r").replace(/^.*\r/m,s)}return t}function r(t){return n(s(t))}t.removeOverwrittenChars=r})(d||(d={}));var l=s(87447);var c=s(4702);var p=s(50724);var m=s(60796);var _=s(65178);const g="jp-OutputArea";const f="jp-OutputArea-child";const y="jp-OutputArea-output";const v="jp-OutputArea-prompt";const x="jp-OutputArea-stdin-hiding";const w="jp-OutputPrompt";const O="jp-OutputArea-executeResult";const C="jp-OutputArea-stdin-item";const I="jp-Stdin";const b="jp-Stdin-prompt";const S="jp-Stdin-input";const N="jp-OutputArea-promptOverlay";class k extends _.Widget{constructor(t){var e,s,i,n;super();this.outputLengthChanged=new u.Signal(this);this._onIOPub=t=>{const e=this.model;const s=t.header.msg_type;let i;const n=t.content.transient||{};const r=n["display_id"];let a;switch(s){case"execute_result":case"display_data":case"stream":case"error":i={...t.content,output_type:s};e.add(i);break;case"clear_output":{const s=t.content.wait;e.clear(s);break}case"update_display_data":i={...t.content,output_type:"display_data"};a=this._displayIdMap.get(r);if(a){for(const t of a){e.set(t,i)}}break;default:break}if(r&&s==="display_data"){a=this._displayIdMap.get(r)||[];a.push(e.length-1);this._displayIdMap.set(r,a)}};this._onExecuteReply=t=>{const e=this.model;const s=t.content;if(s.status!=="ok"){return}const i=s&&s.payload;if(!i||!i.length){return}const n=i.filter((t=>t.source==="page"));if(!n.length){return}const r=JSON.parse(JSON.stringify(n[0]));const a={output_type:"display_data",data:r.data,metadata:{}};e.add(a)};this._displayIdMap=new Map;this._minHeightTimeout=null;this._inputRequested=new u.Signal(this);this._toggleScrolling=new u.Signal(this);this._initialize=new u.Signal(this);this._outputTracker=new l.WidgetTracker({namespace:o.UUID.uuid4()});this._inputHistoryScope="global";super.layout=new _.PanelLayout;this.addClass(g);this.contentFactory=(e=t.contentFactory)!==null&&e!==void 0?e:k.defaultContentFactory;this.rendermime=t.rendermime;this._maxNumberOutputs=(s=t.maxNumberOutputs)!==null&&s!==void 0?s:Infinity;this._translator=(i=t.translator)!==null&&i!==void 0?i:p.nullTranslator;this._inputHistoryScope=(n=t.inputHistoryScope)!==null&&n!==void 0?n:"global";const r=this.model=t.model;for(let a=0;a<Math.min(r.length,this._maxNumberOutputs+1);a++){const t=r.get(a);this._insertOutput(a,t)}r.changed.connect(this.onModelChanged,this);r.stateChanged.connect(this.onStateChanged,this);if(t.promptOverlay){this._addPromptOverlay()}}get layout(){return super.layout}get widgets(){return this.layout.widgets}get future(){return this._future}set future(t){if(this.model.isDisposed){throw Error("Model is disposed")}if(this._future===t){return}if(this._future){this._future.dispose()}this._future=t;this.model.clear();if(this.widgets.length){this._clear();this.outputLengthChanged.emit(Math.min(this.model.length,this._maxNumberOutputs))}t.onIOPub=this._onIOPub;t.onReply=this._onExecuteReply;t.onStdin=e=>{if(c.KernelMessage.isInputRequestMsg(e)){this.onInputRequest(e,t)}}}get inputRequested(){return this._inputRequested}get maxNumberOutputs(){return this._maxNumberOutputs}set maxNumberOutputs(t){if(t<=0){console.warn(`OutputArea.maxNumberOutputs must be strictly positive.`);return}const e=this._maxNumberOutputs;this._maxNumberOutputs=t;if(e<t){this._showTrimmedOutputs(e)}}dispose(){if(this._future){this._future.dispose();this._future=null}this._displayIdMap.clear();this._outputTracker.dispose();super.dispose()}onModelChanged(t,e){switch(e.type){case"add":this._insertOutput(e.newIndex,e.newValues[0]);break;case"remove":if(this.widgets.length){if(this.model.length===0){this._clear()}else{const t=e.oldIndex;for(let s=0;s<e.oldValues.length&&t<this.widgets.length;++s){const e=this.widgets[t];e.parent=null;e.dispose()}this._moveDisplayIdIndices(t,e.oldValues.length);this._preventHeightChangeJitter()}}break;case"set":this._setOutput(e.newIndex,e.newValues[0]);break;default:break}this.outputLengthChanged.emit(Math.min(this.model.length,this._maxNumberOutputs))}get toggleScrolling(){return this._toggleScrolling}get initialize(){return this._initialize}_addPromptOverlay(){const t=document.createElement("div");t.className=N;t.addEventListener("click",(()=>{this._toggleScrolling.emit()}));this.node.appendChild(t);requestAnimationFrame((()=>{this._initialize.emit()}))}_moveDisplayIdIndices(t,e){this._displayIdMap.forEach((s=>{const i=t+e;const n=s.length;for(let r=n-1;r>=0;--r){const n=s[r];if(n>=t&&n<i){s.splice(r,1)}else if(n>=i){s[r]-=e}}}))}onStateChanged(t,e){const s=Math.min(this.model.length,this._maxNumberOutputs);if(e){if(e>=this._maxNumberOutputs){return}this._setOutput(e,this.model.get(e))}else{for(let t=0;t<s;t++){this._setOutput(t,this.model.get(t))}}this.outputLengthChanged.emit(s)}_clear(){if(!this.widgets.length){return}const t=this.widgets.length;for(let e=0;e<t;e++){const t=this.widgets[0];t.parent=null;t.dispose()}this._displayIdMap.clear();this._preventHeightChangeJitter()}_preventHeightChangeJitter(){const t=this.node.getBoundingClientRect();this.node.style.minHeight=`${t.height}px`;if(this._minHeightTimeout){window.clearTimeout(this._minHeightTimeout)}this._minHeightTimeout=window.setTimeout((()=>{if(this.isDisposed){return}this.node.style.minHeight=""}),50)}onInputRequest(t,e){const s=this.contentFactory;const i=t.content.prompt;const n=t.content.password;const r=new _.Panel;r.addClass(f);r.addClass(C);const a=s.createOutputPrompt();a.addClass(v);r.addWidget(a);const o=s.createStdin({parent_header:t.header,prompt:i,password:n,future:e,translator:this._translator,inputHistoryScope:this._inputHistoryScope});o.addClass(y);r.addWidget(o);if(this.model.length>=this.maxNumberOutputs){this.maxNumberOutputs=this.model.length}this._inputRequested.emit(o);const u=o.node.getElementsByTagName("input")[0];void o.value.then((t=>{if(this.model.length>=this.maxNumberOutputs){this.maxNumberOutputs=this.model.length+1}r.addClass(x);this.model.add({output_type:"stream",name:"stdin",text:t+"\n"});u.focus();window.setTimeout((()=>{const t=document.activeElement;r.dispose();if(t&&t instanceof HTMLElement){t.focus()}}),500)}));this.layout.addWidget(r)}_setOutput(t,e){if(t>=this._maxNumberOutputs){return}const s=this.layout.widgets[t];const i=s.widgets?s.widgets.filter((t=>"renderModel"in t)).pop():s;const n=this.rendermime.preferredMimeType(e.data,e.trusted?"any":"ensure");if(T.currentPreferredMimetype.get(i)===n&&k.isIsolated(n,e.metadata)===i instanceof T.IsolatedRenderer){void i.renderModel(e)}else{this.layout.widgets[t].dispose();this._insertOutput(t,e)}}_insertOutput(t,e){if(t>this._maxNumberOutputs){return}const s=this.layout;if(t===this._maxNumberOutputs){const e=new T.TrimmedOutputs(this._maxNumberOutputs,(()=>{const t=this._maxNumberOutputs;this._maxNumberOutputs=Infinity;this._showTrimmedOutputs(t)}));s.insertWidget(t,this._wrappedOutput(e))}else{let i=this.createOutputItem(e);if(i){i.toggleClass(O,e.executionCount!==null)}else{i=new _.Widget}if(!this._outputTracker.has(i)){void this._outputTracker.add(i)}s.insertWidget(t,i)}}get outputTracker(){return this._outputTracker}_showTrimmedOutputs(t){this.widgets[t].dispose();for(let e=t;e<this.model.length;e++){this._insertOutput(e,this.model.get(e))}this.outputLengthChanged.emit(Math.min(this.model.length,this._maxNumberOutputs))}createOutputItem(t){const e=this.createRenderedMimetype(t);if(!e){return null}return this._wrappedOutput(e,t.executionCount)}createRenderedMimetype(t){const e=this.rendermime.preferredMimeType(t.data,t.trusted?"any":"ensure");if(!e){return null}let s=this.rendermime.createRenderer(e);const i=k.isIsolated(e,t.metadata);if(i===true){s=new T.IsolatedRenderer(s)}T.currentPreferredMimetype.set(s,e);s.renderModel(t).catch((t=>{const e=document.createElement("pre");const i=this._translator.load("jupyterlab");e.textContent=i.__("Javascript Error: %1",t.message);s.node.appendChild(e);s.node.className="lm-Widget jp-RenderedText";s.node.setAttribute("data-mime-type","application/vnd.jupyter.stderr")}));return s}_wrappedOutput(t,e=null){const s=new T.OutputPanel;s.addClass(f);const i=this.contentFactory.createOutputPrompt();i.executionCount=e;i.addClass(v);s.addWidget(i);t.addClass(y);s.addWidget(t);return s}}class M extends k{onInputRequest(t,e){return}createOutputItem(t){const e=this.createRenderedMimetype(t);if(!e){return null}const s=new T.OutputPanel;s.addClass(f);e.addClass(y);s.addWidget(e);return s}}(function(t){async function e(t,e,s,i){var n;let r=true;if(i&&Array.isArray(i.tags)&&i.tags.indexOf("raises-exception")!==-1){r=false}const a={code:t,stop_on_error:r};const o=(n=s.session)===null||n===void 0?void 0:n.kernel;if(!o){throw new Error("Session has no kernel.")}const u=o.requestExecute(a,false,i);e.future=u;return u.done}t.execute=e;function s(t,e){const s=e[t];if(s&&s["isolated"]!==undefined){return!!s["isolated"]}else{return!!e["isolated"]}}t.isIsolated=s;class i{createOutputPrompt(){return new A}createStdin(t){return new E(t)}}t.ContentFactory=i;t.defaultContentFactory=new i})(k||(k={}));class A extends _.Widget{constructor(){super();this._executionCount=null;this.addClass(w)}get executionCount(){return this._executionCount}set executionCount(t){this._executionCount=t;if(t===null){this.node.textContent=""}else{this.node.textContent=`[${t}]:`}}}class E extends _.Widget{static _historyIx(t,e){const s=E._history.get(t);if(!s){return undefined}const i=s.length;if(e<=0){return i+e}}static _historyAt(t,e){const s=E._history.get(t);if(!s){return undefined}const i=s.length;const n=E._historyIx(t,e);if(n!==undefined&&n<i){return s[n]}}static _historyPush(t,e){const s=E._history.get(t);s.push(e);if(s.length>1e3){s.shift()}}static _historySearch(t,e,s,i=true){const n=E._history.get(t);const r=n.length;const a=E._historyIx(t,s);const o=t=>t.search(e)!==-1;if(a===undefined){return}if(i){if(a===0){return}const t=n.slice(0,a).findLastIndex(o);if(t!==-1){return t-r}}else{if(a>=r-1){return}const t=n.slice(a+1).findIndex(o);if(t!==-1){return t-r+a+1}}}constructor(t){var e;super({node:T.createInputWidgetNode(t.prompt,t.password)});this._promise=new o.PromiseDelegate;this._resolved=false;this.addClass(I);this._future=t.future;this._historyIndex=0;this._historyKey=t.inputHistoryScope==="session"?t.parent_header.session:"";this._historyPat="";this._parentHeader=t.parent_header;this._password=t.password;this._trans=((e=t.translator)!==null&&e!==void 0?e:p.nullTranslator).load("jupyterlab");this._value=t.prompt+" ";this._input=this.node.getElementsByTagName("input")[0];this._input.placeholder=this._trans.__("↑↓ for history. Search history with c-↑/c-↓");if(!E._history.has(this._historyKey)){E._history.set(this._historyKey,[])}}get value(){return this._promise.promise.then((()=>this._value))}handleEvent(t){if(this._resolved){t.preventDefault();return}const e=this._input;if(t.type==="keydown"){if(t.key==="Enter"){this.resetSearch();this._future.sendInputReply({status:"ok",value:e.value},this._parentHeader);if(this._password){this._value+="········"}else{this._value+=e.value;E._historyPush(this._historyKey,e.value)}this._resolved=true;this._promise.resolve(void 0)}else if(t.key==="Escape"){this.resetSearch();e.blur()}else if(t.ctrlKey&&(t.key==="ArrowUp"||t.key==="ArrowDown")){if(this._historyPat===""){this._historyPat=e.value}const s=t.key==="ArrowUp";const i=E._historySearch(this._historyKey,this._historyPat,this._historyIndex,s);if(i!==undefined){const s=E._historyAt(this._historyKey,i);if(s!==undefined){if(this._historyIndex===0){this._valueCache=e.value}this._setInputValue(s);this._historyIndex=i;t.preventDefault()}}}else if(t.key==="ArrowUp"){this.resetSearch();const s=E._historyAt(this._historyKey,this._historyIndex-1);if(s){if(this._historyIndex===0){this._valueCache=e.value}this._setInputValue(s);--this._historyIndex;t.preventDefault()}}else if(t.key==="ArrowDown"){this.resetSearch();if(this._historyIndex===0){}else if(this._historyIndex===-1){this._setInputValue(this._valueCache);++this._historyIndex}else{const t=E._historyAt(this._historyKey,this._historyIndex+1);if(t){this._setInputValue(t);++this._historyIndex}}}}}resetSearch(){this._historyPat=""}onAfterAttach(t){this._input.addEventListener("keydown",this);this._input.focus()}onBeforeDetach(t){this._input.removeEventListener("keydown",this)}_setInputValue(t){this._input.value=t;this._input.setSelectionRange(t.length,t.length)}}E._history=new Map;var T;(function(t){function e(t,e){const s=document.createElement("div");const i=document.createElement("pre");i.className=b;i.textContent=t;const n=document.createElement("input");n.className=S;if(e){n.type="password"}s.appendChild(i);i.appendChild(n);return s}t.createInputWidgetNode=e;class s extends _.Widget{constructor(t){super({node:document.createElement("iframe")});this.addClass("jp-mod-isolated");this._wrapped=t;const e=this.node;e.frameBorder="0";e.scrolling="auto";e.addEventListener("load",(()=>{e.contentDocument.open();e.contentDocument.write(this._wrapped.node.innerHTML);e.contentDocument.close();const t=e.contentDocument.body;e.style.height=`${t.scrollHeight}px`;e.heightChangeObserver=new ResizeObserver((()=>{e.style.height=`${t.scrollHeight}px`}));e.heightChangeObserver.observe(t)}))}renderModel(t){return this._wrapped.renderModel(t)}}t.IsolatedRenderer=s;t.currentPreferredMimetype=new m.AttachedProperty({name:"preferredMimetype",create:t=>""});class i extends _.Panel{constructor(t){super(t)}_onContext(t){this.node.focus()}onAfterAttach(t){super.onAfterAttach(t);this.node.addEventListener("contextmenu",this._onContext.bind(this))}onBeforeDetach(t){super.onAfterDetach(t);this.node.removeEventListener("contextmenu",this._onContext.bind(this))}}t.OutputPanel=i;class n extends _.Widget{constructor(t,e){const s=document.createElement("div");const i=`The first ${t} are displayed`;const n="Show more outputs";s.insertAdjacentHTML("afterbegin",`<a title=${i}>\n          <pre>${n}</pre>\n        </a>`);super({node:s});this._onClick=e;this.addClass("jp-TrimmedOutputs");this.addClass("jp-RenderedHTMLCommon")}handleEvent(t){if(t.type==="click"){this._onClick(t)}}onAfterAttach(t){super.onAfterAttach(t);this.node.addEventListener("click",this)}onBeforeDetach(t){super.onBeforeDetach(t);this.node.removeEventListener("click",this)}}t.TrimmedOutputs=n})(T||(T={}))}}]);
//# sourceMappingURL=1854.a0f414406a7ddc7080d7.js.map?v=a0f414406a7ddc7080d7