"use strict";(self["webpackChunk_jupyterlab_application_top"]=self["webpackChunk_jupyterlab_application_top"]||[]).push([[8094],{38094:(t,e,s)=>{s.r(e);s.d(e,{default:()=>D});var r=s(68299);var o=s(50724);var i=s(27425);var n=s(22635);var a=s(55172);var l=s(82524);var c=s(76838);var h=s(65178);var u=s(37900);var p=s.n(u);var d=s(10535);var m=s(70601);class S{constructor(){this.commandName="";this.label="";this.keys={};this.source="";this.selector="";this.category="";this.id="";this.numberOfShortcuts=0;this.hasConflict=false}get(t){if(t==="label"){return this.label}else if(t==="selector"){return this.selector}else if(t==="category"){return this.category}else if(t==="source"){return this.source}else{return""}}}class f extends S{constructor(){super();this.takenBy=new y}}class y{constructor(t){if(t){this.takenBy=t;this.takenByKey="";this.takenByLabel=t.category+": "+t.label;this.id=t.commandName+"_"+t.selector}else{this.takenBy=new S;this.takenByKey="";this.takenByLabel="";this.id=""}}}class g extends u.Component{constructor(t){super(t);this.handleUpdate=()=>{let t=this.state.keys;t.push(this.state.currentChain);this.setState({keys:t});this.props.handleUpdate(this.props.shortcut,this.state.keys)};this.handleOverwrite=async()=>{this.props.deleteShortcut(this.state.takenByObject.takenBy,this.state.takenByObject.takenByKey).then(this.handleUpdate())};this.handleReplace=async()=>{let t=this.state.keys;t.push(this.state.currentChain);this.props.toggleInput();await this.props.deleteShortcut(this.props.shortcut,this.props.shortcutId);this.props.handleUpdate(this.props.shortcut,t)};this.parseChaining=(t,e,s,r,o)=>{let i=m.EN_US.keyForKeydownEvent(t.nativeEvent);const n=["Shift","Control","Alt","Meta","Ctrl","Accel"];if(t.key==="Backspace"){s="";e="";r=[];o="";this.setState({value:e,userInput:s,keys:r,currentChain:o})}else if(t.key!=="CapsLock"){const e=s.substr(s.lastIndexOf(" ")+1,s.length).trim();if(n.lastIndexOf(e)===-1&&e!=""){s=s+",";r.push(o);o="";if(t.ctrlKey&&t.key!="Control"){s=(s+" Ctrl").trim();o=(o+" Ctrl").trim()}if(t.metaKey&&t.key!="Meta"){s=(s+" Accel").trim();o=(o+" Accel").trim()}if(t.altKey&&t.key!="Alt"){s=(s+" Alt").trim();o=(o+" Alt").trim()}if(t.shiftKey&&t.key!="Shift"){s=(s+" Shift").trim();o=(o+" Shift").trim()}if(n.lastIndexOf(t.key)===-1){s=(s+" "+i).trim();o=(o+" "+i).trim()}else{if(t.key==="Meta"){s=(s+" Accel").trim();o=(o+" Accel").trim()}else if(t.key==="Control"){s=(s+" Ctrl").trim();o=(o+" Ctrl").trim()}else if(t.key==="Shift"){s=(s+" Shift").trim();o=(o+" Shift").trim()}else if(t.key==="Alt"){s=(s+" Alt").trim();o=(o+" Alt").trim()}else{s=(s+" "+t.key).trim();o=(o+" "+t.key).trim()}}}else{if(t.key==="Control"){s=(s+" Ctrl").trim();o=(o+" Ctrl").trim()}else if(t.key==="Meta"){s=(s+" Accel").trim();o=(o+" Accel").trim()}else if(t.key==="Shift"){s=(s+" Shift").trim();o=(o+" Shift").trim()}else if(t.key==="Alt"){s=(s+" Alt").trim();o=(o+" Alt").trim()}else{s=(s+" "+i).trim();o=(o+" "+i).trim()}}}this.setState({keys:r,currentChain:o});return[s,r,o]};this.checkNonFunctional=t=>{const e=["Ctrl","Alt","Accel","Shift"];const s=this.state.currentChain.split(" ");const r=s[s.length-1];this.setState({isFunctional:!(e.indexOf(r)!==-1)});return e.indexOf(r)!==-1};this.checkShortcutAvailability=(t,e,s)=>{let r=Object.keys(this.props.keyBindingsUsed).indexOf(e.join(" ")+s+"_"+this.props.shortcut.selector)===-1||t==="";let o=new y;if(r){for(let t of e){if(Object.keys(this.props.keyBindingsUsed).indexOf(t+"_"+this.props.shortcut.selector)!==-1&&t!==""){r=false;o=this.props.keyBindingsUsed[t+"_"+this.props.shortcut.selector];break}}if(r&&Object.keys(this.props.keyBindingsUsed).indexOf(s+"_"+this.props.shortcut.selector)!==-1&&s!==""){r=false;o=this.props.keyBindingsUsed[s+"_"+this.props.shortcut.selector]}}else{o=this.props.keyBindingsUsed[e.join(" ")+s+"_"+this.props.shortcut.selector]}if(!r){if(o.takenBy.id===this.props.shortcut.id&&this.props.newOrReplace==="replace"){r=true;o=new y}}this.setState({isAvailable:r});return o};this.handleInput=t=>{t.preventDefault();this.setState({selected:false});const e=this.parseChaining(t,this.state.value,this.state.userInput,this.state.keys,this.state.currentChain);const s=e[0];const r=e[1];const o=e[2];const i=this.props.toSymbols(s);let n=this.checkShortcutAvailability(s,r,o);this.checkConflict(n,r);this.setState({value:i,userInput:s,takenByObject:n,keys:r,currentChain:o},(()=>this.checkNonFunctional(this.state.userInput)))};this.handleBlur=t=>{if(t.relatedTarget===null||t.relatedTarget.id!=="no-blur"&&t.relatedTarget.id!=="overwrite"){this.props.toggleInput();this.setState({value:"",userInput:""});this.props.clearConflicts()}};this.state={value:this.props.placeholder,userInput:"",isAvailable:true,isFunctional:this.props.newOrReplace==="replace",takenByObject:new y,keys:new Array,currentChain:"",selected:true}}checkConflict(t,e){if(t.id!==""&&t.takenBy.id!==this.props.shortcut.id){this.props.sortConflict(this.props.shortcut,t,t.takenByLabel,"")}else{this.props.clearConflicts()}}render(){const t=this.props.translator.load("jupyterlab");let e="jp-Shortcuts-Input";if(!this.state.isAvailable){e+=" jp-mod-unavailable-Input"}return u.createElement("div",{className:this.props.displayInput?this.props.newOrReplace==="new"?"jp-Shortcuts-InputBox jp-Shortcuts-InputBoxNew":"jp-Shortcuts-InputBox":"jp-mod-hidden",onBlur:t=>this.handleBlur(t)},u.createElement("div",{tabIndex:0,id:"no-blur",className:e,onKeyDown:this.handleInput,ref:t=>t&&t.focus()},u.createElement("p",{className:this.state.selected&&this.props.newOrReplace==="replace"?"jp-Shortcuts-InputText jp-mod-selected-InputText":this.state.value===""?"jp-Shortcuts-InputText jp-mod-waiting-InputText":"jp-Shortcuts-InputText"},this.state.value===""?t.__("press keys"):this.state.value)),u.createElement("button",{className:!this.state.isFunctional?"jp-Shortcuts-Submit jp-mod-defunc-Submit":!this.state.isAvailable?"jp-Shortcuts-Submit jp-mod-conflict-Submit":"jp-Shortcuts-Submit",id:"no-blur",disabled:!this.state.isAvailable||!this.state.isFunctional,onClick:()=>{if(this.props.newOrReplace==="new"){this.handleUpdate();this.setState({value:"",keys:[],currentChain:""});this.props.toggleInput()}else{if(this.state.selected){this.props.toggleInput();this.setState({value:"",userInput:""});this.props.clearConflicts()}else{void this.handleReplace()}}}},this.state.isAvailable?u.createElement(i.checkIcon.react,null):u.createElement(i.errorIcon.react,null)),!this.state.isAvailable&&u.createElement("button",{hidden:true,id:"overwrite",onClick:()=>{void this.handleOverwrite();this.props.clearConflicts();this.props.toggleInput()}},t.__("Overwrite")))}}var C;(function(t){t[t["Left"]=0]="Left";t[t["Right"]=1]="Right"})(C||(C={}));function k(t){return{shortcutEditLeft:{commandId:"shortcutui:EditLeft",label:t.__("Edit First"),caption:t.__("Edit existing shortcut")},shortcutEditRight:{commandId:"shortcutui:EditRight",label:t.__("Edit Second"),caption:t.__("Edit existing shortcut")},shortcutEdit:{commandId:"shortcutui:Edit",label:t.__("Edit"),caption:t.__("Edit existing shortcut")},shortcutAddNew:{commandId:"shortcutui:AddNew",label:t.__("Add"),caption:t.__("Add new shortcut")},shortcutAddAnother:{commandId:"shortcutui:AddAnother",label:t.__("Add"),caption:t.__("Add another shortcut")},shortcutReset:{commandId:"shortcutui:Reset",label:t.__("Reset"),caption:t.__("Reset shortcut back to default")}}}class b extends u.Component{constructor(t){super(t);this.toggleInputNew=()=>{this.setState({displayNewInput:!this.state.displayNewInput})};this.toggleInputReplaceLeft=()=>{this.setState({displayReplaceInputLeft:!this.state.displayReplaceInputLeft})};this.toggleInputReplaceRight=()=>{this.setState({displayReplaceInputRight:!this.state.displayReplaceInputRight})};this.addCommandIfNeeded=(t,e)=>{const s=this.props.shortcut.commandName+"_"+this.props.shortcut.selector;if(!this.props.external.hasCommand(t.commandId+s)){this.props.external.addCommand(t.commandId+s,{label:t.label,caption:t.caption,execute:e})}};this.handleRightClick=t=>{this.addCommandIfNeeded(this._commands.shortcutEdit,(()=>this.toggleInputReplaceLeft()));this.addCommandIfNeeded(this._commands.shortcutEditLeft,(()=>this.toggleInputReplaceLeft()));this.addCommandIfNeeded(this._commands.shortcutEditRight,(()=>this.toggleInputReplaceRight()));this.addCommandIfNeeded(this._commands.shortcutAddNew,(()=>this.toggleInputNew()));this.addCommandIfNeeded(this._commands.shortcutAddAnother,(()=>this.toggleInputNew()));this.addCommandIfNeeded(this._commands.shortcutReset,(()=>this.props.resetShortcut(this.props.shortcut)));const e=this.props.shortcut.commandName+"_"+this.props.shortcut.selector;this.setState({numShortcuts:Object.keys(this.props.shortcut.keys).filter((t=>this.props.shortcut.keys[t][0]!=="")).length},(()=>{let s=[];if(this.state.numShortcuts==2){s=s.concat([this._commands.shortcutEditLeft.commandId+e,this._commands.shortcutEditRight.commandId+e])}else if(this.state.numShortcuts==1){s=s.concat([this._commands.shortcutEdit.commandId+e,this._commands.shortcutAddAnother.commandId+e])}else{s=s.concat([this._commands.shortcutAddNew.commandId+e])}if(this.props.shortcut.source==="Custom"){s=s.concat([this._commands.shortcutReset.commandId+e])}this.props.contextMenu(t,s)}))};this.toSymbols=t=>t.split(" ").reduce(((t,e)=>{if(e==="Ctrl"){return(t+" ⌃").trim()}else if(e==="Alt"){return(t+" ⌥").trim()}else if(e==="Shift"){return(t+" ⇧").trim()}else if(e==="Accel"&&c.Platform.IS_MAC){return(t+" ⌘").trim()}else if(e==="Accel"){return(t+" ⌃").trim()}else{return(t+" "+e).trim()}}),"");this._commands=k(t.external.translator.load("jupyterlab"));this.state={displayNewInput:false,displayReplaceInputLeft:false,displayReplaceInputRight:false,numShortcuts:Object.keys(this.props.shortcut.keys).filter((t=>this.props.shortcut.keys[t][0]!=="")).length}}getErrorRow(){const t=this.props.external.translator.load("jupyterlab");return u.createElement("div",{className:"jp-Shortcuts-Row"},u.createElement("div",{className:"jp-Shortcuts-ConflictContainer"},u.createElement("div",{className:"jp-Shortcuts-ErrorMessage"},t.__("Shortcut already in use by %1. Overwrite it?",this.props.shortcut.takenBy.takenByLabel)),u.createElement("div",{className:"jp-Shortcuts-ErrorButton"},u.createElement("button",null,t.__("Cancel")),u.createElement("button",{id:"no-blur",onClick:()=>{var t;(t=document.getElementById("overwrite"))===null||t===void 0?void 0:t.click()}},t.__("Overwrite")))))}getCategoryCell(){return u.createElement("div",{className:"jp-Shortcuts-Cell"},this.props.shortcut.category)}getLabelCell(){return u.createElement("div",{className:"jp-Shortcuts-Cell"},u.createElement("div",{className:"jp-label"},this.props.shortcut.label))}getResetShortCutLink(){const t=this.props.external.translator.load("jupyterlab");return u.createElement("a",{className:"jp-Shortcuts-Reset",onClick:()=>this.props.resetShortcut(this.props.shortcut)},t.__("Reset"))}getSourceCell(){return u.createElement("div",{className:"jp-Shortcuts-Cell"},u.createElement("div",{className:"jp-Shortcuts-SourceCell"},this.props.shortcut.source),this.props.shortcut.source==="Custom"&&this.getResetShortCutLink())}getOptionalSelectorCell(){return this.props.showSelectors?u.createElement("div",{className:"jp-Shortcuts-Cell"},u.createElement("div",{className:"jp-selector"},this.props.shortcut.selector)):null}getClassNameForShortCuts(t){const e=["jp-Shortcuts-ShortcutCell"];switch(t.length){case 1:e.push("jp-Shortcuts-SingleCell");break;case 0:e.push("jp-Shortcuts-EmptyCell");break}return e.join(" ")}getToggleInputReplaceMethod(t){switch(t){case C.Left:return this.toggleInputReplaceLeft;case C.Right:return this.toggleInputReplaceRight}}getDisplayReplaceInput(t){switch(t){case C.Left:return this.state.displayReplaceInputLeft;case C.Right:return this.state.displayReplaceInputRight}}getOrDiplayIfNeeded(t){const e=this.props.external.translator.load("jupyterlab");return u.createElement("div",{className:t.length==2||this.state.displayNewInput?"jp-Shortcuts-OrTwo":"jp-Shortcuts-Or",id:t.length==2?"secondor":this.state.displayReplaceInputLeft?"noor":"or"},e.__("or"))}getShortCutAsInput(t,e){return u.createElement(g,{handleUpdate:this.props.handleUpdate,deleteShortcut:this.props.deleteShortcut,toggleInput:this.getToggleInputReplaceMethod(e),shortcut:this.props.shortcut,shortcutId:t,toSymbols:this.toSymbols,keyBindingsUsed:this.props.keyBindingsUsed,sortConflict:this.props.sortConflict,clearConflicts:this.props.clearConflicts,displayInput:this.getDisplayReplaceInput(e),newOrReplace:"replace",placeholder:this.toSymbols(this.props.shortcut.keys[t].join(", ")),translator:this.props.external.translator})}getShortCutForDisplayOnly(t){return this.props.shortcut.keys[t].map(((e,s)=>u.createElement("div",{className:"jp-Shortcuts-ShortcutKeysContainer",key:s},u.createElement("div",{className:"jp-Shortcuts-ShortcutKeys"},this.toSymbols(e)),s+1<this.props.shortcut.keys[t].length?u.createElement("div",{className:"jp-Shortcuts-Comma"},","):null)))}isLocationBeingEdited(t){return t===C.Left&&this.state.displayReplaceInputLeft||t===C.Right&&this.state.displayReplaceInputRight}getLocationFromIndex(t){return t===0?C.Left:C.Right}getDivForKey(t,e,s){const r=this.getLocationFromIndex(t);return u.createElement("div",{className:"jp-Shortcuts-ShortcutContainer",key:this.props.shortcut.id+"_"+t,onClick:this.getToggleInputReplaceMethod(r)},this.isLocationBeingEdited(r)?this.getShortCutAsInput(e,r):this.getShortCutForDisplayOnly(e),r===C.Left&&this.getOrDiplayIfNeeded(s))}getAddLink(){const t=this.props.external.translator.load("jupyterlab");return u.createElement("a",{className:!this.state.displayNewInput?"jp-Shortcuts-Plus":"",onClick:()=>{this.toggleInputNew(),this.props.clearConflicts()},id:"add-link"},t.__("Add"))}getInputBoxWhenToggled(){return this.state.displayNewInput?u.createElement(g,{handleUpdate:this.props.handleUpdate,deleteShortcut:this.props.deleteShortcut,toggleInput:this.toggleInputNew,shortcut:this.props.shortcut,shortcutId:"",toSymbols:this.toSymbols,keyBindingsUsed:this.props.keyBindingsUsed,sortConflict:this.props.sortConflict,clearConflicts:this.props.clearConflicts,displayInput:this.state.displayNewInput,newOrReplace:"new",placeholder:"",translator:this.props.external.translator}):u.createElement("div",null)}getShortCutsCell(t){return u.createElement("div",{className:"jp-Shortcuts-Cell"},u.createElement("div",{className:this.getClassNameForShortCuts(t)},t.map(((e,s)=>this.getDivForKey(s,e,t))),t.length===1&&!this.state.displayNewInput&&!this.state.displayReplaceInputLeft&&this.getAddLink(),t.length===0&&!this.state.displayNewInput&&this.getAddLink(),this.getInputBoxWhenToggled()))}render(){const t=Object.keys(this.props.shortcut.keys).filter((t=>this.props.shortcut.keys[t][0]!==""));if(this.props.shortcut.id==="error_row"){return this.getErrorRow()}else{return u.createElement("div",{className:"jp-Shortcuts-Row",onContextMenu:t=>{t.persist();this.handleRightClick(t)}},this.getCategoryCell(),this.getLabelCell(),this.getShortCutsCell(t),this.getSourceCell(),this.getOptionalSelectorCell())}}}const I=115;class w extends u.Component{render(){return u.createElement("div",{className:"jp-Shortcuts-ShortcutListContainer",style:{height:`${this.props.height-I}px`},id:"shortcutListContainer"},u.createElement("div",{className:"jp-Shortcuts-ShortcutList"},this.props.shortcuts.map((t=>u.createElement(b,{key:t.commandName+"_"+t.selector,resetShortcut:this.props.resetShortcut,shortcut:t,handleUpdate:this.props.handleUpdate,deleteShortcut:this.props.deleteShortcut,showSelectors:this.props.showSelectors,keyBindingsUsed:this.props.keyBindingsUsed,sortConflict:this.props.sortConflict,clearConflicts:this.props.clearConflicts,contextMenu:this.props.contextMenu,external:this.props.external})))))}}class _ extends u.Component{render(){return u.createElement("div",{className:this.props.title.toLowerCase()===this.props.active?"jp-Shortcuts-Header jp-Shortcuts-CurrentHeader":"jp-Shortcuts-Header",onClick:()=>this.props.updateSort(this.props.title.toLowerCase())},this.props.title,u.createElement(i.caretDownEmptyThinIcon.react,{className:"jp-Shortcuts-SortButton jp-ShortcutTitleItem-sortButton"}))}}var v;(function(t){t.showSelectors="shortcutui:showSelectors";t.resetAll="shortcutui:resetAll"})(v||(v={}));function E(t){return u.createElement("div",{className:"jp-Shortcuts-Symbols"},u.createElement("table",null,u.createElement("tbody",null,u.createElement("tr",null,u.createElement("td",null,u.createElement("kbd",null,"Cmd")),u.createElement("td",null,"⌘"),u.createElement("td",null,u.createElement("kbd",null,"Ctrl")),u.createElement("td",null,"⌃")),u.createElement("tr",null,u.createElement("td",null,u.createElement("kbd",null,"Alt")),u.createElement("td",null,"⌥"),u.createElement("td",null,u.createElement("kbd",null,"Shift")),u.createElement("td",null,"⇧")))))}function j(t){const e=t.translator.load("jupyterlab");return u.createElement("div",{className:"jp-Shortcuts-AdvancedOptions"},u.createElement("a",{className:"jp-Shortcuts-AdvancedOptionsLink",onClick:()=>t.toggleSelectors()},t.showSelectors?e.__("Hide Selectors"):e.__("Show Selectors")),u.createElement("a",{className:"jp-Shortcuts-AdvancedOptionsLink",onClick:()=>t.resetShortcuts()},e.__("Reset All")))}class x extends u.Component{constructor(t){super(t);this.addMenuCommands();this.menu=this.props.external.createMenu();this.menu.addItem({command:v.showSelectors});this.menu.addItem({command:v.resetAll})}addMenuCommands(){const t=this.props.external.translator.load("jupyterlab");if(!this.props.external.hasCommand(v.showSelectors)){this.props.external.addCommand(v.showSelectors,{label:t.__("Toggle Selectors"),caption:t.__("Toggle command selectors"),execute:()=>{this.props.toggleSelectors()}})}if(!this.props.external.hasCommand(v.resetAll)){this.props.external.addCommand(v.resetAll,{label:t.__("Reset All"),caption:t.__("Reset all shortcuts"),execute:()=>{this.props.resetShortcuts()}})}}getShortCutTitleItem(t){return u.createElement("div",{className:"jp-Shortcuts-Cell"},u.createElement(_,{title:t,updateSort:this.props.updateSort,active:this.props.currentSort}))}render(){const t=this.props.external.translator.load("jupyterlab");return u.createElement("div",{className:"jp-Shortcuts-Top"},u.createElement("div",{className:"jp-Shortcuts-TopNav"},u.createElement(E,null),u.createElement(i.InputGroup,{className:"jp-Shortcuts-Search","aria-label":t.__("Search shortcuts"),type:"text",onChange:t=>this.props.updateSearchQuery(t),placeholder:t.__("Search…"),rightIcon:"ui-components:search"}),u.createElement(j,{toggleSelectors:this.props.toggleSelectors,showSelectors:this.props.showSelectors,resetShortcuts:this.props.resetShortcuts,menu:this.menu,translator:this.props.external.translator})),u.createElement("div",{className:"jp-Shortcuts-HeaderRowContainer"},u.createElement("div",{className:"jp-Shortcuts-HeaderRow"},this.getShortCutTitleItem(t.__("Category")),this.getShortCutTitleItem(t.__("Command")),u.createElement("div",{className:"jp-Shortcuts-Cell"},u.createElement("div",{className:"title-div"},t.__("Shortcut"))),this.getShortCutTitleItem(t.__("Source")),this.props.showSelectors&&this.getShortCutTitleItem(t.__("Selectors")))))}}function N(t){return t.replace(/\s+/g,"").toLowerCase()}function R(t,e){const s=t.category.toLowerCase();const r=t["label"].toLowerCase();const o=`${s} ${r}`;let i=Infinity;let n=null;const a=/\b\w/g;while(true){const t=a.exec(o);if(!t){break}const s=d.StringExt.matchSumOfDeltas(o,e,t.index);if(!s){break}if(s&&s.score<=i){i=s.score;n=s.indices}}if(!n||i===Infinity){return null}const l=s.length+1;const c=d.ArrayExt.lowerBound(n,l,((t,e)=>t-e));const h=n.slice(0,c);const u=n.slice(c);for(let p=0,d=u.length;p<d;++p){u[p]-=l}if(h.length===0){return{matchType:0,categoryIndices:null,labelIndices:u,score:i,item:t}}if(u.length===0){return{matchType:1,categoryIndices:h,labelIndices:null,score:i,item:t}}return{matchType:2,categoryIndices:h,labelIndices:u,score:i,item:t}}function A(t,e){e=N(e);let s=[];let r=Object.keys(t);for(let o=0,i=r.length;o<i;++o){let i=t[r[o]];if(!e){s.push({matchType:3,categoryIndices:null,labelIndices:null,score:0,item:i});continue}let n=R(i,e);if(!n){continue}s.push(n)}return s}function L(t,e){const s=e.composite.shortcuts;let r={};s.forEach((e=>{let s=e.command+"_"+e.selector;if(Object.keys(r).indexOf(s)!==-1){let t=r[s].numberOfShortcuts;r[s].keys[t]=e.keys;r[s].numberOfShortcuts++}else{let o=new S;o.commandName=e.command;let i=t.getLabel(e.command);const n=e.command.split(":");if(!i){i=n.length>1?n[1]:"(Command label missing)"}o.label=i;o.category=n[0];o.keys[0]=e.keys;o.selector=e.selector;o.source="Default";o.id=s;o.numberOfShortcuts=1;r[s]=o}}));const o=e.user.shortcuts;o.forEach((t=>{const e=t.command;const s=t.selector;const o=e+"_"+s;if(r[o]){r[o].source="Custom"}}));return r}function O(t){let e={};Object.keys(t).forEach((s=>{Object.keys(t[s].keys).forEach((r=>{const o=new y(t[s]);o.takenByKey=r;e[t[s].keys[r].join(" ")+"_"+t[s].selector]=o}))}));return e}class B extends u.Component{constructor(t){super(t);this.updateSearchQuery=t=>{this.setState({searchQuery:t.target["value"]},(()=>this.setState({filteredShortcutList:this._searchFilterShortcuts(this.state.shortcutList)},(()=>{this.sortShortcuts()}))))};this.resetShortcuts=async()=>{const t=await this.props.external.getAllShortCutSettings();for(const e of Object.keys(t.user)){await this.props.external.removeShortCut(e)}await this._refreshShortcutList()};this.handleUpdate=async(t,e)=>{const s=await this.props.external.getAllShortCutSettings();const r=s.user.shortcuts;const o=[];let i=false;for(let n of r){if(n["command"]===t.commandName&&n["selector"]===t.selector){o.push({command:n["command"],selector:n["selector"],keys:e});i=true}else{o.push(n)}}if(!i){o.push({command:t.commandName,selector:t.selector,keys:e})}await s.set("shortcuts",o);await this._refreshShortcutList()};this.deleteShortcut=async(t,e)=>{await this.handleUpdate(t,[""]);await this._refreshShortcutList()};this.resetShortcut=async t=>{const e=await this.props.external.getAllShortCutSettings();const s=e.user.shortcuts;const r=[];for(let o of s){if(o["command"]!==t.commandName||o["selector"]!==t.selector){r.push(o)}}await e.set("shortcuts",r);await this._refreshShortcutList()};this.toggleSelectors=()=>{this.setState({showSelectors:!this.state.showSelectors})};this.updateSort=t=>{if(t!==this.state.currentSort){this.setState({currentSort:t},this.sortShortcuts)}};this.sortConflict=(t,e)=>{const s=this.state.filteredShortcutList;if(s.filter((t=>t.id==="error_row")).length===0){const r=new f;r.takenBy=e;r.id="error_row";s.splice(s.indexOf(t)+1,0,r);r.hasConflict=true;this.setState({filteredShortcutList:s})}};this.clearConflicts=()=>{const t=this.state.filteredShortcutList.filter((t=>t.id!=="error_row"));t.forEach((t=>{t.hasConflict=false}));this.setState({filteredShortcutList:t})};this.contextMenu=(t,e)=>{t.persist();this.setState({contextMenu:this.props.external.createMenu()},(()=>{t.preventDefault();for(let t of e){this.state.contextMenu.addItem({command:t})}this.state.contextMenu.open(t.clientX,t.clientY)}))};this.state={shortcutList:{},filteredShortcutList:new Array,shortcutsFetched:false,searchQuery:"",showSelectors:false,currentSort:"category",keyBindingsUsed:{},contextMenu:this.props.external.createMenu()}}componentDidMount(){void this._refreshShortcutList()}async _refreshShortcutList(){const t=await this.props.external.getAllShortCutSettings();const e=L(this.props.external,t);this.setState({shortcutList:e,filteredShortcutList:this._searchFilterShortcuts(e),shortcutsFetched:true},(()=>{let t=O(e);this.setState({keyBindingsUsed:t});this.sortShortcuts()}))}_searchFilterShortcuts(t){const e=A(t,this.state.searchQuery).map((t=>t.item));return e}sortShortcuts(){const t=this.state.filteredShortcutList;let e=this.state.currentSort;if(e==="command"){e="label"}if(e!==""){t.sort(((t,s)=>{const r=t.get(e);const o=s.get(e);if(r<o){return-1}else if(r>o){return 1}else{return t["label"]<s["label"]?-1:t["label"]>s["label"]?1:0}}))}this.setState({filteredShortcutList:t})}render(){if(!this.state.shortcutsFetched){return null}return u.createElement("div",{className:"jp-Shortcuts-ShortcutUI",id:"jp-shortcutui"},u.createElement(x,{updateSearchQuery:this.updateSearchQuery,resetShortcuts:this.resetShortcuts,toggleSelectors:this.toggleSelectors,showSelectors:this.state.showSelectors,updateSort:this.updateSort,currentSort:this.state.currentSort,width:this.props.width,external:this.props.external}),u.createElement(w,{shortcuts:this.state.filteredShortcutList,resetShortcut:this.resetShortcut,handleUpdate:this.handleUpdate,deleteShortcut:this.deleteShortcut,showSelectors:this.state.showSelectors,keyBindingsUsed:this.state.keyBindingsUsed,sortConflict:this.sortConflict,clearConflicts:this.clearConflicts,height:this.props.height,contextMenu:this.contextMenu,external:this.props.external}))}}const U=t=>p().createElement(B,{external:t.external,height:1e3,width:1e3});const T="@jupyterlab/shortcuts-extension:shortcuts";function M(t,e,s){const{commands:r}=e;return{translator:s,getAllShortCutSettings:()=>t.load(T,true),removeShortCut:e=>t.remove(T,e),createMenu:()=>new h.Menu({commands:r}),hasCommand:t=>r.hasCommand(t),addCommand:(t,e)=>r.addCommand(t,e),getLabel:t=>r.label(t)}}const F={id:T,description:"Adds the keyboard shortcuts editor.",requires:[r.ISettingRegistry],optional:[o.ITranslator,i.IFormRendererRegistry],activate:async(t,e,s,i)=>{const l=s!==null&&s!==void 0?s:o.nullTranslator;const h=l.load("jupyterlab");const{commands:u}=t;let p;let d;let m={};if(i){const s={fieldRenderer:s=>U({external:M(e,t,l),...s})};i.addRenderer(`${F.id}.shortcuts`,s)}function S(s){const r=t.commands.listCommands().join("\n");if(!d){d=a.JSONExt.deepCopy(s.properties.shortcuts.default)}m={};s.properties.shortcuts.default=Object.keys(e.plugins).map((t=>{const s=e.plugins[t].schema["jupyter.lab.shortcuts"]||[];m[t]=s;return s})).concat([d]).reduce(((t,e)=>{if(c.Platform.IS_MAC){return t.concat(e)}else{return t.concat(e.filter((t=>!t.keys.some((t=>{const{cmd:e}=n.CommandRegistry.parseKeystroke(t);return e})))))}}),[]).sort(((t,e)=>t.command.localeCompare(e.command)));s.properties.shortcuts.description=h.__(`Note: To disable a system default shortcut,\ncopy it to User Preferences and add the\n"disabled" key, for example:\n{\n    "command": "application:activate-next-tab",\n    "keys": [\n        "Ctrl Shift ]"\n    ],\n    "selector": "body",\n    "disabled": true\n}\n\nList of commands followed by keyboard shortcuts:\n%1\n\nList of keyboard shortcuts:`,r)}e.pluginChanged.connect((async(t,s)=>{if(s!==F.id){const t=m[s];const r=e.plugins[s].schema["jupyter.lab.shortcuts"]||[];if(t===undefined||!a.JSONExt.deepEqual(t,r)){p=null;const t=e.plugins[F.id].schema;t.properties.shortcuts.default=d;await e.load(F.id,true)}}}));e.transform(F.id,{compose:t=>{var e,s,o,i;if(!p){p=a.JSONExt.deepCopy(t.schema);S(p)}const n=(o=(s=(e=p.properties)===null||e===void 0?void 0:e.shortcuts)===null||s===void 0?void 0:s.default)!==null&&o!==void 0?o:[];const l={shortcuts:(i=t.data.user.shortcuts)!==null&&i!==void 0?i:[]};const c={shortcuts:r.SettingRegistry.reconcileShortcuts(n,l.shortcuts)};t.data={composite:c,user:l};return t},fetch:t=>{if(!p){p=a.JSONExt.deepCopy(t.schema);S(p)}return{data:t.data,id:t.id,raw:t.raw,schema:p,version:t.version}}});try{p=null;const t=await e.load(F.id);K.loadShortcuts(u,t.composite);t.changed.connect((()=>{K.loadShortcuts(u,t.composite)}))}catch(f){console.error(`Loading ${F.id} failed.`,f)}},autoStart:true};const D=F;var K;(function(t){let e;function s(t,s){var o;const i=(o=s===null||s===void 0?void 0:s.shortcuts)!==null&&o!==void 0?o:[];if(e){e.dispose()}e=i.reduce(((e,s)=>{const o=r(s);if(o){e.add(t.addKeyBinding(o))}return e}),new l.DisposableSet)}t.loadShortcuts=s;function r(t){if(!t||typeof t!=="object"){return undefined}const{isArray:e}=Array;const s="command"in t&&"keys"in t&&"selector"in t&&e(t.keys);return s?t:undefined}})(K||(K={}))}}]);
//# sourceMappingURL=8094.4c25b84cf211c3f6ca27.js.map?v=4c25b84cf211c3f6ca27