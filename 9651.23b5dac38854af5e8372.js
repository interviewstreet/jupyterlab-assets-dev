"use strict";(self["webpackChunk_jupyterlab_application_top"]=self["webpackChunk_jupyterlab_application_top"]||[]).push([[9651],{69651:(e,t,i)=>{i.r(t);i.d(t,{CONTEXT_PROVIDER_ID:()=>L,Completer:()=>M,CompleterModel:()=>g,CompletionHandler:()=>u,CompletionProviderManager:()=>ee,CompletionTriggerKind:()=>a,ContextCompleterProvider:()=>D,HistoryInlineCompletionProvider:()=>re,ICompletionProviderManager:()=>h,IInlineCompleterFactory:()=>d,InlineCompleter:()=>Y,InlineCompletionTriggerKind:()=>c,KERNEL_PROVIDER_ID:()=>A,KernelCompleterProvider:()=>q,ProviderReconciliator:()=>k,completerWidgetIcon:()=>ne,inlineCompleterIcon:()=>se});var s=i(52959);var n=i(78098);var o=i(37917);var r=i(19289);var l=i(55172);var a;(function(e){e[e["Invoked"]=1]="Invoked";e[e["TriggerCharacter"]=2]="TriggerCharacter";e[e["TriggerForIncompleteCompletions"]=3]="TriggerForIncompleteCompletions"})(a||(a={}));var c;(function(e){e[e["Invoke"]=0]="Invoke";e[e["Automatic"]=1]="Automatic"})(c||(c={}));const d=new l.Token("@jupyterlab/completer:IInlineCompleterFactory","A factory of inline completer widgets.");const h=new l.Token("@jupyterlab/completer:ICompletionProviderManager","A service for the completion providers management.");class u{constructor(e){this._fetchingInline=0;this._editor=null;this._enabled=false;this._isDisposed=false;this._autoCompletion=false;this._continuousInline=true;this.completer=e.completer;this.inlineCompleter=e.inlineCompleter;this.completer.selected.connect(this.onCompletionSelected,this);this.completer.visibilityChanged.connect(this.onVisibilityChanged,this);this._reconciliator=e.reconciliator}set reconciliator(e){this._reconciliator=e}get editor(){return this._editor}set editor(e){if(e===this._editor){return}let t=this._editor;if(t&&!t.isDisposed){const e=t.model;t.host.classList.remove(s.COMPLETER_ENABLED_CLASS);t.host.classList.remove(s.COMPLETER_ACTIVE_CLASS);e.selections.changed.disconnect(this.onSelectionsChanged,this);e.sharedModel.changed.disconnect(this.onTextChanged,this)}this.completer.reset();this.completer.editor=e;t=this._editor=e;if(t){const e=t.model;this._enabled=false;e.selections.changed.connect(this.onSelectionsChanged,this);e.sharedModel.changed.connect(this.onTextChanged,this);this.onSelectionsChanged();if(this.inlineCompleter){this.inlineCompleter.editor=t}}}get isDisposed(){return this._isDisposed}set autoCompletion(e){this._autoCompletion=e}get autoCompletion(){return this._autoCompletion}dispose(){if(this.isDisposed){return}this._isDisposed=true;r.Signal.clearData(this)}invokeInline(){const e=this._editor;if(e){this._makeInlineRequest(e.getCursorPosition(),c.Invoke).catch((e=>{console.warn("Inline invoke request bailed",e)}))}}invoke(){o.MessageLoop.sendMessage(this,u.Msg.InvokeRequest)}processMessage(e){switch(e.type){case u.Msg.InvokeRequest.type:this.onInvokeRequest(e);break;default:break}}getState(e,t){return{text:e.model.sharedModel.getSource(),line:t.line,column:t.column}}onCompletionSelected(e,t){const i=e.model;const s=this._editor;if(!s||!i){return}const n=i.createPatch(t);if(!n){return}const{start:o,end:r,value:l}=n;const a=s.getOffsetAt(s.getCursorPosition());s.model.sharedModel.updateSource(o,r,l);if(a<=r&&a>=o){s.setCursorPosition(s.getPositionAt(o+l.length))}}onInvokeRequest(e){if(!this.completer.model){return}if(this.completer.model.original){return}const t=this._editor;if(t){this._makeRequest(t.getCursorPosition(),a.Invoked).catch((e=>{console.warn("Invoke request bailed",e)}))}}onSelectionsChanged(){var e;const t=this.completer.model;const i=this._editor;if(!i){return}const n=(e=this.inlineCompleter)===null||e===void 0?void 0:e.model;if(n){n.handleSelectionChange(i.getSelection())}const o=i.host;if(!t){this._enabled=false;o.classList.remove(s.COMPLETER_ENABLED_CLASS);return}if(t.subsetMatch){return}const r=i.getCursorPosition();const l=i.getLine(r.line);if(!l){this._enabled=false;t.reset(true);o.classList.remove(s.COMPLETER_ENABLED_CLASS);return}const{start:a,end:c}=i.getSelection();if(a.column!==c.column||a.line!==c.line){this._enabled=false;t.reset(true);o.classList.remove(s.COMPLETER_ENABLED_CLASS);return}if(l.slice(0,r.column).match(/^\s*$/)){this._enabled=false;t.reset(true);o.classList.remove(s.COMPLETER_ENABLED_CLASS);return}if(!this._enabled){this._enabled=true;o.classList.add(s.COMPLETER_ENABLED_CLASS)}t.handleCursorChange(this.getState(i,i.getCursorPosition()))}async onTextChanged(e,t){var i;if(!this._enabled){return}const s=this.completer.model;const n=this.editor;if(!n){return}if(s&&this._autoCompletion&&this._reconciliator.shouldShowContinuousHint&&await this._reconciliator.shouldShowContinuousHint(this.completer.isVisible,t)){void this._makeRequest(n.getCursorPosition(),a.TriggerCharacter)}const o=(i=this.inlineCompleter)===null||i===void 0?void 0:i.model;if(o){o.handleTextChange(t);if(this._continuousInline){void this._makeInlineRequest(n.getCursorPosition(),c.Automatic)}}if(s){const{start:e,end:t}=n.getSelection();if(e.column!==t.column||e.line!==t.line){return}s.handleTextChange(this.getState(n,n.getCursorPosition()))}}onVisibilityChanged(e){if(e.isDisposed||e.isHidden){if(this._editor){this._editor.host.classList.remove(s.COMPLETER_ACTIVE_CLASS);this._editor.focus()}return}if(this._editor){this._editor.host.classList.add(s.COMPLETER_ACTIVE_CLASS)}}_makeRequest(e,t){const i=this.editor;if(!i){return Promise.reject(new Error("No active editor"))}const s=this._composeRequest(i,e);const n=this.getState(i,e);return this._reconciliator.fetch(s,t).then((e=>{if(!e){return}const t=this._updateModel(n,e.start,e.end);if(!t){return}if(t.setCompletionItems){t.setCompletionItems(e.items)}})).catch((e=>{}))}async _makeInlineRequest(e,t){const i=this.editor;if(!i){return Promise.reject(new Error("No active editor"))}if(!this.inlineCompleter){return Promise.reject(new Error("No inline completer"))}const s=i.getLine(e.line);if(typeof s==="undefined"||e.column<s.length){return}const n=this._composeRequest(i,e);const o=this.inlineCompleter.model;if(!o){return}o.cursor=e;const r=++this._fetchingInline;const l=this._reconciliator.fetchInline(n,t);const a=new Set;for(const c of l){c.then((e=>{if(!e||!e.items){return}if(r!==this._fetchingInline){return}a.add(c);if(a.size===1){o.setCompletions(e)}else{o.appendCompletions(e)}})).catch((e=>{console.warn(e)})).finally((()=>{a.add(c);const e=l.length-a.size;o.notifyProgress({pendingProviders:e,totalProviders:l.length})}))}}_composeRequest(e,t){const i=e.model.sharedModel.getSource();const s=e.model.mimeType;const o=n.Text.jsIndexToCharIndex(e.getOffsetAt(t),i);return{text:i,offset:o,mimeType:s}}_updateModel(e,t,i){const s=this.completer.model;const o=e.text;if(!s){return null}s.original=e;s.cursor={start:n.Text.charIndexToJsIndex(t,o),end:n.Text.charIndexToJsIndex(i,o)};return s}}(function(e){let t;(function(e){e[e["opened"]=0]="opened";e[e["update"]=1]="update";e[e["closed"]=2]="closed"})(t=e.StraemEvent||(e.StraemEvent={}));let i;(function(e){e.InvokeRequest=new o.Message("invoke-request")})(i=e.Msg||(e.Msg={}))})(u||(u={}));var m=i(10535);function p(e){const t=document.createElement("span");t.textContent=e;return t.innerHTML}class g{constructor(){this.processedItemsCache=null;this._current=null;this._cursor=null;this._isDisposed=false;this._completionItems=[];this._original=null;this._query="";this._subsetMatch=false;this._typeMap={};this._orderedTypes=[];this._stateChanged=new r.Signal(this);this._queryChanged=new r.Signal(this);this._processedToOriginalItem=null;this._resolvingItem=0}get stateChanged(){return this._stateChanged}get queryChanged(){return this._queryChanged}get original(){return this._original}set original(e){const t=this._original===e||this._original&&e&&l.JSONExt.deepEqual(e,this._original);if(t){return}this._reset();this._current=this._original=e;this._stateChanged.emit(undefined)}get current(){return this._current}set current(e){const t=this._current===e||this._current&&e&&l.JSONExt.deepEqual(e,this._current);if(t){return}const i=this._original;if(!i){return}const s=this._cursor;if(!s){return}const n=this._current=e;if(!n){this._stateChanged.emit(undefined);return}const o=i.text.split("\n")[i.line];const r=n.text.split("\n")[n.line];if(!this._subsetMatch&&r.length<o.length){this.reset(true);return}const{start:a,end:c}=s;let d=n.text.substring(a);const h=i.text.substring(c);d=d.substring(0,d.lastIndexOf(h));this._query=d;this.processedItemsCache=null;this._processedToOriginalItem=null;this._queryChanged.emit({newValue:this._query,origin:"editorUpdate"});this._stateChanged.emit(undefined)}get cursor(){return this._cursor}set cursor(e){if(!this.original){return}this._cursor=e}get query(){return this._query}set query(e){this._query=e;this.processedItemsCache=null;this._processedToOriginalItem=null;this._queryChanged.emit({newValue:this._query,origin:"setter"})}get subsetMatch(){return this._subsetMatch}set subsetMatch(e){this._subsetMatch=e}get isDisposed(){return this._isDisposed}dispose(){if(this._isDisposed){return}this._isDisposed=true;r.Signal.clearData(this)}completionItems(){if(!this.processedItemsCache){let e=this._query;if(e){const t=this._markup(e);this.processedItemsCache=t.map((e=>e.processedItem));this._processedToOriginalItem=new WeakMap(t.map((e=>[e.processedItem,e.originalItem])))}else{this.processedItemsCache=this._completionItems.map((e=>this._escapeItemLabel(e)));this._processedToOriginalItem=null}}return this.processedItemsCache}setCompletionItems(e){if(l.JSONExt.deepEqual(e,this._completionItems)){return}this._completionItems=e;this._orderedTypes=_.findOrderedCompletionItemTypes(this._completionItems);this.processedItemsCache=null;this._processedToOriginalItem=null;this._stateChanged.emit(undefined)}typeMap(){return this._typeMap}orderedTypes(){return this._orderedTypes}handleCursorChange(e){if(!this._original){return}const{column:t,line:i}=e;const{current:s,original:n}=this;if(!n){return}if(i!==n.line){this.reset(true);return}if(t<n.column){this.reset(true);return}const{cursor:o}=this;if(!o||!s){return}const r=o.end-o.start;const l=n.text.split("\n")[n.line];const a=s.text.split("\n")[s.line];const c=a.length-l.length;if(t>n.column+r+c){this.reset(true);return}}handleTextChange(e){const t=this._original;if(!t){return}const{text:i,column:s,line:n}=e;const o=i.split("\n")[n][s-1];if(o&&o.match(/\S/)||e.column>=t.column){this.current=e;return}this.reset(false)}createPatch(e){const t=this._original;const i=this._cursor;const s=this._current;if(!t||!i||!s){return undefined}let{start:n,end:o}=i;o=o+(s.text.length-t.text.length);return{start:n,end:o,value:e}}reset(e=false){if(!e&&this._subsetMatch){return}this._reset();this._stateChanged.emit(undefined)}_markup(e){var t;const i=this._completionItems;let s=[];for(const n of i){const i=n.label.indexOf("(");const o=i>-1?n.label.substring(0,i):n.label;const r=m.StringExt.matchSumOfSquares(p(o),e);if(r){let e=m.StringExt.highlight(p(n.label),r.indices,_.mark);const i=Object.assign({},n);i.label=e.join("");i.insertText=(t=n.insertText)!==null&&t!==void 0?t:n.label;s.push({item:i,score:r.score,originalItem:n})}}s.sort(_.scoreCmp);return s.map((e=>({processedItem:e.item,originalItem:e.originalItem})))}resolveItem(e){let t;if(typeof e==="number"){const i=this.completionItems();if(!i||!i[e]){return undefined}t=i[e]}else{t=e}if(!t){return undefined}let i;if(this._processedToOriginalItem){i=this._processedToOriginalItem.get(t)}else{i=t}if(!i){return undefined}return this._resolveItemByValue(i)}_resolveItemByValue(e){const t=++this._resolvingItem;let i;if(e.resolve){let t;if(e.insertText){t=this.createPatch(e.insertText)}i=e.resolve(t)}else{i=Promise.resolve(e)}return i.then((i=>{this._escapeItemLabel(i,true);Object.keys(i).forEach((t=>{e[t]=i[t]}));e.resolve=undefined;if(t!==this._resolvingItem){return Promise.resolve(null)}return i})).catch((t=>{console.error(t);return Promise.resolve(e)}))}_escapeItemLabel(e,t=false){var i;const s=p(e.label);if(s!==e.label){const n=t?e:Object.assign({},e);n.insertText=(i=e.insertText)!==null&&i!==void 0?i:e.label;n.label=s;return n}return e}_reset(){const e=this._query;this._current=null;this._cursor=null;this._completionItems=[];this._original=null;this._query="";this.processedItemsCache=null;this._processedToOriginalItem=null;this._subsetMatch=false;this._typeMap={};this._orderedTypes=[];if(e){this._queryChanged.emit({newValue:this._query,origin:"reset"})}}}var _;(function(e){const t=["function","instance","class","module","keyword"];const i=t.reduce(((e,t)=>{e[t]=null;return e}),{});function s(e){return`<mark>${e}</mark>`}e.mark=s;function n(e,t){var i,s,n;const o=e.score-t.score;if(o!==0){return o}return(n=(i=e.item.insertText)===null||i===void 0?void 0:i.localeCompare((s=t.item.insertText)!==null&&s!==void 0?s:""))!==null&&n!==void 0?n:0}e.scoreCmp=n;function o(e){const i=new Set;e.forEach((e=>{if(e.type&&!t.includes(e.type)&&!i.has(e.type)){i.add(e.type)}}));const s=Array.from(i);s.sort(((e,t)=>e.localeCompare(t)));return t.concat(s)}e.findOrderedCompletionItemTypes=o;function r(e){const s=Object.keys(e).map((t=>e[t])).filter((e=>!!e&&!(e in i))).sort(((e,t)=>e.localeCompare(t)));return t.concat(s)}e.findOrderedTypes=r})(_||(_={}));var f=i(87447);var v=i(59238);var C=i(27425);var y=i(76838);var w=i(65178);const x="jp-Completer-item";const P="jp-mod-active";const I="jp-Completer-list";const S="jp-Completer-docpanel";const b=true;const T=10;class M extends w.Widget{constructor(e){var t,i,s,n;super({node:document.createElement("div")});this._activeIndex=0;this._editor=null;this._model=null;this._selected=new r.Signal(this);this._visibilityChanged=new r.Signal(this);this._indexChanged=new r.Signal(this);this._lastSubsetMatch="";this._geometryLock=false;this._geometryCounter=0;this._docPanelExpanded=false;this._renderCounter=0;this.sanitizer=(t=e.sanitizer)!==null&&t!==void 0?t:new f.Sanitizer;this._defaultRenderer=M.getDefaultRenderer(this.sanitizer);this._renderer=(i=e.renderer)!==null&&i!==void 0?i:this._defaultRenderer;this._docPanel=this._createDocPanelNode();this.model=(s=e.model)!==null&&s!==void 0?s:null;this.editor=(n=e.editor)!==null&&n!==void 0?n:null;this.addClass("jp-Completer");this._updateConstraints()}_updateConstraints(){const e=document.createElement("div");e.classList.add(I);e.style.visibility="hidden";e.style.overflowY="scroll";document.body.appendChild(e);const t=window.getComputedStyle(e);this._maxHeight=parseInt(t.maxHeight,10);this._minHeight=parseInt(t.minHeight,10);this._scrollbarWidth=e.offsetWidth-e.clientWidth;document.body.removeChild(e);const i=this._createDocPanelNode();this._docPanelWidth=E.measureSize(i,"inline-block").width}get activeIndex(){return this._activeIndex}get editor(){return this._editor}set editor(e){this._editor=e}get selected(){return this._selected}get visibilityChanged(){return this._visibilityChanged}get indexChanged(){return this._indexChanged}get model(){return this._model}set model(e){if(!e&&!this._model||e===this._model){return}if(this._model){this._model.stateChanged.disconnect(this.onModelStateChanged,this);this._model.queryChanged.disconnect(this.onModelQueryChanged,this)}this._model=e;if(this._model){this._model.stateChanged.connect(this.onModelStateChanged,this);this._model.queryChanged.connect(this.onModelQueryChanged,this)}}get renderer(){return this._renderer}set renderer(e){this._renderer=e}set showDocsPanel(e){this._showDoc=e}get showDocsPanel(){return this._showDoc}dispose(){this._sizeCache=undefined;this._model=null;super.dispose()}handleEvent(e){if(this.isHidden||!this._editor){return}switch(e.type){case"keydown":this._evtKeydown(e);break;case"pointerdown":this._evtPointerdown(e);break;case"scroll":this._evtScroll(e);break;default:break}}reset(){this._activeIndex=0;this._lastSubsetMatch="";if(this._model){this._model.reset(true)}this._docPanel.style.display="none";this._sizeCache=undefined;this.node.scrollTop=0}selectActive(){const e=this.node.querySelector(`.${P}`);if(!e){this.reset();return}this._selected.emit(e.getAttribute("data-value"));this.reset()}onAfterAttach(e){document.addEventListener("keydown",this,b);document.addEventListener("pointerdown",this,b);document.addEventListener("scroll",this,b)}onBeforeDetach(e){document.removeEventListener("keydown",this,b);document.removeEventListener("pointerdown",this,b);document.removeEventListener("scroll",this,b)}onModelStateChanged(){if(this.isAttached){this._activeIndex=0;this._indexChanged.emit(this._activeIndex);this.update()}}onModelQueryChanged(e,t){if(this._sizeCache&&t.origin==="editorUpdate"){const t=e.completionItems();const i=this._sizeCache.items;const s=i[this._findWidestItemIndex(i)];const n=t[this._findWidestItemIndex(t)];const o=this._getPreferredItemWidthHeuristic();if(t.length!==this._sizeCache.items.length||o(s)!==o(n)){this._sizeCache=undefined}}}onUpdateRequest(e){var t;const i=this._model;if(!i){return}if(!i.query){this._populateSubset()}let s=i.completionItems();if(!s.length){if(!this.isHidden){this.reset();this.hide();this._visibilityChanged.emit(undefined)}return}this._updateConstraints();this._geometryLock=true;const n=this._createCompleterNode(i,s);let o=n.querySelectorAll(`.${x}`)[this._activeIndex];o.classList.add(P);const r=(t=this.model)===null||t===void 0?void 0:t.resolveItem(s[this._activeIndex]);if(this._showDoc){this._docPanel.innerText="";n.appendChild(this._docPanel);this._docPanelExpanded=false;this._docPanel.style.display="none";this._updateDocPanel(r,o)}if(this.isHidden){this.show();this._setGeometry();this._visibilityChanged.emit(undefined)}else{this._setGeometry()}this._geometryLock=false}get sizeCache(){if(!this._sizeCache){return}return{width:this._sizeCache.width+this._sizeCache.docPanelWidth,height:Math.max(this._sizeCache.height,this._sizeCache.docPanelHeight)}}_createDocPanelNode(){const e=document.createElement("div");e.className=S;return e}_createCompleterNode(e,t){const i=++this._renderCounter;let s=this.node;s.textContent="";let n=e.orderedTypes();let o=document.createElement("ul");o.className=I;const r=this._renderer.createCompletionItemNode(t[0],n);const l=[r];const a=E.measureSize(r,"inline-grid");const c=Math.max(Math.ceil(this._maxHeight/a.height),5);const d=Math.min(c+1,t.length);const h=performance.now();for(let g=1;g<d;g++){const e=this._renderer.createCompletionItemNode(t[g],n);l.push(e)}for(const g of l){o.appendChild(g)}const u=this._findWidestItemIndex(t);const m=u<l.length?l[u]:this._renderer.createCompletionItemNode(t[u],n);const p=E.measureSize(m.cloneNode(true),"inline-grid");this._sizeCache={height:Math.min(this._maxHeight,a.height*t.length),width:p.width+this._scrollbarWidth,items:t,docPanelWidth:0,docPanelHeight:0};if(d<t.length){const e=(performance.now()-h)/d;const s=Math.max(5,Math.floor(12/e));let r=d;let c=l[l.length-1];const u=()=>{if(r>=t.length){return}const e=a.height*(t.length-r);c.style.marginBottom=`${e}px`;requestAnimationFrame((()=>{if(i!=this._renderCounter){return}c.style.marginBottom="";const e=Math.min(t.length,r+s);for(let i=r;i<e;i++){const e=this._renderer.createCompletionItemNode(t[i],n);o.appendChild(e);c=e}r=e;u()}))};u()}s.appendChild(o);return s}_findWidestItemIndex(e){const t=this._getPreferredItemWidthHeuristic();const i=e.map(t);return i.indexOf(Math.max(...i))}_getPreferredItemWidthHeuristic(){return this._renderer.itemWidthHeuristic?this._renderer.itemWidthHeuristic.bind(this._renderer):this._defaultRenderer.itemWidthHeuristic.bind(this._defaultRenderer)}_cycle(e){var t,i;const s=this.node.querySelectorAll(`.${x}`);const n=this._activeIndex;const o=s.length-1;let r=this.node.querySelector(`.${P}`);r.classList.remove(P);switch(e){case"up":this._activeIndex=n===0?o:n-1;break;case"down":this._activeIndex=n<o?n+1:0;break;case"pageUp":case"pageDown":{const t=this.node.getBoundingClientRect();const i=r.getBoundingClientRect();const s=Math.floor(t.height/i.height);const l=e==="pageUp"?-1:1;this._activeIndex=Math.min(Math.max(0,n+l*s),o);break}}r=s[this._activeIndex];r.classList.add(P);let l=this.node.querySelector(`.${I}`);y.ElementExt.scrollIntoViewIfNeeded(l,r);this._indexChanged.emit(this._activeIndex);const a=(t=this.model)===null||t===void 0?void 0:t.completionItems();const c=a===null||a===void 0?void 0:a[this._activeIndex];if(c){const e=(i=this.model)===null||i===void 0?void 0:i.resolveItem(c);if(this._showDoc){this._updateDocPanel(e,r)}}}_evtKeydown(e){if(this.isHidden||!this._editor){return}if(!this._editor.host.contains(e.target)){this.reset();return}switch(e.keyCode){case 9:{e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();const t=this._model;if(!t){return}const i=t.completionItems();if(i&&i.length===1){this._selected.emit(i[0].insertText||i[0].label);this.reset();return}const s=this._populateSubset();if(t.query&&t.query!==this._lastSubsetMatch){t.subsetMatch=true;this._selected.emit(t.query);t.subsetMatch=false;this._lastSubsetMatch=t.query}if(s){this.update()}this._cycle(e.shiftKey?"up":"down");return}case 27:e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();this.reset();return;case 33:case 34:case 38:case 40:{e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();const t=E.keyCodeMap[e.keyCode];this._cycle(t);return}default:return}}_evtPointerdown(e){if(this.isHidden||!this._editor){return}if(E.nonstandardClick(e)){this.reset();return}let t=e.target;while(t!==document.documentElement){if(t.classList.contains(x)){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();this._selected.emit(t.getAttribute("data-value"));this.reset();return}if(t===this.node){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();return}t=t.parentElement}this.reset()}_evtScroll(e){if(this.isHidden||!this._editor){return}const{node:t}=this;if(t.contains(e.target)){return}requestAnimationFrame((()=>{this._setGeometry()}))}_populateSubset(){const{model:e}=this;if(!e){return false}const t=e.completionItems();const i=E.commonSubset(t.map((e=>e.insertText||e.label)));const{query:s}=e;if(i&&i!==s&&i.indexOf(s)===0){e.query=i;return true}return false}_setGeometry(){const{node:e}=this;const t=this._model;const i=this._editor;if(!i||!t||!t.original||!t.cursor){return}const s=t.cursor.start;const n=i.getPositionAt(s);const o=i.getCoordinateForPosition(n);const r=window.getComputedStyle(e);const l=parseInt(r.borderLeftWidth,10)||0;const a=parseInt(r.paddingLeft,10)||0;const c=i.host.closest(".jp-MainAreaWidget > .lm-Widget")||i.host;const d=t.completionItems();if(this._sizeCache&&this._sizeCache.items.length!==d.length){this._sizeCache=undefined}C.HoverBox.setGeometry({anchor:o,host:c,maxHeight:this._maxHeight,minHeight:this._minHeight,node:e,size:this.sizeCache,offset:{horizontal:l+a},privilege:"below",style:r,outOfViewDisplay:{top:"stick-inside",bottom:"stick-inside",left:"stick-inside",right:"stick-outside"}});const h=++this._geometryCounter;if(!this._sizeCache){requestAnimationFrame((()=>{if(h!=this._geometryCounter){return}let t=e.getBoundingClientRect();let i=this._docPanel.getBoundingClientRect();this._sizeCache={width:t.width-i.width,height:t.height,items:d,docPanelWidth:i.width,docPanelHeight:i.height}}))}}_updateDocPanel(e,t){var i,s,n;let o=this._docPanel;if(!e){this._toggleDocPanel(false);return}const r=(n=(s=(i=this._renderer).createLoadingDocsIndicator)===null||s===void 0?void 0:s.call(i))!==null&&n!==void 0?n:this._defaultRenderer.createLoadingDocsIndicator();t.appendChild(r);e.then((e=>{var t,i,s;if(!e){return}if(!o){return}if(e.documentation){const n=(s=(i=(t=this._renderer).createDocumentationNode)===null||i===void 0?void 0:i.call(t,e))!==null&&s!==void 0?s:this._defaultRenderer.createDocumentationNode(e);o.textContent="";o.appendChild(n);this._toggleDocPanel(true)}else{this._toggleDocPanel(false)}})).catch((e=>console.error(e))).finally((()=>{t.removeChild(r)}))}_toggleDocPanel(e){let t=this._docPanel;if(e){if(this._docPanelExpanded){return}t.style.display="";this._docPanelExpanded=true}else{if(!this._docPanelExpanded){return}t.style.display="none";this._docPanelExpanded=false}const i=this._sizeCache;if(i){i.docPanelHeight=e?this._maxHeight:0;i.docPanelWidth=e?this._docPanelWidth:0;if(!this._geometryLock){this._setGeometry()}}}}(function(e){class t{constructor(e){this.sanitizer=(e===null||e===void 0?void 0:e.sanitizer)||new f.Sanitizer}createCompletionItemNode(e,t){let i=this._createWrapperNode(e.insertText||e.label);if(e.deprecated){i.classList.add("jp-Completer-deprecated")}return this._constructNode(i,this._createLabelNode(e.label),!!e.type,e.type,t,e.icon)}createDocumentationNode(e){const t=document.createElement("div");t.classList.add("jp-RenderedText");const i=this.sanitizer;const s=e.documentation||"";(0,v.renderText)({host:t,sanitizer:i,source:s}).catch(console.error);return t}itemWidthHeuristic(e){var t;const i=e.label.replace(/<(\/)?mark>/g,"");return i.length+(((t=e.type)===null||t===void 0?void 0:t.length)||0)}createLoadingDocsIndicator(){const e=document.createElement("div");e.classList.add("jp-Completer-loading-bar-container");const t=document.createElement("div");t.classList.add("jp-Completer-loading-bar");e.append(t);return e}_createWrapperNode(e){const t=document.createElement("li");t.className=x;t.setAttribute("data-value",e);return t}_createLabelNode(e){const t=document.createElement("code");t.className="jp-Completer-match";t.innerHTML=e;return t}_constructNode(e,t,i,s,n,o){if(o){const t=o.element({className:"jp-Completer-type jp-Completer-icon"});e.appendChild(t)}else if(i){const t=document.createElement("span");t.textContent=(s[0]||"").toLowerCase();const i=n.indexOf(s)%T+1;t.className="jp-Completer-type jp-Completer-monogram";t.setAttribute(`data-color-index`,i.toString());e.appendChild(t)}else{const t=document.createElement("span");t.className="jp-Completer-monogram";e.appendChild(t)}e.appendChild(t);if(i){e.title=s;const t=document.createElement("code");t.className="jp-Completer-typeExtended";t.textContent=s.toLocaleLowerCase();e.appendChild(t)}else{const t=document.createElement("span");t.className="jp-Completer-typeExtended";e.appendChild(t)}return e}}e.Renderer=t;let i;function s(e){if(!i||e&&i.sanitizer!==e){i=new t({sanitizer:e})}return i}e.getDefaultRenderer=s})(M||(M={}));var E;(function(e){e.keyCodeMap={38:"up",40:"down",33:"pageUp",34:"pageDown"};function t(e){const t=e.length;let i="";if(t<2){return i}const s=e[0].length;for(let n=0;n<s;n++){const s=e[0][n];for(let o=1;o<t;o++){if(e[o][n]!==s){return i}}i+=s}return i}e.commonSubset=t;function i(e){return e.button!==0||e.altKey||e.ctrlKey||e.shiftKey||e.metaKey}e.nonstandardClick=i;function s(e,t){if(e.isConnected){console.warn("Measuring connected elements with `measureSize` has side-effects")}e.style.visibility="hidden";e.style.display=t;document.body.appendChild(e);const i=e.getBoundingClientRect();document.body.removeChild(e);e.removeAttribute("style");return i}e.measureSize=s})(E||(E={}));class k{constructor(e){var t,i;this._resolveFactory=(e,t)=>e.resolve?i=>e.resolve(t,this._context,i):undefined;this._fetching=0;this._inlineFetching=0;this._providers=e.providers;this._inlineProviders=(t=e.inlineProviders)!==null&&t!==void 0?t:[];this._inlineProvidersSettings=(i=e.inlineProvidersSettings)!==null&&i!==void 0?i:{};this._context=e.context;this._timeout=e.timeout}async applicableProviders(){const e=this._providers.map((e=>e.isApplicable(this._context)));const t=await Promise.all(e);return this._providers.filter(((e,i)=>t[i]))}fetchInline(e,t){let i=[];const s=++this._inlineFetching;for(const n of this._inlineProviders){const o=this._inlineProvidersSettings[n.identifier];let l=0;if(t===c.Automatic){l=o.debouncerDelay}const a=()=>{const i=n.fetch(e,{...this._context,triggerKind:t}).then((e=>({...e,items:e.items.map((e=>{const t=e;t.stream=new r.Signal(t);t.provider=n;void this._stream(t,n);return t}))})));const s=new Promise((e=>setTimeout((()=>e(null)),l+o.timeout)));return Promise.race([i,s])};const d=l===0?a():new Promise(((e,t)=>setTimeout((()=>{if(s!=this._inlineFetching){return t(null)}else{return e(a())}}),l)));i.push(d.catch((e=>e)))}return i}async _stream(e,t){if(!e.isIncomplete||!t.stream||!e.token){return}const i=e.stream;const s=e.token;e.token=undefined;e.streaming=true;i.emit(u.StraemEvent.opened);for await(const n of t.stream(s)){const t=n.response;const s=t.insertText.substring(e.insertText.length);e.insertText=t.insertText;e.lastStreamed=s;i.emit(u.StraemEvent.update)}e.isIncomplete=false;e.lastStreamed=undefined;e.streaming=false;i.emit(u.StraemEvent.closed)}async fetch(e,t){const i=++this._fetching;let s=[];const n=await this.applicableProviders();for(const r of n){let n;n=r.fetch(e,this._context,t).then((e=>{if(i!==this._fetching){return Promise.reject(void 0)}const t=e.items.map((e=>({...e,resolve:this._resolveFactory(r,e)})));return{...e,items:t}}));const o=new Promise((e=>setTimeout((()=>e(null)),this._timeout)));n=Promise.race([n,o]);s.push(n.catch((e=>e)))}const o=Promise.all(s);return this._mergeCompletions(o)}async shouldShowContinuousHint(e,t){const i=await this.applicableProviders();if(i.length===0){return false}if(i[0].shouldShowContinuousHint){return i[0].shouldShowContinuousHint(e,t,this._context)}return this._defaultShouldShowContinuousHint(e,t)}_alignPrefixes(e,t,i){if(t!=i){const t=this._context.editor;if(!t){return e}const s=t.getCursorPosition();const n=t.getLine(s.line);if(!n){return e}return e.map((e=>{if(e.start==i){return e}let t=n.substring(e.start,i);return{...e,items:e.items.map((e=>{let i=e.insertText||e.label;e.insertText=i.startsWith(t)?i.slice(t.length):i;return e}))}}))}return e}async _mergeCompletions(e){let t=(await e).filter((e=>{if(!e||e instanceof Error){return false}if(!e.items.length){return false}return true}));if(t.length==0){return null}else if(t.length==1){return t[0]}const i=Math.min(...t.map((e=>e.end)));const s=t.map((e=>e.start));const n=Math.min(...s);const o=Math.max(...s);t=this._alignPrefixes(t,n,o);const r=new Set;const l=new Array;for(const a of t){a.items.forEach((e=>{let t=(e.insertText||e.label).trim();if(r.has(t)){return}r.add(t);l.push(e)}))}return{start:o,end:i,items:l}}_defaultShouldShowContinuousHint(e,t){return!e&&(t.sourceChange==null||t.sourceChange.some((e=>e.insert!=null&&e.insert.length>0)))}}const L="CompletionProvider:context";class D{constructor(){this.identifier=L;this.rank=500;this.renderer=null}async isApplicable(e){return true}fetch(e,t){const i=t.editor;if(!i){return Promise.reject("No editor")}return new Promise((e=>{e(H.contextHint(i))}))}}var H;(function(e){function t(e){const t=e.getTokenAtCursor();const s=i(t,e);const n=s.filter((e=>e.type)).map((e=>e.value));const o=new Set(n);const r=new Array;o.forEach((e=>r.push({label:e})));return{start:t.offset,end:t.offset+t.value.length,items:r}}e.contextHint=t;function i(e,t){const i=t.getTokens();return i.filter((t=>t.value.indexOf(e.value)===0&&t.value!==e.value))}})(H||(H={}));const A="CompletionProvider:kernel";class q{constructor(){this.identifier=A;this.rank=550;this.renderer=null}async isApplicable(e){var t;const i=(t=e.session)===null||t===void 0?void 0:t.kernel;if(!i){return false}return true}async fetch(e,t){var i;const s=(i=t.session)===null||i===void 0?void 0:i.kernel;if(!s){throw new Error("No kernel for completion request.")}const n={code:e.text,cursor_pos:e.offset};const o=await s.requestComplete(n);const r=o.content;if(r.status!=="ok"){throw new Error("Completion fetch failed to return successfully.")}const l=new Array;const a=r.metadata._jupyter_types_experimental;r.matches.forEach(((e,t)=>{if(a&&a[t]){l.push({label:e,type:a[t].type,insertText:a[t].text})}else{l.push({label:e})}}));return{start:r.cursor_start,end:r.cursor_end,items:l}}async resolve(e,t,i){const{editor:s,session:o}=t;if(o&&s){let t=s.model.sharedModel.getSource();const r=s.getCursorPosition();let l=n.Text.jsIndexToCharIndex(s.getOffsetAt(r),t);const a=o.kernel;if(!t||!a){return Promise.resolve(e)}if(i){const{start:e,value:s}=i;t=t.substring(0,e)+s;l=l+s.length}const c={code:t,cursor_pos:l,detail_level:0};const d=await a.requestInspect(c);const h=d.content;if(h.status!=="ok"||!h.found){return e}e.documentation=h.data["text/plain"];return e}return e}shouldShowContinuousHint(e,t){const i=t.sourceChange;if(i==null){return true}if(i.some((e=>e.delete!=null))){return false}return i.some((t=>t.insert!=null&&(t.insert==="."||!e&&t.insert.trim().length>0)))}}var O=i(5502);var R=i(46035);const j="jp-GhostText-lineSpacer";const W="jp-GhostText-letterSpacer";const N="jp-GhostText";const z="jp-GhostText-streamedToken";const B="jp-GhostText-streamingIndicator";class F{constructor(e){this.options=e}placeGhost(e,t){const i=[Z.addMark.of(t)];if(!e.state.field(Z.markField,false)){i.push(R.StateEffect.appendConfig.of([Z.markField]));i.push(R.StateEffect.appendConfig.of([O.EditorView.domEventHandlers({blur:t=>{if(this.options.onBlur(t)===false){return true}const i=[Z.removeMark.of(null)];setTimeout((()=>{e.dispatch({effects:i})}),0)}})]))}e.dispatch({effects:i})}clearGhosts(e){const t=[Z.removeMark.of(null)];e.dispatch({effects:t})}}F.streamingAnimation="uncover";class V extends O.WidgetType{constructor(e){super();this.options=e;this.isSpacer=false}eq(e){return e.content==this.content&&e.options.streaming===this.options.streaming}get lineBreaks(){return(this.content.match(/\n/g)||"").length}updateDOM(e,t){this._updateDOM(e);return true}get content(){return this.options.content}toDOM(){let e=document.createElement("span");if(this.options.onPointerOver){e.addEventListener("pointerover",this.options.onPointerOver)}if(this.options.onPointerLeave){e.addEventListener("pointerleave",this.options.onPointerLeave)}e.classList.add(N);e.dataset.animation=F.streamingAnimation;e.dataset.providedBy=this.options.providerId;this._updateDOM(e);return e}_updateDOM(e){const t=this.content;let i=this.options.addedPart;if(i&&!this.isSpacer){if(i.startsWith("\n")){i=i.substring(1)}e.innerText=t.substring(0,t.length-i.length);const s=document.createElement("span");s.className=z;s.innerText=i;e.appendChild(s)}else{e.innerText=t}if(!this.isSpacer&&this.options.streaming){const t=document.createElement("span");t.className=B;e.appendChild(t)}}destroy(e){if(this.options.onPointerOver){e.removeEventListener("pointerover",this.options.onPointerOver)}if(this.options.onPointerLeave){e.removeEventListener("pointerleave",this.options.onPointerLeave)}super.destroy(e)}}class G extends V{constructor(){super(...arguments);this.isSpacer=true}}class K extends G{toDOM(){const e=super.toDOM();e.classList.add(j);return e}}class U extends G{get content(){return this.options.content[0]}toDOM(){const e=super.toDOM();e.classList.add(W);return e}}var Z;(function(e){let t;(function(e){e[e["Set"]=0]="Set";e[e["Remove"]=1]="Remove";e[e["FilterAndUpdate"]=2]="FilterAndUpdate"})(t||(t={}));e.addMark=R.StateEffect.define({map:(e,t)=>({...e,from:t.mapPos(e.from),to:t.mapPos(e.from+e.content.length)})});e.removeMark=R.StateEffect.define();function i(i){for(let s of i.effects){if(s.is(e.addMark)){return{action:t.Set,spec:s.value}}else if(s.is(e.removeMark)){return{action:t.Remove}}}if(i.docChanged||i.selection){return{action:t.FilterAndUpdate}}return null}function s(e,t){const i=O.Decoration.widget({widget:new V(e),side:1,ghostSpec:e});return i.range(Math.min(e.from,t.newDoc.length),Math.min(e.from,t.newDoc.length))}function n(e,t,i=1e3){if(e.content.length<2){return[]}const s={elapsed:false};setTimeout((()=>{s.elapsed=true}),i);const n=O.Decoration.widget({widget:new U(e),side:1,timeoutInfo:s});const o=O.Decoration.widget({widget:new K(e),side:1,timeoutInfo:s});return[n.range(Math.min(e.from,t.newDoc.length),Math.min(e.from,t.newDoc.length)),o.range(Math.min(e.from,t.newDoc.length),Math.min(e.from,t.newDoc.length))]}e.markField=R.StateField.define({create(){return O.Decoration.none},update(e,o){const r=i(o);e=e.update({filter:(e,t,i)=>{if(i.spec.widget instanceof G){return!i.spec.timeoutInfo.elapsed}return true}});if(!r){return e.map(o.changes)}switch(r.action){case t.Set:{const t=r.spec;const i=s(t,o);return e.update({add:[i],filter:(e,t,s)=>s===i.value})}case t.Remove:return e.update({filter:()=>false});case t.FilterAndUpdate:{let t=e.iter();while(t.value&&t.value.spec.widget instanceof G){t.next()}if(!t.value){return e.map(o.changes)}const i=t.value.spec.ghostSpec;const r={...i};let a=false;o.changes.iterChanges(((e,t,i,s,n)=>{if(a){return}if(e===t&&i!==s){for(let e=0;e<n.lines;e++){const t=n.lineAt(e).text;const i=e>0?"\n"+t:t;if(r.content.startsWith(i)){r.content=r.content.slice(i.length);r.from+=i.length}else{a=true;break}}}else if(i===s&&e!==t){a=true}else{a=true}}));const c=a?n(i,o):[s(r,o)];const d=c.map((e=>e.value));e=e.update({add:c,filter:(e,t,i)=>d.includes(i)});if(a){try{e=e.map(o.changes)}catch(l){console.warn(l);return O.Decoration.none}}return e}}},provide:e=>O.EditorView.decorations.from(e)})})(Z||(Z={}));const $="jp-InlineCompleter";const J="jp-mod-inline-completer-active";const Q="jp-InlineCompleter-hover";const X="jp-InlineCompleter-progressBar";class Y extends w.Widget{constructor(e){var t,i;super({node:document.createElement("div")});this._clearHoverTimeout=null;this._current=0;this._editor=null;this._lastItem=null;this._model=null;this._providerWidget=new w.Widget;this._showShortcuts=Y.defaultSettings.showShortcuts;this._showWidget=Y.defaultSettings.showWidget;this._suggestionsCounter=new w.Widget;this._toolbar=new C.Toolbar;this.model=(t=e.model)!==null&&t!==void 0?t:null;this.editor=(i=e.editor)!==null&&i!==void 0?i:null;this.addClass($);this._ghostManager=new F({onBlur:this._onEditorBlur.bind(this)});this._trans=e.trans;const s=this.layout=new w.PanelLayout;s.addWidget(this._suggestionsCounter);s.addWidget(this.toolbar);s.addWidget(this._providerWidget);this._progressBar=document.createElement("div");this._progressBar.className=X;this.node.appendChild(this._progressBar);this._updateShortcutsVisibility();this._updateDisplay();this.node.tabIndex=0}get toolbar(){return this._toolbar}get editor(){return this._editor}set editor(e){var t;(t=this.model)===null||t===void 0?void 0:t.reset();this._editor=e}get model(){return this._model}set model(e){if(!e&&!this._model||e===this._model){return}if(this._model){this._model.suggestionsChanged.disconnect(this._onModelSuggestionsChanged,this);this._model.filterTextChanged.disconnect(this._onModelFilterTextChanged,this);this._model.provisionProgress.disconnect(this._onProvisionProgress,this)}this._model=e;if(this._model){this._model.suggestionsChanged.connect(this._onModelSuggestionsChanged,this);this._model.filterTextChanged.connect(this._onModelFilterTextChanged,this);this._model.provisionProgress.connect(this._onProvisionProgress,this)}}cycle(e){var t,i;const s=(i=(t=this.model)===null||t===void 0?void 0:t.completions)===null||i===void 0?void 0:i.items;if(!s){return}if(e==="next"){const e=this._current+1;this._current=e===s.length?0:e}else{const e=this._current-1;this._current=e===-1?s.length-1:e}this._updateStreamTracking();this._render()}accept(){const e=this.model;const t=this.current;const i=this._editor;if(!i||!e||!t){return}const s=e.cursor;const n=t.insertText;const o=i.getOffsetAt(i.getCursorPosition());const r=i.getOffsetAt(s);const l=r;const a=o;i.model.sharedModel.updateSource(r,o,n);if(o<=a&&o>=l){i.setCursorPosition(i.getPositionAt(l+n.length))}e.reset();this.update()}get current(){var e;const t=(e=this.model)===null||e===void 0?void 0:e.completions;if(!t){return null}return t.items[this._current]}_updateStreamTracking(){if(this._lastItem){this._lastItem.stream.disconnect(this._onStream,this)}const e=this.current;if(e){e.stream.connect(this._onStream,this)}this._lastItem=e}_onStream(e,t){var i;const s=(i=this.model)===null||i===void 0?void 0:i.completions;if(!s||!s.items||s.items.length===0){return}if(this.isHidden){return}const n=s.items[this._current];this._setText(n)}configure(e){this._showWidget=e.showWidget;this._updateDisplay();if(e.showShortcuts!==this._showShortcuts){this._showShortcuts=e.showShortcuts;this._updateShortcutsVisibility()}F.streamingAnimation=e.streamingAnimation}handleEvent(e){if(this.isHidden||!this._editor){return}switch(e.type){case"pointerdown":this._evtPointerdown(e);break;case"scroll":this._evtScroll(e);break;default:break}}onUpdateRequest(e){super.onUpdateRequest(e);const t=this._model;if(!t){return}let i=t.completions;if(!i||!i.items||i.items.length===0){if(!this.isHidden){this.hide()}return}if(this.isHidden){this.show();this._setGeometry()}}onAfterAttach(e){document.addEventListener("scroll",this,true);document.addEventListener("pointerdown",this,true)}onBeforeDetach(e){document.removeEventListener("scroll",this,true);document.removeEventListener("pointerdown",this,true)}_evtPointerdown(e){var t;if(this.isHidden||!this._editor){return}const i=e.target;if(this.node.contains(i)){return true}this.hide();(t=this.model)===null||t===void 0?void 0:t.reset()}_evtScroll(e){if(this.isHidden||!this._editor){return}const{node:t}=this;if(t.contains(e.target)){return}requestAnimationFrame((()=>{this._setGeometry()}))}_onEditorBlur(e){var t;if(this.node.contains(e.relatedTarget)){return false}(t=this._editor)===null||t===void 0?void 0:t.host.classList.remove(J);this.hide()}_onModelSuggestionsChanged(e,t){var i;if(!this.isAttached){this.update();return}if(t.event==="set"){this._current=(i=t.indexMap.get(this._current))!==null&&i!==void 0?i:0}else if(t.event==="clear"){const e=this.editor;if(e){this._ghostManager.clearGhosts(e.editor);e.host.classList.remove(J)}}this._updateStreamTracking();this.update();this._render()}_onModelFilterTextChanged(e,t){var i,s;const n=(i=this.model)===null||i===void 0?void 0:i.completions;if(!n||!n.items||n.items.length===0){return}this._current=(s=t.get(this._current))!==null&&s!==void 0?s:0;this._updateStreamTracking();setTimeout((()=>{this._render();this._setGeometry()}),0)}_onProvisionProgress(e,t){requestAnimationFrame((()=>{if(t.pendingProviders===0){this._progressBar.style.display="none"}else{this._progressBar.style.display="";this._progressBar.style.width=100*t.pendingProviders/t.totalProviders+"%"}}))}_render(){var e,t;const i=(e=this.model)===null||e===void 0?void 0:e.completions;if(!i||!i.items||i.items.length===0){return}const s=i.items[this._current];this._setText(s);if(this._showWidget==="never"){return}this._suggestionsCounter.node.innerText=this._trans.__("%1/%2",this._current+1,i.items.length);this._providerWidget.node.title=this._trans.__("Provider: %1",s.provider.name);const n=(t=s.provider.icon)!==null&&t!==void 0?t:C.kernelIcon;n.render(this._providerWidget.node)}_setText(e){const t=e.insertText;const i=this._editor;const s=this._model;if(!s||!i){return}const n=i.editor;this._ghostManager.placeGhost(n,{from:i.getOffsetAt(s.cursor),content:t,providerId:e.provider.identifier,addedPart:e.lastStreamed,streaming:e.streaming,onPointerOver:this._onPointerOverGhost.bind(this),onPointerLeave:this._onPointerLeaveGhost.bind(this)});i.host.classList.add(J)}_onPointerOverGhost(){if(this._clearHoverTimeout!==null){window.clearTimeout(this._clearHoverTimeout);this._clearHoverTimeout=null}this.node.classList.add(Q)}_onPointerLeaveGhost(){this._clearHoverTimeout=window.setTimeout((()=>this.node.classList.remove(Q)),500)}_setGeometry(){const{node:e}=this;const t=this._model;const i=this._editor;if(!i||!t||!t.cursor){return}const s=i.host.closest(".jp-MainAreaWidget > .lm-Widget")||i.host;let n;try{n=i.getCoordinateForPosition(t.cursor)}catch(o){this.hide();return}C.HoverBox.setGeometry({anchor:n,host:s,maxHeight:40,minHeight:20,node:e,privilege:"forceAbove",outOfViewDisplay:{top:"stick-outside",bottom:"stick-inside",left:"stick-inside",right:"stick-outside"}})}_updateShortcutsVisibility(){this.node.dataset.showShortcuts=this._showShortcuts+""}_updateDisplay(){this.node.dataset.display=this._showWidget}}(function(e){e.defaultSettings={showWidget:"onHover",showShortcuts:true,streamingAnimation:"uncover",providers:{}};class t{constructor(){this.suggestionsChanged=new r.Signal(this);this.filterTextChanged=new r.Signal(this);this.provisionProgress=new r.Signal(this);this._isDisposed=false;this._completions=null}setCompletions(e){var t,i;const s=new Map((i=(t=this._completions)===null||t===void 0?void 0:t.items)===null||i===void 0?void 0:i.map(((e,t)=>[e.insertText,t])));this._completions=e;const n=new Map(e.items.map(((e,t)=>[s.get(e.insertText),t])));this.suggestionsChanged.emit({event:"set",indexMap:n})}appendCompletions(e){if(!this._completions||!this._completions.items){console.warn("No completions to append to");return}this._completions.items.push(...e.items);this.suggestionsChanged.emit({event:"append"})}notifyProgress(e){this.provisionProgress.emit(e)}get cursor(){return this._cursor}set cursor(e){this._cursor=e}get completions(){return this._completions}reset(){this._completions=null;this.suggestionsChanged.emit({event:"clear"})}get isDisposed(){return this._isDisposed}handleTextChange(e){var t;const i=this._completions;if(!i||!i.items||i.items.length===0){return}const s=new Map(i.items.map(((e,t)=>[e,t])));for(let o of(t=e.sourceChange)!==null&&t!==void 0?t:[]){const e=o.insert;if(e){const t=i.items.filter((t=>{var i;const s=(i=t.filterText)!==null&&i!==void 0?i:t.insertText;if(!s.startsWith(e)){return false}t.filterText=s.substring(e.length);t.insertText=t.insertText.substring(e.length);return true}));if(t.length===0){this._completions=null}i.items=t}else{if(!o.retain){this._completions=null}}}const n=new Map(i.items.map(((e,t)=>[s.get(e),t])));this.filterTextChanged.emit(n)}handleSelectionChange(e){const t=this.cursor;if(!t){return}const{start:i,end:s}=e;if(i.column!==s.column||i.line!==s.line){this.reset()}if(i.line!==t.line||i.column<t.column){this.reset()}}dispose(){if(this._isDisposed){return}this._isDisposed=true;r.Signal.clearData(this)}}e.Model=t})(Y||(Y={}));class ee{constructor(){this._activeProviders=new Set([A,L]);this._inlineCompleterSettings=Y.defaultSettings;this._providers=new Map;this._inlineProviders=new Map;this._panelHandlers=new Map;this._mostRecentContext=new Map;this._activeProvidersChanged=new r.Signal(this);this._inlineCompleterFactory=null}get activeProvidersChanged(){return this._activeProvidersChanged}setTimeout(e){this._timeout=e}setShowDocumentationPanel(e){this._panelHandlers.forEach((t=>t.completer.showDocsPanel=e));this._showDoc=e}setContinuousHinting(e){this._panelHandlers.forEach((t=>t.autoCompletion=e));this._autoCompletion=e}registerProvider(e){const t=e.identifier;if(this._providers.has(t)){console.warn(`Completion provider with identifier ${t} is already registered`)}else{this._providers.set(t,e);this._panelHandlers.forEach(((e,t)=>{void this.updateCompleter(this._mostRecentContext.get(t))}))}}registerInlineProvider(e){const t=e.identifier;if(this._inlineProviders.has(t)){console.warn(`Completion provider with identifier ${t} is already registered`)}else{this._inlineProviders.set(t,e);this._panelHandlers.forEach(((e,t)=>{void this.updateCompleter(this._mostRecentContext.get(t))}))}}getProviders(){return this._providers}activateProvider(e){this._activeProviders=new Set([]);e.forEach((e=>{if(this._providers.has(e)){this._activeProviders.add(e)}}));if(this._activeProviders.size===0){this._activeProviders.add(A);this._activeProviders.add(L)}this._activeProvidersChanged.emit()}async updateCompleter(e){var t,i;const{widget:s,editor:n,sanitizer:o}=e;const r=s.id;const l=this._panelHandlers.get(r);const a=[...this._activeProviders][0];const c=this._providers.get(a);let d=(t=c===null||c===void 0?void 0:c.renderer)!==null&&t!==void 0?t:M.getDefaultRenderer(o);const h=c===null||c===void 0?void 0:c.modelFactory;let u;if(h){u=await h.call(c,e)}else{u=new g}this._mostRecentContext.set(s.id,e);const m={model:u,editor:n,renderer:d,sanitizer:o,showDoc:this._showDoc};if(!l){const t=await this._generateHandler(e,m);this._panelHandlers.set(s.id,t);s.disposed.connect((e=>{this.disposeHandler(e.id,t);this._mostRecentContext.delete(r)}))}else{const t=l.completer;(i=t.model)===null||i===void 0?void 0:i.dispose();t.model=m.model;t.renderer=m.renderer;t.showDocsPanel=m.showDoc;l.autoCompletion=this._autoCompletion;if(n){l.editor=n;l.reconciliator=await this.generateReconciliator(e)}}}invoke(e){const t=this._panelHandlers.get(e);if(t){t.invoke()}}select(e){const t=this._panelHandlers.get(e);if(t){t.completer.selectActive()}}setInlineCompleterFactory(e){this._inlineCompleterFactory=e;this._panelHandlers.forEach(((e,t)=>{void this.updateCompleter(this._mostRecentContext.get(t))}));if(this.inline){return}this.inline={invoke:e=>{const t=this._panelHandlers.get(e);if(t&&t.inlineCompleter){t.invokeInline()}},cycle:(e,t)=>{const i=this._panelHandlers.get(e);if(i&&i.inlineCompleter){i.inlineCompleter.cycle(t)}},accept:e=>{const t=this._panelHandlers.get(e);if(t&&t.inlineCompleter){t.inlineCompleter.accept()}},configure:e=>{this._inlineCompleterSettings=e;this._panelHandlers.forEach(((t,i)=>{for(const[s,n]of this._inlineProviders.entries()){if(n.configure){n.configure(e.providers[s])}}if(t.inlineCompleter){t.inlineCompleter.configure(e)}void this.updateCompleter(this._mostRecentContext.get(i))}))}}}get inlineProviders(){return[...this._inlineProviders.values()]}async generateReconciliator(e){const t=[];for(const[n,o]of Object.entries(this._inlineCompleterSettings.providers)){if(o.enabled===true){t.push(n)}}const i=[...this._inlineProviders.values()].filter((e=>t.includes(e.identifier)));const s=[];for(const n of this._activeProviders){const e=this._providers.get(n);if(e){s.push(e)}}return new k({context:e,providers:s,inlineProviders:i,inlineProvidersSettings:this._inlineCompleterSettings.providers,timeout:this._timeout})}disposeHandler(e,t){var i,s,n,o;(i=t.completer.model)===null||i===void 0?void 0:i.dispose();t.completer.dispose();(n=(s=t.inlineCompleter)===null||s===void 0?void 0:s.model)===null||n===void 0?void 0:n.dispose();(o=t.inlineCompleter)===null||o===void 0?void 0:o.dispose();t.dispose();this._panelHandlers.delete(e)}async _generateHandler(e,t){const i=new M(t);const s=this._inlineCompleterFactory?this._inlineCompleterFactory.factory({...t,model:new Y.Model}):undefined;i.hide();w.Widget.attach(i,document.body);if(s){w.Widget.attach(s,document.body);s.hide();s.configure(this._inlineCompleterSettings)}const n=await this.generateReconciliator(e);const o=new u({completer:i,inlineCompleter:s,reconciliator:n});o.editor=e.editor;return o}}const te='<svg xmlns="http://www.w3.org/2000/svg" width="16" viewBox="0 0 24 24">\n  <path class="jp-icon4" fill="#bbbbbb" d="M17 15H3v2h14v-2Zm0-8h-6v2h6V7ZM3 13h18v-2H3v2Zm0 8h18v-2H3v2Z"/>\n  <path class="jp-icon1" fill="#616161" d="M3 3v2h18V3H3ZM3 7v2h8V7H3Z"/>\n</svg>\n';const ie='<svg xmlns="http://www.w3.org/2000/svg" width="16" viewBox="0 0 24 24">\n<g fill="#616161" class="jp-icon2 jp-icon-selectable">\n  <path d="M6 8h16v14.3H6z" style="fill:#eee;stroke:#444;stroke-linejoin:round"/>\n  <path d="M3 3v2h10V3H3Z" transform="matrix(.8 0 0 1 .5 0)"/>\n</g>\n<g class="jp-icon3 jp-icon-selectable">\n  <path fill="#616161" d="M18 14.1H8v2h11v-2ZM8 12.1H20V10.1H8v2Zm0 8H20v-2H8v3Z"/>\n</g>\n</svg>\n';const se=new C.LabIcon({name:"completer:inline",svgstr:te});const ne=new C.LabIcon({name:"completer:widget",svgstr:ie});var oe=i(50724);class re{constructor(e){this.options=e;this.identifier="@jupyterlab/inline-completer:history";this._maxSuggestions=100;const t=e.translator||oe.nullTranslator;this._trans=t.load("jupyterlab")}get name(){return this._trans.__("History")}get icon(){return C.historyIcon}get schema(){return{properties:{maxSuggestions:{title:this._trans.__("Maximum number of suggestions"),description:this._trans.__("The maximum number of suggestions to retrieve from history."),type:"number"}},default:{enabled:false,maxSuggestions:100}}}configure(e){var t;this._maxSuggestions=(t=e.maxSuggestions)!==null&&t!==void 0?t:100}async fetch(e,t,i){var s;const n=(s=t.session)===null||s===void 0?void 0:s.kernel;if(!n){throw new Error("No kernel for completion request.")}const o=e.text.slice(0,e.offset);const r=o.split("\n").slice(-1)[0];const l={output:false,raw:true,hist_access_type:"search",pattern:r+"*",unique:true,n:this._maxSuggestions};const a=await n.requestHistory(l);const c=[];if(r===""){return{items:[]}}if(a.content.status==="ok"){for(const e of a.content.history){const t=e[2].split("\n");for(let e=0;e<t.length;e++){const i=t[e];if(i.startsWith(r)){const s=i.slice(r.length,i.length)+"\n"+t.slice(e+1).join("\n");c.push({insertText:s})}}}}return{items:c}}}}}]);
//# sourceMappingURL=9651.23b5dac38854af5e8372.js.map?v=23b5dac38854af5e8372