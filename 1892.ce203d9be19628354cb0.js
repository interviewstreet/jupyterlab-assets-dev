"use strict";(self["webpackChunk_jupyterlab_application_top"]=self["webpackChunk_jupyterlab_application_top"]||[]).push([[1892,6156],{51892:(e,t,i)=>{i.r(t);i.d(t,{FormWidget:()=>r,IMetadataFormProvider:()=>g,MetadataFormProvider:()=>v,MetadataFormWidget:()=>c});var a=i(87447);var o=i(27425);var s=i(64173);var l=i.n(s);var d=i(37900);var n=i.n(d);class r extends a.ReactWidget{constructor(e){super();this.addClass("jp-FormWidget");this._props=e}render(){const e={defaultFormData:this._props.settings.default(),updateMetadata:this._props.metadataFormWidget.updateMetadata};return n().createElement(o.FormComponent,{validator:l(),schema:this._props.properties,formData:this._props.formData,formContext:e,uiSchema:this._props.uiSchema,liveValidate:true,idPrefix:`jp-MetadataForm-${this._props.pluginId}`,onChange:e=>{this._props.metadataFormWidget.updateMetadata(e.formData||{})},compact:true,showModifiedFromDefault:this._props.showModified,translator:this._props.translator})}}var h=i(3167);var f=i(68299);var u=i(50724);var m=i(55172);var p=i(65178);class c extends h.NotebookTools.Tool{constructor(e){super();this.updateMetadata=(e,t)=>{var i,a,o,s,l,d,n,r;if(this.notebookTools==undefined)return;const h=this.notebookTools.activeNotebookPanel;const f=this.notebookTools.activeCell;if(f==null)return;this._updatingMetadata=true;const u={};const m={};for(let[p,c]of Object.entries(e)){if(!this.metadataKeys.includes(p))continue;if(((i=this._metaInformation[p])===null||i===void 0?void 0:i.level)==="notebook"&&this._notebookModelNull)continue;if(((a=this._metaInformation[p])===null||a===void 0?void 0:a.cellTypes)&&!((s=(o=this._metaInformation[p])===null||o===void 0?void 0:o.cellTypes)===null||s===void 0?void 0:s.includes(f.model.type))){continue}let e;let t;if(((l=this._metaInformation[p])===null||l===void 0?void 0:l.level)==="notebook"){e=h.model.metadata;t=m}else{e=f.model.metadata;t=u}let v=p.replace(/^\/+/,"").replace(/\/+$/,"").split("/");let g=v[0];if(g==undefined)continue;let b=c!==undefined&&(((n=(d=this._metaInformation[p])===null||d===void 0?void 0:d.writeDefault)!==null&&n!==void 0?n:true)||c!==((r=this._metaInformation[p])===null||r===void 0?void 0:r.default));if(v.length==1){if(b)t[g]=c;else t[g]=undefined;continue}let M=v.slice(1,-1);let k=v[v.length-1];if(!(g in t)){t[g]=e[g]}if(t[g]===undefined)t[g]={};let y=t[g];let w=true;for(let i of M){if(!(i in y)){if(!b){w=false;break}else y[i]={}}y=y[i]}if(w){if(!b)delete y[k];else y[k]=c}if(!b){t[g]=_.deleteEmptyNested(t[g],v.slice(1));if(!Object.keys(t[g]).length)t[g]=undefined}}for(let[p,c]of Object.entries(u)){if(c===undefined)f.model.deleteMetadata(p);else f.model.setMetadata(p,c)}if(!this._notebookModelNull){for(let[e,t]of Object.entries(m)){if(t===undefined)h.model.deleteMetadata(e);else h.model.setMetadata(e,t)}}this._updatingMetadata=false;if(t){this._update()}};this._notebookModelNull=false;this._metadataSchema=e.metadataSchema;this._metaInformation=e.metaInformation;this._uiSchema=e.uiSchema||{};this._pluginId=e.pluginId;this._showModified=e.showModified||false;this.translator=e.translator||u.nullTranslator;this._trans=this.translator.load("jupyterlab");this._updatingMetadata=false;const t=this.layout=new p.SingletonLayout;const i=document.createElement("div");const a=document.createElement("div");a.textContent=this._trans.__("No metadata.");a.className="jp-MetadataForm-placeholderContent";i.appendChild(a);this._placeholder=new p.Widget({node:i});this._placeholder.addClass("jp-MetadataForm-placeholder");t.widget=this._placeholder}get form(){return this._form}get metadataKeys(){var e;const t=[];for(let i of Object.keys(this._metadataSchema.properties)){t.push(i)}(e=this._metadataSchema.allOf)===null||e===void 0?void 0:e.forEach((e=>{if(e.then!==undefined){if(e.then.properties!==undefined){let i=e.then.properties;for(let e of Object.keys(i)){if(!t.includes(e))t.push(e)}}}if(e.else!==undefined){if(e.else.properties!==undefined){let i=e.else.properties;for(let e of Object.keys(i)){if(!t.includes(e))t.push(e)}}}}));return t}getProperties(e){return m.JSONExt.deepCopy(this._metadataSchema.properties[e])||null}setProperties(e,t){Object.entries(t).forEach((([t,i])=>{this._metadataSchema.properties[e][t]=i}))}setContent(e){const t=this.layout;if(t.widget){t.widget.removeClass("jp-MetadataForm-content");t.removeWidget(t.widget)}if(!e){e=this._placeholder}e.addClass("jp-MetadataForm-content");t.widget=e}buildWidget(e){this._form=new r(e);this._form.addClass("jp-MetadataForm");this.setContent(this._form)}onAfterShow(e){this._update()}onActiveCellChanged(e){if(this.isVisible)this._update()}onActiveCellMetadataChanged(e){if(!this._updatingMetadata&&this.isVisible)this._update()}onActiveNotebookPanelChanged(e){const t=this.notebookTools.activeNotebookPanel;this._notebookModelNull=t===null||t.model===null;if(!this._updatingMetadata&&this.isVisible)this._update()}onActiveNotebookPanelMetadataChanged(e){if(!this._updatingMetadata&&this.isVisible)this._update()}_update(){var e,t,i,a,o;const s=this.notebookTools.activeNotebookPanel;const l=this.notebookTools.activeCell;if(l==undefined)return;const d=m.JSONExt.deepCopy(this._metadataSchema);const n={};for(let r of Object.keys(this._metadataSchema.properties||m.JSONExt.emptyObject)){if(((e=this._metaInformation[r])===null||e===void 0?void 0:e.level)==="notebook"&&this._notebookModelNull){delete d.properties[r];continue}if(((t=this._metaInformation[r])===null||t===void 0?void 0:t.cellTypes)&&!((a=(i=this._metaInformation[r])===null||i===void 0?void 0:i.cellTypes)===null||a===void 0?void 0:a.includes(l.model.type))){delete d.properties[r];continue}let h;let f=r.replace(/^\/+/,"").replace(/\/+$/,"").split("/");if(((o=this._metaInformation[r])===null||o===void 0?void 0:o.level)==="notebook"){h=s.model.metadata}else{h=l.model.metadata}let u=true;for(let e of f){if(e in h)h=h[e];else{u=false;break}}if(u)n[r]=h}this.buildWidget({properties:d,settings:new f.BaseSettings({schema:this._metadataSchema}),uiSchema:this._uiSchema,translator:this.translator||null,formData:n,metadataFormWidget:this,showModified:this._showModified,pluginId:this._pluginId})}}var _;(function(e){function t(e,i){let a=i.shift();if(a!==undefined&&a in e){if(Object.keys(e[a]).length)e[a]=t(e[a],i);if(!Object.keys(e[a]).length)delete e[a]}return e}e.deleteEmptyNested=t})(_||(_={}));class v{constructor(){this._items={}}add(e,t){if(!this._items[e]){this._items[e]=t}else{console.warn(`A MetadataformWidget is already registered with id ${e}`)}}get(e){if(this._items[e]){return this._items[e]}else{console.warn(`There is no MetadataformWidget registered with id ${e}`)}}}const g=new m.Token("@jupyterlab/metadataform:IMetadataFormProvider",`A service to register new metadata editor widgets.`)}}]);
//# sourceMappingURL=1892.ce203d9be19628354cb0.js.map?v=ce203d9be19628354cb0