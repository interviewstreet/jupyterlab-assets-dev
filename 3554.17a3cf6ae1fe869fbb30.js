(self["webpackChunk_jupyterlab_application_top"]=self["webpackChunk_jupyterlab_application_top"]||[]).push([[3554],{63554:(e,n,t)=>{"use strict";t.r(n);t.d(n,{connectToIDE:()=>K,connectToProduct:()=>Y});var o;(function(e){e.Call="call",e.Reply="reply",e.Syn="syn",e.SynAck="synAck",e.Ack="ack"})(o||(o={}));var r;(function(e){e.Fulfilled="fulfilled",e.Rejected="rejected"})(r||(r={}));var i;(function(e){e.ConnectionDestroyed="ConnectionDestroyed",e.ConnectionTimeout="ConnectionTimeout",e.NoIframeSrc="NoIframeSrc"})(i||(i={}));var s;(function(e){e.DataCloneError="DataCloneError"})(s||(s={}));var a;(function(e){e.Message="message"})(a||(a={}));const c=(e,n)=>{const t=[];let o=!1;return{destroy(r){o||(o=!0,n(`${e}: Destroying connection`),t.forEach((e=>{e(r)})))},onDestroy(e){o?e():t.push(e)}}},d=e=>(...n)=>{e&&console.log("[Penpal]",...n)},l={"http:":"80","https:":"443"},u=/^(https?:)?\/\/([^/:]+)?(:(\d+))?/,g=["file:","data:"],p=e=>{if(e&&g.find((n=>e.startsWith(n))))return"null";const n=document.location,t=u.exec(e);let o,r,i;t?(o=t[1]?t[1]:n.protocol,r=t[2],i=t[4]):(o=n.protocol,r=n.hostname,i=n.port);const s=i&&i!==l[o]?`:${i}`:"";return`${o}//${r}${s}`},m=({name:e,message:n,stack:t})=>({name:e,message:n,stack:t}),h=e=>{const n=new Error;return Object.keys(e).forEach((t=>n[t]=e[t])),n},f=(e,n,t)=>{const{localName:i,local:c,remote:d,originForSending:l,originForReceiving:u}=e;let g=!1;const p=e=>{if(e.source!==d||e.data.penpal!==o.Call)return;if(u!=="*"&&e.origin!==u){t(`${i} received message from origin ${e.origin} which did not match expected origin ${u}`);return}const a=e.data,{methodName:c,args:p,id:h}=a;t(`${i}: Received ${c}() call`);const f=e=>n=>{if(t(`${i}: Sending ${c}() reply`),g){t(`${i}: Unable to send ${c}() reply due to destroyed connection`);return}const a={penpal:o.Reply,id:h,resolution:e,returnValue:n};e===r.Rejected&&n instanceof Error&&(a.returnValue=m(n),a.returnValueIsError=!0);try{d.postMessage(a,l)}catch(u){if(u.name===s.DataCloneError){const e={penpal:o.Reply,id:h,resolution:r.Rejected,returnValue:m(u),returnValueIsError:!0};d.postMessage(e,l)}throw u}};new Promise((e=>e(n[c].apply(n,p)))).then(f(r.Fulfilled),f(r.Rejected))};return c.addEventListener(a.Message,p),()=>{g=!0,c.removeEventListener(a.Message,p)}};let y=0;const w=()=>++y,v=".",C=e=>e?e.split(v):[],$=e=>e.join(v),k=(e,n)=>{const t=C(n||"");return t.push(e),$(t)},E=(e,n,t)=>{const o=C(n);return o.reduce(((e,n,r)=>(typeof e[n]>"u"&&(e[n]={}),r===o.length-1&&(e[n]=t),e[n])),e),e},b=(e,n)=>{const t={};return Object.keys(e).forEach((o=>{const r=e[o],i=k(o,n);typeof r=="object"&&Object.assign(t,b(r,i)),typeof r=="function"&&(t[i]=r)})),t},R=e=>{const n={};for(const t in e)E(n,t,e[t]);return n},S=(e,n,t,s,c)=>{const{localName:d,local:l,remote:u,originForSending:g,originForReceiving:p}=n;let m=!1;c(`${d}: Connecting call sender`);const f=e=>(...n)=>{c(`${d}: Sending ${e}() call`);let t;try{u.closed&&(t=!0)}catch{t=!0}if(t&&s(),m){const n=new Error(`Unable to send ${e}() call due to destroyed connection`);throw n.code=i.ConnectionDestroyed,n}return new Promise(((t,i)=>{const s=w(),m=n=>{if(n.source!==u||n.data.penpal!==o.Reply||n.data.id!==s)return;if(p!=="*"&&n.origin!==p){c(`${d} received message from origin ${n.origin} which did not match expected origin ${p}`);return}const g=n.data;c(`${d}: Received ${e}() reply`),l.removeEventListener(a.Message,m);let f=g.returnValue;g.returnValueIsError&&(f=h(f)),(g.resolution===r.Fulfilled?t:i)(f)};l.addEventListener(a.Message,m);const f={penpal:o.Call,id:s,methodName:e,args:n};u.postMessage(f,g)}))},y=t.reduce(((e,n)=>(e[n]=f(n),e)),{});return Object.assign(e,R(y)),()=>{m=!0}},N=(e,n,t,o,r)=>{const{destroy:i,onDestroy:s}=o;let a,c;const d={};return o=>{if(n!=="*"&&o.origin!==n){r(`Parent: Handshake - Received ACK message from origin ${o.origin} which did not match expected origin ${n}`);return}r("Parent: Handshake - Received ACK");const l={localName:"Parent",local:window,remote:o.source,originForSending:t,originForReceiving:n};a&&a(),a=f(l,e,r),s(a),c&&c.forEach((e=>{delete d[e]})),c=o.data.methodNames;const u=S(d,l,c,i,r);return s(u),d}},j=(e,n,t,r)=>i=>{if(!i.source)return;if(t!=="*"&&i.origin!==t){e(`Parent: Handshake - Received SYN message from origin ${i.origin} which did not match expected origin ${t}`);return}e("Parent: Handshake - Received SYN, responding with SYN-ACK");const s={penpal:o.SynAck,methodNames:Object.keys(n)};i.source.postMessage(s,r)},M=6e4,A=(e,n)=>{const{destroy:t,onDestroy:o}=n,r=setInterval((()=>{e.isConnected||(clearInterval(r),t())}),M);o((()=>{clearInterval(r)}))},D=(e,n)=>{let t;return e!==void 0&&(t=window.setTimeout((()=>{const t=new Error(`Connection timed out after ${e}ms`);t.code=i.ConnectionTimeout,n(t)}),e)),()=>{clearTimeout(t)}},P=e=>{if(!e.src&&!e.srcdoc){const e=new Error("Iframe must have src or srcdoc property defined.");throw e.code=i.NoIframeSrc,e}},F=e=>{let{iframe:n,methods:t={},childOrigin:r,timeout:i,debug:s=!1}=e;const l=d(s),u=c("Parent",l),{onDestroy:g,destroy:m}=u;r||(P(n),r=p(n.src));const h=r==="null"?"*":r,f=b(t),y=j(l,f,r,h),w=N(f,r,h,u,l);return{promise:new Promise(((e,t)=>{const r=D(i,m),s=t=>{if(!(t.source!==n.contentWindow||!t.data)){if(t.data.penpal===o.Syn){y(t);return}if(t.data.penpal===o.Ack){const n=w(t);n&&(r(),e(n));return}}};window.addEventListener(a.Message,s),l("Parent: Awaiting handshake"),A(n,u),g((e=>{window.removeEventListener(a.Message,s),e&&t(e)}))})),destroy(){m()}}},I=(e,n,t,r)=>{const{destroy:i,onDestroy:s}=t;return t=>{if(!(e instanceof RegExp?e.test(t.origin):e==="*"||e===t.origin)){r(`Child: Handshake - Received SYN-ACK from origin ${t.origin} which did not match expected origin ${e}`);return}r("Child: Handshake - Received SYN-ACK, responding with ACK");const a=t.origin==="null"?"*":t.origin,c={penpal:o.Ack,methodNames:Object.keys(n)};window.parent.postMessage(c,a);const d={localName:"Child",local:window,remote:window.parent,originForSending:a,originForReceiving:t.origin},l=f(d,n,r);s(l);const u={},g=S(u,d,t.data.methodNames,i,r);return s(g),u}},O=()=>{try{clearTimeout()}catch{return!1}return!0},L=(e={})=>{const{parentOrigin:n="*",methods:t={},timeout:r,debug:i=!1}=e,s=d(i),l=c("Child",s),{destroy:u,onDestroy:g}=l,p=b(t),m=I(n,p,l,s),h=()=>{s("Child: Handshake - Sending SYN");const e={penpal:o.Syn},t=n instanceof RegExp?"*":n;window.parent.postMessage(e,t)};return{promise:new Promise(((e,n)=>{const t=D(r,u),i=n=>{if(!!O()&&!(n.source!==parent||!n.data)&&n.data.penpal===o.SynAck){const o=m(n);o&&(window.removeEventListener(a.Message,i),t(),e(o))}};window.addEventListener(a.Message,i),h(),g((e=>{window.removeEventListener(a.Message,i),e&&n(e)}))})),destroy(){u()}}},x=e=>()=>e?Object.keys(e):[],T=e=>n=>e?Object.keys(e).includes(n):!1,H=e=>{const n=x(e),t=T(e);return{getCapabilities:n,hasCapability:t}},V=5e3,K=e=>{const{timeout:n=V,debug:t=!1,methods:o}=e,r={...o,...H(o)};return F({...e,methods:r,timeout:n,debug:t})},Y=e=>{const{timeout:n=V,debug:t=!1,methods:o}=e,r={...o,...H(o)};return L({...e,methods:r,timeout:n,debug:t})}}}]);
//# sourceMappingURL=3554.17a3cf6ae1fe869fbb30.js.map?v=17a3cf6ae1fe869fbb30