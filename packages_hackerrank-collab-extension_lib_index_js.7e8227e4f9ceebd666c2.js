(self["webpackChunk_jupyterlab_application_top"] = self["webpackChunk_jupyterlab_application_top"] || []).push([["packages_hackerrank-collab-extension_lib_index_js"],{

/***/ "../../node_modules/firebase/app/dist/index.cjs.js":
/*!*********************************************************!*\
  !*** ../../node_modules/firebase/app/dist/index.cjs.js ***!
  \*********************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

"use strict";


function _interopDefault (ex) { return (ex && (typeof ex === 'object') && 'default' in ex) ? ex['default'] : ex; }

var firebase = _interopDefault(__webpack_require__(/*! @firebase/app */ "../../node_modules/@firebase/app/dist/index.cjs.js"));

var name = "firebase";
var version = "7.12.0";

/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
firebase.registerVersion(name, version, 'app');

module.exports = firebase;
//# sourceMappingURL=index.cjs.js.map


/***/ }),

/***/ "../../packages/hackerrank-collab-extension/style/icons/Users.svg":
/*!************************************************************************!*\
  !*** ../../packages/hackerrank-collab-extension/style/icons/Users.svg ***!
  \************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ("<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n<path class=\"jp-icon3\" fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M1.46447 15.4645C2.40215 14.5268 3.67392 14 5 14H13C14.3261 14 15.5979 14.5268 16.5355 15.4645C17.4732 16.4021 18 17.6739 18 19V21C18 21.5523 17.5523 22 17 22C16.4477 22 16 21.5523 16 21V19C16 18.2044 15.6839 17.4413 15.1213 16.8787C14.5587 16.3161 13.7956 16 13 16H5C4.20435 16 3.44129 16.3161 2.87868 16.8787C2.31607 17.4413 2 18.2044 2 19V21C2 21.5523 1.55228 22 1 22C0.447715 22 0 21.5523 0 21V19C0 17.6739 0.526784 16.4021 1.46447 15.4645Z\" fill=\"#B5C0D0\"/>\n<path class=\"jp-icon3\" fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M9 4C7.34315 4 6 5.34315 6 7C6 8.65685 7.34315 10 9 10C10.6569 10 12 8.65685 12 7C12 5.34315 10.6569 4 9 4ZM4 7C4 4.23858 6.23858 2 9 2C11.7614 2 14 4.23858 14 7C14 9.76142 11.7614 12 9 12C6.23858 12 4 9.76142 4 7Z\" fill=\"#B5C0D0\"/>\n<path class=\"jp-icon3\" fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M19.0318 14.88C19.1698 14.3453 19.7153 14.0237 20.25 14.1618C21.3227 14.4387 22.273 15.0641 22.9517 15.9397C23.6304 16.8152 23.9992 17.8914 24 18.9993L24 21C24 21.5523 23.5523 22 23 22C22.4477 22 22 21.5523 22 21L22 19.0007C21.9994 18.3361 21.7782 17.6902 21.371 17.165C20.9638 16.6396 20.3936 16.2644 19.75 16.0982C19.2153 15.9602 18.8937 15.4148 19.0318 14.88Z\" fill=\"#B5C0D0\"/>\n<path class=\"jp-icon3\" fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M15.0312 2.88196C15.1682 2.34694 15.713 2.02426 16.248 2.16125C17.3236 2.43663 18.2768 3.06213 18.9576 3.93914C19.6383 4.81615 20.0078 5.89479 20.0078 7.005C20.0078 8.11521 19.6383 9.19385 18.9576 10.0709C18.2768 10.9479 17.3236 11.5734 16.248 11.8488C15.713 11.9857 15.1682 11.6631 15.0312 11.128C14.8943 10.593 15.2169 10.0482 15.752 9.91125C16.3973 9.74603 16.9692 9.37073 17.3777 8.84452C17.7861 8.31831 18.0078 7.67113 18.0078 7.005C18.0078 6.33887 17.7861 5.69169 17.3777 5.16548C16.9692 4.63928 16.3973 4.26398 15.752 4.09875C15.2169 3.96176 14.8943 3.41699 15.0312 2.88196Z\" fill=\"#B5C0D0\"/>\n</svg>\n");

/***/ }),

/***/ "../../packages/hackerrank-collab-extension/style/icons/corner-up-right.svg":
/*!**********************************************************************************!*\
  !*** ../../packages/hackerrank-collab-extension/style/icons/corner-up-right.svg ***!
  \**********************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ("<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\"\n  stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"feather feather-corner-up-right jp-icon3\">\n  <polyline points=\"15 14 20 9 15 4\"></polyline>\n  <path d=\"M4 20v-7a4 4 0 0 1 4-4h12\"></path>\n</svg>");

/***/ }),

/***/ "../../packages/hackerrank-collab-extension/lib/codepair-util.js":
/*!***********************************************************************!*\
  !*** ../../packages/hackerrank-collab-extension/lib/codepair-util.js ***!
  \***********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "THEMES_MAP": () => (/* binding */ THEMES_MAP),
/* harmony export */   "initializeApp": () => (/* binding */ initializeApp),
/* harmony export */   "openFile": () => (/* binding */ openFile),
/* harmony export */   "firebaseLogin": () => (/* binding */ firebaseLogin),
/* harmony export */   "getInterviewBaseRef": () => (/* binding */ getInterviewBaseRef),
/* harmony export */   "getQuestionBaseRef": () => (/* binding */ getQuestionBaseRef),
/* harmony export */   "getQuestionCollaboratorsRef": () => (/* binding */ getQuestionCollaboratorsRef),
/* harmony export */   "getAllQuestionCollaboratorsRef": () => (/* binding */ getAllQuestionCollaboratorsRef)
/* harmony export */ });
/* harmony import */ var firebase_app__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! firebase/app */ "../../node_modules/firebase/app/dist/index.cjs.js");
/* harmony import */ var firebase_app__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(firebase_app__WEBPACK_IMPORTED_MODULE_0__);

const THEMES_MAP = Object.freeze({
    dark: 'JupyterLab Dark',
    light: 'JupyterLab Light'
});
/**
 * Firebase specific helpers
 */
// TODO: catch the error
function initializeApp(firebaseConfig) {
    return new Promise(resolve => {
        const init = async function () {
            // We need to require auth after setting the window variables.
            await Promise.all(/*! import() */[__webpack_require__.e("vendors-node_modules_firebase_auth_dist_auth_esm_js"), __webpack_require__.e("node_modules_firebase_auth_dist_index_esm_js")]).then(__webpack_require__.bind(__webpack_require__, /*! firebase/auth */ "../../node_modules/firebase/auth/dist/index.esm.js"));
            await Promise.all(/*! import() */[__webpack_require__.e("vendors-node_modules_firebase_database_dist_index_cjs_js"), __webpack_require__.e("node_modules_firebase_database_dist_index_esm_js")]).then(__webpack_require__.bind(__webpack_require__, /*! firebase/database */ "../../node_modules/firebase/database/dist/index.esm.js"));
            firebase_app__WEBPACK_IMPORTED_MODULE_0___default().initializeApp(firebaseConfig);
            resolve();
        };
        if (firebaseConfig.akamaiProxyFirebase) {
            // eslint-disable-next-line @typescript-eslint/ban-ts-comment
            // @ts-ignore
            window.fbProxyUrl = firebaseConfig.akamaiProxyEndpoint;
        }
        else if (firebaseConfig.proxyFirebase) {
            // eslint-disable-next-line @typescript-eslint/ban-ts-comment
            // @ts-ignore
            window.fbProxyUrl = firebaseConfig.fbProxyEndpoint;
        }
        // eslint-disable-next-line @typescript-eslint/ban-ts-comment
        // @ts-ignore
        if (window.fbProxyUrl) {
            // FIXME: The variable name is changed to nc after transpiling.
            // eslint-disable-next-line @typescript-eslint/ban-ts-comment
            // @ts-ignore
            window.nc = `https://${window.fbProxyUrl}/identitytoolkit/v3/relyingparty/`;
            // eslint-disable-next-line @typescript-eslint/ban-ts-comment
            // @ts-ignore
            firebaseConfig.databaseURL = `https://${window.fbProxyUrl}/?ns=${firebaseConfig.databaseName}`;
        }
        void init();
    });
}
function openFile(commandsRegistry, path, widgetType, activate = false) {
    if (widgetType === 'document') {
        return commandsRegistry.execute('docmanager:open', {
            path,
            options: { activate }
        });
    }
    else if (widgetType === 'console') {
        return commandsRegistry.execute('console:open', { path, activate });
    }
    else if (widgetType === 'terminal') {
        return commandsRegistry.execute('terminal:open', { name: path, activate });
    }
    return Promise.resolve();
}
// TODO: catch the error
async function firebaseLogin(firebaseToken) {
    /**
     If candidate/interviewer is not logged in, no need to give open
     access to firebase
     */
    if (!firebaseToken) {
        throw new Error('No Firebase Token Found');
    }
    /**
     * Read more about supporting multiple browser tabs loggedin with different user
     * Link: https://firebase.google.com/docs/auth/web/auth-state-persistence
     */
    await firebase_app__WEBPACK_IMPORTED_MODULE_0___default().auth().setPersistence((firebase_app__WEBPACK_IMPORTED_MODULE_0___default().auth.Auth.Persistence.SESSION));
    return firebase_app__WEBPACK_IMPORTED_MODULE_0___default().auth().signInWithCustomToken(firebaseToken);
}
function getInterviewBaseRef(slug) {
    return `${slug}/`;
}
function getQuestionBaseRef(slug, questionId) {
    return `${slug}/${questionId}/`;
}
function getQuestionCollaboratorsRef(slug, userId) {
    return `${getInterviewBaseRef(slug)}indicators/${userId}`;
}
function getAllQuestionCollaboratorsRef(slug) {
    return getQuestionCollaboratorsRef(slug, '');
}
//# sourceMappingURL=codepair-util.js.map

/***/ }),

/***/ "../../packages/hackerrank-collab-extension/lib/collab.js":
/*!****************************************************************!*\
  !*** ../../packages/hackerrank-collab-extension/lib/collab.js ***!
  \****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ HackerrankCollaboration)
/* harmony export */ });
/* harmony import */ var firebase__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! firebase */ "webpack/sharing/consume/default/firebase/firebase");
/* harmony import */ var firebase__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(firebase__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _codepair_util__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./codepair-util */ "../../packages/hackerrank-collab-extension/lib/codepair-util.js");
/* harmony import */ var _hackerrank_jupyterlab_collab__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @hackerrank/jupyterlab-collab */ "webpack/sharing/consume/default/@hackerrank/jupyterlab-collab/@hackerrank/jupyterlab-collab");
/* harmony import */ var _hackerrank_jupyterlab_collab__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_hackerrank_jupyterlab_collab__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @jupyterlab/apputils */ "webpack/sharing/consume/default/@jupyterlab/apputils/@jupyterlab/apputils");
/* harmony import */ var _jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _jupyterlab_docregistry__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @jupyterlab/docregistry */ "webpack/sharing/consume/default/@jupyterlab/docregistry/@jupyterlab/docregistry");
/* harmony import */ var _jupyterlab_docregistry__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_jupyterlab_docregistry__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var lodash_debounce__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! lodash.debounce */ "webpack/sharing/consume/default/lodash.debounce/lodash.debounce");
/* harmony import */ var lodash_debounce__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(lodash_debounce__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var _lumino_algorithm__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @lumino/algorithm */ "webpack/sharing/consume/default/@lumino/algorithm/@lumino/algorithm?a039");
/* harmony import */ var _lumino_algorithm__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(_lumino_algorithm__WEBPACK_IMPORTED_MODULE_5__);
/* harmony import */ var _fullstory_logger__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./fullstory-logger */ "../../packages/hackerrank-collab-extension/lib/fullstory-logger.js");





// Won't install types for debounce.
// eslint-disable-next-line @typescript-eslint/ban-ts-comment
// @ts-ignore



class HackerrankCollaboration {
    constructor(shell) {
        this.shell = shell;
        this.isReady = false;
        this.debouncedUpdatePathInFirebase = lodash_debounce__WEBPACK_IMPORTED_MODULE_4___default()(this.updatePathInFirebase, 400);
        this.setupFirebaseListener = (interviewSlug) => {
            const collabPath = (0,_codepair_util__WEBPACK_IMPORTED_MODULE_6__.getAllQuestionCollaboratorsRef)(interviewSlug);
            const usersRef = firebase__WEBPACK_IMPORTED_MODULE_0___default().database().ref(collabPath);
            usersRef.on('child_added', this.handleUserIndicatorChange);
            usersRef.on('child_changed', this.handleUserIndicatorChange);
            usersRef.on('child_removed', this.handleUserIndicatorRemove);
        };
        this.handleUserIndicatorChange = (childSnap) => {
            const userId = childSnap.key;
            const indicatorData = childSnap.val();
            _hackerrank_jupyterlab_collab__WEBPACK_IMPORTED_MODULE_1__.UserIndicatorState.set(userId, indicatorData);
        };
        this.handleUserIndicatorRemove = (childSnap) => {
            const userId = childSnap.key;
            _hackerrank_jupyterlab_collab__WEBPACK_IMPORTED_MODULE_1__.UserIndicatorState.delete(userId);
        };
    }
    async initialize(options) {
        try {
            this.options = options;
            await (0,_codepair_util__WEBPACK_IMPORTED_MODULE_6__.initializeApp)(options.firebaseConfig);
            await (0,_codepair_util__WEBPACK_IMPORTED_MODULE_6__.firebaseLogin)(options.firebaseToken);
            this.setupFirebaseListener(options.interviewSlug);
            this.setInterviewInfo({
                userId: options.userId,
                userColor: options.userColor,
                userName: options.userName,
                interviewSlug: options.interviewSlug,
                questionId: options.questionId
            });
            this.updateCurrentFiles();
            this.startWatchingFiles();
            this.isReady = true;
        }
        catch (err) {
            _fullstory_logger__WEBPACK_IMPORTED_MODULE_7__.default.error("Couldn't setup collaboration", Object.assign({ errName: err.name, errMsg: err.message, errStack: err.stack }, options));
            void (0,_jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_2__.showErrorMessage)("Couldn't setup collaboration", "You'll still be able to see changes made on the document, but some features may not work. Please refresh the page to try again.");
        }
    }
    updateUser(user) {
        if (!this.isReady)
            return;
        _hackerrank_jupyterlab_collab__WEBPACK_IMPORTED_MODULE_1__.InterviewState.set("userId", user.userId);
        _hackerrank_jupyterlab_collab__WEBPACK_IMPORTED_MODULE_1__.InterviewState.set("userColor", user.userColor);
        _hackerrank_jupyterlab_collab__WEBPACK_IMPORTED_MODULE_1__.InterviewState.set("userName", user.userName);
        _hackerrank_jupyterlab_collab__WEBPACK_IMPORTED_MODULE_1__.UserIndicatorState.set(user.userId, Object.assign(Object.assign({}, _hackerrank_jupyterlab_collab__WEBPACK_IMPORTED_MODULE_1__.UserIndicatorState.get(user.userId)), { screenname: user.userName, color: user.userColor }));
        this.updateCurrentFiles();
    }
    updatePathInFirebase(path, widgetType) {
        if (!this.isReady)
            return;
        const hash = (0,_codepair_util__WEBPACK_IMPORTED_MODULE_6__.getQuestionCollaboratorsRef)(this.options.interviewSlug, this.options.userId);
        void firebase__WEBPACK_IMPORTED_MODULE_0___default().database().ref(hash).update({
            filePath: path,
            widgetType,
            color: this.options.userColor
        });
    }
    setInterviewInfo(interviewInfo) {
        Object.keys(interviewInfo).forEach(key => {
            _hackerrank_jupyterlab_collab__WEBPACK_IMPORTED_MODULE_1__.InterviewState.set(key, interviewInfo[key]);
        });
        return;
    }
    updateCurrentFiles() {
        const userName = _hackerrank_jupyterlab_collab__WEBPACK_IMPORTED_MODULE_1__.InterviewState.get("userName");
        const userColor = _hackerrank_jupyterlab_collab__WEBPACK_IMPORTED_MODULE_1__.InterviewState.get("userColor");
        (0,_lumino_algorithm__WEBPACK_IMPORTED_MODULE_5__.each)(this.shell.widgets("main"), (widget) => {
            if (!(widget instanceof _jupyterlab_docregistry__WEBPACK_IMPORTED_MODULE_3__.DocumentWidget))
                return;
            const sharedModel = widget.context.model.sharedModel;
            if (!sharedModel)
                return;
            const awareness = sharedModel.awareness;
            awareness.setLocalStateField('user', {
                name: userName,
                color: userColor
            });
        });
    }
    onActiveChanged(widget) {
        var _a, _b;
        const { path, widgetType } = (0,_hackerrank_jupyterlab_collab__WEBPACK_IMPORTED_MODULE_1__.getWidgetInfo)(widget);
        this.debouncedUpdatePathInFirebase(path, widgetType);
        if (widget instanceof _jupyterlab_docregistry__WEBPACK_IMPORTED_MODULE_3__.DocumentWidget) {
            const model = widget.context.model;
            if (model.sharedModel) {
                const sharedModel = model.sharedModel;
                const currState = sharedModel.awareness.getLocalState();
                /**
                 * Only set if name is anon. If name is anything other
                 * than the latest value that we have on state, change it.
                 */
                const userId = _hackerrank_jupyterlab_collab__WEBPACK_IMPORTED_MODULE_1__.InterviewState.get("userId");
                if (!userId)
                    return;
                const userName = _hackerrank_jupyterlab_collab__WEBPACK_IMPORTED_MODULE_1__.InterviewState.get("userName");
                const userColor = _hackerrank_jupyterlab_collab__WEBPACK_IMPORTED_MODULE_1__.InterviewState.get("userColor");
                if (currState && (((_a = currState.user) === null || _a === void 0 ? void 0 : _a.name) != userName || ((_b = currState.user) === null || _b === void 0 ? void 0 : _b.color) != userColor)) {
                    sharedModel.awareness.setLocalStateField('user', {
                        name: userName,
                        color: userColor
                    });
                }
            }
        }
    }
    startWatchingFiles() {
        /**
         * Using both active and current change events because
         * 1. activeChanged doesn't get triggered when a widget is closed. Ideally,
         * when a widget is closed and the focus isn't moved to next widget, then
         * activeChanged should've been called with newValue = null.
         * 2. currentChanged only gives info about the current widget. It's true that
         * currentChanged always precedes activeChanged as widget is made current first
         * before it's made active. So, it could've been used as a proxy for activeChanged.
         * However, currentChanged also doesn't get called when the user directly clicks on
         * a widget without clicking anywhere in the IDE.
         * Listening to both these events and taking only activeWidget from shell ensures
         * that we're guarded against the shortcomings of both these events.
         */
        this.shell.activeChanged.connect((sender, args) => {
            this.onActiveChanged(this.shell.activeWidget);
        });
        this.shell.currentChanged.connect((sender, args) => {
            this.onActiveChanged(this.shell.activeWidget);
        });
    }
}
//# sourceMappingURL=collab.js.map

/***/ }),

/***/ "../../packages/hackerrank-collab-extension/lib/fullstory-logger.js":
/*!**************************************************************************!*\
  !*** ../../packages/hackerrank-collab-extension/lib/fullstory-logger.js ***!
  \**************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
class FullStoryLogger {
    log(message, data = {}) {
        this.logFullStory('log', message, data);
        console.log(message, data);
    }
    info(message, data = {}) {
        this.logFullStory('info', message, data);
        console.info(message, data);
    }
    warn(message, data = {}) {
        this.logFullStory('warn', message, data);
        console.warn(message, data);
    }
    error(message, data = {}) {
        this.logFullStory('error', message, data);
        console.error(message, data);
    }
    logFullStory(type, message, data = {}) {
        var _a;
        try {
            if (!this._fsInstance) {
                this._fsInstance = this.getFSInstance();
            }
            (_a = this._fsInstance) === null || _a === void 0 ? void 0 : _a.event(`Theia (${type}):${message} `, data);
        }
        catch (e) {
            console.error('Error while logging fullstory event', {
                message,
                data,
                e,
            });
        }
    }
    getFSInstance() {
        // eslint-disable-next-line @typescript-eslint/ban-ts-comment
        // @ts-ignore
        const fsNamespace = window['_fs_namespace'];
        // eslint-disable-next-line @typescript-eslint/ban-ts-comment
        // @ts-ignore
        const fsModule = window[fsNamespace];
        if (typeof fsModule === 'function') {
            return fsModule;
        }
        return undefined;
    }
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (new FullStoryLogger());
//# sourceMappingURL=fullstory-logger.js.map

/***/ }),

/***/ "../../packages/hackerrank-collab-extension/lib/iframe-comm.js":
/*!*********************************************************************!*\
  !*** ../../packages/hackerrank-collab-extension/lib/iframe-comm.js ***!
  \*********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ IframeCommunication)
/* harmony export */ });
/* harmony import */ var _codepair_util__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./codepair-util */ "../../packages/hackerrank-collab-extension/lib/codepair-util.js");
/* harmony import */ var _collab__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./collab */ "../../packages/hackerrank-collab-extension/lib/collab.js");
/* harmony import */ var _jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @jupyterlab/apputils */ "webpack/sharing/consume/default/@jupyterlab/apputils/@jupyterlab/apputils");
/* harmony import */ var _jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _fullstory_logger__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./fullstory-logger */ "../../packages/hackerrank-collab-extension/lib/fullstory-logger.js");
/* harmony import */ var _participants_list__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./participants-list */ "../../packages/hackerrank-collab-extension/lib/participants-list.js");





class IframeCommunication {
    constructor(shell, commandsRegistry) {
        this.shell = shell;
        this.commandsRegistry = commandsRegistry;
        this.hasFocus = false;
        this.pingInterval = 0; // default 5 seconds ping
        this.handleParentMessage = (e) => {
            const { data } = e;
            switch (data.messageType) {
                case 'codepair': {
                    const { firebaseConfig, userColor, userId, interviewSlug, questionId, firebaseToken, userName, theme, pingInterval, pendoVisitorId, pendoAccountId, isSkadoosh, isAdmin, userEmail } = data;
                    _fullstory_logger__WEBPACK_IMPORTED_MODULE_1__.default.log('Collab config setup', {
                        firebaseConfig,
                        userColor,
                        userId,
                        userEmail,
                        interviewSlug,
                        questionId,
                        firebaseToken,
                        userName,
                        pingInterval,
                        pendoVisitorId,
                        pendoAccountId,
                        isSkadoosh,
                        isAdmin,
                        theme,
                    });
                    /**
                     * TODO: Remove this after iframe communication
                     * library is integrated.
                     */
                    try {
                        // eslint-disable-next-line @typescript-eslint/ban-ts-comment
                        // @ts-ignore
                        if (window.pendo && !isSkadoosh) {
                            if (pendoVisitorId) {
                                // eslint-disable-next-line @typescript-eslint/ban-ts-comment
                                // @ts-ignore
                                window.pendo.initialize({
                                    visitor: {
                                        id: pendoVisitorId,
                                        email: userEmail,
                                        isJupyterlabIDE: true
                                    },
                                    account: {
                                        id: pendoAccountId,
                                    },
                                });
                            }
                            else if (!isAdmin && userEmail) {
                                // eslint-disable-next-line @typescript-eslint/ban-ts-comment
                                // @ts-ignore
                                window.pendo.initialize({
                                    visitor: {
                                        id: userEmail,
                                        email: userEmail,
                                        isJupyterlabIDE: true
                                    },
                                    account: {
                                        id: null,
                                    },
                                });
                            }
                        }
                    }
                    catch (err) {
                        _fullstory_logger__WEBPACK_IMPORTED_MODULE_1__.default.error('Pendo initialization failed', {
                            message: err.message,
                            stack: err.stack,
                        });
                    }
                    // theme can be 'dark', 'light'
                    void this.changeTheme(theme);
                    this.collabInst = new _collab__WEBPACK_IMPORTED_MODULE_2__.default(this.shell);
                    void this.collabInst.initialize({
                        firebaseConfig,
                        firebaseToken,
                        userName,
                        questionId,
                        interviewSlug,
                        userId,
                        userColor
                    }).then(() => {
                        const participantsListWidget = new _participants_list__WEBPACK_IMPORTED_MODULE_3__.default(this.commandsRegistry);
                        this.shell.add(participantsListWidget, "left", { rank: 300 });
                    });
                    if (pingInterval > 0) {
                        this.pingInterval = pingInterval;
                        this.setupPingToParent();
                    }
                    break;
                }
                case 'jump_to_cursor': {
                    const { filePath, widgetType } = data;
                    (0,_codepair_util__WEBPACK_IMPORTED_MODULE_4__.openFile)(this.commandsRegistry, filePath, widgetType, true).catch((err) => {
                        _fullstory_logger__WEBPACK_IMPORTED_MODULE_1__.default.error("Couldn't jump to cursor", {
                            errName: err.name,
                            errMsg: err.message,
                            errStack: err.stack,
                            filePath: filePath,
                            widgetType: widgetType
                        });
                        return (0,_jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_0__.showErrorMessage)("Could't open file", "We encountered an error while jumping to the user's current position. Please refresh the page to try again");
                    });
                    break;
                }
                case 'USER.CHANGE': {
                    this.collabInst.updateUser(data);
                    break;
                }
                case 'echo': {
                    this.sendMessageToParent('echo', data);
                    break;
                }
                case 'open_file_in_bg': {
                    const { filePath, widgetType } = data;
                    (0,_codepair_util__WEBPACK_IMPORTED_MODULE_4__.openFile)(this.commandsRegistry, filePath, widgetType, false).catch((err) => {
                        _fullstory_logger__WEBPACK_IMPORTED_MODULE_1__.default.error("Couldn't open file in background", {
                            errName: err.name,
                            errMsg: err.message,
                            errStack: err.stack
                        });
                    });
                    break;
                }
                case 'change_theme': {
                    const { theme } = data;
                    void this.changeTheme(theme);
                    break;
                }
                default:
                    break;
            }
        };
        this.setupPingToParent = () => {
            if (this.hasFocus) {
                this.sendMessageToParent('ping');
            }
            clearTimeout(this.pingTimeout);
            this.pingTimeout = setTimeout(() => this.setupPingToParent(), this.pingInterval);
        };
        window.addEventListener('focus', () => {
            this.sendMessageToParent('ping');
            this.sendMessageToParent('event_focus');
            this.hasFocus = true;
        });
        window.addEventListener('blur', e => {
            setTimeout(() => {
                var _a, _b;
                if (!(((_a = document.activeElement) === null || _a === void 0 ? void 0 : _a.tagName) === 'IFRAME' ||
                    ((_b = document.activeElement) === null || _b === void 0 ? void 0 : _b.tagName) === 'EMBED' ||
                    document.activeElement instanceof HTMLIFrameElement ||
                    document.activeElement instanceof HTMLEmbedElement)) {
                    this.hasFocus = false;
                    this.sendMessageToParent('event_blur');
                    if (this.collabInst) {
                        this.collabInst.debouncedUpdatePathInFirebase('', 'unknown');
                    }
                }
            });
        });
        window.addEventListener('message', this.handleParentMessage, false);
        void shell.restored.then(() => {
            this.sendMessageToParent('ide_ready', {});
        });
    }
    changeTheme(theme) {
        return this.commandsRegistry.execute('apputils:change-theme', {
            theme: _codepair_util__WEBPACK_IMPORTED_MODULE_4__.THEMES_MAP[theme]
        });
    }
    sendMessageToParent(messageType, data = {}) {
        try {
            window.parent.postMessage(Object.assign(Object.assign({}, data), { messageType }), '*');
        }
        catch (err) {
            _fullstory_logger__WEBPACK_IMPORTED_MODULE_1__.default.error("Couldn't send message to parent", {
                errName: err.name,
                errMsg: err.message,
                errStack: err.stack,
                messageType,
                data
            });
        }
    }
}
//# sourceMappingURL=iframe-comm.js.map

/***/ }),

/***/ "../../packages/hackerrank-collab-extension/lib/index.js":
/*!***************************************************************!*\
  !*** ../../packages/hackerrank-collab-extension/lib/index.js ***!
  \***************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _jupyterlab_application__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @jupyterlab/application */ "webpack/sharing/consume/default/@jupyterlab/application/@jupyterlab/application");
/* harmony import */ var _jupyterlab_application__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_jupyterlab_application__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _iframe_comm__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./iframe-comm */ "../../packages/hackerrank-collab-extension/lib/iframe-comm.js");
// Copyright (c) Jupyter Development Team.
// Distributed under the terms of the Modified BSD License.
/**
 * @packageDocumentation
 * @module jupyterlab-collab-extension
 */


const plugin = {
    id: '@hackerrank/jupyterlab-collab-extension:plugin',
    autoStart: true,
    requires: [_jupyterlab_application__WEBPACK_IMPORTED_MODULE_0__.ILabShell],
    activate: (app, shell) => {
        new _iframe_comm__WEBPACK_IMPORTED_MODULE_1__.default(shell, app.commands);
    }
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (plugin);
//# sourceMappingURL=index.js.map

/***/ }),

/***/ "../../packages/hackerrank-collab-extension/lib/participants-list.js":
/*!***************************************************************************!*\
  !*** ../../packages/hackerrank-collab-extension/lib/participants-list.js ***!
  \***************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ ParticipantsListWidget)
/* harmony export */ });
/* harmony import */ var _hackerrank_jupyterlab_collab__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @hackerrank/jupyterlab-collab */ "webpack/sharing/consume/default/@hackerrank/jupyterlab-collab/@hackerrank/jupyterlab-collab");
/* harmony import */ var _hackerrank_jupyterlab_collab__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_hackerrank_jupyterlab_collab__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @jupyterlab/apputils */ "webpack/sharing/consume/default/@jupyterlab/apputils/@jupyterlab/apputils");
/* harmony import */ var _jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! react */ "webpack/sharing/consume/default/react/react");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _codepair_util__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./codepair-util */ "../../packages/hackerrank-collab-extension/lib/codepair-util.js");
/* harmony import */ var _fullstory_logger__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./fullstory-logger */ "../../packages/hackerrank-collab-extension/lib/fullstory-logger.js");
/* harmony import */ var _tooltip__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./tooltip */ "../../packages/hackerrank-collab-extension/lib/tooltip.js");
/* harmony import */ var _jupyterlab_ui_components__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @jupyterlab/ui-components */ "webpack/sharing/consume/default/@jupyterlab/ui-components/@jupyterlab/ui-components");
/* harmony import */ var _jupyterlab_ui_components__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_jupyterlab_ui_components__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _style_icons_Users_svg__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../style/icons/Users.svg */ "../../packages/hackerrank-collab-extension/style/icons/Users.svg");
/* harmony import */ var _style_icons_corner_up_right_svg__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../style/icons/corner-up-right.svg */ "../../packages/hackerrank-collab-extension/style/icons/corner-up-right.svg");










const INTERVIEWER_DEFAULT_NAME = 'Interviewer';
const PARTICIPANTS_LIST_CLASS = 'participants-list-container';
const usersIcon = new _jupyterlab_ui_components__WEBPACK_IMPORTED_MODULE_3__.LabIcon({ name: 'users-icon', svgstr: _style_icons_Users_svg__WEBPACK_IMPORTED_MODULE_4__.default });
const cornerIcon = new _jupyterlab_ui_components__WEBPACK_IMPORTED_MODULE_3__.LabIcon({ name: 'corner-up-right', svgstr: _style_icons_corner_up_right_svg__WEBPACK_IMPORTED_MODULE_5__.default });
class ParticipantsListWidget extends _jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_1__.ReactWidget {
    constructor(commandsRegistry) {
        super();
        this.commandsRegistry = commandsRegistry;
        this.openFile = (filePath, widgetType) => {
            if (!filePath)
                return;
            (0,_codepair_util__WEBPACK_IMPORTED_MODULE_6__.openFile)(this.commandsRegistry, filePath, widgetType, true).catch((err) => {
                _fullstory_logger__WEBPACK_IMPORTED_MODULE_7__.default.error("Couldn't jump to cursor", {
                    errName: err.name,
                    errMsg: err.message,
                    errStack: err.stack,
                    filePath: filePath,
                    widgetType: widgetType
                });
                return (0,_jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_1__.showErrorMessage)("Could't open file", "We encountered an error while jumping to the user's current position. Please refresh the page to try again");
            });
        };
        this.id = "participants-list";
        this.title.caption = "Participants List";
        this.title.icon = usersIcon;
        this.node.setAttribute('role', 'region');
        this.node.setAttribute('aria-label', 'Participants List Section');
        this.addClass(PARTICIPANTS_LIST_CLASS);
        _hackerrank_jupyterlab_collab__WEBPACK_IMPORTED_MODULE_0__.UserIndicatorState.changed.connect(() => {
            this.update();
        });
    }
    getScreenname(userKey, user, currUserId) {
        if (userKey == currUserId)
            return 'You';
        if (user.screenname === `${INTERVIEWER_DEFAULT_NAME} 1`) {
            return INTERVIEWER_DEFAULT_NAME;
        }
        return user.screenname || 'Participant';
    }
    fileNameFromPath(filePath = '') {
        const fileName = filePath.split('/').pop();
        return fileName || "";
    }
    render() {
        const userKeys = _hackerrank_jupyterlab_collab__WEBPACK_IMPORTED_MODULE_0__.UserIndicatorState.keys();
        const currQuestionId = _hackerrank_jupyterlab_collab__WEBPACK_IMPORTED_MODULE_0__.InterviewState.get("questionId");
        const currUserId = _hackerrank_jupyterlab_collab__WEBPACK_IMPORTED_MODULE_0__.InterviewState.get("userId");
        if (_hackerrank_jupyterlab_collab__WEBPACK_IMPORTED_MODULE_0__.UserIndicatorState.size === 0 || _hackerrank_jupyterlab_collab__WEBPACK_IMPORTED_MODULE_0__.InterviewState.size === 0 || !currQuestionId || !currUserId) {
            return react__WEBPACK_IMPORTED_MODULE_2__.createElement("div", { className: "users-list" }, "No Participants...");
        }
        return (react__WEBPACK_IMPORTED_MODULE_2__.createElement("div", { className: "users-list" }, userKeys.map((userKey) => {
            const user = _hackerrank_jupyterlab_collab__WEBPACK_IMPORTED_MODULE_0__.UserIndicatorState.get(userKey);
            if (user == null ||
                !user.insideInterview ||
                user.qid !== currQuestionId ||
                !user.filePath ||
                !user.widgetType ||
                user.widgetType === "unknown") {
                return null;
            }
            const userName = this.getScreenname(userKey, user, currUserId.toString());
            const fileName = this.fileNameFromPath(user.filePath);
            let children;
            if (userKey == currUserId) {
                children = (react__WEBPACK_IMPORTED_MODULE_2__.createElement("div", { className: "users-list-item-info self" },
                    react__WEBPACK_IMPORTED_MODULE_2__.createElement("span", { className: "users-list-item-info-file-name" }, fileName)));
            }
            else {
                children = (react__WEBPACK_IMPORTED_MODULE_2__.createElement(_tooltip__WEBPACK_IMPORTED_MODULE_8__.default, { content: "Jump to file", delay: 200 },
                    react__WEBPACK_IMPORTED_MODULE_2__.createElement("div", { className: "users-list-item-info", onClick: () => this.openFile(user.filePath, user.widgetType) },
                        react__WEBPACK_IMPORTED_MODULE_2__.createElement("span", { className: "users-list-item-info-file-name" }, fileName),
                        react__WEBPACK_IMPORTED_MODULE_2__.createElement(cornerIcon.react, null))));
            }
            return (react__WEBPACK_IMPORTED_MODULE_2__.createElement("div", { className: "users-list-item", key: userKey },
                react__WEBPACK_IMPORTED_MODULE_2__.createElement("div", { style: { color: user.color } }, userName),
                children));
        })));
    }
}
//# sourceMappingURL=participants-list.js.map

/***/ }),

/***/ "../../packages/hackerrank-collab-extension/lib/tooltip.js":
/*!*****************************************************************!*\
  !*** ../../packages/hackerrank-collab-extension/lib/tooltip.js ***!
  \*****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "webpack/sharing/consume/default/react/react");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);

const Tooltip = (props) => {
    const timeout = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)();
    const [active, setActive] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
    const showTip = () => {
        timeout.current = setTimeout(() => {
            setActive(true);
        }, props.delay || 400);
    };
    const hideTip = () => {
        clearInterval(timeout.current);
        setActive(false);
    };
    return (react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", { className: "Tooltip-Wrapper", onMouseEnter: showTip, onMouseLeave: hideTip },
        props.children,
        active && (react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", { className: `Tooltip-Tip ${'bottom'}` }, props.content))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Tooltip);
//# sourceMappingURL=tooltip.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AanVweXRlcmxhYi9hcHBsaWNhdGlvbi10b3AvLi4vLi4vbm9kZV9tb2R1bGVzL2ZpcmViYXNlL2FwcC9kaXN0L2luZGV4LmNqcy5qcyIsIndlYnBhY2s6Ly9AanVweXRlcmxhYi9hcHBsaWNhdGlvbi10b3AvLi4vLi4vcGFja2FnZXMvaGFja2VycmFuay1jb2xsYWItZXh0ZW5zaW9uL3N0eWxlL2ljb25zL1VzZXJzLnN2ZyIsIndlYnBhY2s6Ly9AanVweXRlcmxhYi9hcHBsaWNhdGlvbi10b3AvLi4vLi4vcGFja2FnZXMvaGFja2VycmFuay1jb2xsYWItZXh0ZW5zaW9uL3N0eWxlL2ljb25zL2Nvcm5lci11cC1yaWdodC5zdmciLCJ3ZWJwYWNrOi8vQGp1cHl0ZXJsYWIvYXBwbGljYXRpb24tdG9wLy4uLy4uL3BhY2thZ2VzL2hhY2tlcnJhbmstY29sbGFiLWV4dGVuc2lvbi9saWIvY29kZXBhaXItdXRpbC5qcyIsIndlYnBhY2s6Ly9AanVweXRlcmxhYi9hcHBsaWNhdGlvbi10b3AvLi4vLi4vcGFja2FnZXMvaGFja2VycmFuay1jb2xsYWItZXh0ZW5zaW9uL2xpYi9jb2xsYWIuanMiLCJ3ZWJwYWNrOi8vQGp1cHl0ZXJsYWIvYXBwbGljYXRpb24tdG9wLy4uLy4uL3BhY2thZ2VzL2hhY2tlcnJhbmstY29sbGFiLWV4dGVuc2lvbi9saWIvZnVsbHN0b3J5LWxvZ2dlci5qcyIsIndlYnBhY2s6Ly9AanVweXRlcmxhYi9hcHBsaWNhdGlvbi10b3AvLi4vLi4vcGFja2FnZXMvaGFja2VycmFuay1jb2xsYWItZXh0ZW5zaW9uL2xpYi9pZnJhbWUtY29tbS5qcyIsIndlYnBhY2s6Ly9AanVweXRlcmxhYi9hcHBsaWNhdGlvbi10b3AvLi4vLi4vcGFja2FnZXMvaGFja2VycmFuay1jb2xsYWItZXh0ZW5zaW9uL2xpYi9pbmRleC5qcyIsIndlYnBhY2s6Ly9AanVweXRlcmxhYi9hcHBsaWNhdGlvbi10b3AvLi4vLi4vcGFja2FnZXMvaGFja2VycmFuay1jb2xsYWItZXh0ZW5zaW9uL2xpYi9wYXJ0aWNpcGFudHMtbGlzdC5qcyIsIndlYnBhY2s6Ly9AanVweXRlcmxhYi9hcHBsaWNhdGlvbi10b3AvLi4vLi4vcGFja2FnZXMvaGFja2VycmFuay1jb2xsYWItZXh0ZW5zaW9uL2xpYi90b29sdGlwLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFhOztBQUViLCtCQUErQixpRkFBaUY7O0FBRWhILCtCQUErQixtQkFBTyxDQUFDLHlFQUFlOztBQUV0RDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7Ozs7Ozs7Ozs7Ozs7OztBQzVCQSxpRUFBZSxzakVBQXNqRSxFOzs7Ozs7Ozs7Ozs7Ozs7QUNBcmtFLGlFQUFlLDRXQUE0VyxFOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUNBdlY7QUFDN0I7QUFDUDtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQSxrQkFBa0IsZ1RBQXVCO0FBQ3pDLGtCQUFrQixpVUFBMkI7QUFDN0MsWUFBWSxpRUFBc0I7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUNBQW1DLGtCQUFrQjtBQUNyRDtBQUNBO0FBQ0Esb0RBQW9ELGtCQUFrQixPQUFPLDRCQUE0QjtBQUN6RztBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQSxzQkFBc0I7QUFDdEIsU0FBUztBQUNUO0FBQ0E7QUFDQSx5REFBeUQsaUJBQWlCO0FBQzFFO0FBQ0E7QUFDQSwwREFBMEQsdUJBQXVCO0FBQ2pGO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNB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LDBEQUFtQixTQUFTLDZFQUE2RTtBQUNySDtBQUNBLG1CQUFtQiwwREFBbUIsU0FBUywyQkFBMkIsU0FBUyxHQUFHO0FBQ3RGO0FBQ0EsaUVBQWUsT0FBTyxFQUFDO0FBQ3ZCLG1DIiwiZmlsZSI6InBhY2thZ2VzX2hhY2tlcnJhbmstY29sbGFiLWV4dGVuc2lvbl9saWJfaW5kZXhfanMuN2U4MjI3ZTRmOWNlZWJkNjY2YzIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmZ1bmN0aW9uIF9pbnRlcm9wRGVmYXVsdCAoZXgpIHsgcmV0dXJuIChleCAmJiAodHlwZW9mIGV4ID09PSAnb2JqZWN0JykgJiYgJ2RlZmF1bHQnIGluIGV4KSA/IGV4WydkZWZhdWx0J10gOiBleDsgfVxuXG52YXIgZmlyZWJhc2UgPSBfaW50ZXJvcERlZmF1bHQocmVxdWlyZSgnQGZpcmViYXNlL2FwcCcpKTtcblxudmFyIG5hbWUgPSBcImZpcmViYXNlXCI7XG52YXIgdmVyc2lvbiA9IFwiNy4xMi4wXCI7XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxOCBHb29nbGUgSW5jLlxyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5maXJlYmFzZS5yZWdpc3RlclZlcnNpb24obmFtZSwgdmVyc2lvbiwgJ2FwcCcpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IGZpcmViYXNlO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguY2pzLmpzLm1hcFxuIiwiZXhwb3J0IGRlZmF1bHQgXCI8c3ZnIHdpZHRoPVxcXCIyMFxcXCIgaGVpZ2h0PVxcXCIyMFxcXCIgdmlld0JveD1cXFwiMCAwIDI0IDI0XFxcIiBmaWxsPVxcXCJub25lXFxcIiB4bWxucz1cXFwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcXFwiPlxcbjxwYXRoIGNsYXNzPVxcXCJqcC1pY29uM1xcXCIgZmlsbC1ydWxlPVxcXCJldmVub2RkXFxcIiBjbGlwLXJ1bGU9XFxcImV2ZW5vZGRcXFwiIGQ9XFxcIk0xLjQ2NDQ3IDE1LjQ2NDVDMi40MDIxNSAxNC41MjY4IDMuNjczOTIgMTQgNSAxNEgxM0MxNC4zMjYxIDE0IDE1LjU5NzkgMTQuNTI2OCAxNi41MzU1IDE1LjQ2NDVDMTcuNDczMiAxNi40MDIxIDE4IDE3LjY3MzkgMTggMTlWMjFDMTggMjEuNTUyMyAxNy41NTIzIDIyIDE3IDIyQzE2LjQ0NzcgMjIgMTYgMjEuNTUyMyAxNiAyMVYxOUMxNiAxOC4yMDQ0IDE1LjY4MzkgMTcuNDQxMyAxNS4xMjEzIDE2Ljg3ODdDMTQuNTU4NyAxNi4zMTYxIDEzLjc5NTYgMTYgMTMgMTZINUM0LjIwNDM1IDE2IDMuNDQxMjkgMTYuMzE2MSAyLjg3ODY4IDE2Ljg3ODdDMi4zMTYwNyAxNy40NDEzIDIgMTguMjA0NCAyIDE5VjIxQzIgMjEuNTUyMyAxLjU1MjI4IDIyIDEgMjJDMC40NDc3MTUgMjIgMCAyMS41NTIzIDAgMjFWMTlDMCAxNy42NzM5IDAuNTI2Nzg0IDE2LjQwMjEgMS40NjQ0NyAxNS40NjQ1WlxcXCIgZmlsbD1cXFwiI0I1QzBEMFxcXCIvPlxcbjxwYXRoIGNsYXNzPVxcXCJqcC1pY29uM1xcXCIgZmlsbC1ydWxlPVxcXCJldmVub2RkXFxcIiBjbGlwLXJ1bGU9XFxcImV2ZW5vZGRcXFwiIGQ9XFxcIk05IDRDNy4zNDMxNSA0IDYgNS4zNDMxNSA2IDdDNiA4LjY1Njg1IDcuMzQzMTUgMTAgOSAxMEMxMC42NTY5IDEwIDEyIDguNjU2ODUgMTIgN0MxMiA1LjM0MzE1IDEwLjY1NjkgNCA5IDRaTTQgN0M0IDQuMjM4NTggNi4yMzg1OCAyIDkgMkMxMS43NjE0IDIgMTQgNC4yMzg1OCAxNCA3QzE0IDkuNzYxNDIgMTEuNzYxNCAxMiA5IDEyQzYuMjM4NTggMTIgNCA5Ljc2MTQyIDQgN1pcXFwiIGZpbGw9XFxcIiNCNUMwRDBcXFwiLz5cXG48cGF0aCBjbGFzcz1cXFwianAtaWNvbjNcXFwiIGZpbGwtcnVsZT1cXFwiZXZlbm9kZFxcXCIgY2xpcC1ydWxlPVxcXCJldmVub2RkXFxcIiBkPVxcXCJNMTkuMDMxOCAxNC44OEMxOS4xNjk4IDE0LjM0NTMgMTkuNzE1MyAxNC4wMjM3IDIwLjI1IDE0LjE2MThDMjEuMzIyNyAxNC40Mzg3IDIyLjI3MyAxNS4wNjQxIDIyLjk1MTcgMTUuOTM5N0MyMy42MzA0IDE2LjgxNTIgMjMuOTk5MiAxNy44OTE0IDI0IDE4Ljk5OTNMMjQgMjFDMjQgMjEuNTUyMyAyMy41NTIzIDIyIDIzIDIyQzIyLjQ0NzcgMjIgMjIgMjEuNTUyMyAyMiAyMUwyMiAxOS4wMDA3QzIxLjk5OTQgMTguMzM2MSAyMS43NzgyIDE3LjY5MDIgMjEuMzcxIDE3LjE2NUMyMC45NjM4IDE2LjYzOTYgMjAuMzkzNiAxNi4yNjQ0IDE5Ljc1IDE2LjA5ODJDMTkuMjE1MyAxNS45NjAyIDE4Ljg5MzcgMTUuNDE0OCAxOS4wMzE4IDE0Ljg4WlxcXCIgZmlsbD1cXFwiI0I1QzBEMFxcXCIvPlxcbjxwYXRoIGNsYXNzPVxcXCJqcC1pY29uM1xcXCIgZmlsbC1ydWxlPVxcXCJldmVub2RkXFxcIiBjbGlwLXJ1bGU9XFxcImV2ZW5vZGRcXFwiIGQ9XFxcIk0xNS4wMzEyIDIuODgxOTZDMTUuMTY4MiAyLjM0Njk0IDE1LjcxMyAyLjAyNDI2IDE2LjI0OCAyLjE2MTI1QzE3LjMyMzYgMi40MzY2MyAxOC4yNzY4IDMuMDYyMTMgMTguOTU3NiAzLjkzOTE0QzE5LjYzODMgNC44MTYxNSAyMC4wMDc4IDUuODk0NzkgMjAuMDA3OCA3LjAwNUMyMC4wMDc4IDguMTE1MjEgMTkuNjM4MyA5LjE5Mzg1IDE4Ljk1NzYgMTAuMDcwOUMxOC4yNzY4IDEwLjk0NzkgMTcuMzIzNiAxMS41NzM0IDE2LjI0OCAxMS44NDg4QzE1LjcxMyAxMS45ODU3IDE1LjE2ODIgMTEuNjYzMSAxNS4wMzEyIDExLjEyOEMxNC44OTQzIDEwLjU5MyAxNS4yMTY5IDEwLjA0ODIgMTUuNzUyIDkuOTExMjVDMTYuMzk3MyA5Ljc0NjAzIDE2Ljk2OTIgOS4zNzA3MyAxNy4zNzc3IDguODQ0NTJDMTcuNzg2MSA4LjMxODMxIDE4LjAwNzggNy42NzExMyAxOC4wMDc4IDcuMDA1QzE4LjAwNzggNi4zMzg4NyAxNy43ODYxIDUuNjkxNjkgMTcuMzc3NyA1LjE2NTQ4QzE2Ljk2OTIgNC42MzkyOCAxNi4zOTczIDQuMjYzOTggMTUuNzUyIDQuMDk4NzVDMTUuMjE2OSAzLjk2MTc2IDE0Ljg5NDMgMy40MTY5OSAxNS4wMzEyIDIuODgxOTZaXFxcIiBmaWxsPVxcXCIjQjVDMEQwXFxcIi8+XFxuPC9zdmc+XFxuXCI7IiwiZXhwb3J0IGRlZmF1bHQgXCI8c3ZnIHhtbG5zPVxcXCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1xcXCIgd2lkdGg9XFxcIjI0XFxcIiBoZWlnaHQ9XFxcIjI0XFxcIiB2aWV3Qm94PVxcXCIwIDAgMjQgMjRcXFwiIGZpbGw9XFxcIm5vbmVcXFwiIHN0cm9rZT1cXFwiY3VycmVudENvbG9yXFxcIlxcbiAgc3Ryb2tlLXdpZHRoPVxcXCIyXFxcIiBzdHJva2UtbGluZWNhcD1cXFwicm91bmRcXFwiIHN0cm9rZS1saW5lam9pbj1cXFwicm91bmRcXFwiIGNsYXNzPVxcXCJmZWF0aGVyIGZlYXRoZXItY29ybmVyLXVwLXJpZ2h0IGpwLWljb24zXFxcIj5cXG4gIDxwb2x5bGluZSBwb2ludHM9XFxcIjE1IDE0IDIwIDkgMTUgNFxcXCI+PC9wb2x5bGluZT5cXG4gIDxwYXRoIGQ9XFxcIk00IDIwdi03YTQgNCAwIDAgMSA0LTRoMTJcXFwiPjwvcGF0aD5cXG48L3N2Zz5cIjsiLCJpbXBvcnQgRmlyZWJhc2UgZnJvbSAnZmlyZWJhc2UvYXBwJztcbmV4cG9ydCBjb25zdCBUSEVNRVNfTUFQID0gT2JqZWN0LmZyZWV6ZSh7XG4gICAgZGFyazogJ0p1cHl0ZXJMYWIgRGFyaycsXG4gICAgbGlnaHQ6ICdKdXB5dGVyTGFiIExpZ2h0J1xufSk7XG4vKipcbiAqIEZpcmViYXNlIHNwZWNpZmljIGhlbHBlcnNcbiAqL1xuLy8gVE9ETzogY2F0Y2ggdGhlIGVycm9yXG5leHBvcnQgZnVuY3Rpb24gaW5pdGlhbGl6ZUFwcChmaXJlYmFzZUNvbmZpZykge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcbiAgICAgICAgY29uc3QgaW5pdCA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vIFdlIG5lZWQgdG8gcmVxdWlyZSBhdXRoIGFmdGVyIHNldHRpbmcgdGhlIHdpbmRvdyB2YXJpYWJsZXMuXG4gICAgICAgICAgICBhd2FpdCBpbXBvcnQoJ2ZpcmViYXNlL2F1dGgnKTtcbiAgICAgICAgICAgIGF3YWl0IGltcG9ydCgnZmlyZWJhc2UvZGF0YWJhc2UnKTtcbiAgICAgICAgICAgIEZpcmViYXNlLmluaXRpYWxpemVBcHAoZmlyZWJhc2VDb25maWcpO1xuICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICB9O1xuICAgICAgICBpZiAoZmlyZWJhc2VDb25maWcuYWthbWFpUHJveHlGaXJlYmFzZSkge1xuICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9iYW4tdHMtY29tbWVudFxuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgd2luZG93LmZiUHJveHlVcmwgPSBmaXJlYmFzZUNvbmZpZy5ha2FtYWlQcm94eUVuZHBvaW50O1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGZpcmViYXNlQ29uZmlnLnByb3h5RmlyZWJhc2UpIHtcbiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvYmFuLXRzLWNvbW1lbnRcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgIHdpbmRvdy5mYlByb3h5VXJsID0gZmlyZWJhc2VDb25maWcuZmJQcm94eUVuZHBvaW50O1xuICAgICAgICB9XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvYmFuLXRzLWNvbW1lbnRcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICBpZiAod2luZG93LmZiUHJveHlVcmwpIHtcbiAgICAgICAgICAgIC8vIEZJWE1FOiBUaGUgdmFyaWFibGUgbmFtZSBpcyBjaGFuZ2VkIHRvIG5jIGFmdGVyIHRyYW5zcGlsaW5nLlxuICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9iYW4tdHMtY29tbWVudFxuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgd2luZG93Lm5jID0gYGh0dHBzOi8vJHt3aW5kb3cuZmJQcm94eVVybH0vaWRlbnRpdHl0b29sa2l0L3YzL3JlbHlpbmdwYXJ0eS9gO1xuICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9iYW4tdHMtY29tbWVudFxuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgZmlyZWJhc2VDb25maWcuZGF0YWJhc2VVUkwgPSBgaHR0cHM6Ly8ke3dpbmRvdy5mYlByb3h5VXJsfS8/bnM9JHtmaXJlYmFzZUNvbmZpZy5kYXRhYmFzZU5hbWV9YDtcbiAgICAgICAgfVxuICAgICAgICB2b2lkIGluaXQoKTtcbiAgICB9KTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBvcGVuRmlsZShjb21tYW5kc1JlZ2lzdHJ5LCBwYXRoLCB3aWRnZXRUeXBlLCBhY3RpdmF0ZSA9IGZhbHNlKSB7XG4gICAgaWYgKHdpZGdldFR5cGUgPT09ICdkb2N1bWVudCcpIHtcbiAgICAgICAgcmV0dXJuIGNvbW1hbmRzUmVnaXN0cnkuZXhlY3V0ZSgnZG9jbWFuYWdlcjpvcGVuJywge1xuICAgICAgICAgICAgcGF0aCxcbiAgICAgICAgICAgIG9wdGlvbnM6IHsgYWN0aXZhdGUgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgZWxzZSBpZiAod2lkZ2V0VHlwZSA9PT0gJ2NvbnNvbGUnKSB7XG4gICAgICAgIHJldHVybiBjb21tYW5kc1JlZ2lzdHJ5LmV4ZWN1dGUoJ2NvbnNvbGU6b3BlbicsIHsgcGF0aCwgYWN0aXZhdGUgfSk7XG4gICAgfVxuICAgIGVsc2UgaWYgKHdpZGdldFR5cGUgPT09ICd0ZXJtaW5hbCcpIHtcbiAgICAgICAgcmV0dXJuIGNvbW1hbmRzUmVnaXN0cnkuZXhlY3V0ZSgndGVybWluYWw6b3BlbicsIHsgbmFtZTogcGF0aCwgYWN0aXZhdGUgfSk7XG4gICAgfVxuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbn1cbi8vIFRPRE86IGNhdGNoIHRoZSBlcnJvclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGZpcmViYXNlTG9naW4oZmlyZWJhc2VUb2tlbikge1xuICAgIC8qKlxuICAgICBJZiBjYW5kaWRhdGUvaW50ZXJ2aWV3ZXIgaXMgbm90IGxvZ2dlZCBpbiwgbm8gbmVlZCB0byBnaXZlIG9wZW5cbiAgICAgYWNjZXNzIHRvIGZpcmViYXNlXG4gICAgICovXG4gICAgaWYgKCFmaXJlYmFzZVRva2VuKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gRmlyZWJhc2UgVG9rZW4gRm91bmQnKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVhZCBtb3JlIGFib3V0IHN1cHBvcnRpbmcgbXVsdGlwbGUgYnJvd3NlciB0YWJzIGxvZ2dlZGluIHdpdGggZGlmZmVyZW50IHVzZXJcbiAgICAgKiBMaW5rOiBodHRwczovL2ZpcmViYXNlLmdvb2dsZS5jb20vZG9jcy9hdXRoL3dlYi9hdXRoLXN0YXRlLXBlcnNpc3RlbmNlXG4gICAgICovXG4gICAgYXdhaXQgRmlyZWJhc2UuYXV0aCgpLnNldFBlcnNpc3RlbmNlKEZpcmViYXNlLmF1dGguQXV0aC5QZXJzaXN0ZW5jZS5TRVNTSU9OKTtcbiAgICByZXR1cm4gRmlyZWJhc2UuYXV0aCgpLnNpZ25JbldpdGhDdXN0b21Ub2tlbihmaXJlYmFzZVRva2VuKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBnZXRJbnRlcnZpZXdCYXNlUmVmKHNsdWcpIHtcbiAgICByZXR1cm4gYCR7c2x1Z30vYDtcbn1cbmV4cG9ydCBmdW5jdGlvbiBnZXRRdWVzdGlvbkJhc2VSZWYoc2x1ZywgcXVlc3Rpb25JZCkge1xuICAgIHJldHVybiBgJHtzbHVnfS8ke3F1ZXN0aW9uSWR9L2A7XG59XG5leHBvcnQgZnVuY3Rpb24gZ2V0UXVlc3Rpb25Db2xsYWJvcmF0b3JzUmVmKHNsdWcsIHVzZXJJZCkge1xuICAgIHJldHVybiBgJHtnZXRJbnRlcnZpZXdCYXNlUmVmKHNsdWcpfWluZGljYXRvcnMvJHt1c2VySWR9YDtcbn1cbmV4cG9ydCBmdW5jdGlvbiBnZXRBbGxRdWVzdGlvbkNvbGxhYm9yYXRvcnNSZWYoc2x1Zykge1xuICAgIHJldHVybiBnZXRRdWVzdGlvbkNvbGxhYm9yYXRvcnNSZWYoc2x1ZywgJycpO1xufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y29kZXBhaXItdXRpbC5qcy5tYXAiLCJpbXBvcnQgZmlyZWJhc2UgZnJvbSAnZmlyZWJhc2UnO1xuaW1wb3J0IHsgZmlyZWJhc2VMb2dpbiwgZ2V0QWxsUXVlc3Rpb25Db2xsYWJvcmF0b3JzUmVmLCBnZXRRdWVzdGlvbkNvbGxhYm9yYXRvcnNSZWYsIGluaXRpYWxpemVBcHAgfSBmcm9tICcuL2NvZGVwYWlyLXV0aWwnO1xuaW1wb3J0IHsgZ2V0V2lkZ2V0SW5mbywgSW50ZXJ2aWV3U3RhdGUsIFVzZXJJbmRpY2F0b3JTdGF0ZSB9IGZyb20gJ0BoYWNrZXJyYW5rL2p1cHl0ZXJsYWItY29sbGFiJztcbmltcG9ydCB7IHNob3dFcnJvck1lc3NhZ2UgfSBmcm9tICdAanVweXRlcmxhYi9hcHB1dGlscyc7XG5pbXBvcnQgeyBEb2N1bWVudFdpZGdldCB9IGZyb20gJ0BqdXB5dGVybGFiL2RvY3JlZ2lzdHJ5Jztcbi8vIFdvbid0IGluc3RhbGwgdHlwZXMgZm9yIGRlYm91bmNlLlxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9iYW4tdHMtY29tbWVudFxuLy8gQHRzLWlnbm9yZVxuaW1wb3J0IGRlYm91bmNlIGZyb20gXCJsb2Rhc2guZGVib3VuY2VcIjtcbmltcG9ydCB7IGVhY2ggfSBmcm9tICdAbHVtaW5vL2FsZ29yaXRobSc7XG5pbXBvcnQgZnVsbHN0b3J5TG9nZ2VyIGZyb20gJy4vZnVsbHN0b3J5LWxvZ2dlcic7XG5leHBvcnQgZGVmYXVsdCBjbGFzcyBIYWNrZXJyYW5rQ29sbGFib3JhdGlvbiB7XG4gICAgY29uc3RydWN0b3Ioc2hlbGwpIHtcbiAgICAgICAgdGhpcy5zaGVsbCA9IHNoZWxsO1xuICAgICAgICB0aGlzLmlzUmVhZHkgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5kZWJvdW5jZWRVcGRhdGVQYXRoSW5GaXJlYmFzZSA9IGRlYm91bmNlKHRoaXMudXBkYXRlUGF0aEluRmlyZWJhc2UsIDQwMCk7XG4gICAgICAgIHRoaXMuc2V0dXBGaXJlYmFzZUxpc3RlbmVyID0gKGludGVydmlld1NsdWcpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNvbGxhYlBhdGggPSBnZXRBbGxRdWVzdGlvbkNvbGxhYm9yYXRvcnNSZWYoaW50ZXJ2aWV3U2x1Zyk7XG4gICAgICAgICAgICBjb25zdCB1c2Vyc1JlZiA9IGZpcmViYXNlLmRhdGFiYXNlKCkucmVmKGNvbGxhYlBhdGgpO1xuICAgICAgICAgICAgdXNlcnNSZWYub24oJ2NoaWxkX2FkZGVkJywgdGhpcy5oYW5kbGVVc2VySW5kaWNhdG9yQ2hhbmdlKTtcbiAgICAgICAgICAgIHVzZXJzUmVmLm9uKCdjaGlsZF9jaGFuZ2VkJywgdGhpcy5oYW5kbGVVc2VySW5kaWNhdG9yQ2hhbmdlKTtcbiAgICAgICAgICAgIHVzZXJzUmVmLm9uKCdjaGlsZF9yZW1vdmVkJywgdGhpcy5oYW5kbGVVc2VySW5kaWNhdG9yUmVtb3ZlKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5oYW5kbGVVc2VySW5kaWNhdG9yQ2hhbmdlID0gKGNoaWxkU25hcCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgdXNlcklkID0gY2hpbGRTbmFwLmtleTtcbiAgICAgICAgICAgIGNvbnN0IGluZGljYXRvckRhdGEgPSBjaGlsZFNuYXAudmFsKCk7XG4gICAgICAgICAgICBVc2VySW5kaWNhdG9yU3RhdGUuc2V0KHVzZXJJZCwgaW5kaWNhdG9yRGF0YSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGFuZGxlVXNlckluZGljYXRvclJlbW92ZSA9IChjaGlsZFNuYXApID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHVzZXJJZCA9IGNoaWxkU25hcC5rZXk7XG4gICAgICAgICAgICBVc2VySW5kaWNhdG9yU3RhdGUuZGVsZXRlKHVzZXJJZCk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIGFzeW5jIGluaXRpYWxpemUob3B0aW9ucykge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgICAgICAgICAgIGF3YWl0IGluaXRpYWxpemVBcHAob3B0aW9ucy5maXJlYmFzZUNvbmZpZyk7XG4gICAgICAgICAgICBhd2FpdCBmaXJlYmFzZUxvZ2luKG9wdGlvbnMuZmlyZWJhc2VUb2tlbik7XG4gICAgICAgICAgICB0aGlzLnNldHVwRmlyZWJhc2VMaXN0ZW5lcihvcHRpb25zLmludGVydmlld1NsdWcpO1xuICAgICAgICAgICAgdGhpcy5zZXRJbnRlcnZpZXdJbmZvKHtcbiAgICAgICAgICAgICAgICB1c2VySWQ6IG9wdGlvbnMudXNlcklkLFxuICAgICAgICAgICAgICAgIHVzZXJDb2xvcjogb3B0aW9ucy51c2VyQ29sb3IsXG4gICAgICAgICAgICAgICAgdXNlck5hbWU6IG9wdGlvbnMudXNlck5hbWUsXG4gICAgICAgICAgICAgICAgaW50ZXJ2aWV3U2x1Zzogb3B0aW9ucy5pbnRlcnZpZXdTbHVnLFxuICAgICAgICAgICAgICAgIHF1ZXN0aW9uSWQ6IG9wdGlvbnMucXVlc3Rpb25JZFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUN1cnJlbnRGaWxlcygpO1xuICAgICAgICAgICAgdGhpcy5zdGFydFdhdGNoaW5nRmlsZXMoKTtcbiAgICAgICAgICAgIHRoaXMuaXNSZWFkeSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgZnVsbHN0b3J5TG9nZ2VyLmVycm9yKFwiQ291bGRuJ3Qgc2V0dXAgY29sbGFib3JhdGlvblwiLCBPYmplY3QuYXNzaWduKHsgZXJyTmFtZTogZXJyLm5hbWUsIGVyck1zZzogZXJyLm1lc3NhZ2UsIGVyclN0YWNrOiBlcnIuc3RhY2sgfSwgb3B0aW9ucykpO1xuICAgICAgICAgICAgdm9pZCBzaG93RXJyb3JNZXNzYWdlKFwiQ291bGRuJ3Qgc2V0dXAgY29sbGFib3JhdGlvblwiLCBcIllvdSdsbCBzdGlsbCBiZSBhYmxlIHRvIHNlZSBjaGFuZ2VzIG1hZGUgb24gdGhlIGRvY3VtZW50LCBidXQgc29tZSBmZWF0dXJlcyBtYXkgbm90IHdvcmsuIFBsZWFzZSByZWZyZXNoIHRoZSBwYWdlIHRvIHRyeSBhZ2Fpbi5cIik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgdXBkYXRlVXNlcih1c2VyKSB7XG4gICAgICAgIGlmICghdGhpcy5pc1JlYWR5KVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBJbnRlcnZpZXdTdGF0ZS5zZXQoXCJ1c2VySWRcIiwgdXNlci51c2VySWQpO1xuICAgICAgICBJbnRlcnZpZXdTdGF0ZS5zZXQoXCJ1c2VyQ29sb3JcIiwgdXNlci51c2VyQ29sb3IpO1xuICAgICAgICBJbnRlcnZpZXdTdGF0ZS5zZXQoXCJ1c2VyTmFtZVwiLCB1c2VyLnVzZXJOYW1lKTtcbiAgICAgICAgVXNlckluZGljYXRvclN0YXRlLnNldCh1c2VyLnVzZXJJZCwgT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBVc2VySW5kaWNhdG9yU3RhdGUuZ2V0KHVzZXIudXNlcklkKSksIHsgc2NyZWVubmFtZTogdXNlci51c2VyTmFtZSwgY29sb3I6IHVzZXIudXNlckNvbG9yIH0pKTtcbiAgICAgICAgdGhpcy51cGRhdGVDdXJyZW50RmlsZXMoKTtcbiAgICB9XG4gICAgdXBkYXRlUGF0aEluRmlyZWJhc2UocGF0aCwgd2lkZ2V0VHlwZSkge1xuICAgICAgICBpZiAoIXRoaXMuaXNSZWFkeSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgY29uc3QgaGFzaCA9IGdldFF1ZXN0aW9uQ29sbGFib3JhdG9yc1JlZih0aGlzLm9wdGlvbnMuaW50ZXJ2aWV3U2x1ZywgdGhpcy5vcHRpb25zLnVzZXJJZCk7XG4gICAgICAgIHZvaWQgZmlyZWJhc2UuZGF0YWJhc2UoKS5yZWYoaGFzaCkudXBkYXRlKHtcbiAgICAgICAgICAgIGZpbGVQYXRoOiBwYXRoLFxuICAgICAgICAgICAgd2lkZ2V0VHlwZSxcbiAgICAgICAgICAgIGNvbG9yOiB0aGlzLm9wdGlvbnMudXNlckNvbG9yXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBzZXRJbnRlcnZpZXdJbmZvKGludGVydmlld0luZm8pIHtcbiAgICAgICAgT2JqZWN0LmtleXMoaW50ZXJ2aWV3SW5mbykuZm9yRWFjaChrZXkgPT4ge1xuICAgICAgICAgICAgSW50ZXJ2aWV3U3RhdGUuc2V0KGtleSwgaW50ZXJ2aWV3SW5mb1trZXldKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdXBkYXRlQ3VycmVudEZpbGVzKCkge1xuICAgICAgICBjb25zdCB1c2VyTmFtZSA9IEludGVydmlld1N0YXRlLmdldChcInVzZXJOYW1lXCIpO1xuICAgICAgICBjb25zdCB1c2VyQ29sb3IgPSBJbnRlcnZpZXdTdGF0ZS5nZXQoXCJ1c2VyQ29sb3JcIik7XG4gICAgICAgIGVhY2godGhpcy5zaGVsbC53aWRnZXRzKFwibWFpblwiKSwgKHdpZGdldCkgPT4ge1xuICAgICAgICAgICAgaWYgKCEod2lkZ2V0IGluc3RhbmNlb2YgRG9jdW1lbnRXaWRnZXQpKVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIGNvbnN0IHNoYXJlZE1vZGVsID0gd2lkZ2V0LmNvbnRleHQubW9kZWwuc2hhcmVkTW9kZWw7XG4gICAgICAgICAgICBpZiAoIXNoYXJlZE1vZGVsKVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIGNvbnN0IGF3YXJlbmVzcyA9IHNoYXJlZE1vZGVsLmF3YXJlbmVzcztcbiAgICAgICAgICAgIGF3YXJlbmVzcy5zZXRMb2NhbFN0YXRlRmllbGQoJ3VzZXInLCB7XG4gICAgICAgICAgICAgICAgbmFtZTogdXNlck5hbWUsXG4gICAgICAgICAgICAgICAgY29sb3I6IHVzZXJDb2xvclxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBvbkFjdGl2ZUNoYW5nZWQod2lkZ2V0KSB7XG4gICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgIGNvbnN0IHsgcGF0aCwgd2lkZ2V0VHlwZSB9ID0gZ2V0V2lkZ2V0SW5mbyh3aWRnZXQpO1xuICAgICAgICB0aGlzLmRlYm91bmNlZFVwZGF0ZVBhdGhJbkZpcmViYXNlKHBhdGgsIHdpZGdldFR5cGUpO1xuICAgICAgICBpZiAod2lkZ2V0IGluc3RhbmNlb2YgRG9jdW1lbnRXaWRnZXQpIHtcbiAgICAgICAgICAgIGNvbnN0IG1vZGVsID0gd2lkZ2V0LmNvbnRleHQubW9kZWw7XG4gICAgICAgICAgICBpZiAobW9kZWwuc2hhcmVkTW9kZWwpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBzaGFyZWRNb2RlbCA9IG1vZGVsLnNoYXJlZE1vZGVsO1xuICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJTdGF0ZSA9IHNoYXJlZE1vZGVsLmF3YXJlbmVzcy5nZXRMb2NhbFN0YXRlKCk7XG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogT25seSBzZXQgaWYgbmFtZSBpcyBhbm9uLiBJZiBuYW1lIGlzIGFueXRoaW5nIG90aGVyXG4gICAgICAgICAgICAgICAgICogdGhhbiB0aGUgbGF0ZXN0IHZhbHVlIHRoYXQgd2UgaGF2ZSBvbiBzdGF0ZSwgY2hhbmdlIGl0LlxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIGNvbnN0IHVzZXJJZCA9IEludGVydmlld1N0YXRlLmdldChcInVzZXJJZFwiKTtcbiAgICAgICAgICAgICAgICBpZiAoIXVzZXJJZClcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIGNvbnN0IHVzZXJOYW1lID0gSW50ZXJ2aWV3U3RhdGUuZ2V0KFwidXNlck5hbWVcIik7XG4gICAgICAgICAgICAgICAgY29uc3QgdXNlckNvbG9yID0gSW50ZXJ2aWV3U3RhdGUuZ2V0KFwidXNlckNvbG9yXCIpO1xuICAgICAgICAgICAgICAgIGlmIChjdXJyU3RhdGUgJiYgKCgoX2EgPSBjdXJyU3RhdGUudXNlcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLm5hbWUpICE9IHVzZXJOYW1lIHx8ICgoX2IgPSBjdXJyU3RhdGUudXNlcikgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmNvbG9yKSAhPSB1c2VyQ29sb3IpKSB7XG4gICAgICAgICAgICAgICAgICAgIHNoYXJlZE1vZGVsLmF3YXJlbmVzcy5zZXRMb2NhbFN0YXRlRmllbGQoJ3VzZXInLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiB1c2VyTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiB1c2VyQ29sb3JcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHN0YXJ0V2F0Y2hpbmdGaWxlcygpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFVzaW5nIGJvdGggYWN0aXZlIGFuZCBjdXJyZW50IGNoYW5nZSBldmVudHMgYmVjYXVzZVxuICAgICAgICAgKiAxLiBhY3RpdmVDaGFuZ2VkIGRvZXNuJ3QgZ2V0IHRyaWdnZXJlZCB3aGVuIGEgd2lkZ2V0IGlzIGNsb3NlZC4gSWRlYWxseSxcbiAgICAgICAgICogd2hlbiBhIHdpZGdldCBpcyBjbG9zZWQgYW5kIHRoZSBmb2N1cyBpc24ndCBtb3ZlZCB0byBuZXh0IHdpZGdldCwgdGhlblxuICAgICAgICAgKiBhY3RpdmVDaGFuZ2VkIHNob3VsZCd2ZSBiZWVuIGNhbGxlZCB3aXRoIG5ld1ZhbHVlID0gbnVsbC5cbiAgICAgICAgICogMi4gY3VycmVudENoYW5nZWQgb25seSBnaXZlcyBpbmZvIGFib3V0IHRoZSBjdXJyZW50IHdpZGdldC4gSXQncyB0cnVlIHRoYXRcbiAgICAgICAgICogY3VycmVudENoYW5nZWQgYWx3YXlzIHByZWNlZGVzIGFjdGl2ZUNoYW5nZWQgYXMgd2lkZ2V0IGlzIG1hZGUgY3VycmVudCBmaXJzdFxuICAgICAgICAgKiBiZWZvcmUgaXQncyBtYWRlIGFjdGl2ZS4gU28sIGl0IGNvdWxkJ3ZlIGJlZW4gdXNlZCBhcyBhIHByb3h5IGZvciBhY3RpdmVDaGFuZ2VkLlxuICAgICAgICAgKiBIb3dldmVyLCBjdXJyZW50Q2hhbmdlZCBhbHNvIGRvZXNuJ3QgZ2V0IGNhbGxlZCB3aGVuIHRoZSB1c2VyIGRpcmVjdGx5IGNsaWNrcyBvblxuICAgICAgICAgKiBhIHdpZGdldCB3aXRob3V0IGNsaWNraW5nIGFueXdoZXJlIGluIHRoZSBJREUuXG4gICAgICAgICAqIExpc3RlbmluZyB0byBib3RoIHRoZXNlIGV2ZW50cyBhbmQgdGFraW5nIG9ubHkgYWN0aXZlV2lkZ2V0IGZyb20gc2hlbGwgZW5zdXJlc1xuICAgICAgICAgKiB0aGF0IHdlJ3JlIGd1YXJkZWQgYWdhaW5zdCB0aGUgc2hvcnRjb21pbmdzIG9mIGJvdGggdGhlc2UgZXZlbnRzLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zaGVsbC5hY3RpdmVDaGFuZ2VkLmNvbm5lY3QoKHNlbmRlciwgYXJncykgPT4ge1xuICAgICAgICAgICAgdGhpcy5vbkFjdGl2ZUNoYW5nZWQodGhpcy5zaGVsbC5hY3RpdmVXaWRnZXQpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5zaGVsbC5jdXJyZW50Q2hhbmdlZC5jb25uZWN0KChzZW5kZXIsIGFyZ3MpID0+IHtcbiAgICAgICAgICAgIHRoaXMub25BY3RpdmVDaGFuZ2VkKHRoaXMuc2hlbGwuYWN0aXZlV2lkZ2V0KTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y29sbGFiLmpzLm1hcCIsImNsYXNzIEZ1bGxTdG9yeUxvZ2dlciB7XG4gICAgbG9nKG1lc3NhZ2UsIGRhdGEgPSB7fSkge1xuICAgICAgICB0aGlzLmxvZ0Z1bGxTdG9yeSgnbG9nJywgbWVzc2FnZSwgZGF0YSk7XG4gICAgICAgIGNvbnNvbGUubG9nKG1lc3NhZ2UsIGRhdGEpO1xuICAgIH1cbiAgICBpbmZvKG1lc3NhZ2UsIGRhdGEgPSB7fSkge1xuICAgICAgICB0aGlzLmxvZ0Z1bGxTdG9yeSgnaW5mbycsIG1lc3NhZ2UsIGRhdGEpO1xuICAgICAgICBjb25zb2xlLmluZm8obWVzc2FnZSwgZGF0YSk7XG4gICAgfVxuICAgIHdhcm4obWVzc2FnZSwgZGF0YSA9IHt9KSB7XG4gICAgICAgIHRoaXMubG9nRnVsbFN0b3J5KCd3YXJuJywgbWVzc2FnZSwgZGF0YSk7XG4gICAgICAgIGNvbnNvbGUud2FybihtZXNzYWdlLCBkYXRhKTtcbiAgICB9XG4gICAgZXJyb3IobWVzc2FnZSwgZGF0YSA9IHt9KSB7XG4gICAgICAgIHRoaXMubG9nRnVsbFN0b3J5KCdlcnJvcicsIG1lc3NhZ2UsIGRhdGEpO1xuICAgICAgICBjb25zb2xlLmVycm9yKG1lc3NhZ2UsIGRhdGEpO1xuICAgIH1cbiAgICBsb2dGdWxsU3RvcnkodHlwZSwgbWVzc2FnZSwgZGF0YSA9IHt9KSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmICghdGhpcy5fZnNJbnN0YW5jZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2ZzSW5zdGFuY2UgPSB0aGlzLmdldEZTSW5zdGFuY2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIChfYSA9IHRoaXMuX2ZzSW5zdGFuY2UpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5ldmVudChgVGhlaWEgKCR7dHlwZX0pOiR7bWVzc2FnZX0gYCwgZGF0YSk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHdoaWxlIGxvZ2dpbmcgZnVsbHN0b3J5IGV2ZW50Jywge1xuICAgICAgICAgICAgICAgIG1lc3NhZ2UsXG4gICAgICAgICAgICAgICAgZGF0YSxcbiAgICAgICAgICAgICAgICBlLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0RlNJbnN0YW5jZSgpIHtcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9iYW4tdHMtY29tbWVudFxuICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgIGNvbnN0IGZzTmFtZXNwYWNlID0gd2luZG93WydfZnNfbmFtZXNwYWNlJ107XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvYmFuLXRzLWNvbW1lbnRcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICBjb25zdCBmc01vZHVsZSA9IHdpbmRvd1tmc05hbWVzcGFjZV07XG4gICAgICAgIGlmICh0eXBlb2YgZnNNb2R1bGUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIHJldHVybiBmc01vZHVsZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cbn1cbmV4cG9ydCBkZWZhdWx0IG5ldyBGdWxsU3RvcnlMb2dnZXIoKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWZ1bGxzdG9yeS1sb2dnZXIuanMubWFwIiwiaW1wb3J0IHsgb3BlbkZpbGUsIFRIRU1FU19NQVAgfSBmcm9tICcuL2NvZGVwYWlyLXV0aWwnO1xuaW1wb3J0IEhhY2tlcnJhbmtDb2xsYWJvcmF0aW9uIGZyb20gJy4vY29sbGFiJztcbmltcG9ydCB7IHNob3dFcnJvck1lc3NhZ2UgfSBmcm9tICdAanVweXRlcmxhYi9hcHB1dGlscyc7XG5pbXBvcnQgZnVsbHN0b3J5TG9nZ2VyIGZyb20gJy4vZnVsbHN0b3J5LWxvZ2dlcic7XG5pbXBvcnQgUGFydGljaXBhbnRzTGlzdFdpZGdldCBmcm9tICcuL3BhcnRpY2lwYW50cy1saXN0JztcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIElmcmFtZUNvbW11bmljYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKHNoZWxsLCBjb21tYW5kc1JlZ2lzdHJ5KSB7XG4gICAgICAgIHRoaXMuc2hlbGwgPSBzaGVsbDtcbiAgICAgICAgdGhpcy5jb21tYW5kc1JlZ2lzdHJ5ID0gY29tbWFuZHNSZWdpc3RyeTtcbiAgICAgICAgdGhpcy5oYXNGb2N1cyA9IGZhbHNlO1xuICAgICAgICB0aGlzLnBpbmdJbnRlcnZhbCA9IDA7IC8vIGRlZmF1bHQgNSBzZWNvbmRzIHBpbmdcbiAgICAgICAgdGhpcy5oYW5kbGVQYXJlbnRNZXNzYWdlID0gKGUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgZGF0YSB9ID0gZTtcbiAgICAgICAgICAgIHN3aXRjaCAoZGF0YS5tZXNzYWdlVHlwZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgJ2NvZGVwYWlyJzoge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB7IGZpcmViYXNlQ29uZmlnLCB1c2VyQ29sb3IsIHVzZXJJZCwgaW50ZXJ2aWV3U2x1ZywgcXVlc3Rpb25JZCwgZmlyZWJhc2VUb2tlbiwgdXNlck5hbWUsIHRoZW1lLCBwaW5nSW50ZXJ2YWwsIHBlbmRvVmlzaXRvcklkLCBwZW5kb0FjY291bnRJZCwgaXNTa2Fkb29zaCwgaXNBZG1pbiwgdXNlckVtYWlsIH0gPSBkYXRhO1xuICAgICAgICAgICAgICAgICAgICBmdWxsc3RvcnlMb2dnZXIubG9nKCdDb2xsYWIgY29uZmlnIHNldHVwJywge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmlyZWJhc2VDb25maWcsXG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VyQ29sb3IsXG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VyRW1haWwsXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnRlcnZpZXdTbHVnLFxuICAgICAgICAgICAgICAgICAgICAgICAgcXVlc3Rpb25JZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmViYXNlVG9rZW4sXG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VyTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBpbmdJbnRlcnZhbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBlbmRvVmlzaXRvcklkLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGVuZG9BY2NvdW50SWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBpc1NrYWRvb3NoLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNBZG1pbixcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoZW1lLFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICAgICAqIFRPRE86IFJlbW92ZSB0aGlzIGFmdGVyIGlmcmFtZSBjb21tdW5pY2F0aW9uXG4gICAgICAgICAgICAgICAgICAgICAqIGxpYnJhcnkgaXMgaW50ZWdyYXRlZC5cbiAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L2Jhbi10cy1jb21tZW50XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LnBlbmRvICYmICFpc1NrYWRvb3NoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBlbmRvVmlzaXRvcklkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvYmFuLXRzLWNvbW1lbnRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cucGVuZG8uaW5pdGlhbGl6ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aXNpdG9yOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHBlbmRvVmlzaXRvcklkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtYWlsOiB1c2VyRW1haWwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNKdXB5dGVybGFiSURFOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjb3VudDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBwZW5kb0FjY291bnRJZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICghaXNBZG1pbiAmJiB1c2VyRW1haWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9iYW4tdHMtY29tbWVudFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5wZW5kby5pbml0aWFsaXplKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpc2l0b3I6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogdXNlckVtYWlsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtYWlsOiB1c2VyRW1haWwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNKdXB5dGVybGFiSURFOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjb3VudDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGxzdG9yeUxvZ2dlci5lcnJvcignUGVuZG8gaW5pdGlhbGl6YXRpb24gZmFpbGVkJywge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGVyci5tZXNzYWdlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrOiBlcnIuc3RhY2ssXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvLyB0aGVtZSBjYW4gYmUgJ2RhcmsnLCAnbGlnaHQnXG4gICAgICAgICAgICAgICAgICAgIHZvaWQgdGhpcy5jaGFuZ2VUaGVtZSh0aGVtZSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29sbGFiSW5zdCA9IG5ldyBIYWNrZXJyYW5rQ29sbGFib3JhdGlvbih0aGlzLnNoZWxsKTtcbiAgICAgICAgICAgICAgICAgICAgdm9pZCB0aGlzLmNvbGxhYkluc3QuaW5pdGlhbGl6ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaXJlYmFzZUNvbmZpZyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmViYXNlVG9rZW4sXG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VyTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXN0aW9uSWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnRlcnZpZXdTbHVnLFxuICAgICAgICAgICAgICAgICAgICAgICAgdXNlcklkLFxuICAgICAgICAgICAgICAgICAgICAgICAgdXNlckNvbG9yXG4gICAgICAgICAgICAgICAgICAgIH0pLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcGFydGljaXBhbnRzTGlzdFdpZGdldCA9IG5ldyBQYXJ0aWNpcGFudHNMaXN0V2lkZ2V0KHRoaXMuY29tbWFuZHNSZWdpc3RyeSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNoZWxsLmFkZChwYXJ0aWNpcGFudHNMaXN0V2lkZ2V0LCBcImxlZnRcIiwgeyByYW5rOiAzMDAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBpZiAocGluZ0ludGVydmFsID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5waW5nSW50ZXJ2YWwgPSBwaW5nSW50ZXJ2YWw7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldHVwUGluZ1RvUGFyZW50KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhc2UgJ2p1bXBfdG9fY3Vyc29yJzoge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB7IGZpbGVQYXRoLCB3aWRnZXRUeXBlIH0gPSBkYXRhO1xuICAgICAgICAgICAgICAgICAgICBvcGVuRmlsZSh0aGlzLmNvbW1hbmRzUmVnaXN0cnksIGZpbGVQYXRoLCB3aWRnZXRUeXBlLCB0cnVlKS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmdWxsc3RvcnlMb2dnZXIuZXJyb3IoXCJDb3VsZG4ndCBqdW1wIHRvIGN1cnNvclwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyTmFtZTogZXJyLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyTXNnOiBlcnIubWVzc2FnZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJTdGFjazogZXJyLnN0YWNrLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVQYXRoOiBmaWxlUGF0aCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWRnZXRUeXBlOiB3aWRnZXRUeXBlXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzaG93RXJyb3JNZXNzYWdlKFwiQ291bGQndCBvcGVuIGZpbGVcIiwgXCJXZSBlbmNvdW50ZXJlZCBhbiBlcnJvciB3aGlsZSBqdW1waW5nIHRvIHRoZSB1c2VyJ3MgY3VycmVudCBwb3NpdGlvbi4gUGxlYXNlIHJlZnJlc2ggdGhlIHBhZ2UgdG8gdHJ5IGFnYWluXCIpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhc2UgJ1VTRVIuQ0hBTkdFJzoge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbGxhYkluc3QudXBkYXRlVXNlcihkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhc2UgJ2VjaG8nOiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VuZE1lc3NhZ2VUb1BhcmVudCgnZWNobycsIGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2FzZSAnb3Blbl9maWxlX2luX2JnJzoge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB7IGZpbGVQYXRoLCB3aWRnZXRUeXBlIH0gPSBkYXRhO1xuICAgICAgICAgICAgICAgICAgICBvcGVuRmlsZSh0aGlzLmNvbW1hbmRzUmVnaXN0cnksIGZpbGVQYXRoLCB3aWRnZXRUeXBlLCBmYWxzZSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZnVsbHN0b3J5TG9nZ2VyLmVycm9yKFwiQ291bGRuJ3Qgb3BlbiBmaWxlIGluIGJhY2tncm91bmRcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVyck5hbWU6IGVyci5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVyck1zZzogZXJyLm1lc3NhZ2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyU3RhY2s6IGVyci5zdGFja1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2FzZSAnY2hhbmdlX3RoZW1lJzoge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB7IHRoZW1lIH0gPSBkYXRhO1xuICAgICAgICAgICAgICAgICAgICB2b2lkIHRoaXMuY2hhbmdlVGhlbWUodGhlbWUpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuc2V0dXBQaW5nVG9QYXJlbnQgPSAoKSA9PiB7XG4gICAgICAgICAgICBpZiAodGhpcy5oYXNGb2N1cykge1xuICAgICAgICAgICAgICAgIHRoaXMuc2VuZE1lc3NhZ2VUb1BhcmVudCgncGluZycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMucGluZ1RpbWVvdXQpO1xuICAgICAgICAgICAgdGhpcy5waW5nVGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4gdGhpcy5zZXR1cFBpbmdUb1BhcmVudCgpLCB0aGlzLnBpbmdJbnRlcnZhbCk7XG4gICAgICAgIH07XG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdmb2N1cycsICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2VuZE1lc3NhZ2VUb1BhcmVudCgncGluZycpO1xuICAgICAgICAgICAgdGhpcy5zZW5kTWVzc2FnZVRvUGFyZW50KCdldmVudF9mb2N1cycpO1xuICAgICAgICAgICAgdGhpcy5oYXNGb2N1cyA9IHRydWU7XG4gICAgICAgIH0pO1xuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsIGUgPT4ge1xuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgICAgICAgICBpZiAoISgoKF9hID0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnRhZ05hbWUpID09PSAnSUZSQU1FJyB8fFxuICAgICAgICAgICAgICAgICAgICAoKF9iID0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudCkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnRhZ05hbWUpID09PSAnRU1CRUQnIHx8XG4gICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgaW5zdGFuY2VvZiBIVE1MSUZyYW1lRWxlbWVudCB8fFxuICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5hY3RpdmVFbGVtZW50IGluc3RhbmNlb2YgSFRNTEVtYmVkRWxlbWVudCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5oYXNGb2N1cyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbmRNZXNzYWdlVG9QYXJlbnQoJ2V2ZW50X2JsdXInKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY29sbGFiSW5zdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb2xsYWJJbnN0LmRlYm91bmNlZFVwZGF0ZVBhdGhJbkZpcmViYXNlKCcnLCAndW5rbm93bicpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIHRoaXMuaGFuZGxlUGFyZW50TWVzc2FnZSwgZmFsc2UpO1xuICAgICAgICB2b2lkIHNoZWxsLnJlc3RvcmVkLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZW5kTWVzc2FnZVRvUGFyZW50KCdpZGVfcmVhZHknLCB7fSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBjaGFuZ2VUaGVtZSh0aGVtZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb21tYW5kc1JlZ2lzdHJ5LmV4ZWN1dGUoJ2FwcHV0aWxzOmNoYW5nZS10aGVtZScsIHtcbiAgICAgICAgICAgIHRoZW1lOiBUSEVNRVNfTUFQW3RoZW1lXVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgc2VuZE1lc3NhZ2VUb1BhcmVudChtZXNzYWdlVHlwZSwgZGF0YSA9IHt9KSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICB3aW5kb3cucGFyZW50LnBvc3RNZXNzYWdlKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgZGF0YSksIHsgbWVzc2FnZVR5cGUgfSksICcqJyk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgZnVsbHN0b3J5TG9nZ2VyLmVycm9yKFwiQ291bGRuJ3Qgc2VuZCBtZXNzYWdlIHRvIHBhcmVudFwiLCB7XG4gICAgICAgICAgICAgICAgZXJyTmFtZTogZXJyLm5hbWUsXG4gICAgICAgICAgICAgICAgZXJyTXNnOiBlcnIubWVzc2FnZSxcbiAgICAgICAgICAgICAgICBlcnJTdGFjazogZXJyLnN0YWNrLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VUeXBlLFxuICAgICAgICAgICAgICAgIGRhdGFcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aWZyYW1lLWNvbW0uanMubWFwIiwiLy8gQ29weXJpZ2h0IChjKSBKdXB5dGVyIERldmVsb3BtZW50IFRlYW0uXG4vLyBEaXN0cmlidXRlZCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIE1vZGlmaWVkIEJTRCBMaWNlbnNlLlxuLyoqXG4gKiBAcGFja2FnZURvY3VtZW50YXRpb25cbiAqIEBtb2R1bGUganVweXRlcmxhYi1jb2xsYWItZXh0ZW5zaW9uXG4gKi9cbmltcG9ydCB7IElMYWJTaGVsbCB9IGZyb20gJ0BqdXB5dGVybGFiL2FwcGxpY2F0aW9uJztcbmltcG9ydCBJZnJhbWVDb21tdW5pY2F0aW9uIGZyb20gJy4vaWZyYW1lLWNvbW0nO1xuY29uc3QgcGx1Z2luID0ge1xuICAgIGlkOiAnQGhhY2tlcnJhbmsvanVweXRlcmxhYi1jb2xsYWItZXh0ZW5zaW9uOnBsdWdpbicsXG4gICAgYXV0b1N0YXJ0OiB0cnVlLFxuICAgIHJlcXVpcmVzOiBbSUxhYlNoZWxsXSxcbiAgICBhY3RpdmF0ZTogKGFwcCwgc2hlbGwpID0+IHtcbiAgICAgICAgbmV3IElmcmFtZUNvbW11bmljYXRpb24oc2hlbGwsIGFwcC5jb21tYW5kcyk7XG4gICAgfVxufTtcbmV4cG9ydCBkZWZhdWx0IHBsdWdpbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsImltcG9ydCB7IEludGVydmlld1N0YXRlLCBVc2VySW5kaWNhdG9yU3RhdGUgfSBmcm9tICdAaGFja2VycmFuay9qdXB5dGVybGFiLWNvbGxhYic7XG5pbXBvcnQgeyBSZWFjdFdpZGdldCB9IGZyb20gJ0BqdXB5dGVybGFiL2FwcHV0aWxzJztcbmltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IG9wZW5GaWxlIH0gZnJvbSAnLi9jb2RlcGFpci11dGlsJztcbmltcG9ydCBmdWxsc3RvcnlMb2dnZXIgZnJvbSAnLi9mdWxsc3RvcnktbG9nZ2VyJztcbmltcG9ydCB7IHNob3dFcnJvck1lc3NhZ2UgfSBmcm9tICdAanVweXRlcmxhYi9hcHB1dGlscyc7XG5pbXBvcnQgVG9vbHRpcCBmcm9tICcuL3Rvb2x0aXAnO1xuaW1wb3J0IHsgTGFiSWNvbiB9IGZyb20gJ0BqdXB5dGVybGFiL3VpLWNvbXBvbmVudHMnO1xuaW1wb3J0IHVzZXJzU3ZnU3RyIGZyb20gXCIuLi9zdHlsZS9pY29ucy9Vc2Vycy5zdmdcIjtcbmltcG9ydCBjb3JuZXJTdmdTdHIgZnJvbSBcIi4uL3N0eWxlL2ljb25zL2Nvcm5lci11cC1yaWdodC5zdmdcIjtcbmNvbnN0IElOVEVSVklFV0VSX0RFRkFVTFRfTkFNRSA9ICdJbnRlcnZpZXdlcic7XG5jb25zdCBQQVJUSUNJUEFOVFNfTElTVF9DTEFTUyA9ICdwYXJ0aWNpcGFudHMtbGlzdC1jb250YWluZXInO1xuY29uc3QgdXNlcnNJY29uID0gbmV3IExhYkljb24oeyBuYW1lOiAndXNlcnMtaWNvbicsIHN2Z3N0cjogdXNlcnNTdmdTdHIgfSk7XG5jb25zdCBjb3JuZXJJY29uID0gbmV3IExhYkljb24oeyBuYW1lOiAnY29ybmVyLXVwLXJpZ2h0Jywgc3Znc3RyOiBjb3JuZXJTdmdTdHIgfSk7XG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQYXJ0aWNpcGFudHNMaXN0V2lkZ2V0IGV4dGVuZHMgUmVhY3RXaWRnZXQge1xuICAgIGNvbnN0cnVjdG9yKGNvbW1hbmRzUmVnaXN0cnkpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5jb21tYW5kc1JlZ2lzdHJ5ID0gY29tbWFuZHNSZWdpc3RyeTtcbiAgICAgICAgdGhpcy5vcGVuRmlsZSA9IChmaWxlUGF0aCwgd2lkZ2V0VHlwZSkgPT4ge1xuICAgICAgICAgICAgaWYgKCFmaWxlUGF0aClcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBvcGVuRmlsZSh0aGlzLmNvbW1hbmRzUmVnaXN0cnksIGZpbGVQYXRoLCB3aWRnZXRUeXBlLCB0cnVlKS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgZnVsbHN0b3J5TG9nZ2VyLmVycm9yKFwiQ291bGRuJ3QganVtcCB0byBjdXJzb3JcIiwge1xuICAgICAgICAgICAgICAgICAgICBlcnJOYW1lOiBlcnIubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgZXJyTXNnOiBlcnIubWVzc2FnZSxcbiAgICAgICAgICAgICAgICAgICAgZXJyU3RhY2s6IGVyci5zdGFjayxcbiAgICAgICAgICAgICAgICAgICAgZmlsZVBhdGg6IGZpbGVQYXRoLFxuICAgICAgICAgICAgICAgICAgICB3aWRnZXRUeXBlOiB3aWRnZXRUeXBlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNob3dFcnJvck1lc3NhZ2UoXCJDb3VsZCd0IG9wZW4gZmlsZVwiLCBcIldlIGVuY291bnRlcmVkIGFuIGVycm9yIHdoaWxlIGp1bXBpbmcgdG8gdGhlIHVzZXIncyBjdXJyZW50IHBvc2l0aW9uLiBQbGVhc2UgcmVmcmVzaCB0aGUgcGFnZSB0byB0cnkgYWdhaW5cIik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5pZCA9IFwicGFydGljaXBhbnRzLWxpc3RcIjtcbiAgICAgICAgdGhpcy50aXRsZS5jYXB0aW9uID0gXCJQYXJ0aWNpcGFudHMgTGlzdFwiO1xuICAgICAgICB0aGlzLnRpdGxlLmljb24gPSB1c2Vyc0ljb247XG4gICAgICAgIHRoaXMubm9kZS5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAncmVnaW9uJyk7XG4gICAgICAgIHRoaXMubm9kZS5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCAnUGFydGljaXBhbnRzIExpc3QgU2VjdGlvbicpO1xuICAgICAgICB0aGlzLmFkZENsYXNzKFBBUlRJQ0lQQU5UU19MSVNUX0NMQVNTKTtcbiAgICAgICAgVXNlckluZGljYXRvclN0YXRlLmNoYW5nZWQuY29ubmVjdCgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZSgpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZ2V0U2NyZWVubmFtZSh1c2VyS2V5LCB1c2VyLCBjdXJyVXNlcklkKSB7XG4gICAgICAgIGlmICh1c2VyS2V5ID09IGN1cnJVc2VySWQpXG4gICAgICAgICAgICByZXR1cm4gJ1lvdSc7XG4gICAgICAgIGlmICh1c2VyLnNjcmVlbm5hbWUgPT09IGAke0lOVEVSVklFV0VSX0RFRkFVTFRfTkFNRX0gMWApIHtcbiAgICAgICAgICAgIHJldHVybiBJTlRFUlZJRVdFUl9ERUZBVUxUX05BTUU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHVzZXIuc2NyZWVubmFtZSB8fCAnUGFydGljaXBhbnQnO1xuICAgIH1cbiAgICBmaWxlTmFtZUZyb21QYXRoKGZpbGVQYXRoID0gJycpIHtcbiAgICAgICAgY29uc3QgZmlsZU5hbWUgPSBmaWxlUGF0aC5zcGxpdCgnLycpLnBvcCgpO1xuICAgICAgICByZXR1cm4gZmlsZU5hbWUgfHwgXCJcIjtcbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB1c2VyS2V5cyA9IFVzZXJJbmRpY2F0b3JTdGF0ZS5rZXlzKCk7XG4gICAgICAgIGNvbnN0IGN1cnJRdWVzdGlvbklkID0gSW50ZXJ2aWV3U3RhdGUuZ2V0KFwicXVlc3Rpb25JZFwiKTtcbiAgICAgICAgY29uc3QgY3VyclVzZXJJZCA9IEludGVydmlld1N0YXRlLmdldChcInVzZXJJZFwiKTtcbiAgICAgICAgaWYgKFVzZXJJbmRpY2F0b3JTdGF0ZS5zaXplID09PSAwIHx8IEludGVydmlld1N0YXRlLnNpemUgPT09IDAgfHwgIWN1cnJRdWVzdGlvbklkIHx8ICFjdXJyVXNlcklkKSB7XG4gICAgICAgICAgICByZXR1cm4gUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJ1c2Vycy1saXN0XCIgfSwgXCJObyBQYXJ0aWNpcGFudHMuLi5cIik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIChSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInVzZXJzLWxpc3RcIiB9LCB1c2VyS2V5cy5tYXAoKHVzZXJLZXkpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHVzZXIgPSBVc2VySW5kaWNhdG9yU3RhdGUuZ2V0KHVzZXJLZXkpO1xuICAgICAgICAgICAgaWYgKHVzZXIgPT0gbnVsbCB8fFxuICAgICAgICAgICAgICAgICF1c2VyLmluc2lkZUludGVydmlldyB8fFxuICAgICAgICAgICAgICAgIHVzZXIucWlkICE9PSBjdXJyUXVlc3Rpb25JZCB8fFxuICAgICAgICAgICAgICAgICF1c2VyLmZpbGVQYXRoIHx8XG4gICAgICAgICAgICAgICAgIXVzZXIud2lkZ2V0VHlwZSB8fFxuICAgICAgICAgICAgICAgIHVzZXIud2lkZ2V0VHlwZSA9PT0gXCJ1bmtub3duXCIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHVzZXJOYW1lID0gdGhpcy5nZXRTY3JlZW5uYW1lKHVzZXJLZXksIHVzZXIsIGN1cnJVc2VySWQudG9TdHJpbmcoKSk7XG4gICAgICAgICAgICBjb25zdCBmaWxlTmFtZSA9IHRoaXMuZmlsZU5hbWVGcm9tUGF0aCh1c2VyLmZpbGVQYXRoKTtcbiAgICAgICAgICAgIGxldCBjaGlsZHJlbjtcbiAgICAgICAgICAgIGlmICh1c2VyS2V5ID09IGN1cnJVc2VySWQpIHtcbiAgICAgICAgICAgICAgICBjaGlsZHJlbiA9IChSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInVzZXJzLWxpc3QtaXRlbS1pbmZvIHNlbGZcIiB9LFxuICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwic3BhblwiLCB7IGNsYXNzTmFtZTogXCJ1c2Vycy1saXN0LWl0ZW0taW5mby1maWxlLW5hbWVcIiB9LCBmaWxlTmFtZSkpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGNoaWxkcmVuID0gKFJlYWN0LmNyZWF0ZUVsZW1lbnQoVG9vbHRpcCwgeyBjb250ZW50OiBcIkp1bXAgdG8gZmlsZVwiLCBkZWxheTogMjAwIH0sXG4gICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwidXNlcnMtbGlzdC1pdGVtLWluZm9cIiwgb25DbGljazogKCkgPT4gdGhpcy5vcGVuRmlsZSh1c2VyLmZpbGVQYXRoLCB1c2VyLndpZGdldFR5cGUpIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwic3BhblwiLCB7IGNsYXNzTmFtZTogXCJ1c2Vycy1saXN0LWl0ZW0taW5mby1maWxlLW5hbWVcIiB9LCBmaWxlTmFtZSksXG4gICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KGNvcm5lckljb24ucmVhY3QsIG51bGwpKSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIChSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInVzZXJzLWxpc3QtaXRlbVwiLCBrZXk6IHVzZXJLZXkgfSxcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgc3R5bGU6IHsgY29sb3I6IHVzZXIuY29sb3IgfSB9LCB1c2VyTmFtZSksXG4gICAgICAgICAgICAgICAgY2hpbGRyZW4pKTtcbiAgICAgICAgfSkpKTtcbiAgICB9XG59XG4vLyMgc291cmNlTWFwcGluZ1VSTD1wYXJ0aWNpcGFudHMtbGlzdC5qcy5tYXAiLCJpbXBvcnQgUmVhY3QsIHsgdXNlUmVmLCB1c2VTdGF0ZSB9IGZyb20gJ3JlYWN0JztcbmNvbnN0IFRvb2x0aXAgPSAocHJvcHMpID0+IHtcbiAgICBjb25zdCB0aW1lb3V0ID0gdXNlUmVmKCk7XG4gICAgY29uc3QgW2FjdGl2ZSwgc2V0QWN0aXZlXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgICBjb25zdCBzaG93VGlwID0gKCkgPT4ge1xuICAgICAgICB0aW1lb3V0LmN1cnJlbnQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIHNldEFjdGl2ZSh0cnVlKTtcbiAgICAgICAgfSwgcHJvcHMuZGVsYXkgfHwgNDAwKTtcbiAgICB9O1xuICAgIGNvbnN0IGhpZGVUaXAgPSAoKSA9PiB7XG4gICAgICAgIGNsZWFySW50ZXJ2YWwodGltZW91dC5jdXJyZW50KTtcbiAgICAgICAgc2V0QWN0aXZlKGZhbHNlKTtcbiAgICB9O1xuICAgIHJldHVybiAoUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJUb29sdGlwLVdyYXBwZXJcIiwgb25Nb3VzZUVudGVyOiBzaG93VGlwLCBvbk1vdXNlTGVhdmU6IGhpZGVUaXAgfSxcbiAgICAgICAgcHJvcHMuY2hpbGRyZW4sXG4gICAgICAgIGFjdGl2ZSAmJiAoUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogYFRvb2x0aXAtVGlwICR7J2JvdHRvbSd9YCB9LCBwcm9wcy5jb250ZW50KSkpKTtcbn07XG5leHBvcnQgZGVmYXVsdCBUb29sdGlwO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9dG9vbHRpcC5qcy5tYXAiXSwic291cmNlUm9vdCI6IiJ9