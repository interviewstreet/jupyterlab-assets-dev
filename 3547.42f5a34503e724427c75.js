"use strict";(self["webpackChunk_jupyterlab_application_top"]=self["webpackChunk_jupyterlab_application_top"]||[]).push([[3547],{3547:(e,t,s)=>{s.r(t);s.d(t,{CodeConsole:()=>I,ConsoleHistory:()=>r,ConsolePanel:()=>R,ForeignHandler:()=>i,IConsoleTracker:()=>B});var o=s(19289);const n="jp-CodeConsole-foreignCell";class i{constructor(e){this._enabled=false;this._isDisposed=false;this.sessionContext=e.sessionContext;this.sessionContext.iopubMessage.connect(this.onIOPubMessage,this);this._parent=e.parent}get enabled(){return this._enabled}set enabled(e){this._enabled=e}get parent(){return this._parent}get isDisposed(){return this._isDisposed}dispose(){if(this.isDisposed){return}this._isDisposed=true;o.Signal.clearData(this)}onIOPubMessage(e,t){var s;if(!this._enabled){return false}const o=(s=this.sessionContext.session)===null||s===void 0?void 0:s.kernel;if(!o){return false}const n=this._parent;const i=t.parent_header.session;if(i===o.clientId){return false}const r=t.header.msg_type;const l=t.parent_header;const a=l.msg_id;let c;switch(r){case"execute_input":{const e=t;c=this._newCell(a);const s=c.model;s.executionCount=e.content.execution_count;s.sharedModel.setSource(e.content.code);s.trusted=true;n.update();return true}case"execute_result":case"display_data":case"stream":case"error":{c=this._parent.getCell(a);if(!c){return false}const e={...t.content,output_type:r};c.model.outputs.add(e);n.update();return true}case"clear_output":{const e=t.content.wait;c=this._parent.getCell(a);if(c){c.model.outputs.clear(e)}return true}default:return false}}_newCell(e){const t=this.parent.createCodeCell();t.addClass(n);this._parent.addCell(t,e);return t}}class r{constructor(e){this._cursor=0;this._hasSession=false;this._history=[];this._placeholder="";this._setByHistory=false;this._isDisposed=false;this._editor=null;this._filtered=[];const{sessionContext:t}=e;if(t){this.sessionContext=t;void this._handleKernel();this.sessionContext.kernelChanged.connect(this._handleKernel,this)}}get editor(){return this._editor}set editor(e){if(this._editor===e){return}const t=this._editor;if(t){t.edgeRequested.disconnect(this.onEdgeRequest,this);t.model.sharedModel.changed.disconnect(this.onTextChange,this)}this._editor=e;if(e){e.edgeRequested.connect(this.onEdgeRequest,this);e.model.sharedModel.changed.connect(this.onTextChange,this)}}get placeholder(){return this._placeholder}get isDisposed(){return this._isDisposed}dispose(){this._isDisposed=true;this._history.length=0;o.Signal.clearData(this)}back(e){if(!this._hasSession){this._hasSession=true;this._placeholder=e;this.setFilter(e);this._cursor=this._filtered.length-1}--this._cursor;this._cursor=Math.max(0,this._cursor);const t=this._filtered[this._cursor];return Promise.resolve(t)}forward(e){if(!this._hasSession){this._hasSession=true;this._placeholder=e;this.setFilter(e);this._cursor=this._filtered.length}++this._cursor;this._cursor=Math.min(this._filtered.length-1,this._cursor);const t=this._filtered[this._cursor];return Promise.resolve(t)}push(e){if(e&&e!==this._history[this._history.length-1]){this._history.push(e)}this.reset()}reset(){this._cursor=this._history.length;this._hasSession=false;this._placeholder=""}onHistory(e){this._history.length=0;let t="";let s="";if(e.content.status==="ok"){for(let o=0;o<e.content.history.length;o++){s=e.content.history[o][2];if(s!==t){this._history.push(t=s)}}}this._cursor=this._history.length}onTextChange(){if(this._setByHistory){this._setByHistory=false;return}this.reset()}onEdgeRequest(e,t){const s=e.model.sharedModel;const o=s.getSource();if(t==="top"||t==="topLine"){void this.back(o).then((t=>{if(this.isDisposed||!t){return}if(s.getSource()===t){return}this._setByHistory=true;s.setSource(t);let o=0;o=t.indexOf("\n");if(o<0){o=t.length}e.setCursorPosition({line:0,column:o})}))}else{void this.forward(o).then((t=>{if(this.isDisposed){return}const o=t||this.placeholder;if(s.getSource()===o){return}this._setByHistory=true;s.setSource(o);const n=e.getPositionAt(o.length);if(n){e.setCursorPosition(n)}}))}}async _handleKernel(){var e,t;const s=(t=(e=this.sessionContext)===null||e===void 0?void 0:e.session)===null||t===void 0?void 0:t.kernel;if(!s){this._history.length=0;return}return s.requestHistory(l.initialRequest).then((e=>{this.onHistory(e)}))}setFilter(e=""){this._filtered.length=0;let t="";let s="";for(let o=0;o<this._history.length;o++){s=this._history[o];if(s!==t&&e===s.slice(0,e.length)){this._filtered.push(t=s)}}this._filtered.push(e)}}var l;(function(e){e.initialRequest={output:false,raw:true,hist_access_type:"tail",n:500}})(l||(l={}));var a=s(87447);var c=s(78098);var h=s(59238);var d=s(50724);var u=s(27425);var p=s(55172);var _=s(65178);var C=s(46035);var f=s(5502);var m=s(77383);var g=s(82713);var y=s(54999);var v=s(57807);const w="jpKernelUser";const x="jpCodeRunner";const D="jp-CodeConsole";const b="jp-Console-cell";const k="jp-CodeConsole-banner";const S="jp-CodeConsole-promptCell";const F="jp-CodeConsole-content";const M="jp-CodeConsole-input";const P=250;const T="application/vnd.jupyter.cells";class I extends _.Widget{constructor(e){var t,s;super();this.editorConfig=I.defaultEditorConfig;this._banner=null;this._executed=new o.Signal(this);this._mimetype="text/x-ipython";this._msgIds=new Map;this._msgIdCells=new Map;this._promptCellCreated=new o.Signal(this);this._dragData=null;this._drag=null;this._focusedCell=null;this._translator=(t=e.translator)!==null&&t!==void 0?t:d.nullTranslator;this.addClass(D);this.node.dataset[w]="true";this.node.dataset[x]="true";this.node.tabIndex=-1;const n=this.layout=new _.PanelLayout;this._cells=new y.ObservableList;this._content=new _.Panel;this._input=new _.Panel;this.contentFactory=e.contentFactory;this.modelFactory=(s=e.modelFactory)!==null&&s!==void 0?s:I.defaultModelFactory;this.rendermime=e.rendermime;this.sessionContext=e.sessionContext;this._mimeTypeService=e.mimeTypeService;this._content.addClass(F);this._input.addClass(M);n.addWidget(this._content);n.addWidget(this._input);this._history=new r({sessionContext:this.sessionContext});void this._onKernelChanged();this.sessionContext.kernelChanged.connect(this._onKernelChanged,this);this.sessionContext.statusChanged.connect(this._onKernelStatusChanged,this)}get executed(){return this._executed}get promptCellCreated(){return this._promptCellCreated}get cells(){return this._cells}get promptCell(){const e=this._input.layout;return e.widgets[0]||null}addCell(e,t){e.addClass(b);this._content.addWidget(e);this._cells.push(e);if(t){this._msgIds.set(t,e);this._msgIdCells.set(e,t)}e.disposed.connect(this._onCellDisposed,this);this.update()}addBanner(){if(this._banner){const e=this._banner;this._cells.push(this._banner);e.disposed.connect(this._onCellDisposed,this)}const e=this.modelFactory.createRawCell({sharedModel:(0,m.createStandaloneCell)({cell_type:"raw",source:"..."})});const t=(this._banner=new g.RawCell({model:e,contentFactory:this.contentFactory,placeholder:false,editorConfig:{autoClosingBrackets:false,codeFolding:false,highlightActiveLine:false,highlightTrailingWhitespace:false,highlightWhitespace:false,indentUnit:"4",lineNumbers:false,lineWrap:true,matchBrackets:false,readOnly:true,rulers:[],scrollPastEnd:false,smartIndent:false,tabSize:4,theme:"jupyter"}})).initializeState();t.addClass(k);t.readOnly=true;this._content.addWidget(t)}clear(){const e=this._cells;while(e.length>0){e.get(0).dispose()}}createCodeCell(){const e=this.contentFactory;const t=this._createCodeCellOptions();const s=e.createCodeCell(t);s.readOnly=true;s.model.mimeType=this._mimetype;return s}dispose(){if(this.isDisposed){return}this._msgIdCells=null;this._msgIds=null;this._history.dispose();super.dispose()}async execute(e=false,t=P){var s,o;if(((o=(s=this.sessionContext.session)===null||s===void 0?void 0:s.kernel)===null||o===void 0?void 0:o.status)==="dead"){return}const n=this.promptCell;if(!n){throw new Error("Cannot execute without a prompt cell")}n.model.trusted=true;if(e){this.newPromptCell();await this._execute(n);return}const i=await this._shouldExecute(t);if(this.isDisposed){return}if(i){this.newPromptCell();this.promptCell.editor.focus();await this._execute(n)}else{n.editor.newIndentedLine()}}getCell(e){return this._msgIds.get(e)}inject(e,t={}){const s=this.createCodeCell();s.model.sharedModel.setSource(e);for(const o of Object.keys(t)){s.model.setMetadata(o,t[o])}this.addCell(s);return this._execute(s)}insertLinebreak(){const e=this.promptCell;if(!e){return}e.editor.newIndentedLine()}replaceSelection(e){var t,s;const o=this.promptCell;if(!o){return}(s=(t=o.editor).replaceSelection)===null||s===void 0?void 0:s.call(t,e)}serialize(){const e=[];for(const t of this._cells){const s=t.model;if((0,g.isCodeCellModel)(s)){e.push(s.toJSON())}}if(this.promptCell){e.push(this.promptCell.model.toJSON())}return e}_evtMouseDown(e){const{button:t,shiftKey:s}=e;if(!(t===0||t===2)||s&&t===2){return}let o=e.target;const n=e=>e.classList.contains(b);let i=g.CellDragUtils.findCell(o,this._cells,n);if(i===-1){o=document.elementFromPoint(e.clientX,e.clientY);i=g.CellDragUtils.findCell(o,this._cells,n)}if(i===-1){return}const r=this._cells.get(i);const l=g.CellDragUtils.detectTargetArea(r,e.target);if(l==="prompt"){this._dragData={pressX:e.clientX,pressY:e.clientY,index:i};this._focusedCell=r;document.addEventListener("mouseup",this,true);document.addEventListener("mousemove",this,true);e.preventDefault()}}_evtMouseMove(e){const t=this._dragData;if(t&&g.CellDragUtils.shouldStartDrag(t.pressX,t.pressY,e.clientX,e.clientY)){void this._startDrag(t.index,e.clientX,e.clientY)}}_startDrag(e,t,s){const o=this._focusedCell.model;const n=[o.toJSON()];const i=g.CellDragUtils.createCellDragImage(this._focusedCell,n);this._drag=new v.Drag({mimeData:new p.MimeData,dragImage:i,proposedAction:"copy",supportedActions:"copy",source:this});this._drag.mimeData.setData(T,n);const r=o.sharedModel.getSource();this._drag.mimeData.setData("text/plain",r);this._focusedCell=null;document.removeEventListener("mousemove",this,true);document.removeEventListener("mouseup",this,true);return this._drag.start(t,s).then((()=>{if(this.isDisposed){return}this._drag=null;this._dragData=null}))}handleEvent(e){switch(e.type){case"keydown":this._evtKeyDown(e);break;case"mousedown":this._evtMouseDown(e);break;case"mousemove":this._evtMouseMove(e);break;case"mouseup":this._evtMouseUp(e);break;default:break}}onAfterAttach(e){const t=this.node;t.addEventListener("keydown",this,true);t.addEventListener("click",this);t.addEventListener("mousedown",this);if(!this.promptCell){this.newPromptCell()}else{this.promptCell.editor.focus();this.update()}}onBeforeDetach(e){const t=this.node;t.removeEventListener("keydown",this,true);t.removeEventListener("click",this)}onActivateRequest(e){const t=this.promptCell&&this.promptCell.editor;if(t){t.focus()}this.update()}newPromptCell(){var e;let t=this.promptCell;const s=this._input;if(t){t.readOnly=true;t.removeClass(S);o.Signal.clearData(t.editor);(e=t.editor)===null||e===void 0?void 0:e.blur();const n=s.widgets[0];n.parent=null;this.addCell(t)}const n=this.contentFactory;const i=this._createCodeCellOptions();t=n.createCodeCell(i);t.model.mimeType=this._mimetype;t.addClass(S);this._input.addWidget(t);this._history.editor=t.editor;this._promptCellCreated.emit(t)}onUpdateRequest(e){E.scrollToBottom(this._content.node)}_evtKeyDown(e){const t=this.promptCell&&this.promptCell.editor;if(!t){return}if(e.keyCode===13&&!t.hasFocus()){e.preventDefault();t.focus()}else if(e.keyCode===27&&t.hasFocus()){e.preventDefault();e.stopPropagation();this.node.focus()}}_evtMouseUp(e){if(this.promptCell&&this.promptCell.node.contains(e.target)){this.promptCell.editor.focus()}}_execute(e){const t=e.model.sharedModel.getSource();this._history.push(t);if(t==="clear"||t==="%clear"){this.clear();return Promise.resolve(void 0)}e.model.contentChanged.connect(this.update,this);const s=t=>{if(this.isDisposed){return}if(t&&t.content.status==="ok"){const s=t.content;if(s.payload&&s.payload.length){const t=s.payload.filter((e=>e.source==="set_next_input"))[0];if(t){const s=t.text;e.model.sharedModel.setSource(s)}}}else if(t&&t.content.status==="error"){for(const e of this._cells){if(e.model.executionCount===null){e.setPrompt("")}}}e.model.contentChanged.disconnect(this.update,this);this.update();this._executed.emit(new Date)};const o=()=>{if(this.isDisposed){return}e.model.contentChanged.disconnect(this.update,this);this.update()};return g.CodeCell.execute(e,this.sessionContext).then(s,o)}_handleInfo(e){if(e.status!=="ok"){this._banner.model.sharedModel.setSource("Error in getting kernel banner");return}this._banner.model.sharedModel.setSource(e.banner);const t=e.language_info;this._mimetype=this._mimeTypeService.getMimeTypeByLanguage(t);if(this.promptCell){this.promptCell.model.mimeType=this._mimetype}}_createCodeCellOptions(){const e=this.contentFactory;const t=this.modelFactory;const s=t.createCodeCell({});const o=this.rendermime;const n=this.editorConfig;const i=f.EditorView.domEventHandlers({keydown:(e,t)=>{if(e.keyCode===13){e.preventDefault();return true}return false}});return{model:s,rendermime:o,contentFactory:e,editorConfig:n,editorExtensions:[C.Prec.high(i)],placeholder:false,translator:this._translator}}_onCellDisposed(e,t){if(!this.isDisposed){this._cells.removeValue(e);const t=this._msgIdCells.get(e);if(t){this._msgIdCells.delete(e);this._msgIds.delete(t)}}}_shouldExecute(e){const t=this.promptCell;if(!t){return Promise.resolve(false)}const s=t.model;const o=s.sharedModel.getSource();return new Promise(((t,s)=>{var n;const i=setTimeout((()=>{t(true)}),e);const r=(n=this.sessionContext.session)===null||n===void 0?void 0:n.kernel;if(!r){t(false);return}r.requestIsComplete({code:o}).then((e=>{clearTimeout(i);if(this.isDisposed){t(false)}if(e.content.status!=="incomplete"){t(true);return}t(false)})).catch((()=>{t(true)}))}))}async _onKernelChanged(){var e;this.clear();if(this._banner){this._banner.dispose();this._banner=null}this.addBanner();if((e=this.sessionContext.session)===null||e===void 0?void 0:e.kernel){this._handleInfo(await this.sessionContext.session.kernel.info)}}async _onKernelStatusChanged(){var e;const t=(e=this.sessionContext.session)===null||e===void 0?void 0:e.kernel;if((t===null||t===void 0?void 0:t.status)==="restarting"){this.addBanner();this._handleInfo(await(t===null||t===void 0?void 0:t.info))}}}(function(e){e.defaultEditorConfig={codeFolding:false,lineNumbers:false};class t extends g.Cell.ContentFactory{createCodeCell(e){return new g.CodeCell(e).initializeState()}createRawCell(e){return new g.RawCell(e).initializeState()}}e.ContentFactory=t;class s{constructor(e={}){this.codeCellContentFactory=e.codeCellContentFactory||g.CodeCellModel.defaultContentFactory}createCodeCell(e={}){if(!e.contentFactory){e.contentFactory=this.codeCellContentFactory}return new g.CodeCellModel(e)}createRawCell(e){return new g.RawCellModel(e)}}e.ModelFactory=s;e.defaultModelFactory=new s({})})(I||(I={}));var E;(function(e){function t(e){e.scrollTop=e.scrollHeight-e.clientHeight}e.scrollToBottom=t})(E||(E={}));const j="jp-ConsolePanel";class R extends a.MainAreaWidget{constructor(e){super({content:new _.Panel});this._executed=null;this._connected=null;this.addClass(j);let{rendermime:t,mimeTypeService:s,path:o,basePath:n,name:i,manager:r,modelFactory:l,sessionContext:C,translator:f}=e;this.translator=f!==null&&f!==void 0?f:d.nullTranslator;const m=this.translator.load("jupyterlab");const g=this.contentFactory=e.contentFactory;const y=L.count++;if(!o){o=c.PathExt.join(n||"",`console-${y}-${p.UUID.uuid4()}`)}C=this._sessionContext=C!==null&&C!==void 0?C:new a.SessionContext({sessionManager:r.sessions,specsManager:r.kernelspecs,path:r.contents.localPath(o),name:i||m.__("Console %1",y),type:"console",kernelPreference:e.kernelPreference,setBusy:e.setBusy});const v=new h.RenderMimeRegistry.UrlResolver({path:o,contents:r.contents});t=t.clone({resolver:v});this.console=g.createConsole({rendermime:t,sessionContext:C,mimeTypeService:s,contentFactory:g,modelFactory:l,translator:f});this.content.addWidget(this.console);void C.initialize().then((async t=>{var s;if(t){await((s=e.sessionDialogs)!==null&&s!==void 0?s:new a.SessionContextDialogs({translator:f})).selectKernel(C)}this._connected=new Date;this._updateTitlePanel()}));this.console.executed.connect(this._onExecuted,this);this._updateTitlePanel();C.kernelChanged.connect(this._updateTitlePanel,this);C.propertyChanged.connect(this._updateTitlePanel,this);this.title.icon=u.consoleIcon;this.title.closable=true;this.id=`console-${y}`}get sessionContext(){return this._sessionContext}dispose(){this.sessionContext.dispose();this.console.dispose();super.dispose()}onActivateRequest(e){const t=this.console.promptCell;if(t){t.editor.focus()}}onCloseRequest(e){super.onCloseRequest(e);this.dispose()}_onExecuted(e,t){this._executed=t;this._updateTitlePanel()}_updateTitlePanel(){L.updateTitle(this,this._connected,this._executed,this.translator)}}(function(e){class t extends I.ContentFactory{createConsole(e){return new I(e)}}e.ContentFactory=t;e.IContentFactory=new p.Token("@jupyterlab/console:IContentFactory","A factory object that creates new code consoles. Use this if you want to create and host code consoles in your own UI elements.")})(R||(R={}));var L;(function(e){e.count=1;function t(e,t,s,o){o=o||d.nullTranslator;const n=o.load("jupyterlab");const i=e.console.sessionContext.session;if(i){let o=n.__("Name: %1\n",i.name)+n.__("Directory: %1\n",c.PathExt.dirname(i.path))+n.__("Kernel: %1",e.console.sessionContext.kernelDisplayName);if(t){o+=n.__("\nConnected: %1",c.Time.format(t.toISOString()))}if(s){o+=n.__("\nLast Execution: %1")}e.title.label=i.name;e.title.caption=o}else{e.title.label=n.__("Console");e.title.caption=""}}e.updateTitle=t})(L||(L={}));const B=new p.Token("@jupyterlab/console:IConsoleTracker",`A widget tracker for code consoles.\n  Use this if you want to be able to iterate over and interact with code consoles\n  created by the application.`)}}]);
//# sourceMappingURL=3547.42f5a34503e724427c75.js.map?v=42f5a34503e724427c75