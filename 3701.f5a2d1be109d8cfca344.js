"use strict";(self["webpackChunk_jupyterlab_application_top"]=self["webpackChunk_jupyterlab_application_top"]||[]).push([[3701],{83701:(e,t,s)=>{s.r(t);s.d(t,{BreadCrumbs:()=>y,CHUNK_SIZE:()=>ge,DirListing:()=>oe,FileBrowser:()=>me,FileBrowserModel:()=>ve,FileDialog:()=>Ce,FileUploadStatus:()=>Te,FilterFileBrowserModel:()=>ye,IDefaultFileBrowser:()=>Ie,IFileBrowserCommands:()=>xe,IFileBrowserFactory:()=>Le,LARGE_FILE_SIZE:()=>_e,TogglableHiddenFileBrowserModel:()=>we,Uploader:()=>ke});var i=s(87447);var n=s(4702);var r=s(50724);var o=s(27425);var a=s(65178);var l=s(78098);var d=s(15115);var h=s(10535);var c=s(55172);var u=s(76838);const m="jp-BreadCrumbs";const p="jp-BreadCrumbs-home";const f="jp-BreadCrumbs-preferred";const _="jp-BreadCrumbs-item";const g=["/","../../","../",""];const v="application/x-jupyter-icontents";const w="jp-mod-dropTarget";class y extends a.Widget{constructor(e){super();this._previousState=null;this.translator=e.translator||r.nullTranslator;this._trans=this.translator.load("jupyterlab");this._model=e.model;this._fullPath=e.fullPath||false;this.addClass(m);this._crumbs=b.createCrumbs();this._crumbSeps=b.createCrumbSeparators();const t=l.PageConfig.getOption("preferredPath");this._hasPreferred=t&&t!=="/"?true:false;if(this._hasPreferred){this.node.appendChild(this._crumbs[b.Crumb.Preferred])}this.node.appendChild(this._crumbs[b.Crumb.Home]);this._model.refreshed.connect(this.update,this)}handleEvent(e){switch(e.type){case"click":this._evtClick(e);break;case"lm-dragenter":this._evtDragEnter(e);break;case"lm-dragleave":this._evtDragLeave(e);break;case"lm-dragover":this._evtDragOver(e);break;case"lm-drop":this._evtDrop(e);break;default:return}}get fullPath(){return this._fullPath}set fullPath(e){this._fullPath=e}onAfterAttach(e){super.onAfterAttach(e);this.update();const t=this.node;t.addEventListener("click",this);t.addEventListener("lm-dragenter",this);t.addEventListener("lm-dragleave",this);t.addEventListener("lm-dragover",this);t.addEventListener("lm-drop",this)}onBeforeDetach(e){super.onBeforeDetach(e);const t=this.node;t.removeEventListener("click",this);t.removeEventListener("lm-dragenter",this);t.removeEventListener("lm-dragleave",this);t.removeEventListener("lm-dragover",this);t.removeEventListener("lm-drop",this)}onUpdateRequest(e){const t=this._model.manager.services.contents;const s=t.localPath(this._model.path);const i={path:s,hasPreferred:this._hasPreferred,fullPath:this._fullPath};if(this._previousState&&c.JSONExt.deepEqual(i,this._previousState)){return}this._previousState=i;b.updateCrumbs(this._crumbs,this._crumbSeps,i)}_evtClick(e){if(e.button!==0){return}let t=e.target;while(t&&t!==this.node){if(t.classList.contains(f)){this._model.cd(l.PageConfig.getOption("preferredPath")).catch((e=>(0,i.showErrorMessage)(this._trans.__("Open Error"),e)));e.preventDefault();e.stopPropagation();return}if(t.classList.contains(_)||t.classList.contains(p)){let s=h.ArrayExt.findFirstIndex(this._crumbs,(e=>e===t));let n=g[s];if(this._fullPath&&s<0&&!t.classList.contains(p)){n=t.title}this._model.cd(n).catch((e=>(0,i.showErrorMessage)(this._trans.__("Open Error"),e)));e.preventDefault();e.stopPropagation();return}t=t.parentElement}}_evtDragEnter(e){if(e.mimeData.hasData(v)){const t=h.ArrayExt.findFirstIndex(this._crumbs,(t=>u.ElementExt.hitTest(t,e.clientX,e.clientY)));if(t!==-1){if(t!==b.Crumb.Current){this._crumbs[t].classList.add(w);e.preventDefault();e.stopPropagation()}}}}_evtDragLeave(e){e.preventDefault();e.stopPropagation();const t=i.DOMUtils.findElement(this.node,w);if(t){t.classList.remove(w)}}_evtDragOver(e){e.preventDefault();e.stopPropagation();e.dropAction=e.proposedAction;const t=i.DOMUtils.findElement(this.node,w);if(t){t.classList.remove(w)}const s=h.ArrayExt.findFirstIndex(this._crumbs,(t=>u.ElementExt.hitTest(t,e.clientX,e.clientY)));if(s!==-1){this._crumbs[s].classList.add(w)}}_evtDrop(e){e.preventDefault();e.stopPropagation();if(e.proposedAction==="none"){e.dropAction="none";return}if(!e.mimeData.hasData(v)){return}e.dropAction=e.proposedAction;let t=e.target;while(t&&t.parentElement){if(t.classList.contains(w)){t.classList.remove(w);break}t=t.parentElement}const s=h.ArrayExt.findFirstIndex(this._crumbs,(e=>e===t));if(s===-1){return}const n=this._model;const r=l.PathExt.resolve(n.path,g[s]);const o=n.manager;const a=[];const c=e.mimeData.getData(v);for(const i of c){const e=o.services.contents.localPath(i);const t=l.PathExt.basename(e);const s=l.PathExt.join(r,t);a.push((0,d.renameFile)(o,i,s))}void Promise.all(a).catch((e=>(0,i.showErrorMessage)(this._trans.__("Move Error"),e)))}}var b;(function(e){let t;(function(e){e[e["Home"]=0]="Home";e[e["Ellipsis"]=1]="Ellipsis";e[e["Parent"]=2]="Parent";e[e["Current"]=3]="Current";e[e["Preferred"]=4]="Preferred"})(t=e.Crumb||(e.Crumb={}));function s(e,s,i){const n=e[0].parentNode;const r=n.firstChild;while(r&&r.nextSibling){n.removeChild(r.nextSibling)}if(i.hasPreferred){n.appendChild(e[t.Home]);n.appendChild(s[0])}else{n.appendChild(s[0])}const o=i.path.split("/");if(!i.fullPath&&o.length>2){n.appendChild(e[t.Ellipsis]);const i=o.slice(0,o.length-2).join("/");e[t.Ellipsis].title=i;n.appendChild(s[1])}if(i.path){if(!i.fullPath){if(o.length>=2){e[t.Parent].textContent=o[o.length-2];n.appendChild(e[t.Parent]);const i=o.slice(0,o.length-1).join("/");e[t.Parent].title=i;n.appendChild(s[2])}e[t.Current].textContent=o[o.length-1];n.appendChild(e[t.Current]);e[t.Current].title=i.path;n.appendChild(s[3])}else{for(let e=0;e<o.length;e++){const t=document.createElement("span");t.className=_;t.textContent=o[e];const s=`/${o.slice(0,e+1).join("/")}`;t.title=s;n.appendChild(t);const i=document.createElement("span");i.textContent="/";n.appendChild(i)}}}}e.updateCrumbs=s;function i(){const e=o.folderIcon.element({className:p,tag:"span",title:l.PageConfig.getOption("serverRoot")||"Jupyter Server Root",stylesheet:"breadCrumb"});const t=o.ellipsesIcon.element({className:_,tag:"span",stylesheet:"breadCrumb"});const s=document.createElement("span");s.className=_;const i=document.createElement("span");i.className=_;const n=o.homeIcon.element({className:f,tag:"span",title:l.PageConfig.getOption("preferredPath")||"Jupyter Preferred Path",stylesheet:"breadCrumb"});return[e,t,s,i,n]}e.createCrumbs=i;function n(){const e=[];const t=2;for(let s=0;s<t+2;s++){const t=document.createElement("span");t.textContent="/";e.push(t)}return e}e.createCrumbSeparators=n})(b||(b={}));var C=s(35627);var E=s(57807);var D=s(37917);var L=s(19289);var I=s(48130);const x="jp-DirListing";const k="jp-DirListing-header";const P="jp-DirListing-headerItem";const F="jp-DirListing-headerItemText";const N="jp-DirListing-headerItemIcon";const M="jp-DirListing-content";const S="jp-DirListing-item";const j="jp-DirListing-itemText";const A="jp-DirListing-itemIcon";const T="jp-DirListing-itemModified";const O="jp-DirListing-itemFileSize";const B="jp-DirListing-checkboxWrapper";const U="jp-DirListing-editor";const R="jp-id-name";const V="jp-id-modified";const K="jp-id-filesize";const z="jp-id-narrow";const H="jp-LastModified-hidden";const W="jp-FileSize-hidden";const Y="application/x-jupyter-icontents";const q="application/x-jupyter-icontentsrich";const X="jp-mod-dropTarget";const $="jp-mod-selected";const G="jp-DragIcon";const J="jp-mod-clipboard";const Z="jp-mod-cut";const Q="jp-mod-multiSelected";const ee="jp-mod-running";const te="jp-mod-descending";const se=1e3;const ie=5;const ne=!!navigator.platform.match(/Mac/i);const re="application/vnd.lumino.widget-factory";class oe extends a.Widget{constructor(e){super({node:(e.renderer||oe.defaultRenderer).createNode()});this._items=[];this._sortedItems=[];this._sortState={direction:"ascending",key:"name"};this._onItemOpened=new L.Signal(this);this._drag=null;this._dragData=null;this._selectTimer=-1;this._isCut=false;this._prevPath="";this._clipboard=[];this._softSelection="";this.selection=Object.create(null);this._searchPrefix="";this._searchPrefixTimer=-1;this._inRename=false;this._isDirty=false;this._hiddenColumns=new Set;this._sortNotebooksFirst=false;this._focusIndex=0;this.addClass(x);this.translator=e.translator||r.nullTranslator;this._trans=this.translator.load("jupyterlab");this._model=e.model;this._model.fileChanged.connect(this._onFileChanged,this);this._model.refreshed.connect(this._onModelRefreshed,this);this._model.pathChanged.connect(this._onPathChanged,this);this._editNode=document.createElement("input");this._editNode.className=U;this._manager=this._model.manager;this._renderer=e.renderer||oe.defaultRenderer;const t=i.DOMUtils.findElement(this.node,k);this._hiddenColumns.add("file_size");this._renderer.populateHeaderNode(t,this.translator,this._hiddenColumns);this._manager.activateRequested.connect(this._onActivateRequested,this)}dispose(){this._items.length=0;this._sortedItems.length=0;this._clipboard.length=0;super.dispose()}get model(){return this._model}get headerNode(){return i.DOMUtils.findElement(this.node,k)}get contentNode(){return i.DOMUtils.findElement(this.node,M)}get renderer(){return this._renderer}get sortState(){return this._sortState}get onItemOpened(){return this._onItemOpened}selectedItems(){const e=this._sortedItems;return(0,h.filter)(e,(e=>this.selection[e.path]))}sortedItems(){return this._sortedItems[Symbol.iterator]()}sort(e){this._sortedItems=ae.sort(this.model.items(),e,this._sortNotebooksFirst);this._sortState=e;this.update()}rename(){return this._doRename()}cut(){this._isCut=true;this._copy();this.update()}copy(){this._copy()}paste(){if(!this._clipboard.length){this._isCut=false;return Promise.resolve(undefined)}const e=this._model.path;const t=[];for(const s of this._clipboard){if(this._isCut){const i=this._manager.services.contents.localPath(s);const n=i.split("/");const r=n[n.length-1];const o=l.PathExt.join(e,r);t.push(this._model.manager.rename(s,o))}else{t.push(this._model.manager.copy(s,e))}}for(const s of this._items){s.classList.remove(Z)}this._clipboard.length=0;this._isCut=false;this.removeClass(J);return Promise.all(t).then((()=>undefined)).catch((e=>{void(0,i.showErrorMessage)(this._trans._p("showErrorMessage","Paste Error"),e)}))}async delete(){const e=this._sortedItems.filter((e=>this.selection[e.path]));if(!e.length){return}const t=e.length===1?this._trans.__("Are you sure you want to permanently delete: %1?",e[0].name):this._trans._n("Are you sure you want to permanently delete the %1 selected item?","Are you sure you want to permanently delete the %1 selected items?",e.length);const s=await(0,i.showDialog)({title:this._trans.__("Delete"),body:t,buttons:[i.Dialog.cancelButton({label:this._trans.__("Cancel")}),i.Dialog.warnButton({label:this._trans.__("Delete")})],defaultButton:0});if(!this.isDisposed&&s.button.accept){await this._delete(e.map((e=>e.path)))}let n=this._focusIndex;const r=this._sortedItems.length-e.length-1;if(n>r){n=Math.max(0,r)}this._focusItem(n)}duplicate(){const e=this._model.path;const t=[];for(const s of this.selectedItems()){if(s.type!=="directory"){t.push(this._model.manager.copy(s.path,e))}}return Promise.all(t).then((()=>undefined)).catch((e=>{void(0,i.showErrorMessage)(this._trans._p("showErrorMessage","Duplicate file"),e)}))}async download(){await Promise.all(Array.from(this.selectedItems()).filter((e=>e.type!=="directory")).map((e=>this._model.download(e.path))))}shutdownKernels(){const e=this._model;const t=this._sortedItems;const s=t.map((e=>e.path));const n=Array.from(this._model.sessions()).filter((e=>{const i=h.ArrayExt.firstIndexOf(s,e.path);return this.selection[t[i].path]})).map((t=>e.manager.services.sessions.shutdown(t.id)));return Promise.all(n).then((()=>undefined)).catch((e=>{void(0,i.showErrorMessage)(this._trans._p("showErrorMessage","Shut down kernel"),e)}))}selectNext(e=false){let t=-1;const s=Object.keys(this.selection);const i=this._sortedItems;if(s.length===1||e){const e=s[s.length-1];t=h.ArrayExt.findFirstIndex(i,(t=>t.path===e));t+=1;if(t===this._items.length){t=0}}else if(s.length===0){t=0}else{const e=s[s.length-1];t=h.ArrayExt.findFirstIndex(i,(t=>t.path===e))}if(t!==-1){this._selectItem(t,e);u.ElementExt.scrollIntoViewIfNeeded(this.contentNode,this._items[t])}}selectPrevious(e=false){let t=-1;const s=Object.keys(this.selection);const i=this._sortedItems;if(s.length===1||e){const e=s[0];t=h.ArrayExt.findFirstIndex(i,(t=>t.path===e));t-=1;if(t===-1){t=this._items.length-1}}else if(s.length===0){t=this._items.length-1}else{const e=s[0];t=h.ArrayExt.findFirstIndex(i,(t=>t.path===e))}if(t!==-1){this._selectItem(t,e);u.ElementExt.scrollIntoViewIfNeeded(this.contentNode,this._items[t])}}selectByPrefix(){const e=this._searchPrefix.toLowerCase();const t=this._sortedItems;const s=h.ArrayExt.findFirstIndex(t,(t=>t.name.toLowerCase().substr(0,e.length)===e));if(s!==-1){this._selectItem(s,false);u.ElementExt.scrollIntoViewIfNeeded(this.contentNode,this._items[s])}}isSelected(e){const t=this._sortedItems;return Array.from((0,h.filter)(t,(t=>t.name===e&&this.selection[t.path]))).length!==0}modelForClick(e){const t=this._sortedItems;const s=ae.hitTestNodes(this._items,e);if(s!==-1){return t[s]}return undefined}clearSelectedItems(){this.selection=Object.create(null)}async selectItemByName(e,t=false){await this.model.refresh();if(this.isDisposed){throw new Error("File browser is disposed.")}const s=this._sortedItems;const i=h.ArrayExt.findFirstIndex(s,(t=>t.name===e));if(i===-1){throw new Error("Item does not exist.")}this._selectItem(i,false,t);D.MessageLoop.sendMessage(this,a.Widget.Msg.UpdateRequest);u.ElementExt.scrollIntoViewIfNeeded(this.contentNode,this._items[i])}handleEvent(e){switch(e.type){case"mousedown":this._evtMousedown(e);break;case"mouseup":this._evtMouseup(e);break;case"mousemove":this._evtMousemove(e);break;case"keydown":this.evtKeydown(e);break;case"click":this._evtClick(e);break;case"dblclick":this.evtDblClick(e);break;case"dragenter":case"dragover":this.addClass("jp-mod-native-drop");e.preventDefault();break;case"dragleave":case"dragend":this.removeClass("jp-mod-native-drop");break;case"drop":this.removeClass("jp-mod-native-drop");this.evtNativeDrop(e);break;case"scroll":this._evtScroll(e);break;case"lm-dragenter":this.evtDragEnter(e);break;case"lm-dragleave":this.evtDragLeave(e);break;case"lm-dragover":this.evtDragOver(e);break;case"lm-drop":this.evtDrop(e);break;default:break}}onAfterAttach(e){super.onAfterAttach(e);const t=this.node;const s=i.DOMUtils.findElement(t,M);t.addEventListener("mousedown",this);t.addEventListener("keydown",this);t.addEventListener("click",this);t.addEventListener("dblclick",this);s.addEventListener("dragenter",this);s.addEventListener("dragover",this);s.addEventListener("dragleave",this);s.addEventListener("dragend",this);s.addEventListener("drop",this);s.addEventListener("scroll",this);s.addEventListener("lm-dragenter",this);s.addEventListener("lm-dragleave",this);s.addEventListener("lm-dragover",this);s.addEventListener("lm-drop",this)}onBeforeDetach(e){super.onBeforeDetach(e);const t=this.node;const s=i.DOMUtils.findElement(t,M);t.removeEventListener("mousedown",this);t.removeEventListener("keydown",this);t.removeEventListener("click",this);t.removeEventListener("dblclick",this);s.removeEventListener("scroll",this);s.removeEventListener("dragover",this);s.removeEventListener("dragover",this);s.removeEventListener("dragleave",this);s.removeEventListener("dragend",this);s.removeEventListener("drop",this);s.removeEventListener("lm-dragenter",this);s.removeEventListener("lm-dragleave",this);s.removeEventListener("lm-dragover",this);s.removeEventListener("lm-drop",this);document.removeEventListener("mousemove",this,true);document.removeEventListener("mouseup",this,true)}onAfterShow(e){if(this._isDirty){this.sort(this.sortState);this.update()}}onUpdateRequest(e){var t;this._isDirty=false;const s=this._sortedItems;const n=this._items;const r=i.DOMUtils.findElement(this.node,M);const o=this._renderer;this.removeClass(Q);this.removeClass($);while(n.length>s.length){r.removeChild(n.pop())}while(n.length<s.length){const e=o.createItemNode(this._hiddenColumns);e.classList.add(S);n.push(e);r.appendChild(e)}n.forEach(((e,t)=>{e.classList.remove($);e.classList.remove(ee);e.classList.remove(Z);const s=o.getCheckboxNode(e);if(s){s.checked=false}const i=o.getNameNode(e);if(i){i.tabIndex=t===this._focusIndex?0:-1}}));const a=o.getCheckboxNode(this.headerNode);if(a){const e=Object.keys(this.selection).length;const t=s.length>0&&e===s.length;const i=!t&&e>0;a.checked=t;a.indeterminate=i;a.dataset.checked=String(t);a.dataset.indeterminate=String(i);const n=this.translator.load("jupyterlab");a===null||a===void 0?void 0:a.setAttribute("aria-label",t||i?n.__("Deselect all files and directories"):n.__("Select all files and directories"))}s.forEach(((e,t)=>{const s=n[t];const i=this._manager.registry.getFileTypeForModel(e);o.updateItemNode(s,e,i,this.translator,this._hiddenColumns,this.selection[e.path]);if(this.selection[e.path]&&this._isCut&&this._model.path===this._prevPath){s.classList.add(Z)}s.setAttribute("data-isdir",e.type==="directory"?"true":"false")}));const l=Object.keys(this.selection).length;if(l){this.addClass($);if(l>1){this.addClass(Q)}}const d=s.map((e=>e.path));for(const i of this._model.sessions()){const e=h.ArrayExt.firstIndexOf(d,i.path);const s=n[e];if(s){let e=(t=i.kernel)===null||t===void 0?void 0:t.name;const n=this._model.specs;s.classList.add(ee);if(n&&e){const t=n.kernelspecs[e];e=t?t.display_name:this._trans.__("unknown")}s.title=this._trans.__("%1\nKernel: %2",s.title,e)}}this._prevPath=this._model.path}onResize(e){const{width:t}=e.width===-1?this.node.getBoundingClientRect():e;this.toggleClass("jp-DirListing-narrow",t<250)}setColumnVisibility(e,t){if(t){this._hiddenColumns.delete(e)}else{this._hiddenColumns.add(e)}this.headerNode.innerHTML="";this._renderer.populateHeaderNode(this.headerNode,this.translator,this._hiddenColumns)}setNotebooksFirstSorting(e){let t=this._sortNotebooksFirst;this._sortNotebooksFirst=e;if(this._sortNotebooksFirst!==t){this.sort(this._sortState)}}isWithinCheckboxHitArea(e){let t=e.target;while(t){if(t.classList.contains(B)){return true}t=t.parentElement}return false}_evtClick(e){const t=e.target;const s=this.headerNode;const i=this._renderer;if(s.contains(t)){const t=i.getCheckboxNode(s);if(t&&this.isWithinCheckboxHitArea(e)){const e=t.dataset.indeterminate==="false"&&t.dataset.checked==="false";if(e){this._sortedItems.forEach((e=>this.selection[e.path]=true))}else{this.clearSelectedItems()}this.update()}else{const t=this.renderer.handleHeaderClick(s,e);if(t){this.sort(t)}}return}else{this._focusItem(this._focusIndex)}}_evtScroll(e){this.headerNode.scrollLeft=this.contentNode.scrollLeft}_evtMousedown(e){if(e.target===this._editNode){return}if(this._editNode.parentNode){if(this._editNode!==e.target){this._editNode.focus();this._editNode.blur();clearTimeout(this._selectTimer)}else{return}}let t=ae.hitTestNodes(this._items,e);if(t===-1){return}this.handleFileSelect(e);if(e.button!==0){clearTimeout(this._selectTimer)}const s=ne&&e.ctrlKey||e.button===2;if(s){return}if(e.button===0){this._dragData={pressX:e.clientX,pressY:e.clientY,index:t};document.addEventListener("mouseup",this,true);document.addEventListener("mousemove",this,true)}}_evtMouseup(e){if(this._softSelection){const t=e.metaKey||e.shiftKey||e.ctrlKey;if(!t&&e.button===0){this.clearSelectedItems();this.selection[this._softSelection]=true;this.update()}this._softSelection=""}if(e.button===0){this._focusItem(this._focusIndex)}if(e.button!==0||!this._drag){document.removeEventListener("mousemove",this,true);document.removeEventListener("mouseup",this,true);return}e.preventDefault();e.stopPropagation()}_evtMousemove(e){e.preventDefault();e.stopPropagation();if(this._drag||!this._dragData){return}const t=this._dragData;const s=Math.abs(e.clientX-t.pressX);const i=Math.abs(e.clientY-t.pressY);if(s<ie&&i<ie){return}this._startDrag(t.index,e.clientX,e.clientY)}handleOpen(e){this._onItemOpened.emit(e);if(e.type==="directory"){const t=this._manager.services.contents.localPath(e.path);this._model.cd(`/${t}`).catch((e=>(0,i.showErrorMessage)(this._trans._p("showErrorMessage","Open directory"),e)))}else{const t=e.path;this._manager.openOrReveal(t)}}_getNextFocusIndex(e,t){const s=e+t;if(s===-1||s===this._items.length){return e}else{return s}}_handleArrowY(e,t){if(e.altKey||e.metaKey){return}if(!this._items.length){return}if(!e.target.classList.contains(j)){return}e.stopPropagation();e.preventDefault();const s=this._focusIndex;let i=this._getNextFocusIndex(s,t);if(t>0&&s===0&&!e.ctrlKey&&Object.keys(this.selection).length===0){i=0}if(e.shiftKey){this._handleMultiSelect(i)}else if(!e.ctrlKey){this._selectItem(i,e.shiftKey,false)}this._focusItem(i);this.update()}async goUp(){const e=this.model;if(e.path===e.rootPath){return}try{await e.cd("..")}catch(t){console.warn(`Failed to go to parent directory of ${e.path}`,t)}}evtKeydown(e){if(this._inRename){return}switch(e.keyCode){case 13:{if(e.ctrlKey||e.shiftKey||e.altKey||e.metaKey){return}e.preventDefault();e.stopPropagation();for(const e of this.selectedItems()){this.handleOpen(e)}return}case 38:this._handleArrowY(e,-1);return;case 40:this._handleArrowY(e,1);return;case 32:{if(e.ctrlKey){if(e.metaKey||e.shiftKey||e.altKey){return}const t=this._items[this._focusIndex];if(!(t.contains(e.target)&&t.contains(document.activeElement))){return}e.stopPropagation();e.preventDefault();const{path:s}=this._sortedItems[this._focusIndex];if(this.selection[s]){delete this.selection[s]}else{this.selection[s]=true}this.update();return}break}}if(e.key!==undefined&&e.key.length===1&&!((e.key===" "||e.keyCode===32)&&e.target.type==="checkbox")){if(e.ctrlKey||e.shiftKey||e.altKey||e.metaKey){return}this._searchPrefix+=e.key;clearTimeout(this._searchPrefixTimer);this._searchPrefixTimer=window.setTimeout((()=>{this._searchPrefix=""}),se);this.selectByPrefix();e.stopPropagation();e.preventDefault()}}evtDblClick(e){if(e.button!==0){return}if(e.ctrlKey||e.shiftKey||e.altKey||e.metaKey){return}if(this.isWithinCheckboxHitArea(e)){return}e.preventDefault();e.stopPropagation();clearTimeout(this._selectTimer);this._editNode.blur();const t=e.target;const s=h.ArrayExt.findFirstIndex(this._items,(e=>e.contains(t)));if(s===-1){return}const i=this._sortedItems[s];this.handleOpen(i)}evtNativeDrop(e){var t,s,n;const r=(t=e.dataTransfer)===null||t===void 0?void 0:t.files;if(!r||r.length===0){return}const o=(s=e.dataTransfer)===null||s===void 0?void 0:s.items.length;if(!o){return}for(let a=0;a<o;a++){let t=(n=e.dataTransfer)===null||n===void 0?void 0:n.items[a].webkitGetAsEntry();if(t===null||t===void 0?void 0:t.isDirectory){console.log("currently not supporting drag + drop for folders");void(0,i.showDialog)({title:this._trans.__("Error Uploading Folder"),body:this._trans.__("Drag and Drop is currently not supported for folders"),buttons:[i.Dialog.cancelButton({label:this._trans.__("Close")})]})}}e.preventDefault();for(let i=0;i<r.length;i++){void this._model.upload(r[i])}}evtDragEnter(e){if(e.mimeData.hasData(Y)){const t=ae.hitTestNodes(this._items,e);if(t===-1){return}const s=this._sortedItems[t];if(s.type!=="directory"||this.selection[s.path]){return}const i=e.target;i.classList.add(X);e.preventDefault();e.stopPropagation()}}evtDragLeave(e){e.preventDefault();e.stopPropagation();const t=i.DOMUtils.findElement(this.node,X);if(t){t.classList.remove(X)}}evtDragOver(e){e.preventDefault();e.stopPropagation();e.dropAction=e.proposedAction;const t=i.DOMUtils.findElement(this.node,X);if(t){t.classList.remove(X)}const s=ae.hitTestNodes(this._items,e);this._items[s].classList.add(X)}evtDrop(e){e.preventDefault();e.stopPropagation();clearTimeout(this._selectTimer);if(e.proposedAction==="none"){e.dropAction="none";return}if(!e.mimeData.hasData(Y)){return}let t=e.target;while(t&&t.parentElement){if(t.classList.contains(X)){t.classList.remove(X);break}t=t.parentElement}const s=h.ArrayExt.firstIndexOf(this._items,t);const n=this._sortedItems;let r=this._model.path;if(n[s].type==="directory"){r=l.PathExt.join(r,n[s].name)}const o=this._manager;const a=[];const c=e.mimeData.getData(Y);if(e.ctrlKey&&e.proposedAction==="move"){e.dropAction="copy"}else{e.dropAction=e.proposedAction}for(const i of c){const t=o.services.contents.localPath(i);const s=l.PathExt.basename(t);const n=l.PathExt.join(r,s);if(n===i){continue}if(e.dropAction==="copy"){a.push(o.copy(i,r))}else{a.push((0,d.renameFile)(o,i,n))}}Promise.all(a).catch((e=>{void(0,i.showErrorMessage)(this._trans._p("showErrorMessage","Error while copying/moving files"),e)}))}_startDrag(e,t,s){let i=Object.keys(this.selection);const n=this._items[e];const r=this._sortedItems;let o;let a;if(!n.classList.contains($)){a=r[e];i=[a.path];o=[a]}else{const e=i[0];a=r.find((t=>t.path===e));o=this.selectedItems()}if(!a){return}const l=this._manager.registry.getFileTypeForModel(a);const d=this.renderer.createDragImage(n,i.length,this._trans,l);this._drag=new E.Drag({dragImage:d,mimeData:new c.MimeData,supportedActions:"move",proposedAction:"move"});this._drag.mimeData.setData(Y,i);const h=this.model.manager.services;for(const c of o){this._drag.mimeData.setData(q,{model:c,withContent:async()=>await h.contents.get(c.path)})}if(a&&a.type!=="directory"){const e=i.slice(1).reverse();this._drag.mimeData.setData(re,(()=>{if(!a){return}const t=a.path;let s=this._manager.findWidget(t);if(!s){s=this._manager.open(a.path)}if(e.length){const t=new c.PromiseDelegate;void t.promise.then((()=>{let t=s;e.forEach((e=>{const s={ref:t===null||t===void 0?void 0:t.id,mode:"tab-after"};t=this._manager.openOrReveal(e,void 0,void 0,s);this._manager.openOrReveal(a.path)}))}));t.resolve(void 0)}return s}))}document.removeEventListener("mousemove",this,true);document.removeEventListener("mouseup",this,true);clearTimeout(this._selectTimer);void this._drag.start(t,s).then((e=>{this._drag=null;clearTimeout(this._selectTimer)}))}handleFileSelect(e){const t=this._sortedItems;const s=ae.hitTestNodes(this._items,e);clearTimeout(this._selectTimer);if(s===-1){return}this._softSelection="";const i=t[s].path;const n=Object.keys(this.selection);const r=e.button===0&&!(ne&&e.ctrlKey)&&this.isWithinCheckboxHitArea(e);if(ne&&e.metaKey||!ne&&e.ctrlKey||r){if(this.selection[i]){delete this.selection[i]}else{this.selection[i]=true}this._focusItem(s)}else if(e.shiftKey){this._handleMultiSelect(s);this._focusItem(s)}else if(i in this.selection&&n.length>1){this._softSelection=i}else{return this._selectItem(s,false,true)}this.update()}_focusItem(e){const t=this._items;if(t.length===0){this._focusIndex=0;this.node.focus();return}this._focusIndex=e;const s=t[e];const i=this.renderer.getNameNode(s);if(i){i.tabIndex=0;i.focus()}}_allSelectedBetween(e,t){if(e===t){return}const[s,i]=e<t?[e+1,t]:[t+1,e];return this._sortedItems.slice(s,i).reduce(((e,t)=>e&&this.selection[t.path]),true)}_handleMultiSelect(e){const t=this._sortedItems;const s=this._focusIndex;const i=t[e];let n=true;if(e===s){this.selection[i.path]=true;return}if(this.selection[i.path]){if(Math.abs(e-s)===1){const i=t[s];const n=t[s+(e<s?1:-1)];if(this.selection[i.path]&&(!n||!this.selection[n.path])){delete this.selection[i.path]}}else if(this._allSelectedBetween(s,e)){n=false}}const r=s<e?1:-1;for(let o=s;o!==e+r;o+=r){if(n){if(o===s){continue}this.selection[t[o].path]=true}else{if(o===e){continue}delete this.selection[t[o].path]}}}_copy(){this._clipboard.length=0;for(const e of this.selectedItems()){this._clipboard.push(e.path)}}async _delete(e){await Promise.all(e.map((e=>this._model.manager.deleteFile(e).catch((e=>{void(0,i.showErrorMessage)(this._trans._p("showErrorMessage","Delete Failed"),e)})))))}async _doRename(){this._inRename=true;const e=Object.keys(this.selection);if(e.length===0){this._inRename=false;return Promise.resolve("")}const t=this._sortedItems;let{path:s}=t[this._focusIndex];if(!this.selection[s]){s=e.slice(-1)[0]}const n=h.ArrayExt.findFirstIndex(t,(e=>e.path===s));const r=this._items[n];const o=t[n];const a=this.renderer.getNameNode(r);const c=o.name;this._editNode.value=c;this._selectItem(n,false,true);const u=await ae.userInputForRename(a,this._editNode,c);if(this.isDisposed){this._inRename=false;throw new Error("File browser is disposed.")}let m=u;if(!u||u===c){m=c}else if(!(0,d.isValidFileName)(u)){void(0,i.showErrorMessage)(this._trans.__("Rename Error"),Error(this._trans._p("showErrorMessage",'"%1" is not a valid name for a file. Names must have nonzero length, and cannot include "/", "\\", or ":"',u)));m=c}else{const e=this._manager;const t=l.PathExt.join(this._model.path,c);const s=l.PathExt.join(this._model.path,u);try{await(0,d.renameFile)(e,t,s)}catch(p){if(p!=="File not renamed"){void(0,i.showErrorMessage)(this._trans._p("showErrorMessage","Rename Error"),p)}m=c}if(this.isDisposed){this._inRename=false;throw new Error("File browser is disposed.")}}if(!this.isDisposed&&Object.keys(this.selection).length===1&&this.selection[o.path]){try{await this.selectItemByName(m,true)}catch(f){console.warn("After rename, failed to select file",m)}}this._inRename=false;return m}_selectItem(e,t,s=true){const i=this._sortedItems;if(!t){this.clearSelectedItems()}const n=i[e].path;this.selection[n]=true;if(s){this._focusItem(e)}this.update()}_onModelRefreshed(){const e=Object.keys(this.selection);this.clearSelectedItems();for(const t of this._model.items()){const s=t.path;if(e.indexOf(s)!==-1){this.selection[s]=true}}if(this.isVisible){this.sort(this.sortState)}else{this._isDirty=true}}_onPathChanged(){this.clearSelectedItems();this.sort(this.sortState);requestAnimationFrame((()=>{this._focusItem(0)}))}_onFileChanged(e,t){const s=t.newValue;if(!s){return}const i=s.name;if(t.type!=="new"||!i){return}void this.selectItemByName(i).catch((()=>{}))}_onActivateRequested(e,t){const s=l.PathExt.dirname(t);if(s!==this._model.path){return}const i=l.PathExt.basename(t);this.selectItemByName(i).catch((()=>{}))}}(function(e){class t{createNode(){const e=document.createElement("div");const t=document.createElement("div");const s=document.createElement("ul");s.setAttribute("data-lm-dragscroll","true");s.className=M;t.className=k;e.appendChild(t);e.appendChild(s);e.tabIndex=-1;return e}populateHeaderNode(e,t,s){t=t||r.nullTranslator;const n=t.load("jupyterlab");const o=this.createHeaderItemNode(n.__("Name"));const a=document.createElement("div");const l=this.createHeaderItemNode(n.__("Last Modified"));const d=this.createHeaderItemNode(n.__("File Size"));o.classList.add(R);o.classList.add($);l.classList.add(V);d.classList.add(K);a.classList.add(z);a.textContent="...";if(!(s===null||s===void 0?void 0:s.has("is_selected"))){const t=this.createCheckboxWrapperNode({alwaysVisible:true});e.appendChild(t)}e.appendChild(o);e.appendChild(a);e.appendChild(l);e.appendChild(d);if(s===null||s===void 0?void 0:s.has("last_modified")){l.classList.add(H)}else{l.classList.remove(H)}if(s===null||s===void 0?void 0:s.has("file_size")){d.classList.add(W)}else{d.classList.remove(W)}ae.updateCaret(i.DOMUtils.findElement(o,N),"right","up")}handleHeaderClick(e,t){const s=i.DOMUtils.findElement(e,R);const n=i.DOMUtils.findElement(e,V);const r=i.DOMUtils.findElement(e,K);const o={direction:"ascending",key:"name"};const a=t.target;const l=i.DOMUtils.findElement(n,N);const d=i.DOMUtils.findElement(r,N);const h=i.DOMUtils.findElement(s,N);if(s.contains(a)){if(s.classList.contains($)){if(!s.classList.contains(te)){o.direction="descending";s.classList.add(te);ae.updateCaret(h,"right","down")}else{s.classList.remove(te);ae.updateCaret(h,"right","up")}}else{s.classList.remove(te);ae.updateCaret(h,"right","up")}s.classList.add($);n.classList.remove($);n.classList.remove(te);r.classList.remove($);r.classList.remove(te);ae.updateCaret(l,"left");ae.updateCaret(d,"left");return o}if(n.contains(a)){o.key="last_modified";if(n.classList.contains($)){if(!n.classList.contains(te)){o.direction="descending";n.classList.add(te);ae.updateCaret(l,"left","down")}else{n.classList.remove(te);ae.updateCaret(l,"left","up")}}else{n.classList.remove(te);ae.updateCaret(l,"left","up")}n.classList.add($);s.classList.remove($);s.classList.remove(te);r.classList.remove($);r.classList.remove(te);ae.updateCaret(h,"right");ae.updateCaret(d,"left");return o}if(r.contains(a)){o.key="file_size";if(r.classList.contains($)){if(!r.classList.contains(te)){o.direction="descending";r.classList.add(te);ae.updateCaret(d,"left","down")}else{r.classList.remove(te);ae.updateCaret(d,"left","up")}}else{r.classList.remove(te);ae.updateCaret(d,"left","up")}r.classList.add($);s.classList.remove($);s.classList.remove(te);n.classList.remove($);n.classList.remove(te);ae.updateCaret(h,"right");ae.updateCaret(l,"left");return o}return o}createItemNode(e){const t=document.createElement("li");const s=document.createElement("span");const i=document.createElement("span");const n=document.createElement("span");const r=document.createElement("span");s.className=A;i.className=j;n.className=T;r.className=O;if(!(e===null||e===void 0?void 0:e.has("is_selected"))){const e=this.createCheckboxWrapperNode();t.appendChild(e)}t.appendChild(s);t.appendChild(i);t.appendChild(n);t.appendChild(r);if(e===null||e===void 0?void 0:e.has("last_modified")){n.classList.add(H)}else{n.classList.remove(H)}if(e===null||e===void 0?void 0:e.has("file_size")){r.classList.add(W)}else{r.classList.remove(W)}return t}createCheckboxWrapperNode(e){const t=document.createElement("label");t.classList.add(B);const s=document.createElement("input");s.type="checkbox";s.addEventListener("click",(e=>{e.preventDefault()}));if(e===null||e===void 0?void 0:e.alwaysVisible){t.classList.add("jp-mod-visible")}else{s.tabIndex=-1}t.appendChild(s);return t}updateItemNode(e,t,s,n,a,d){if(d){e.classList.add($)}s=s||C.DocumentRegistry.getDefaultTextFileType(n);const{icon:c,iconClass:u,name:m}=s;n=n||r.nullTranslator;const p=n.load("jupyterlab");const f=i.DOMUtils.findElement(e,A);const _=i.DOMUtils.findElement(e,j);const g=i.DOMUtils.findElement(e,T);const v=i.DOMUtils.findElement(e,O);const w=i.DOMUtils.findElement(e,B);const y=!(a===null||a===void 0?void 0:a.has("is_selected"));if(w&&!y){e.removeChild(w)}else if(y&&!w){const t=this.createCheckboxWrapperNode();e.insertBefore(t,f)}if(a===null||a===void 0?void 0:a.has("last_modified")){g.classList.add(H)}else{g.classList.remove(H)}if(a===null||a===void 0?void 0:a.has("file_size")){v.classList.add(W)}else{v.classList.remove(W)}o.LabIcon.resolveElement({icon:c,iconClass:(0,o.classes)(u,"jp-Icon"),container:f,className:A,stylesheet:"listing"});let b=p.__("Name: %1",t.name);if(t.size!==null&&t.size!==undefined){const e=ae.formatFileSize(t.size,1,1024);v.textContent=e;b+=p.__("\nSize: %1",ae.formatFileSize(t.size,1,1024))}else{v.textContent=""}if(t.path){const e=l.PathExt.dirname(t.path);if(e){b+=p.__("\nPath: %1",e.substr(0,50));if(e.length>50){b+="..."}}}if(t.created){b+=p.__("\nCreated: %1",l.Time.format(new Date(t.created)))}if(t.last_modified){b+=p.__("\nModified: %1",l.Time.format(new Date(t.last_modified)))}b+=p.__("\nWritable: %1",t.writable);e.title=b;e.setAttribute("data-file-type",m);if(t.name.startsWith(".")){e.setAttribute("data-is-dot","true")}else{e.removeAttribute("data-is-dot")}const E=!t.indices?[]:t.indices;let D=h.StringExt.highlight(t.name,E,I.h.mark);if(_){I.VirtualDOM.render(I.h.span(D),_)}const L=w===null||w===void 0?void 0:w.querySelector('input[type="checkbox"]');if(L){let e;if(s.contentType==="directory"){e=d?p.__('Deselect directory "%1"',D):p.__('Select directory "%1"',D)}else{e=d?p.__('Deselect file "%1"',D):p.__('Select file "%1"',D)}L.setAttribute("aria-label",e);L.checked=d!==null&&d!==void 0?d:false}let x="";let k="";if(t.last_modified){x=l.Time.formatHuman(new Date(t.last_modified));k=l.Time.format(new Date(t.last_modified))}g.textContent=x;g.title=k}getNameNode(e){return i.DOMUtils.findElement(e,j)}getCheckboxNode(e){return e.querySelector(`.${B} input[type=checkbox]`)}createDragImage(e,t,s,n){const r=e.cloneNode(true);const o=i.DOMUtils.findElement(r,T);const a=i.DOMUtils.findElement(r,A);r.removeChild(o);if(!n){a.textContent="";a.className=""}else{a.textContent=n.iconLabel||"";a.className=n.iconClass||""}a.classList.add(G);if(t>1){const e=i.DOMUtils.findElement(r,j);e.textContent=s._n("%1 Item","%1 Items",t)}return r}createHeaderItemNode(e){const t=document.createElement("div");const s=document.createElement("span");const i=document.createElement("span");t.className=P;s.className=F;i.className=N;s.textContent=e;t.appendChild(s);t.appendChild(i);return t}}e.Renderer=t;e.defaultRenderer=new t})(oe||(oe={}));var ae;(function(e){function t(e,t,s){const i=e.parentElement;i.replaceChild(t,e);t.focus();const n=t.value.lastIndexOf(".");if(n===-1){t.setSelectionRange(0,t.value.length)}else{t.setSelectionRange(0,n)}return new Promise((n=>{t.onblur=()=>{i.replaceChild(e,t);n(t.value)};t.onkeydown=i=>{switch(i.keyCode){case 13:i.stopPropagation();i.preventDefault();t.blur();break;case 27:i.stopPropagation();i.preventDefault();t.value=s;t.blur();e.focus();break;default:break}}}))}e.userInputForRename=t;function s(e,t,s=false){const i=Array.from(e);const n=t.direction==="descending"?1:-1;function r(e,t){if(s){return e.type!==t.type}return e.type==="directory"!==(t.type==="directory")}function o(e){if(e.type==="directory"){return 2}if(e.type==="notebook"&&s){return 1}return 0}function a(e){return(t,s)=>{if(r(t,s)){return o(s)-o(t)}const i=e(t,s);if(i!==0){return i*n}return t.name.localeCompare(s.name)}}if(t.key==="last_modified"){i.sort(a(((e,t)=>new Date(e.last_modified).getTime()-new Date(t.last_modified).getTime())))}else if(t.key==="file_size"){i.sort(a(((e,t)=>{var s,i;return((s=e.size)!==null&&s!==void 0?s:0)-((i=t.size)!==null&&i!==void 0?i:0)})))}else{i.sort(a(((e,t)=>t.name.localeCompare(e.name))))}return i}e.sort=s;function i(e,t){return h.ArrayExt.findFirstIndex(e,(e=>u.ElementExt.hitTest(e,t.clientX,t.clientY)||t.target===e))}e.hitTestNodes=i;function n(e,t,s){if(e===0){return"0 B"}const i=t||2;const n=["B","KB","MB","GB","TB","PB","EB","ZB","YB"];const r=Math.floor(Math.log(e)/Math.log(s));if(r>=0&&r<n.length){return parseFloat((e/Math.pow(s,r)).toFixed(i))+" "+n[r]}else{return String(e)}}e.formatFileSize=n;function r(e,t,s){if(s){(s==="down"?o.caretDownIcon:o.caretUpIcon).element({container:e,tag:"span",stylesheet:"listingHeaderItem",float:t})}else{o.LabIcon.remove(e);e.className=N}}e.updateCaret=r})(ae||(ae={}));const le="jp-FileBrowser";const de="jp-FileBrowser-Panel";const he="jp-FileBrowser-crumbs";const ce="jp-FileBrowser-toolbar";const ue="jp-FileBrowser-listing";class me extends o.SidePanel{constructor(e){var t;super({content:new a.Panel,translator:e.translator});this._directoryPending=null;this._filePending=null;this._showLastModifiedColumn=true;this._showFileSizeColumn=false;this._showHiddenFiles=false;this._showFileCheckboxes=false;this._sortNotebooksFirst=false;this.addClass(le);this.toolbar.addClass(ce);this.id=e.id;const s=this.translator=(t=e.translator)!==null&&t!==void 0?t:r.nullTranslator;const i=this.model=e.model;const n=e.renderer;i.connectionFailure.connect(this._onConnectionFailure,this);this._manager=i.manager;this.toolbar.node.setAttribute("aria-label",this._trans.__("file browser"));this.mainPanel=new a.Panel;this.mainPanel.addClass(de);this.mainPanel.title.label=this._trans.__("File Browser");this.crumbs=new y({model:i,translator:s});this.crumbs.addClass(he);this.listing=this.createDirListing({model:i,renderer:n,translator:s});this.listing.addClass(ue);this.mainPanel.addWidget(this.crumbs);this.mainPanel.addWidget(this.listing);this.addWidget(this.mainPanel);if(e.restore!==false){void i.restore(this.id)}}get navigateToCurrentDirectory(){return this._navigateToCurrentDirectory}set navigateToCurrentDirectory(e){this._navigateToCurrentDirectory=e}get showLastModifiedColumn(){return this._showLastModifiedColumn}set showLastModifiedColumn(e){if(this.listing.setColumnVisibility){this.listing.setColumnVisibility("last_modified",e);this._showLastModifiedColumn=e}else{console.warn("Listing does not support toggling column visibility")}}get showFullPath(){return this.crumbs.fullPath}set showFullPath(e){this.crumbs.fullPath=e}get showFileSizeColumn(){return this._showFileSizeColumn}set showFileSizeColumn(e){if(this.listing.setColumnVisibility){this.listing.setColumnVisibility("file_size",e);this._showFileSizeColumn=e}else{console.warn("Listing does not support toggling column visibility")}}get showHiddenFiles(){return this._showHiddenFiles}set showHiddenFiles(e){this.model.showHiddenFiles(e);this._showHiddenFiles=e}get showFileCheckboxes(){return this._showFileCheckboxes}set showFileCheckboxes(e){if(this.listing.setColumnVisibility){this.listing.setColumnVisibility("is_selected",e);this._showFileCheckboxes=e}else{console.warn("Listing does not support toggling column visibility")}}get sortNotebooksFirst(){return this._sortNotebooksFirst}set sortNotebooksFirst(e){if(this.listing.setNotebooksFirstSorting){this.listing.setNotebooksFirstSorting(e);this._sortNotebooksFirst=e}else{console.warn("Listing does not support sorting notebooks first")}}selectedItems(){return this.listing.selectedItems()}async selectItemByName(e){await this.listing.selectItemByName(e)}clearSelectedItems(){this.listing.clearSelectedItems()}rename(){return this.listing.rename()}cut(){this.listing.cut()}copy(){this.listing.copy()}paste(){return this.listing.paste()}async _createNew(e){try{const t=await this._manager.newUntitled(e);await this.listing.selectItemByName(t.name,true);await this.rename();return t}catch(t){void(0,i.showErrorMessage)(this._trans.__("Error"),t);throw t}}async createNewDirectory(){if(this._directoryPending){return this._directoryPending}this._directoryPending=this._createNew({path:this.model.path,type:"directory"});try{return await this._directoryPending}finally{this._directoryPending=null}}async createNewFile(e){if(this._filePending){return this._filePending}this._filePending=this._createNew({path:this.model.path,type:"file",ext:e.ext});try{return await this._filePending}finally{this._filePending=null}}delete(){return this.listing.delete()}duplicate(){return this.listing.duplicate()}download(){return this.listing.download()}async goUp(){return this.listing.goUp()}shutdownKernels(){return this.listing.shutdownKernels()}selectNext(){this.listing.selectNext()}selectPrevious(){this.listing.selectPrevious()}modelForClick(e){return this.listing.modelForClick(e)}createDirListing(e){return new oe(e)}_onConnectionFailure(e,t){if(t instanceof n.ServerConnection.ResponseError&&t.response.status===404){const e=this._trans.__("Directory not found");t.message=this._trans.__('Directory not found: "%1"',this.model.path);void(0,i.showErrorMessage)(e,t)}}}var pe=s(65061);const fe=1e4;const _e=15*1024*1024;const ge=1024*1024;class ve{constructor(e){var t;this._connectionFailure=new L.Signal(this);this._fileChanged=new L.Signal(this);this._items=[];this._key="";this._pathChanged=new L.Signal(this);this._paths=new Set;this._pending=null;this._pendingPath=null;this._refreshed=new L.Signal(this);this._sessions=[];this._state=null;this._isDisposed=false;this._restored=new c.PromiseDelegate;this._uploads=[];this._uploadChanged=new L.Signal(this);this.manager=e.manager;this.translator=e.translator||r.nullTranslator;this._trans=this.translator.load("jupyterlab");this._driveName=e.driveName||"";this._model={path:this.rootPath,name:l.PathExt.basename(this.rootPath),type:"directory",content:undefined,writable:false,created:"unknown",last_modified:"unknown",mimetype:"text/plain",format:"text"};this._state=e.state||null;const s=e.refreshInterval||fe;const{services:i}=e.manager;i.contents.fileChanged.connect(this.onFileChanged,this);i.sessions.runningChanged.connect(this.onRunningChanged,this);this._unloadEventListener=e=>{if(this._uploads.length>0){const t=this._trans.__("Files still uploading");e.returnValue=t;return t}};window.addEventListener("beforeunload",this._unloadEventListener);this._poll=new pe.Poll({auto:(t=e.auto)!==null&&t!==void 0?t:true,name:"@jupyterlab/filebrowser:Model",factory:()=>this.cd("."),frequency:{interval:s,backoff:true,max:300*1e3},standby:e.refreshStandby||"when-hidden"})}get connectionFailure(){return this._connectionFailure}get driveName(){return this._driveName}get restored(){return this._restored.promise}get fileChanged(){return this._fileChanged}get path(){return this._model?this._model.path:""}get rootPath(){return this._driveName?this._driveName+":":""}get pathChanged(){return this._pathChanged}get refreshed(){return this._refreshed}get specs(){return this.manager.services.kernelspecs.specs}get isDisposed(){return this._isDisposed}get uploadChanged(){return this._uploadChanged}uploads(){return this._uploads[Symbol.iterator]()}dispose(){if(this.isDisposed){return}window.removeEventListener("beforeunload",this._unloadEventListener);this._isDisposed=true;this._poll.dispose();this._sessions.length=0;this._items.length=0;L.Signal.clearData(this)}items(){return this._items[Symbol.iterator]()}sessions(){return this._sessions[Symbol.iterator]()}async refresh(){await this._poll.refresh();await this._poll.tick;this._refreshed.emit(void 0)}async cd(e="."){if(e!=="."){e=this.manager.services.contents.resolvePath(this._model.path,e)}else{e=this._pendingPath||this._model.path}if(this._pending){if(e===this._pendingPath){return this._pending}await this._pending}const t=this.path;const s={content:true};this._pendingPath=e;if(t!==e){this._sessions.length=0}const i=this.manager.services;this._pending=i.contents.get(e,s).then((s=>{if(this.isDisposed){return}this.handleContents(s);this._pendingPath=null;this._pending=null;if(t!==e){if(this._state&&this._key){void this._state.save(this._key,{path:e})}this._pathChanged.emit({name:"path",oldValue:t,newValue:e})}this.onRunningChanged(i.sessions,i.sessions.running());this._refreshed.emit(void 0)})).catch((t=>{this._pendingPath=null;this._pending=null;if(t.response&&t.response.status===404&&e!=="/"){t.message=this._trans.__('Directory not found: "%1"',this._model.path);console.error(t);this._connectionFailure.emit(t);return this.cd("/")}else{this._connectionFailure.emit(t)}}));return this._pending}async download(e){const t=await this.manager.services.contents.getDownloadUrl(e);const s=document.createElement("a");s.href=t;s.download="";document.body.appendChild(s);s.click();document.body.removeChild(s);return void 0}async restore(e,t=true){const{manager:s}=this;const i=`file-browser-${e}:cwd`;const n=this._state;const r=!!this._key;if(r){return}this._key=i;if(!t||!n){this._restored.resolve(undefined);return}await s.services.ready;try{const e=await n.fetch(i);if(!e){this._restored.resolve(undefined);return}const t=e["path"];if(t){await this.cd("/")}const r=s.services.contents.localPath(t);await s.services.contents.get(t);await this.cd(r)}catch(o){await n.remove(i)}this._restored.resolve(undefined)}async upload(e){const t=l.PageConfig.getNotebookVersion();const s=t<[4,0,0]||t>=[5,1,0];const i=e.size>_e;if(i&&!s){const t=this._trans.__("Cannot upload file (>%1 MB). %2",_e/(1024*1024),e.name);console.warn(t);throw t}const n="File not uploaded";if(i&&!(await this._shouldUploadLarge(e))){throw"Cancelled large file upload"}await this._uploadCheckDisposed();await this.refresh();await this._uploadCheckDisposed();if(this._items.find((t=>t.name===e.name))&&!(await(0,d.shouldOverwrite)(e.name))){throw n}await this._uploadCheckDisposed();const r=s&&e.size>ge;return await this._upload(e,r)}async _shouldUploadLarge(e){const{button:t}=await(0,i.showDialog)({title:this._trans.__("Large file size warning"),body:this._trans.__("The file size is %1 MB. Do you still want to upload it?",Math.round(e.size/(1024*1024))),buttons:[i.Dialog.cancelButton({label:this._trans.__("Cancel")}),i.Dialog.warnButton({label:this._trans.__("Upload")})]});return t.accept}async _upload(e,t){let s=this._model.path;s=s?s+"/"+e.name:e.name;const i=e.name;const n="file";const r="base64";const o=async(t,o)=>{await this._uploadCheckDisposed();const a=new FileReader;a.readAsDataURL(t);await new Promise(((t,s)=>{a.onload=t;a.onerror=t=>s(`Failed to upload "${e.name}":`+t)}));await this._uploadCheckDisposed();const l=a.result.split(",")[1];const d={type:n,format:r,name:i,chunk:o,content:l};return await this.manager.services.contents.save(s,d)};if(!t){try{return await o(e)}catch(d){h.ArrayExt.removeFirstWhere(this._uploads,(t=>e.name===t.path));throw d}}let a;let l={path:s,progress:0};this._uploadChanged.emit({name:"start",newValue:l,oldValue:null});for(let c=0;!a;c+=ge){const t=c+ge;const i=t>=e.size;const n=i?-1:t/ge;const r={path:s,progress:c/e.size};this._uploads.splice(this._uploads.indexOf(l));this._uploads.push(r);this._uploadChanged.emit({name:"update",newValue:r,oldValue:l});l=r;let u;try{u=await o(e.slice(c,t),n)}catch(d){h.ArrayExt.removeFirstWhere(this._uploads,(t=>e.name===t.path));this._uploadChanged.emit({name:"failure",newValue:l,oldValue:null});throw d}if(i){a=u}}this._uploads.splice(this._uploads.indexOf(l));this._uploadChanged.emit({name:"finish",newValue:null,oldValue:l});return a}_uploadCheckDisposed(){if(this.isDisposed){return Promise.reject("Filemanager disposed. File upload canceled")}return Promise.resolve()}handleContents(e){this._model={name:e.name,path:e.path,type:e.type,content:undefined,writable:e.writable,created:e.created,last_modified:e.last_modified,size:e.size,mimetype:e.mimetype,format:e.format};this._items=e.content;this._paths.clear();e.content.forEach((e=>{this._paths.add(e.path)}))}onRunningChanged(e,t){this._populateSessions(t);this._refreshed.emit(void 0)}onFileChanged(e,t){const s=this._model.path;const{sessions:i}=this.manager.services;const{oldValue:n,newValue:r}=t;const o=n&&n.path&&l.PathExt.dirname(n.path)===s?n:r&&r.path&&l.PathExt.dirname(r.path)===s?r:undefined;if(o){void this._poll.refresh();this._populateSessions(i.running());this._fileChanged.emit(t);return}}_populateSessions(e){this._sessions.length=0;for(const t of e){if(this._paths.has(t.path)){this._sessions.push(t)}}}}class we extends ve{constructor(e){super(e);this._includeHiddenFiles=e.includeHiddenFiles||false}items(){return this._includeHiddenFiles?super.items():(0,h.filter)(super.items(),(e=>!e.name.startsWith(".")))}showHiddenFiles(e){this._includeHiddenFiles=e;void this.refresh()}}class ye extends we{constructor(e){var t,s;super(e);this._filter=(t=e.filter)!==null&&t!==void 0?t:e=>({});this._filterDirectories=(s=e.filterDirectories)!==null&&s!==void 0?s:true}get filterDirectories(){return this._filterDirectories}set filterDirectories(e){this._filterDirectories=e}items(){return(0,h.filter)(super.items(),(e=>{if(!this._filterDirectories&&e.type==="directory"){return true}else{const t=this._filter(e);e.indices=t===null||t===void 0?void 0:t.indices;return!!t}}))}setFilter(e){this._filter=e;void this.refresh()}}const be="jp-Open-Dialog";var Ce;(function(e){async function t(e){const t=e.translator||r.nullTranslator;const s=t.load("jupyterlab");const n=new Ee(e.manager,e.filter,t,e.defaultPath);const o={title:e.title,buttons:[i.Dialog.cancelButton(),i.Dialog.okButton({label:s.__("Select")})],focusNodeSelector:e.focusNodeSelector,host:e.host,renderer:e.renderer,body:n};await n.ready;const a=new i.Dialog(o);return a.launch()}e.getOpenFiles=t;function s(e){return t({...e,filter:e=>e.type==="directory"?{}:null})}e.getExistingDirectory=s})(Ce||(Ce={}));class Ee extends a.Widget{constructor(e,t,s,n,l){super();this._ready=new c.PromiseDelegate;s=s!==null&&s!==void 0?s:r.nullTranslator;const d=s.load("jupyterlab");this.addClass(be);De.createFilteredFileBrowser("filtered-file-browser-dialog",e,t,{},s,n,l).then((e=>{this._browser=e;(0,i.setToolbar)(this._browser,(e=>[{name:"new-folder",widget:new i.ToolbarButton({icon:o.newFolderIcon,onClick:()=>{void e.createNewDirectory()},tooltip:d.__("New Folder")})},{name:"refresher",widget:new i.ToolbarButton({icon:o.refreshIcon,onClick:()=>{e.model.refresh().catch((e=>{console.error("Failed to refresh file browser in open dialog.",e)}))},tooltip:d.__("Refresh File List")})}]));const t=new a.PanelLayout;t.addWidget(this._browser);this.dispose=()=>{if(this.isDisposed){return}this._browser.model.dispose();super.dispose()};this.layout=t;this._ready.resolve()})).catch((e=>{console.error("Error while creating file browser in open dialog",e);this._ready.reject(void 0)}))}getValue(){const e=Array.from(this._browser.selectedItems());if(e.length===0){return[{path:this._browser.model.path,name:l.PathExt.basename(this._browser.model.path),type:"directory",content:undefined,writable:false,created:"unknown",last_modified:"unknown",mimetype:"text/plain",format:"text"}]}else{return e}}get ready(){return this._ready.promise}}var De;(function(e){e.createFilteredFileBrowser=async(e,t,s,i={},n,o,a)=>{n=n||r.nullTranslator;const l=new ye({manager:t,filter:s,translator:n,driveName:i.driveName,refreshInterval:i.refreshInterval,filterDirectories:a});const d=new me({id:e,model:l,translator:n});if(o){await d.model.cd(o)}return d}})(De||(De={}));const Le=new c.Token("@jupyterlab/filebrowser:IFileBrowserFactory",`A factory object that creates file browsers.\n  Use this if you want to create your own file browser (e.g., for a custom storage backend),\n  or to interact with other file browsers that have been created by extensions.`);const Ie=new c.Token("@jupyterlab/filebrowser:IDefaultFileBrowser","A service for the default file browser.");const xe=new c.Token("@jupyterlab/filebrowser:IFileBrowserCommands","A token to ensure file browser commands are loaded.");class ke extends o.ToolbarButton{constructor(e){super({icon:o.fileUploadIcon,label:e.label,onClick:()=>{this._input.click()},tooltip:Pe.translateToolTip(e.translator)});this._onInputChanged=()=>{const e=Array.prototype.slice.call(this._input.files);const t=e.map((e=>this.fileBrowserModel.upload(e)));void Promise.all(t).catch((e=>{void(0,i.showErrorMessage)(this._trans._p("showErrorMessage","Upload Error"),e)}))};this._onInputClicked=()=>{this._input.value=""};this._input=Pe.createUploadInput();this.fileBrowserModel=e.model;this.translator=e.translator||r.nullTranslator;this._trans=this.translator.load("jupyterlab");this._input.onclick=this._onInputClicked;this._input.onchange=this._onInputChanged;this.addClass("jp-id-upload")}}var Pe;(function(e){function t(){const e=document.createElement("input");e.type="file";e.multiple=true;return e}e.createUploadInput=t;function s(e){e=e||r.nullTranslator;const t=e.load("jupyterlab");return t.__("Upload Files")}e.translateToolTip=s})(Pe||(Pe={}));var Fe=s(53825);var Ne=s(37900);var Me=s.n(Ne);const Se=4;function je(e){const t=e.translator||r.nullTranslator;const s=t.load("jupyterlab");return Me().createElement(Fe.GroupItem,{spacing:Se},Me().createElement(Fe.TextItem,{source:s.__("Uploading…")}),Me().createElement(Fe.ProgressBar,{percentage:e.upload}))}const Ae=2e3;class Te extends o.VDomRenderer{constructor(e){super(new Te.Model(e.tracker.currentWidget&&e.tracker.currentWidget.model));this._onBrowserChange=(e,t)=>{if(t===null){this.model.browserModel=null}else{this.model.browserModel=t.model}};this.translator=e.translator||r.nullTranslator;this._trans=this.translator.load("jupyterlab");this._tracker=e.tracker;this._tracker.currentChanged.connect(this._onBrowserChange)}render(){const e=this.model.items;if(e.length>0){const e=this.model.items[0];if(e.complete){return Me().createElement(Fe.TextItem,{source:this._trans.__("Complete!")})}else{return Me().createElement(je,{upload:this.model.items[0].progress,translator:this.translator})}}else{return Me().createElement(je,{upload:100,translator:this.translator})}}dispose(){super.dispose();this._tracker.currentChanged.disconnect(this._onBrowserChange)}}(function(e){class t extends o.VDomModel{constructor(e){super();this._uploadChanged=(e,t)=>{if(t.name==="start"){this._items.push({path:t.newValue.path,progress:t.newValue.progress*100,complete:false})}else if(t.name==="update"){const e=h.ArrayExt.findFirstIndex(this._items,(e=>e.path===t.oldValue.path));if(e!==-1){this._items[e].progress=t.newValue.progress*100}}else if(t.name==="finish"){const e=h.ArrayExt.findFirstValue(this._items,(e=>e.path===t.oldValue.path));if(e){e.complete=true;setTimeout((()=>{h.ArrayExt.removeFirstOf(this._items,e);this.stateChanged.emit(void 0)}),Ae)}}else if(t.name==="failure"){h.ArrayExt.removeFirstWhere(this._items,(e=>e.path===t.newValue.path))}this.stateChanged.emit(void 0)};this._items=[];this._browserModel=null;this.browserModel=e}get items(){return this._items}get browserModel(){return this._browserModel}set browserModel(e){const t=this._browserModel;if(t){t.uploadChanged.disconnect(this._uploadChanged)}this._browserModel=e;this._items=[];if(this._browserModel!==null){this._browserModel.uploadChanged.connect(this._uploadChanged)}this.stateChanged.emit(void 0)}}e.Model=t})(Te||(Te={}))}}]);
//# sourceMappingURL=3701.f5a2d1be109d8cfca344.js.map?v=f5a2d1be109d8cfca344