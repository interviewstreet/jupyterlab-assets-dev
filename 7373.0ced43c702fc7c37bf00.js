(self["webpackChunk_jupyterlab_application_top"]=self["webpackChunk_jupyterlab_application_top"]||[]).push([[7373],{6493:(e,t,s)=>{"use strict";s.d(t,{GL:()=>u,Ag:()=>g,xq:()=>y,oy:()=>m});var a=s(3260);var n=s(94072);var o=s(40870);var i=s(21332);var r=s(75736);var l=s(1872);var c=s(11038);var d=s.n(c);const h=3e4;class u extends r.y{constructor(e){super();this.doc=e;this.clientID=e.clientID;this.states=new Map;this.meta=new Map;this._checkInterval=setInterval((()=>{const e=o.ZG();if(this.getLocalState()!==null&&h/2<=e-this.meta.get(this.clientID).lastUpdated){this.setLocalState(this.getLocalState())}const t=[];this.meta.forEach(((s,a)=>{if(a!==this.clientID&&h<=e-s.lastUpdated&&this.states.has(a)){t.push(a)}}));if(t.length>0){g(this,t,"timeout")}}),i.GW(h/10));e.on("destroy",(()=>{this.destroy()}));this.setLocalState({})}destroy(){this.emit("destroy",[this]);this.setLocalState(null);super.destroy();clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){const t=this.clientID;const s=this.meta.get(t);const a=s===undefined?0:s.clock+1;const n=this.states.get(t);if(e===null){this.states.delete(t)}else{this.states.set(t,e)}this.meta.set(t,{clock:a,lastUpdated:o.ZG()});const i=[];const r=[];const c=[];const d=[];if(e===null){d.push(t)}else if(n==null){if(e!=null){i.push(t)}}else{r.push(t);if(!l.Hi(n,e)){c.push(t)}}if(i.length>0||c.length>0||d.length>0){this.emit("change",[{added:i,updated:c,removed:d},"local"])}this.emit("update",[{added:i,updated:r,removed:d},"local"])}setLocalStateField(e,t){const s=this.getLocalState();if(s!==null){this.setLocalState({...s,[e]:t})}}getStates(){return this.states}}const g=(e,t,s)=>{const a=[];for(let n=0;n<t.length;n++){const s=t[n];if(e.states.has(s)){e.states.delete(s);if(s===e.clientID){const t=e.meta.get(s);e.meta.set(s,{clock:t.clock+1,lastUpdated:o.ZG()})}a.push(s)}}if(a.length>0){e.emit("change",[{added:[],updated:[],removed:a},s]);e.emit("update",[{added:[],updated:[],removed:a},s])}};const y=(e,t,s=e.states)=>{const n=t.length;const o=a.Mf();a.uE(o,n);for(let i=0;i<n;i++){const n=t[i];const r=s.get(n)||null;const l=e.meta.get(n).clock;a.uE(o,n);a.uE(o,l);a.uw(o,JSON.stringify(r))}return a._f(o)};const p=(e,t)=>{const s=decoding.createDecoder(e);const a=encoding.createEncoder();const n=decoding.readVarUint(s);encoding.writeVarUint(a,n);for(let o=0;o<n;o++){const e=decoding.readVarUint(s);const n=decoding.readVarUint(s);const o=JSON.parse(decoding.readVarString(s));const i=t(o);encoding.writeVarUint(a,e);encoding.writeVarUint(a,n);encoding.writeVarString(a,JSON.stringify(i))}return encoding.toUint8Array(a)};const m=(e,t,s)=>{const a=n.l1(t);const i=o.ZG();const r=[];const c=[];const d=[];const h=[];const u=n.yg(a);for(let o=0;o<u;o++){const t=n.yg(a);let s=n.yg(a);const o=JSON.parse(n.kf(a));const u=e.meta.get(t);const g=e.states.get(t);const y=u===undefined?0:u.clock;if(y<s||y===s&&o===null&&e.states.has(t)){if(o===null){if(t===e.clientID&&e.getLocalState()!=null){s++}else{e.states.delete(t)}}else{e.states.set(t,o)}e.meta.set(t,{clock:s,lastUpdated:i});if(u===undefined&&o!==null){r.push(t)}else if(u!==undefined&&o===null){h.push(t)}else if(o!==null){if(!l.Hi(o,g)){d.push(t)}c.push(t)}}}if(r.length>0||d.length>0||h.length>0){e.emit("change",[{added:r,updated:d,removed:h},s])}if(r.length>0||c.length>0||h.length>0){e.emit("update",[{added:r,updated:c,removed:h},s])}}},47373:(e,t,s)=>{"use strict";s.r(t);s.d(t,{YBaseCell:()=>g,YCodeCell:()=>y,YDocument:()=>l,YFile:()=>c,YMarkdownCell:()=>m,YNotebook:()=>d,YRawCell:()=>p,convertYMapEventToMapChange:()=>f,createCellFromType:()=>h,createMutex:()=>v,createStandaloneCell:()=>u});var a=s(98034);var n=s(8595);var o=s(6493);var i=s(11038);const r=e=>JSON.parse(JSON.stringify(e));class l{constructor(){this.isDisposed=false;this.ydoc=new i.Doc;this.source=this.ydoc.getText("source");this.ystate=this.ydoc.getMap("state");this.undoManager=new i.UndoManager([this.source],{trackedOrigins:new Set([this])});this.awareness=new o.GL(this.ydoc);this._changed=new n.Signal(this)}get dirty(){return this.ystate.get("dirty")}set dirty(e){this.transact((()=>{this.ystate.set("dirty",e)}),false)}transact(e,t=true){this.ydoc.transact(e,t?this:null)}dispose(){this.isDisposed=true;this.ydoc.destroy()}canUndo(){return this.undoManager.undoStack.length>0}canRedo(){return this.undoManager.redoStack.length>0}undo(){this.undoManager.undo()}redo(){this.undoManager.redo()}clearUndoHistory(){this.undoManager.clear()}get changed(){return this._changed}}class c extends l{constructor(){super();this._modelObserver=e=>{const t={};t.sourceChange=e.changes.delta;this._changed.emit(t)};this._onStateChanged=e=>{const t=[];e.keysChanged.forEach((s=>{const a=e.changes.keys.get(s);if(a){t.push({name:s,oldValue:a.oldValue,newValue:this.ystate.get(s)})}}));this._changed.emit({stateChange:t})};this.ysource=this.ydoc.getText("source");this.ysource.observe(this._modelObserver);this.ystate.observe(this._onStateChanged)}dispose(){this.ysource.unobserve(this._modelObserver);this.ystate.unobserve(this._onStateChanged)}static create(){return new c}getSource(){return this.ysource.toString()}setSource(e){this.transact((()=>{const t=this.ysource;t.delete(0,t.length);t.insert(0,e)}))}updateSource(e,t,s=""){this.transact((()=>{const a=this.ysource;a.insert(e,s);a.delete(e+s.length,t-e)}))}}class d extends l{constructor(e){super();this._onAwarenessChanged=()=>{const e=this.awareness.getStates();e.forEach(((e,t)=>{var s,a;const n=e.user;const o=e.activeCellIndex;if(o&&n.userId){(s=this.cells[o.newValue])===null||s===void 0?void 0:s.addCollaborator(n);(a=this.cells[o.oldValue])===null||a===void 0?void 0:a.removeCollaborator(n)}}))};this._onYCellsChanged=e=>{e.changes.added.forEach((e=>{const t=e.content.type;if(!this._ycellMapping.has(t)){this._ycellMapping.set(t,h(t))}const s=this._ycellMapping.get(t);s._notebook=this;if(!this.disableDocumentWideUndoRedo){s._undoManager=this.undoManager}else{s._undoManager=new i.UndoManager([s.ymodel],{})}}));e.changes.deleted.forEach((e=>{const t=e.content.type;const s=this._ycellMapping.get(t);if(s){s.dispose();this._ycellMapping.delete(t)}}));let t=0;const s=[];e.changes.delta.forEach((e=>{if(e.insert!=null){const a=e.insert.map((e=>this._ycellMapping.get(e)));s.push({insert:a});this.cells.splice(t,0,...a);t+=e.insert.length}else if(e.delete!=null){s.push(e);this.cells.splice(t,e.delete)}else if(e.retain!=null){s.push(e);t+=e.retain}}));this._changed.emit({cellsChange:s})};this._onMetadataChanged=e=>{if(e.keysChanged.has("metadata")){const t=e.changes.keys.get("metadata");const s={oldValue:(t===null||t===void 0?void 0:t.oldValue)?t.oldValue:undefined,newValue:this.getMetadata()};this._changed.emit({metadataChange:s})}};this._onStateChanged=e=>{const t=[];e.keysChanged.forEach((s=>{const a=e.changes.keys.get(s);if(a){t.push({name:s,oldValue:a.oldValue,newValue:this.ystate.get(s)})}}));this._changed.emit({stateChange:t})};this.ycells=this.ydoc.getArray("cells");this.ymeta=this.ydoc.getMap("meta");this.ymodel=this.ydoc.getMap("model");this.undoManager=new i.UndoManager([this.ycells],{trackedOrigins:new Set([this])});this._ycellMapping=new Map;this._disableDocumentWideUndoRedo=e.disableDocumentWideUndoRedo;this.ycells.observe(this._onYCellsChanged);this.cells=this.ycells.toArray().map((e=>{if(!this._ycellMapping.has(e)){this._ycellMapping.set(e,h(e))}return this._ycellMapping.get(e)}));this.ymeta.observe(this._onMetadataChanged);this.ystate.observe(this._onStateChanged);this.awareness.on("change",this._onAwarenessChanged)}get nbformat(){return this.ystate.get("nbformat")}set nbformat(e){this.transact((()=>{this.ystate.set("nbformat",e)}),false)}get nbformat_minor(){return this.ystate.get("nbformatMinor")}set nbformat_minor(e){this.transact((()=>{this.ystate.set("nbformatMinor",e)}),false)}dispose(){this.ycells.unobserve(this._onYCellsChanged);this.ymeta.unobserve(this._onMetadataChanged);this.ystate.unobserve(this._onStateChanged)}getCell(e){return this.cells[e]}insertCell(e,t){this.insertCells(e,[t])}insertCells(e,t){t.forEach((e=>{this._ycellMapping.set(e.ymodel,e);if(!this.disableDocumentWideUndoRedo){e.undoManager=this.undoManager}}));this.transact((()=>{this.ycells.insert(e,t.map((e=>e.ymodel)))}))}moveCell(e,t){this.transact((()=>{const s=this.getCell(e).clone();this.deleteCell(e);this.insertCell(t,s)}))}deleteCell(e){this.deleteCellRange(e,e+1)}deleteCellRange(e,t){this.transact((()=>{this.ycells.delete(e,t-e)}))}getMetadata(){const e=this.ymeta.get("metadata");return e?r(e):{}}setMetadata(e){this.ymeta.set("metadata",r(e))}updateMetadata(e){this.ymeta.set("metadata",Object.assign({},this.getMetadata(),e))}notifyActiveCellIndex(e,t){this.awareness.setLocalStateField("activeCellIndex",{oldValue:e,newValue:t})}static create(e){return new d({disableDocumentWideUndoRedo:e})}get disableDocumentWideUndoRedo(){return this._disableDocumentWideUndoRedo}}const h=e=>{switch(e.get("cell_type")){case"code":return new y(e);case"markdown":return new m(e);case"raw":return new p(e);default:throw new Error("Found unknown cell type")}};const u=(e,t)=>{switch(e){case"markdown":return m.createStandalone(t);case"code":return y.createStandalone(t);default:return p.createStandalone(t)}};class g{constructor(e){this._notebook=null;this.isStandalone=false;this._modelObserver=e=>{const t={};const s=e.find((e=>e.target===this.ymodel.get("source")));if(s){t.sourceChange=s.changes.delta}const a=e.find((e=>e.target===this.ymodel.get("outputs")));if(a){t.outputsChange=a.changes.delta}const n=e.find((e=>e.target===this.ymodel));if(n&&n.keysChanged.has("metadata")){const e=n.changes.keys.get("metadata");t.metadataChange={oldValue:(e===null||e===void 0?void 0:e.oldValue)?e.oldValue:undefined,newValue:this.getMetadata()}}if(n&&n.keysChanged.has("execution_count")){const e=n.changes.keys.get("execution_count");t.executionCountChange={oldValue:e.oldValue,newValue:this.ymodel.get("execution_count")}}const o=this.ymodel.get("source");if(n&&n.keysChanged.has("source")){t.sourceChange=[{delete:this._prevSourceLength},{insert:o.toString()}]}this._prevSourceLength=o.length;this._changed.emit(t)};this.isDisposed=false;this._undoManager=null;this._changed=new n.Signal(this);this._collaborators=[];this.ymodel=e;const t=e.get("source");this._prevSourceLength=t?t.length:0;this.ymodel.observeDeep(this._modelObserver);this._awareness=null}get ysource(){return this.ymodel.get("source")}get awareness(){var e,t,s;return(s=(e=this._awareness)!==null&&e!==void 0?e:(t=this.notebook)===null||t===void 0?void 0:t.awareness)!==null&&s!==void 0?s:null}transact(e,t=true){this.notebook&&t?this.notebook.transact(e):this.ymodel.doc.transact(e,this)}get undoManager(){var e;if(!this.notebook){return this._undoManager}return((e=this.notebook)===null||e===void 0?void 0:e.disableDocumentWideUndoRedo)?this._undoManager:this.notebook.undoManager}set undoManager(e){this._undoManager=e}undo(){var e;(e=this.undoManager)===null||e===void 0?void 0:e.undo()}redo(){var e;(e=this.undoManager)===null||e===void 0?void 0:e.redo()}canUndo(){return!!this.undoManager&&this.undoManager.undoStack.length>0}canRedo(){return!!this.undoManager&&this.undoManager.redoStack.length>0}clearUndoHistory(){var e;(e=this.undoManager)===null||e===void 0?void 0:e.clear()}get notebook(){return this._notebook}static create(e=a.UUID.uuid4()){const t=new i.Map;const s=new i.Text;t.set("source",s);t.set("metadata",{});t.set("cell_type",this.prototype.cell_type);t.set("id",e);return new this(t)}static createStandalone(e){const t=this.create(e);t.isStandalone=true;const s=new i.Doc;s.getArray().insert(0,[t.ymodel]);t._awareness=new o.GL(s);t._undoManager=new i.UndoManager([t.ymodel],{trackedOrigins:new Set([t])});return t}clone(){const e=new i.Map;const t=new i.Text(this.getSource());e.set("source",t);e.set("metadata",this.getMetadata());e.set("cell_type",this.cell_type);e.set("id",this.getId());const s=this.constructor;const a=new s(e);a._undoManager=this.undoManager;return a}get changed(){return this._changed}dispose(){this.ymodel.unobserveDeep(this._modelObserver)}getAttachments(){return this.ymodel.get("attachments")}setAttachments(e){this.transact((()=>{if(e==null){this.ymodel.delete("attachments")}else{this.ymodel.set("attachments",e)}}))}getId(){return this.ymodel.get("id")}getSource(){return this.ymodel.get("source").toString()}setSource(e){const t=this.ymodel.get("source");this.transact((()=>{t.delete(0,t.length);t.insert(0,e)}))}updateSource(e,t,s=""){this.transact((()=>{const a=this.ysource;a.insert(e,s);a.delete(e+s.length,t-e)}))}get cell_type(){throw new Error("A YBaseCell must not be constructed")}addCollaborator(e){if(!e.userId)return;const t=this._collaborators.find((t=>e.userId===t.userId));if(t){return}const s=this._collaborators.slice();this._collaborators.push(e);const a={};a.collaboratorsChange={oldValue:s,newValue:this._collaborators};this._changed.emit(a)}removeCollaborator(e){if(!e.userId)return;const t=this._collaborators.find((t=>e.userId===t.userId));if(!t){return}const s=this._collaborators.slice();this._collaborators=this._collaborators.filter((t=>e.userId!==t.userId));const a={};a.collaboratorsChange={oldValue:s,newValue:this._collaborators};this._changed.emit(a)}getMetadata(){return r(this.ymodel.get("metadata"))}setMetadata(e){this.transact((()=>{this.ymodel.set("metadata",r(e))}))}toJSON(){return{id:this.getId(),cell_type:this.cell_type,source:this.getSource(),metadata:this.getMetadata()}}}class y extends g{get cell_type(){return"code"}get execution_count(){return this.ymodel.get("execution_count")}set execution_count(e){this.transact((()=>{this.ymodel.set("execution_count",e)}))}getOutputs(){return r(this.ymodel.get("outputs").toArray())}setOutputs(e){const t=this.ymodel.get("outputs");this.transact((()=>{t.delete(0,t.length);t.insert(0,e)}),false)}updateOutputs(e,t,s=[]){const a=this.ymodel.get("outputs");const n=t<a.length?t-e:a.length-e;this.transact((()=>{a.delete(e,n);a.insert(e,s)}),false)}static create(e){const t=super.create(e);t.ymodel.set("execution_count",0);t.ymodel.set("outputs",new i.Array);return t}static createStandalone(e){const t=super.createStandalone(e);t.ymodel.set("execution_count",null);t.ymodel.set("outputs",new i.Array);return t}clone(){const e=super.clone();const t=new i.Array;t.insert(0,this.getOutputs());e.ymodel.set("execution_count",this.execution_count);e.ymodel.set("outputs",t);return e}toJSON(){return{id:this.getId(),cell_type:"code",source:this.getSource(),metadata:this.getMetadata(),outputs:this.getOutputs(),execution_count:this.execution_count}}}class p extends g{static create(e){return super.create(e)}static createStandalone(e){return super.createStandalone(e)}get cell_type(){return"raw"}toJSON(){return{id:this.getId(),cell_type:"raw",source:this.getSource(),metadata:this.getMetadata(),attachments:this.getAttachments()}}}class m extends g{static create(e){return super.create(e)}static createStandalone(e){return super.createStandalone(e)}get cell_type(){return"markdown"}toJSON(){return{id:this.getId(),cell_type:"markdown",source:this.getSource(),metadata:this.getMetadata(),attachments:this.getAttachments()}}}const _=null&&d;function f(e){let t=new Map;e.changes.keys.forEach(((e,s)=>{t.set(s,{action:e.action,oldValue:e.oldValue,newValue:this.ymeta.get(s)})}));return t}const v=()=>{let e=true;return t=>{if(e){e=false;try{t()}finally{e=true}}}}}}]);
//# sourceMappingURL=7373.0ced43c702fc7c37bf00.js.map?v=0ced43c702fc7c37bf00