"use strict";(self["webpackChunk_jupyterlab_application_top"]=self["webpackChunk_jupyterlab_application_top"]||[]).push([[3865],{33865:(e,t,s)=>{s.r(t);s.d(t,{YBaseCell:()=>m,YCodeCell:()=>y,YDocument:()=>l,YFile:()=>h,YMarkdownCell:()=>_,YNotebook:()=>b,YRawCell:()=>f,convertYMapEventToMapChange:()=>a,createMutex:()=>n,createStandaloneCell:()=>g});function a(e){let t=new Map;e.changes.keys.forEach(((e,s)=>{t.set(s,{action:e.action,oldValue:e.oldValue,newValue:this.ymeta.get(s)})}));return t}const n=()=>{let e=true;return t=>{if(e){e=false;try{t()}finally{e=true}}}};var o=s(55172);var i=s(19289);var r=s(6493);var d=s(29925);class l{constructor(e){var t;this.onStateChanged=e=>{const t=new Array;e.keysChanged.forEach((s=>{const a=e.changes.keys.get(s);if(a){t.push({name:s,oldValue:a.oldValue,newValue:this.ystate.get(s)})}}));this._changed.emit({stateChange:t})};this._changed=new i.Signal(this);this._isDisposed=false;this._disposed=new i.Signal(this);this._ydoc=(t=e===null||e===void 0?void 0:e.ydoc)!==null&&t!==void 0?t:new d.Doc;this._ystate=this._ydoc.getMap("state");this._undoManager=new d.UndoManager([],{trackedOrigins:new Set([this]),doc:this._ydoc});this._awareness=new r.GL(this._ydoc);this._ystate.observe(this.onStateChanged)}get ydoc(){return this._ydoc}get ystate(){return this._ystate}get undoManager(){return this._undoManager}get awareness(){return this._awareness}get changed(){return this._changed}get disposed(){return this._disposed}get isDisposed(){return this._isDisposed}get state(){return o.JSONExt.deepCopy(this.ystate.toJSON())}canUndo(){return this.undoManager.undoStack.length>0}canRedo(){return this.undoManager.redoStack.length>0}dispose(){if(this._isDisposed){return}this._isDisposed=true;this.ystate.unobserve(this.onStateChanged);this.awareness.destroy();this.undoManager.destroy();this.ydoc.destroy();this._disposed.emit();i.Signal.clearData(this)}getState(e){const t=this.ystate.get(e);return typeof t==="undefined"?t:o.JSONExt.deepCopy(t)}setState(e,t){if(!o.JSONExt.deepEqual(this.ystate.get(e),t)){this.ystate.set(e,t)}}undo(){this.undoManager.undo()}redo(){this.undoManager.redo()}clearUndoHistory(){this.undoManager.clear()}transact(e,t=true){this.ydoc.transact(e,t?this:null)}}class h extends l{constructor(){super();this.version="1.0.0";this.ysource=this.ydoc.getText("source");this._modelObserver=e=>{this._changed.emit({sourceChange:e.changes.delta})};this.undoManager.addToScope(this.ysource);this.ysource.observe(this._modelObserver)}static create(){return new h}get source(){return this.getSource()}set source(e){this.setSource(e)}dispose(){if(this.isDisposed){return}this.ysource.unobserve(this._modelObserver);super.dispose()}getSource(){return this.ysource.toString()}setSource(e){this.transact((()=>{const t=this.ysource;t.delete(0,t.length);t.insert(0,e)}))}updateSource(e,t,s=""){this.transact((()=>{const a=this.ysource;a.insert(e,s);a.delete(e+s.length,t-e)}))}}const u=(e,t={})=>{switch(e.get("cell_type")){case"code":return new y(e,e.get("source"),e.get("outputs"),t);case"markdown":return new _(e,e.get("source"),t);case"raw":return new f(e,e.get("source"),t);default:throw new Error("Found unknown cell type")}};const c=(e,t)=>{var s,a;const n=new d.Map;const i=new d.Text;const r=new d.Map;n.set("source",i);n.set("metadata",r);n.set("cell_type",e.cell_type);n.set("id",(s=e.id)!==null&&s!==void 0?s:o.UUID.uuid4());let l;switch(e.cell_type){case"markdown":{l=new _(n,i,{notebook:t},r);if(e.attachments!=null){l.setAttachments(e.attachments)}break}case"code":{const s=new d.Array;n.set("outputs",s);l=new y(n,i,s,{notebook:t},r);const o=e;l.execution_count=(a=o.execution_count)!==null&&a!==void 0?a:null;if(o.outputs){l.setOutputs(o.outputs)}break}default:{l=new f(n,i,{notebook:t},r);if(e.attachments){l.setAttachments(e.attachments)}break}}if(e.metadata!=null){l.setMetadata(e.metadata)}if(e.source!=null){l.setSource(typeof e.source==="string"?e.source:e.source.join(""))}return l};const g=e=>c(e);class m{static create(e){return c({id:e,cell_type:this.prototype.cell_type})}constructor(e,t,s={},a){this._modelObserver=e=>{this._changed.emit(this.getChanges(e))};this._metadataChanged=new i.Signal(this);this._notebook=null;this._changed=new i.Signal(this);this._disposed=new i.Signal(this);this._isDisposed=false;this._undoManager=null;this._collaborators=[];this.ymodel=e;this._ysource=t;this._ymetadata=a!==null&&a!==void 0?a:this.ymodel.get("metadata");this._prevSourceLength=t?t.length:0;this._notebook=null;this._awareness=null;this._undoManager=null;if(s.notebook){this._notebook=s.notebook}else{const e=new d.Doc;e.getArray().insert(0,[this.ymodel]);this._awareness=new r.GL(e);this._undoManager=new d.UndoManager([this.ymodel],{trackedOrigins:new Set([this])})}this.ymodel.observeDeep(this._modelObserver)}get awareness(){var e,t,s;return(s=(e=this._awareness)!==null&&e!==void 0?e:(t=this.notebook)===null||t===void 0?void 0:t.awareness)!==null&&s!==void 0?s:null}get cell_type(){throw new Error("A YBaseCell must not be constructed")}addCollaborator(e){console.log("addCollaborator",e,this._collaborators);if(!e.username)return;const t=this._collaborators.find((t=>e.username===t.username));if(t){return}const s=this._collaborators.slice();this._collaborators.push(e);const a={};a.collaboratorsChange={oldValue:s,newValue:this._collaborators};console.log("changes",a);this._changed.emit(a)}removeCollaborator(e){console.log("removeCollaborator",e,this._collaborators);if(!e.username)return;const t=this._collaborators.find((t=>e.username===t.username));if(!t){return}const s=this._collaborators.slice();this._collaborators=this._collaborators.filter((t=>e.username!==t.username));const a={};a.collaboratorsChange={oldValue:s,newValue:this._collaborators};this._changed.emit(a)}get changed(){return this._changed}get disposed(){return this._disposed}get id(){return this.getId()}get isDisposed(){return this._isDisposed}get isStandalone(){return this._notebook!==null}get metadata(){return this.getMetadata()}set metadata(e){this.setMetadata(e)}get metadataChanged(){return this._metadataChanged}get notebook(){return this._notebook}get source(){return this.getSource()}set source(e){this.setSource(e)}get undoManager(){var e;if(!this.notebook){return this._undoManager}return((e=this.notebook)===null||e===void 0?void 0:e.disableDocumentWideUndoRedo)?this._undoManager:this.notebook.undoManager}setUndoManager(){if(this._undoManager){throw new Error("The cell undo manager is already set.")}if(this._notebook&&this._notebook.disableDocumentWideUndoRedo){this._undoManager=new d.UndoManager([this.ymodel],{trackedOrigins:new Set([this])})}}get ysource(){return this._ysource}canUndo(){return!!this.undoManager&&this.undoManager.undoStack.length>0}canRedo(){return!!this.undoManager&&this.undoManager.redoStack.length>0}clearUndoHistory(){var e;(e=this.undoManager)===null||e===void 0?void 0:e.clear()}undo(){var e;(e=this.undoManager)===null||e===void 0?void 0:e.undo()}redo(){var e;(e=this.undoManager)===null||e===void 0?void 0:e.redo()}dispose(){var e;if(this._isDisposed)return;this._isDisposed=true;this.ymodel.unobserveDeep(this._modelObserver);if(this._awareness){const e=this._awareness.doc;this._awareness.destroy();e.destroy()}if(this._undoManager){if(this._undoManager===((e=this.notebook)===null||e===void 0?void 0:e.undoManager)){this._undoManager=null}else{this._undoManager.destroy()}}this._disposed.emit();i.Signal.clearData(this)}getId(){return this.ymodel.get("id")}getSource(){return this.ysource.toString()}setSource(e){this.transact((()=>{this.ysource.delete(0,this.ysource.length);this.ysource.insert(0,e)}))}updateSource(e,t,s=""){this.transact((()=>{const a=this.ysource;a.insert(e,s);a.delete(e+s.length,t-e)}))}deleteMetadata(e){if(typeof this.getMetadata(e)==="undefined"){return}this.transact((()=>{this._ymetadata.delete(e);const t=this.getMetadata("jupyter");if(e==="collapsed"&&t){const{outputs_hidden:e,...s}=t;if(Object.keys(s).length===0){this._ymetadata.delete("jupyter")}else{this._ymetadata.set("jupyter",s)}}else if(e==="jupyter"){this._ymetadata.delete("collapsed")}}),false)}getMetadata(e){const t=this._ymetadata;if(t===undefined){return undefined}if(typeof e==="string"){const s=t.get(e);return typeof s==="undefined"?undefined:o.JSONExt.deepCopy(t.get(e))}else{return o.JSONExt.deepCopy(t.toJSON())}}setMetadata(e,t){var s,a;if(typeof e==="string"){if(typeof t==="undefined"){throw new TypeError(`Metadata value for ${e} cannot be 'undefined'; use deleteMetadata.`)}const a=e;if(o.JSONExt.deepEqual((s=this.getMetadata(a))!==null&&s!==void 0?s:null,t)){return}this.transact((()=>{var e;this._ymetadata.set(a,t);if(a==="collapsed"){const s=(e=this.getMetadata("jupyter"))!==null&&e!==void 0?e:{};if(s.outputs_hidden!==t){this.setMetadata("jupyter",{...s,outputs_hidden:t})}}else if(a==="jupyter"){const e=t["outputs_hidden"];if(typeof e!=="undefined"){if(this.getMetadata("collapsed")!==e){this.setMetadata("collapsed",e)}}else{this.deleteMetadata("collapsed")}}}),false)}else{const t=o.JSONExt.deepCopy(e);if(t.collapsed!=null){t.jupyter=t.jupyter||{};t.jupyter.outputs_hidden=t.collapsed}else if(((a=t===null||t===void 0?void 0:t.jupyter)===null||a===void 0?void 0:a.outputs_hidden)!=null){t.collapsed=t.jupyter.outputs_hidden}if(!o.JSONExt.deepEqual(t,this.getMetadata())){this.transact((()=>{for(const[e,s]of Object.entries(t)){this._ymetadata.set(e,s)}}),false)}}}toJSON(){return{id:this.getId(),cell_type:this.cell_type,source:this.getSource(),metadata:this.getMetadata()}}transact(e,t=true){!this.notebook||this.notebook.disableDocumentWideUndoRedo?this.ymodel.doc==null?e():this.ymodel.doc.transact(e,t?this:null):this.notebook.transact(e,t)}getChanges(e){const t={};const s=e.find((e=>e.target===this.ymodel.get("source")));if(s){t.sourceChange=s.changes.delta}const a=e.find((e=>e.target===this._ymetadata));if(a){t.metadataChange=a.changes.keys;a.changes.keys.forEach(((e,t)=>{switch(e.action){case"add":this._metadataChanged.emit({key:t,newValue:this._ymetadata.get(t),type:"add"});break;case"delete":this._metadataChanged.emit({key:t,oldValue:e.oldValue,type:"remove"});break;case"update":{const s=this._ymetadata.get(t);const a=e.oldValue;let n=true;if(typeof a=="object"&&typeof s=="object"){n=o.JSONExt.deepEqual(a,s)}else{n=a===s}if(!n){this._metadataChanged.emit({key:t,type:"change",oldValue:a,newValue:s})}}break}}))}const n=e.find((e=>e.target===this.ymodel));const i=this.ymodel.get("source");if(n&&n.keysChanged.has("source")){t.sourceChange=[{delete:this._prevSourceLength},{insert:i.toString()}]}this._prevSourceLength=i.length;return t}}class y extends m{static create(e){return super.create(e)}constructor(e,t,s,a={},n){super(e,t,a,n);this._youtputs=s}get cell_type(){return"code"}get execution_count(){return this.ymodel.get("execution_count")||null}set execution_count(e){if(this.ymodel.get("execution_count")!==e){this.transact((()=>{this.ymodel.set("execution_count",e)}),false)}}get outputs(){return this.getOutputs()}set outputs(e){this.setOutputs(e)}getOutputs(){return o.JSONExt.deepCopy(this._youtputs.toArray())}setOutputs(e){this.transact((()=>{this._youtputs.delete(0,this._youtputs.length);this._youtputs.insert(0,e)}),false)}updateOutputs(e,t,s=[]){const a=t<this._youtputs.length?t-e:this._youtputs.length-e;this.transact((()=>{this._youtputs.delete(e,a);this._youtputs.insert(e,s)}),false)}toJSON(){return{...super.toJSON(),outputs:this.getOutputs(),execution_count:this.execution_count}}getChanges(e){const t=super.getChanges(e);const s=e.find((e=>e.target===this.ymodel.get("outputs")));if(s){t.outputsChange=s.changes.delta}const a=e.find((e=>e.target===this.ymodel));if(a&&a.keysChanged.has("execution_count")){const e=a.changes.keys.get("execution_count");t.executionCountChange={oldValue:e.oldValue,newValue:this.ymodel.get("execution_count")}}return t}}class p extends m{get attachments(){return this.getAttachments()}set attachments(e){this.setAttachments(e)}getAttachments(){return this.ymodel.get("attachments")}setAttachments(e){this.transact((()=>{if(e==null){this.ymodel.delete("attachments")}else{this.ymodel.set("attachments",e)}}),false)}getChanges(e){const t=super.getChanges(e);const s=e.find((e=>e.target===this.ymodel));if(s&&s.keysChanged.has("attachments")){const e=s.changes.keys.get("attachments");t.executionCountChange={oldValue:e.oldValue,newValue:this.ymodel.get("attachments")}}return t}}class f extends p{static create(e){return super.create(e)}get cell_type(){return"raw"}toJSON(){return{id:this.getId(),cell_type:"raw",source:this.getSource(),metadata:this.getMetadata(),attachments:this.getAttachments()}}}class _ extends p{static create(e){return super.create(e)}get cell_type(){return"markdown"}toJSON(){return{id:this.getId(),cell_type:"markdown",source:this.getSource(),metadata:this.getMetadata(),attachments:this.getAttachments()}}}class b extends l{constructor(e={}){var t;super();this.version="1.0.0";this.ymeta=this.ydoc.getMap("meta");this._onAwarenessChanged=()=>{const e=this.awareness.getStates();console.log("_onAwarenessChanged >>>",e,this.awareness);e.forEach(((e,t)=>{var s,a;const n=e.user;const o=e.activeCellIndex;console.log("user >>> activeCellIndex",n,o);if(o&&(n===null||n===void 0?void 0:n.username)){console.log("activeCellIndex >>> user",n,o);(s=this.cells[o.newValue])===null||s===void 0?void 0:s.addCollaborator(n);(a=this.cells[o.oldValue])===null||a===void 0?void 0:a.removeCollaborator(n)}}))};this._onMetaChanged=e=>{const t=e.find((e=>e.target===this.ymeta.get("metadata")));if(t){const e=t.changes.keys;const s=this.ymeta.get("metadata");t.changes.keys.forEach(((e,t)=>{switch(e.action){case"add":this._metadataChanged.emit({key:t,type:"add",newValue:s.get(t)});break;case"delete":this._metadataChanged.emit({key:t,type:"remove",oldValue:e.oldValue});break;case"update":{const a=s.get(t);const n=e.oldValue;let i=true;if(typeof n=="object"&&typeof a=="object"){i=o.JSONExt.deepEqual(n,a)}else{i=n===a}if(!i){this._metadataChanged.emit({key:t,type:"change",oldValue:n,newValue:a})}}break}}));this._changed.emit({metadataChange:e})}const s=e.find((e=>e.target===this.ymeta));if(!s){return}if(s.keysChanged.has("metadata")){const e=s.changes.keys.get("metadata");if((e===null||e===void 0?void 0:e.action)==="add"&&!e.oldValue){const e=new Map;for(const t of Object.keys(this.metadata)){e.set(t,{action:"add",oldValue:undefined});this._metadataChanged.emit({key:t,type:"add",newValue:this.getMetadata(t)})}this._changed.emit({metadataChange:e})}}if(s.keysChanged.has("nbformat")){const e=s.changes.keys.get("nbformat");const t={key:"nbformat",oldValue:(e===null||e===void 0?void 0:e.oldValue)?e.oldValue:undefined,newValue:this.nbformat};this._changed.emit({nbformatChanged:t})}if(s.keysChanged.has("nbformat_minor")){const e=s.changes.keys.get("nbformat_minor");const t={key:"nbformat_minor",oldValue:(e===null||e===void 0?void 0:e.oldValue)?e.oldValue:undefined,newValue:this.nbformat_minor};this._changed.emit({nbformatChanged:t})}};this._onYCellsChanged=e=>{e.changes.added.forEach((e=>{const t=e.content.type;if(!this._ycellMapping.has(t)){const e=u(t,{notebook:this});e.setUndoManager();this._ycellMapping.set(t,e)}}));e.changes.deleted.forEach((e=>{const t=e.content.type;const s=this._ycellMapping.get(t);if(s){s.dispose();this._ycellMapping.delete(t)}}));let t=0;const s=[];e.changes.delta.forEach((e=>{if(e.insert!=null){const a=e.insert.map((e=>this._ycellMapping.get(e)));s.push({insert:a});this.cells.splice(t,0,...a);t+=e.insert.length}else if(e.delete!=null){s.push(e);this.cells.splice(t,e.delete)}else if(e.retain!=null){s.push(e);t+=e.retain}}));this._changed.emit({cellsChange:s})};this._metadataChanged=new i.Signal(this);this._ycells=this.ydoc.getArray("cells");this._ycellMapping=new WeakMap;this._disableDocumentWideUndoRedo=(t=e.disableDocumentWideUndoRedo)!==null&&t!==void 0?t:false;this.cells=this._ycells.toArray().map((e=>{if(!this._ycellMapping.has(e)){this._ycellMapping.set(e,u(e,{notebook:this}))}return this._ycellMapping.get(e)}));this.undoManager.addToScope(this._ycells);this._ycells.observe(this._onYCellsChanged);this.ymeta.observeDeep(this._onMetaChanged);console.log("this.awareness >>>",this.awareness);this.awareness.on("change",this._onAwarenessChanged)}static create(e={}){var t,s,a,n,o,i,r,d,l;const h=new b({disableDocumentWideUndoRedo:(t=e.disableDocumentWideUndoRedo)!==null&&t!==void 0?t:false});const u={cells:(a=(s=e.data)===null||s===void 0?void 0:s.cells)!==null&&a!==void 0?a:[],nbformat:(o=(n=e.data)===null||n===void 0?void 0:n.nbformat)!==null&&o!==void 0?o:4,nbformat_minor:(r=(i=e.data)===null||i===void 0?void 0:i.nbformat_minor)!==null&&r!==void 0?r:5,metadata:(l=(d=e.data)===null||d===void 0?void 0:d.metadata)!==null&&l!==void 0?l:{}};h.fromJSON(u);return h}get disableDocumentWideUndoRedo(){return this._disableDocumentWideUndoRedo}get metadata(){return this.getMetadata()}set metadata(e){this.setMetadata(e)}get metadataChanged(){return this._metadataChanged}get nbformat(){return this.ymeta.get("nbformat")}set nbformat(e){this.transact((()=>{this.ymeta.set("nbformat",e)}),false)}get nbformat_minor(){return this.ymeta.get("nbformat_minor")}set nbformat_minor(e){this.transact((()=>{this.ymeta.set("nbformat_minor",e)}),false)}dispose(){if(this.isDisposed){return}this._ycells.unobserve(this._onYCellsChanged);this.ymeta.unobserveDeep(this._onMetaChanged);super.dispose()}getCell(e){return this.cells[e]}addCell(e){return this.insertCell(this._ycells.length,e)}insertCell(e,t){return this.insertCells(e,[t])[0]}insertCells(e,t){const s=t.map((e=>{const t=c(e,this);this._ycellMapping.set(t.ymodel,t);return t}));this.transact((()=>{this._ycells.insert(e,s.map((e=>e.ymodel)))}));s.forEach((e=>{e.setUndoManager()}));return s}moveCell(e,t){this.moveCells(e,t)}moveCells(e,t,s=1){const a=new Array(s).fill(true).map(((t,s)=>this.getCell(e+s).toJSON()));this.transact((()=>{this._ycells.delete(e,s);this._ycells.insert(e>t?t:t-s+1,a.map((e=>c(e,this).ymodel)))}))}deleteCell(e){this.deleteCellRange(e,e+1)}deleteCellRange(e,t){this.transact((()=>{this._ycells.delete(e,t-e)}))}deleteMetadata(e){if(typeof this.getMetadata(e)==="undefined"){return}const t=this.metadata;delete t[e];this.setMetadata(t)}getMetadata(e){const t=this.ymeta.get("metadata");if(t===undefined){return undefined}if(typeof e==="string"){const s=t.get(e);return typeof s==="undefined"?undefined:o.JSONExt.deepCopy(s)}else{return o.JSONExt.deepCopy(t.toJSON())}}setMetadata(e,t){var s;if(typeof e==="string"){if(typeof t==="undefined"){throw new TypeError(`Metadata value for ${e} cannot be 'undefined'; use deleteMetadata.`)}if(o.JSONExt.deepEqual((s=this.getMetadata(e))!==null&&s!==void 0?s:null,t)){return}const a={};a[e]=t;this.updateMetadata(a)}else{if(!this.metadata||!o.JSONExt.deepEqual(this.metadata,e)){const t=o.JSONExt.deepCopy(e);const s=this.ymeta.get("metadata");if(s===undefined){return undefined}this.transact((()=>{s.clear();for(const[e,a]of Object.entries(t)){s.set(e,a)}}))}}}updateMetadata(e){const t=o.JSONExt.deepCopy(e);const s=this.ymeta.get("metadata");if(s===undefined){return undefined}this.transact((()=>{for(const[e,a]of Object.entries(t)){s.set(e,a)}}))}notifyActiveCellIndex(e,t){console.log("notifyActiveCellIndex >>>",e,t);console.log("this.awareness >>>",this.awareness);this.awareness.setLocalStateField("activeCellIndex",{oldValue:e,newValue:t})}fromJSON(e){this.transact((()=>{this.nbformat=e.nbformat;this.nbformat_minor=e.nbformat_minor;const t=e.metadata;if(t["orig_nbformat"]!==undefined){delete t["orig_nbformat"]}if(!this.metadata){const e=new d.Map;for(const[s,a]of Object.entries(t)){e.set(s,a)}this.ymeta.set("metadata",e)}else{this.metadata=t}const s=e.nbformat===4&&e.nbformat_minor>=5;const a=e.cells.map((e=>{if(!s){delete e.id}return e}));this.insertCells(this.cells.length,a);this.deleteCellRange(0,this.cells.length)}))}toJSON(){const e=this.nbformat===4&&this.nbformat_minor<=4;return{metadata:this.metadata,nbformat_minor:this.nbformat_minor,nbformat:this.nbformat,cells:this.cells.map((t=>{const s=t.toJSON();if(e){delete s.id}return s}))}}}}}]);
//# sourceMappingURL=3865.78281f929681a2a9cdda.js.map?v=78281f929681a2a9cdda