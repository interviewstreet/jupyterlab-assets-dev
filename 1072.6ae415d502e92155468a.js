(self["webpackChunk_jupyterlab_application_top"]=self["webpackChunk_jupyterlab_application_top"]||[]).push([[1072],{6493:(e,t,s)=>{"use strict";s.d(t,{GL:()=>u,Ag:()=>f,xq:()=>p,oy:()=>m});var n=s(3260);var o=s(94072);var i=s(40870);var c=s(21332);var a=s(75736);var r=s(1872);var l=s(11038);var d=s.n(l);const h=3e4;class u extends a.y{constructor(e){super();this.doc=e;this.clientID=e.clientID;this.states=new Map;this.meta=new Map;this._checkInterval=setInterval((()=>{const e=i.ZG();if(this.getLocalState()!==null&&h/2<=e-this.meta.get(this.clientID).lastUpdated){this.setLocalState(this.getLocalState())}const t=[];this.meta.forEach(((s,n)=>{if(n!==this.clientID&&h<=e-s.lastUpdated&&this.states.has(n)){t.push(n)}}));if(t.length>0){f(this,t,"timeout")}}),c.GW(h/10));e.on("destroy",(()=>{this.destroy()}));this.setLocalState({})}destroy(){this.emit("destroy",[this]);this.setLocalState(null);super.destroy();clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){const t=this.clientID;const s=this.meta.get(t);const n=s===undefined?0:s.clock+1;const o=this.states.get(t);if(e===null){this.states.delete(t)}else{this.states.set(t,e)}this.meta.set(t,{clock:n,lastUpdated:i.ZG()});const c=[];const a=[];const l=[];const d=[];if(e===null){d.push(t)}else if(o==null){if(e!=null){c.push(t)}}else{a.push(t);if(!r.Hi(o,e)){l.push(t)}}if(c.length>0||l.length>0||d.length>0){this.emit("change",[{added:c,updated:l,removed:d},"local"])}this.emit("update",[{added:c,updated:a,removed:d},"local"])}setLocalStateField(e,t){const s=this.getLocalState();if(s!==null){this.setLocalState({...s,[e]:t})}}getStates(){return this.states}}const f=(e,t,s)=>{const n=[];for(let o=0;o<t.length;o++){const s=t[o];if(e.states.has(s)){e.states.delete(s);if(s===e.clientID){const t=e.meta.get(s);e.meta.set(s,{clock:t.clock+1,lastUpdated:i.ZG()})}n.push(s)}}if(n.length>0){e.emit("change",[{added:[],updated:[],removed:n},s]);e.emit("update",[{added:[],updated:[],removed:n},s])}};const p=(e,t,s=e.states)=>{const o=t.length;const i=n.Mf();n.uE(i,o);for(let c=0;c<o;c++){const o=t[c];const a=s.get(o)||null;const r=e.meta.get(o).clock;n.uE(i,o);n.uE(i,r);n.uw(i,JSON.stringify(a))}return n._f(i)};const g=(e,t)=>{const s=decoding.createDecoder(e);const n=encoding.createEncoder();const o=decoding.readVarUint(s);encoding.writeVarUint(n,o);for(let i=0;i<o;i++){const e=decoding.readVarUint(s);const o=decoding.readVarUint(s);const i=JSON.parse(decoding.readVarString(s));const c=t(i);encoding.writeVarUint(n,e);encoding.writeVarUint(n,o);encoding.writeVarString(n,JSON.stringify(c))}return encoding.toUint8Array(n)};const m=(e,t,s)=>{const n=o.l1(t);const c=i.ZG();const a=[];const l=[];const d=[];const h=[];const u=o.yg(n);for(let i=0;i<u;i++){const t=o.yg(n);let s=o.yg(n);const i=JSON.parse(o.kf(n));const u=e.meta.get(t);const f=e.states.get(t);const p=u===undefined?0:u.clock;if(p<s||p===s&&i===null&&e.states.has(t)){if(i===null){if(t===e.clientID&&e.getLocalState()!=null){s++}else{e.states.delete(t)}}else{e.states.set(t,i)}e.meta.set(t,{clock:s,lastUpdated:c});if(u===undefined&&i!==null){a.push(t)}else if(u!==undefined&&i===null){h.push(t)}else if(i!==null){if(!r.Hi(i,f)){d.push(t)}l.push(t)}}}if(a.length>0||d.length>0||h.length>0){e.emit("change",[{added:a,updated:d,removed:h},s])}if(a.length>0||l.length>0||h.length>0){e.emit("update",[{added:a,updated:l,removed:h},s])}}},21072:(e,t,s)=>{"use strict";s.r(t);s.d(t,{IDocumentProviderFactory:()=>l,ProviderMock:()=>a,WebSocketProviderWithLocks:()=>oe,getAnonymousUserName:()=>o,getRandomColor:()=>c,moonsOfJupyter:()=>n,userColors:()=>i});const n=["Metis","Adrastea","Amalthea","Thebe","Io","Europa","Ganymede","Callisto","Themisto","Leda","Ersa","Pandia","Himalia","Lysithea","Elara","Dia","Carpo","Valetudo","Euporie","Eupheme","Helike","Euanthe","Hermippe","Praxidike","Thyone","Thelxinoe","Ananke","Mneme","Orthosie","Harpalyke","Iocaste","Erinome","Aitne","Herse","Taygete","Eukelade","Carme","Isonoe","Autonoe","Philophrosyne","Cyllene","Pasithee","Pasiphae","Sponde","Eurydome","Kalyke","Hegemone","Kale","Kallichore","Chaldene","Arche","Eirene","Kore","Megaclite","Aoede","Callirrhoe","Sinope"];const o=()=>"Anonymous "+n[Math.floor(Math.random()*n.length)];const i=["#12A0D3","#17AB30","#CC8500","#A79011","#ee6352","#609DA9","#4BA749","#00A1B3"];const c=()=>i[Math.floor(Math.random()*i.length)];class a{requestInitialContent(){return Promise.resolve(false)}putInitializedState(){}acquireLock(){return Promise.resolve(0)}releaseLock(e){}destroy(){}setPath(e){}}var r=s(98034);const l=new r.Token("@jupyterlab/docprovider:IDocumentProviderFactory");var d=s(94072);var h=s(3260);var u=s(11038);var f=s(23205);var p=s(24803);var g=s(55852);const m=new Map;class w{constructor(e){this.room=e;this.onmessage=null;g.z((t=>t.key===e&&this.onmessage!==null&&this.onmessage({data:p.Gh(t.newValue||"")})))}postMessage(e){g.X.setItem(this.room,p.s3(p.eh(e)))}}const y=typeof BroadcastChannel==="undefined"?w:BroadcastChannel;const _=e=>f.Yu(m,e,(()=>{const t=new Set;const s=new y(e);s.onmessage=e=>t.forEach((t=>t(e.data)));return{bc:s,subs:t}}));const v=(e,t)=>_(e).subs.add(t);const b=(e,t)=>_(e).subs.delete(t);const I=(e,t)=>{const s=_(e);s.bc.postMessage(t);s.subs.forEach((e=>e(t)))};var k=s(40870);const C=0;const U=1;const L=2;const S=(e,t)=>{h.uE(e,C);const s=u.encodeStateVector(t);h.mP(e,s)};const E=(e,t,s)=>{h.uE(e,U);h.mP(e,u.encodeStateAsUpdate(t,s))};const M=(e,t,s)=>E(t,s,d.HN(e));const q=(e,t,s)=>{try{u.applyUpdate(t,d.HN(e),s)}catch(n){console.error("Caught error while handling a Yjs update",n)}};const A=(e,t)=>{h.uE(e,L);h.mP(e,t)};const R=q;const H=(e,t,s,n)=>{const o=d.yg(e);switch(o){case C:M(e,t,s);break;case U:q(e,s,n);break;case L:R(e,s,n);break;default:throw new Error("Unknown message type")}return o};const P=0;const D=(e,t)=>{encoding.writeVarUint(e,P);encoding.writeVarString(e,t)};const x=(e,t,s)=>{switch(d.yg(e)){case P:s(t,d.kf(e))}};var T=s(6493);const V=()=>{let e=true;return(t,s)=>{if(e){e=false;try{t()}finally{e=true}}else if(s!==undefined){s()}}};var G=s(75736);var B=s(21332);var W=s(69600);const N=e=>{const t={};const s=e.split("?");const n=s[s.length-1].split("&");for(var o=0;o<n.length;o++){const e=n[o];if(e.length>0){const s=e.split("=");t[decodeURIComponent(s[0])]=decodeURIComponent(s[1]||"")}}return t};const z=e=>W.UI(e,((e,t)=>`${encodeURIComponent(t)}=${encodeURIComponent(e)}`)).join("&");var Z=s(34406);const j=0;const J=3;const O=1;const K=2;const F=[];F[j]=(e,t,s,n,o)=>{h.uE(e,j);const i=H(t,e,s.doc,s);if(n&&i===U&&!s.synced){s.synced=true}};F[J]=(e,t,s,n,o)=>{h.uE(e,O);h.mP(e,T.xq(s.awareness,Array.from(s.awareness.getStates().keys())))};F[O]=(e,t,s,n,o)=>{T.oy(s.awareness,d.HN(t),s)};F[K]=(e,t,s,n,o)=>{x(t,s.doc,Q)};const $=1200;const Y=2500;const X=3e4;const Q=(e,t)=>console.warn(`Permission denied to access ${e.url}.\n${t}`);const ee=(e,t,s)=>{const n=d.l1(t);const o=h.Mf();const i=d.yg(n);const c=e.messageHandlers[i];if(c){c(o,n,e,s,i)}else{console.error("Unable to compute message")}return o};const te=e=>{if(e.shouldConnect&&e.ws===null){const t=new e._WS(e.url);t.binaryType="arraybuffer";e.ws=t;e.wsconnecting=true;e.wsconnected=false;e.synced=false;t.onmessage=s=>{e.wsLastMessageReceived=k.ZG();const n=ee(e,new Uint8Array(s.data),true);if(h.kE(n)>1){t.send(h._f(n))}};t.onclose=()=>{e.ws=null;e.wsconnecting=false;if(e.wsconnected){e.wsconnected=false;e.synced=false;T.Ag(e.awareness,Array.from(e.awareness.getStates().keys()).filter((t=>t!==e.doc.clientID)),e);e.emit("status",[{status:"disconnected"}])}else{e.wsUnsuccessfulReconnects++}setTimeout(te,B.VV(B.mv(e.wsUnsuccessfulReconnects+1)*$,Y),e)};t.onopen=()=>{e.wsLastMessageReceived=k.ZG();e.wsconnecting=false;e.wsconnected=true;e.wsUnsuccessfulReconnects=0;e.emit("status",[{status:"connected"}]);const s=h.Mf();h.uE(s,j);S(s,e.doc);t.send(h._f(s));if(e.awareness.getLocalState()!==null){const s=h.Mf();h.uE(s,O);h.mP(s,T.xq(e.awareness,[e.doc.clientID]));t.send(h._f(s))}};e.emit("status",[{status:"connecting"}])}};const se=(e,t)=>{if(e.wsconnected){e.ws.send(t)}if(e.bcconnected){e.mux((()=>{I(e.bcChannel,t)}))}};class ne extends G.y{constructor(e,t,s,{connect:n=true,awareness:o=new T.GL(s),params:i={},WebSocketPolyfill:c=WebSocket,resyncInterval:a=-1}={}){super();while(e[e.length-1]==="/"){e=e.slice(0,e.length-1)}const r=z(i);this.bcChannel=e+"/"+t;this.url=e+"/"+t+(r.length===0?"":"?"+r);this.roomname=t;this.doc=s;this._WS=c;this.awareness=o;this.wsconnected=false;this.wsconnecting=false;this.bcconnected=false;this.wsUnsuccessfulReconnects=0;this.messageHandlers=F.slice();this.mux=V();this._synced=false;this.ws=null;this.wsLastMessageReceived=0;this.shouldConnect=n;this._resyncInterval=0;if(a>0){this._resyncInterval=setInterval((()=>{if(this.ws){const e=h.Mf();h.uE(e,j);S(e,s);this.ws.send(h._f(e))}}),a)}this._bcSubscriber=e=>{this.mux((()=>{const t=ee(this,new Uint8Array(e),false);if(h.kE(t)>1){I(this.bcChannel,h._f(t))}}))};this._updateHandler=(e,t)=>{if(t!==this){const t=h.Mf();h.uE(t,j);A(t,e);se(this,h._f(t))}};this.doc.on("update",this._updateHandler);this._awarenessUpdateHandler=({added:e,updated:t,removed:s},n)=>{const i=e.concat(t).concat(s);const c=h.Mf();h.uE(c,O);h.mP(c,T.xq(o,i));se(this,h._f(c))};this._beforeUnloadHandler=()=>{T.Ag(this.awareness,[s.clientID],"window unload")};if(typeof window!=="undefined"){window.addEventListener("beforeunload",this._beforeUnloadHandler)}else if(typeof Z!=="undefined"){Z.on("exit",(()=>this._beforeUnloadHandler))}o.on("update",this._awarenessUpdateHandler);this._checkInterval=setInterval((()=>{if(this.wsconnected&&X<k.ZG()-this.wsLastMessageReceived){this.ws.close()}}),X/10);if(n){this.connect()}}get synced(){return this._synced}set synced(e){if(this._synced!==e){this._synced=e;this.emit("synced",[e]);this.emit("sync",[e])}}destroy(){if(this._resyncInterval!==0){clearInterval(this._resyncInterval)}clearInterval(this._checkInterval);this.disconnect();if(typeof window!=="undefined"){window.removeEventListener("beforeunload",this._beforeUnloadHandler)}else if(typeof Z!=="undefined"){Z.off("exit",(()=>this._beforeUnloadHandler))}this.awareness.off("update",this._awarenessUpdateHandler);this.doc.off("update",this._updateHandler);super.destroy()}connectBc(){if(!this.bcconnected){v(this.bcChannel,this._bcSubscriber);this.bcconnected=true}this.mux((()=>{const e=h.Mf();h.uE(e,j);S(e,this.doc);I(this.bcChannel,h._f(e));const t=h.Mf();h.uE(t,j);E(t,this.doc);I(this.bcChannel,h._f(t));const s=h.Mf();h.uE(s,J);I(this.bcChannel,h._f(s));const n=h.Mf();h.uE(n,O);h.mP(n,T.xq(this.awareness,[this.doc.clientID]));I(this.bcChannel,h._f(n))}))}disconnectBc(){const e=h.Mf();h.uE(e,O);h.mP(e,T.xq(this.awareness,[this.doc.clientID],new Map));se(this,h._f(e));if(this.bcconnected){b(this.bcChannel,this._bcSubscriber);this.bcconnected=false}}disconnect(){this.shouldConnect=false;this.disconnectBc();if(this.ws!==null){this.ws.close()}}connect(){this.shouldConnect=true;if(!this.wsconnected&&this.ws===null){te(this);this.connectBc()}}}class oe extends ne{constructor(e){var t,s,n;super(e.url,e.contentType+":"+e.path,e.ymodel.ydoc,{awareness:e.ymodel.awareness});this._currentLockRequest=null;this._initialContentRequest=null;this._path=e.path;this._contentType=e.contentType;this._serverUrl=e.url;const i=new URL(window.location.href).searchParams;const a=(t="#"+i.get("usercolor"))!==null&&t!==void 0?t:c().slice(1);const r=(s=i.get("username"))!==null&&s!==void 0?s:o();const l=e.ymodel.awareness;const h=l.getLocalState();if(h&&((n=h.user)===null||n===void 0?void 0:n.name)==null){e.ymodel.awareness.setLocalStateField("user",{name:r,color:a})}this.messageHandlers[127]=(e,t,s,n,o)=>{const i=d.Jl(t);const c=this._currentLockRequest;this._currentLockRequest=null;if(c){c.resolve(i)}};this.messageHandlers[125]=(e,t,s,n,o)=>{const i=d.iU(t);if(i.byteLength>0){u.applyUpdate(this.doc,i)}const c=this._initialContentRequest;this._initialContentRequest=null;if(c){c.resolve(i.byteLength>0)}};this._isInitialized=false;this._onConnectionStatus=this._onConnectionStatus.bind(this);this.on("status",this._onConnectionStatus)}setPath(e){if(e!==this._path){this._path=e;const t=h.Mf();h.cW(t,123);const s=unescape(encodeURIComponent(this._contentType+":"+e));for(let e=0;e<s.length;e++){h.cW(t,s.codePointAt(e))}this._sendMessage(h._f(t));this.disconnectBc();this.bcChannel=this._serverUrl+"/"+this._contentType+":"+this._path;this.url=this.bcChannel;this.connectBc()}}requestInitialContent(){if(this._initialContentRequest){return this._initialContentRequest.promise}this._initialContentRequest=new r.PromiseDelegate;this._sendMessage(new Uint8Array([125]));setTimeout((()=>{var e;return(e=this._initialContentRequest)===null||e===void 0?void 0:e.resolve(false)}),1e3);return this._initialContentRequest.promise}putInitializedState(){const e=h.Mf();h.uE(e,124);h.HK(e,u.encodeStateAsUpdate(this.doc));this._sendMessage(h._f(e));this._isInitialized=true}acquireLock(){if(this._currentLockRequest){return this._currentLockRequest.promise}this._sendMessage(new Uint8Array([127]));if(this._requestLockInterval){clearInterval(this._requestLockInterval)}this._requestLockInterval=setInterval((()=>{if(this.wsconnected){this._sendMessage(new Uint8Array([127]))}}),500);let e,t;const s=new Promise(((s,n)=>{e=s;t=n}));this._currentLockRequest={promise:s,resolve:e,reject:t};return s}releaseLock(e){const t=h.Mf();h.uE(t,126);h.Ep(t,e);this._sendMessage(h._f(t));if(this._requestLockInterval){clearInterval(this._requestLockInterval)}}_sendMessage(e){const t=()=>{setTimeout((()=>{if(this.wsconnected){this.ws.send(e)}else{this.once("status",t)}}),0)};t()}async _onConnectionStatus(e){if(this._isInitialized&&e.status==="connected"){const e=await this.acquireLock();const t=await this.requestInitialContent();if(!t){this.putInitializedState()}this.releaseLock(e)}}}}}]);
//# sourceMappingURL=1072.6ae415d502e92155468a.js.map?v=6ae415d502e92155468a