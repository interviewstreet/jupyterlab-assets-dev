(self["webpackChunk_jupyterlab_application_top"]=self["webpackChunk_jupyterlab_application_top"]||[]).push([[5731],{15731:(t,e,s)=>{"use strict";s.r(e);s.d(e,{IJSONSettingEditorTracker:()=>J.g,ISettingEditorTracker:()=>J.O,JsonSettingEditor:()=>M,SettingsEditor:()=>C});var i=s(67616);var r=s(70278);var n=s(8595);var a=s(18453);var o=s(2411);var l=s.n(o);var d=s(29131);var c=s(47063);const h="jupyter.lab.setting-icon";const u="jupyter.lab.setting-icon-class";const p="jupyter.lab.setting-icon-label";class g extends i.ReactWidget{constructor(t){var e;super();this._changed=new n.Signal(this);this._handleSelectSignal=new n.Signal(this);this._updateFilterSignal=new n.Signal(this);this._allPlugins=[];this._settings={};this._scrollTop=0;this._selection="";this.registry=t.registry;this.translator=t.translator||r.nullTranslator;this.addClass("jp-PluginList");this._confirm=t.confirm;this.registry.pluginChanged.connect((()=>{this.update()}),this);this.mapPlugins=this.mapPlugins.bind(this);this.setFilter=this.setFilter.bind(this);this.setFilter((0,i.updateFilterFunction)((e=t.query)!==null&&e!==void 0?e:"",false,false));this.setError=this.setError.bind(this);this._evtMousedown=this._evtMousedown.bind(this);this._query=t.query;this._allPlugins=g.sortPlugins(this.registry).filter((e=>{var s;const{schema:i}=e;const r=i["jupyter.lab.setting-deprecated"]===true;const n=Object.keys(i.properties||{}).length>0;const a=i.additionalProperties!==false;const o=this._confirm||!this._confirm&&!((s=t.toSkip)!==null&&s!==void 0?s:[]).includes(e.id);return!r&&o&&(n||a)}));const s=async()=>{for(const t of this._allPlugins){const e=await this.registry.load(t.id);this._settings[t.id]=e}this.update()};void s();this._errors={};this.selection=this._allPlugins[0].id}get changed(){return this._changed}get scrollTop(){var t;return(t=this.node.querySelector("ul"))===null||t===void 0?void 0:t.scrollTop}get hasErrors(){for(const t in this._errors){if(this._errors[t]){return true}}return false}get filter(){return this._filter}get selection(){return this._selection}set selection(t){this._selection=t;this.update()}get updateFilterSignal(){return this._updateFilterSignal}get handleSelectSignal(){return this._handleSelectSignal}onUpdateRequest(t){const e=this.node.querySelector("ul");if(e&&this._scrollTop!==undefined){e.scrollTop=this._scrollTop}super.onUpdateRequest(t)}_evtMousedown(t){const e=t.currentTarget;const s=e.getAttribute("data-id");if(!s){return}if(this._confirm){this._confirm(s).then((()=>{this.selection=s;this._changed.emit(undefined);this.update()})).catch((()=>{}))}else{this._scrollTop=this.scrollTop;this._selection=s;this._handleSelectSignal.emit(s);this._changed.emit(undefined);this.update()}}getHint(t,e,s){let i=s.data.user[t];if(!i){i=s.data.composite[t]}if(!i){i=s.schema[t]}if(!i){const{properties:s}=e.schema;i=s&&s[t]&&s[t].default}return typeof i==="string"?i:""}getFilterString(t,e,s,i){var r;if(i&&s){i=i.replace("#/definitions/","");e=(r=s[i])!==null&&r!==void 0?r:{}}if(e.properties){e=e.properties}else if(e.items){e=e.items}else{return[]}if(e["$ref"]){return this.getFilterString(t,e,s,e["$ref"])}if(Object.keys(e).length===0){return[]}return Object.keys(e).reduce(((i,r)=>{var n,a;const o=e[r];if(!o){if(t((n=e.title)!==null&&n!==void 0?n:"")){return e.title}if(t(r)){return r}}if(t((a=o.title)!==null&&a!==void 0?a:"")){i.push(o.title)}if(t(r)){i.push(r)}i.concat(this.getFilterString(t,o,s,o["$ref"]));return i}),[])}setFilter(t,e){this._filter=e=>{var s,i;if(t((s=e.schema.title)!==null&&s!==void 0?s:"")){return null}const r=this.getFilterString(t,(i=e.schema)!==null&&i!==void 0?i:{},e.schema.definitions);return r};this._query=e;this._updateFilterSignal.emit(this._filter);this.update()}setError(t,e){if(this._errors[t]!==e){this._errors[t]=e;this.update()}else{this._errors[t]=e}}mapPlugins(t){var e,s,i,r;const{id:n,schema:a,version:o}=t;const g=this.translator.load("jupyterlab");const m=typeof a.title==="string"?g._p("schema",a.title):n;const _=c.StringExt.matchSumOfSquares(m.toLocaleLowerCase(),(s=(e=this._query)===null||e===void 0?void 0:e.toLocaleLowerCase())!==null&&s!==void 0?s:"");const f=c.StringExt.highlight(m,(i=_===null||_===void 0?void 0:_.indices)!==null&&i!==void 0?i:[],(t=>l().createElement("mark",null,t)));const v=typeof a.description==="string"?g._p("schema",a.description):"";const y=`${v}\n${n}\n${o}`;const S=this.getHint(h,this.registry,t);const E=this.getHint(u,this.registry,t);const j=this.getHint(p,this.registry,t);const w=(r=this._filter(t))===null||r===void 0?void 0:r.map((t=>{var e,s,i;const r=c.StringExt.matchSumOfSquares(t.toLocaleLowerCase(),(s=(e=this._query)===null||e===void 0?void 0:e.toLocaleLowerCase())!==null&&s!==void 0?s:"");const a=c.StringExt.highlight(t,(i=r===null||r===void 0?void 0:r.indices)!==null&&i!==void 0?i:[],(t=>l().createElement("mark",null,t)));return l().createElement("li",{key:`${n}-${t}`}," ",a," ")}));return l().createElement("div",{onClick:this._evtMousedown,className:`${n===this.selection?"jp-mod-selected jp-PluginList-entry":"jp-PluginList-entry"} ${this._errors[n]?"jp-ErrorPlugin":""}`,"data-id":n,key:n,title:y},l().createElement("div",{className:"jp-pluginList-entry-label",role:"tab"},l().createElement("div",{className:"jp-SelectedIndicator"}),l().createElement(d.LabIcon.resolveReact,{icon:S||(E?undefined:d.settingsIcon),iconClass:(0,d.classes)(E,"jp-Icon"),title:j,tag:"span",stylesheet:"settingsEditor"}),l().createElement("span",null,f)),l().createElement("ul",null,w))}render(){const t=this.translator.load("jupyterlab");const e=this._allPlugins.filter((t=>{const e=this._filter(t);return e===null||e.length>0}));const s=e.filter((t=>{var e;return(e=this._settings[t.id])===null||e===void 0?void 0:e.isModified}));const r=s.map(this.mapPlugins);const n=e.filter((t=>!s.includes(t))).map(this.mapPlugins);return l().createElement("div",{className:"jp-PluginList-wrapper"},l().createElement(i.FilterBox,{updateFilter:this.setFilter,useFuzzyFilter:false,placeholder:t.__("Searchâ€¦"),forceRefresh:false,caseSensitive:false,initialQuery:this._query}),r.length>0&&l().createElement("div",null,l().createElement("h1",{className:"jp-PluginList-header"},t.__("Modified")),l().createElement("ul",null,r)),n.length>0&&l().createElement("div",null,l().createElement("h1",{className:"jp-PluginList-header"},t.__("Settings")),l().createElement("ul",null,n)),r.length===0&&n.length===0&&l().createElement("p",{className:"jp-PluginList-noResults"},t.__("No items match your search.")))}}(function(t){function e(t){return Object.keys(t.plugins).map((e=>t.plugins[e])).sort(((t,e)=>(t.schema.title||t.id).localeCompare(e.schema.title||e.id)))}t.sortPlugins=e})(g||(g={}));var m=s(98034);var _=s(72245);var f=s(80647);const v=4;const y=t=>{const e=t.load("jupyterlab");const s=t=>{var s;return l().createElement("div",{className:t.className},l().createElement(t.TitleField,{title:t.title,required:t.required,id:`${t.idSchema.$id}-title`}),l().createElement(t.DescriptionField,{id:`${t.idSchema.$id}-description`,description:(s=t.schema.description)!==null&&s!==void 0?s:""}),t.items.map((t=>l().createElement("div",{key:t.key,className:t.className},t.children,l().createElement("div",{className:"jp-ArrayOperations"},l().createElement("button",{className:"jp-mod-styled jp-mod-reject",onClick:t.onReorderClick(t.index,t.index-1),disabled:!t.hasMoveUp},e.__("Move Up")),l().createElement("button",{className:"jp-mod-styled jp-mod-reject",onClick:t.onReorderClick(t.index,t.index+1),disabled:!t.hasMoveDown},e.__("Move Down")),l().createElement("button",{className:"jp-mod-styled jp-mod-warn",onClick:t.onDropIndexClick(t.index),disabled:!t.hasRemove},e.__("Remove")))))),t.canAdd&&l().createElement("button",{className:"jp-mod-styled jp-mod-reject",onClick:t.onAddClick},e.__("Add")))};s.displayName="CustomArrayTemplate";return s};const S=t=>{const e=t.load("jupyterlab");const s=t=>{const{TitleField:s,DescriptionField:i}=t;return l().createElement("fieldset",{id:t.idSchema.$id},(t.uiSchema["ui:title"]||t.title)&&l().createElement(s,{id:`${t.idSchema.$id}__title`,title:t.title||t.uiSchema["ui:title"],required:t.required}),t.description&&l().createElement(i,{id:`${t.idSchema.$id}__description`,description:t.description}),t.properties.map((t=>t.content)),f.P6.canExpand(t.schema,t.uiSchema,t.formData)&&l().createElement("button",{className:"jp-mod-styled jp-mod-reject",onClick:t.onAddClick(t.schema),disabled:t.disabled||t.readonly},e.__("Add")))};s.displayName="CustomObjectTemplate";return s};const E=t=>{var e;const{formData:s,schema:i,label:r,displayLabel:n,id:a,formContext:o,errors:d,rawErrors:h,children:u,onKeyChange:p,onDropPropertyClick:g}=t;const _=a.split("_");_.shift();const v=_.join(".");let y;if(_.length===1){y=o.settings.default(v)}else if(_.length>1){const t={};t[_[0]]=o.settings.default(_[0]);y=(0,c.reduce)(_,((t,e,s)=>t===null||t===void 0?void 0:t[e]),t)}const S=v!==""&&s!==undefined&&y!==undefined&&!i.properties&&i.type!=="array"&&!m.JSONExt.deepEqual(s,y);const E=v==="";const j=!E&&i.type!="object"&&a!="jp-SettingsEditor-@jupyterlab/shortcuts-extension:shortcuts_shortcuts";const w=i.hasOwnProperty(f.P6.ADDITIONAL_PROPERTY_FLAG);return l().createElement("div",{className:`form-group ${n||i.type==="boolean"?"small-field":""}`},S&&!h&&l().createElement("div",{className:"jp-modifiedIndicator"}),h&&l().createElement("div",{className:"jp-modifiedIndicator jp-errorIndicator"}),l().createElement("div",{className:"jp-FormGroup-content"},n&&!E&&r&&!w&&l().createElement("h3",{className:"jp-FormGroup-fieldLabel jp-FormGroup-contentItem"},r),w&&l().createElement("input",{className:"jp-FormGroup-contentItem jp-mod-styled",type:"text",onBlur:t=>p(t.target.value),defaultValue:r}),l().createElement("div",{className:`${E?"jp-root":i.type==="object"?"jp-objectFieldWrapper":"jp-inputFieldWrapper jp-FormGroup-contentItem"}`},u),w&&l().createElement("button",{className:"jp-FormGroup-contentItem jp-mod-styled jp-mod-warn jp-FormGroup-removeButton",onClick:g(r)},"Remove"),i.description&&j&&l().createElement("div",{className:"jp-FormGroup-description"},i.description),S&&i.default!==undefined&&l().createElement("div",{className:"jp-FormGroup-default"},"Default: ",(e=i.default)===null||e===void 0?void 0:e.toLocaleString()),l().createElement("div",{className:"validationErrors"},d)))};class j extends l().Component{constructor(t){super(t);this.reset=async t=>{t.stopPropagation();for(const e in this.props.settings.user){await this.props.settings.remove(e)}this._formData=this.props.settings.composite;this.setState({isModified:false})};this.onSelect=(t,e)=>{if(e===this.props.settings.id){this.props.onCollapseChange(false)}};this._onChange=t=>{this.props.hasError(t.errors.length!==0);this._formData=t.formData;if(t.errors.length===0){this.props.updateDirtyState(true);void this._debouncer.invoke()}this.props.onSelect(this.props.settings.id)};const{settings:e}=t;this._formData=e.composite;this.state={isModified:e.isModified,uiSchema:{},filteredSchema:this.props.settings.schema,arrayFieldTemplate:y(this.props.translator),objectFieldTemplate:S(this.props.translator),formContext:{settings:this.props.settings}};this.handleChange=this.handleChange.bind(this);this._debouncer=new _.Debouncer(this.handleChange)}componentDidMount(){this._setUiSchema();this._setFilteredSchema()}componentDidUpdate(t){this._setUiSchema(t.renderers);this._setFilteredSchema(t.filteredValues);if(t.translator!==this.props.translator){this.setState({arrayFieldTemplate:y(this.props.translator),objectFieldTemplate:S(this.props.translator)})}if(t.settings!==this.props.settings){this.setState({formContext:{settings:this.props.settings}})}}handleChange(){if(!this.props.settings.isModified&&this.props.settings.isDefault(this._formData)){this.props.updateDirtyState(false);return}this.props.settings.save(JSON.stringify(this._formData,undefined,v)).then((()=>{this.props.updateDirtyState(false);this.setState({isModified:this.props.settings.isModified})})).catch((t=>{this.props.updateDirtyState(false);const e=this.props.translator.load("jupyterlab");void(0,i.showErrorMessage)(e.__("Error saving settings."),t)}))}render(){const t=this.props.translator.load("jupyterlab");const e=this.props.isCollapsed?d.caretRightIcon:d.caretDownIcon;return l().createElement("div",null,l().createElement("div",{className:"jp-SettingsHeader",onClick:()=>{this.props.onCollapseChange(!this.props.isCollapsed);this.props.onSelect(this.props.settings.id)}},l().createElement("header",{className:"jp-SettingsTitle"},l().createElement(e.react,{tag:"span",elementPosition:"center",className:"jp-SettingsTitle-caret"}),l().createElement("h2",null,this.props.settings.schema.title),l().createElement("div",{className:"jp-SettingsHeader-description"},this.props.settings.schema.description)),this.state.isModified&&l().createElement("button",{className:"jp-RestoreButton",onClick:this.reset},t.__("Restore to Defaults"))),!this.props.isCollapsed&&l().createElement(f.ZP,{schema:this.state.filteredSchema,formData:this._formData,FieldTemplate:E,ArrayFieldTemplate:this.state.arrayFieldTemplate,ObjectFieldTemplate:this.state.objectFieldTemplate,uiSchema:this.state.uiSchema,fields:this.props.renderers,formContext:this.state.formContext,liveValidate:true,idPrefix:`jp-SettingsEditor-${this.props.settings.id}`,onChange:this._onChange}))}_setUiSchema(t){var e;if(!t||!m.JSONExt.deepEqual(Object.keys(t).sort(),Object.keys(this.props.renderers).sort())){const t={};for(const s in this.props.renderers){if(Object.keys((e=this.props.settings.schema.properties)!==null&&e!==void 0?e:{}).includes(s)){t[s]={"ui:field":s}}}this.setState({uiSchema:t})}}_setFilteredSchema(t){var e,s,i,r;if(t===undefined||!m.JSONExt.deepEqual(t,this.props.filteredValues)){const t=m.JSONExt.deepCopy(this.props.settings.schema);if((s=(e=this.props.filteredValues)===null||e===void 0?void 0:e.length)!==null&&s!==void 0?s:0>0){for(const e in t.properties){if(!((i=this.props.filteredValues)===null||i===void 0?void 0:i.includes((r=t.properties[e].title)!==null&&r!==void 0?r:e))){delete t.properties[e]}}}this.setState({filteredSchema:t})}}}const w=({settings:t,editorRegistry:e,onSelect:s,handleSelectSignal:i,hasError:r,updateDirtyState:n,updateFilterSignal:a,translator:d,initialFilter:c})=>{const[h,u]=(0,o.useState)(null);const[p,g]=(0,o.useState)((()=>c));const m={};for(const o of t){m[o.id]=l().useRef(null)}const _=l().useRef(null);const f=l().useRef({});(0,o.useEffect)((()=>{var e;const s=(e,s)=>{g((()=>s));for(const i of t){const t=s(i.plugin);if(t===null||t.length>0){u(i.id);break}}};for(const i of t){const t=p(i.plugin);if(t===null||t.length>0){u(i.id);break}}a.connect(s);const r=(t,e)=>{var s,i;u(h!==e?e:null);(i=(s=m[e])===null||s===void 0?void 0:s.current)===null||i===void 0?void 0:i.scrollIntoView(true)};(e=i===null||i===void 0?void 0:i.connect)===null||e===void 0?void 0:e.call(i,r);return()=>{var t;a.disconnect(s);(t=i===null||i===void 0?void 0:i.disconnect)===null||t===void 0?void 0:t.call(i,r)}}),[]);const v=(t,e)=>{if(f.current){f.current[t]=e;for(const t in f.current){if(f.current[t]){n(true);return}}}n(false)};return l().createElement("div",{className:"jp-SettingsPanel",ref:_},t.map((t=>{const i=p(t.plugin);if(i!==null&&i.length===0){return undefined}return l().createElement("div",{ref:m[t.id],className:"jp-SettingsForm",key:`${t.id}SettingsEditor`},l().createElement(j,{isCollapsed:t.id!==h,onCollapseChange:e=>{if(!e){u(t.id)}else if(t.id===h){u(null)}},filteredValues:i,settings:t,renderers:e.renderers,hasError:e=>{r(t.id,e)},updateDirtyState:e=>{v(t.id,e)},onSelect:s,translator:d}))})))};class C extends a.SplitPanel{constructor(t){super({orientation:"horizontal",renderer:a.SplitPanel.defaultRenderer,spacing:1});this._clearDirty=null;this._dirty=false;this._saveStateChange=new n.Signal(this);this.translator=t.translator||r.nullTranslator;this._status=t.status;const e=this._list=new g({registry:t.registry,toSkip:t.toSkip,translator:this.translator,query:t.query});this.addWidget(e);this.setDirtyState=this.setDirtyState.bind(this);void Promise.all(g.sortPlugins(t.registry).filter((t=>{const{schema:e}=t;const s=e["jupyter.lab.setting-deprecated"]===true;const i=Object.keys(e.properties||{}).length>0;const r=e.additionalProperties!==false;return!s&&(i||r)})).map((async e=>await t.registry.load(e.id)))).then((e=>{const s=i.ReactWidget.create(l().createElement(w,{settings:e.filter((e=>{var s;return!((s=t.toSkip)!==null&&s!==void 0?s:[]).includes(e.id)})),editorRegistry:t.editorRegistry,handleSelectSignal:this._list.handleSelectSignal,onSelect:t=>this._list.selection=t,hasError:this._list.setError,updateFilterSignal:this._list.updateFilterSignal,updateDirtyState:this.setDirtyState,translator:this.translator,initialFilter:this._list.filter}));this.addWidget(s)})).catch((t=>{console.error(`Fail to load the setting plugins:\n${t}`)}))}get saveStateChanged(){return this._saveStateChange}setDirtyState(t){this._dirty=t;if(this._dirty&&!this._clearDirty){this._clearDirty=this._status.setDirty()}else if(!this._dirty&&this._clearDirty){this._clearDirty.dispose();this._clearDirty=null}if(t){if(!this.title.className.includes("jp-mod-dirty")){this.title.className+=" jp-mod-dirty"}}else{this.title.className=this.title.className.replace("jp-mod-dirty","")}this._saveStateChange.emit(t?"started":"completed")}onCloseRequest(t){const e=this.translator.load("jupyterlab");if(this._list.hasErrors){void(0,i.showDialog)({title:e.__("Warning"),body:e.__("Unsaved changes due to validation error. Continue without saving?")}).then((e=>{if(e.button.accept){this.dispose();super.onCloseRequest(t)}}))}else if(this._dirty){void(0,i.showDialog)({title:e.__("Warning"),body:e.__("Some changes have not been saved. Continue without saving?")}).then((e=>{if(e.button.accept){this.dispose();super.onCloseRequest(t)}}))}else{this.dispose();super.onCloseRequest(t)}}}var b=s(41994);var F=s(48299);var x=s(21464);var D=s(99345);function N(t,e,s){s=s||r.nullTranslator;const i=s.load("jupyterlab");const n=new T(t,s);const a=new F.InspectorPanel({initialContent:i.__("Any errors will be listed here"),translator:s});const o=new F.InspectionHandler({connector:n,rendermime:e||new x.RenderMimeRegistry({initialFactories:x.standardRendererFactories,translator:s})});a.addClass("jp-SettingsDebug");a.source=o;o.editor=t.source;return a}class T extends D.DataConnector{constructor(t,e){super();this._current=0;this._editor=t;this._trans=(e!==null&&e!==void 0?e:r.nullTranslator).load("jupyterlab")}fetch(t){return new Promise((e=>{const s=this._current=window.setTimeout((()=>{if(s!==this._current){return e(undefined)}const i=this._validate(t.text);if(!i){return e({data:{"text/markdown":this._trans.__("No errors found")},metadata:{}})}e({data:this.render(i),metadata:{}})}),100)}))}render(t){return{"text/markdown":t.map(this.renderError.bind(this)).join("")}}renderError(t){var e;switch(t.keyword){case"additionalProperties":return`**\`[${this._trans.__("additional property error")}]\`**\n          ${this._trans.__("`%1` is not a valid property",(e=t.params)===null||e===void 0?void 0:e.additionalProperty)}`;case"syntax":return`**\`[${this._trans.__("syntax error")}]\`** *${t.message}*`;case"type":return`**\`[${this._trans.__("type error")}]\`**\n          \`${t.dataPath}\` ${t.message}`;default:return`**\`[${this._trans.__("error")}]\`** *${t.message}*`}}_validate(t){const e=this._editor;if(!e.settings){return null}const{id:s,schema:i,version:r}=e.settings;const n={composite:{},user:{}};const a=e.registry.validator;return a.validateData({data:n,id:s,raw:t,schema:i,version:r},false)}}class k extends a.SplitPanel{constructor(){super(...arguments);this.handleMoved=new n.Signal(this)}handleEvent(t){super.handleEvent(t);if(t.type==="mouseup"){this.handleMoved.emit(undefined)}}}const R="jp-SettingsRawEditor";const P="jp-SettingsRawEditor-user";const $="jp-mod-error";class q extends k{constructor(t){super({orientation:"horizontal",renderer:k.defaultRenderer,spacing:1});this._canRevert=false;this._canSave=false;this._commandsChanged=new n.Signal(this);this._settings=null;this._toolbar=new i.Toolbar;const{commands:e,editorFactory:s,registry:a,translator:o}=t;this.registry=a;this.translator=o||r.nullTranslator;this._commands=e;const l=this._defaults=new b.CodeEditorWrapper({model:new b.CodeEditor.Model,factory:s});l.editor.model.value.text="";l.editor.model.mimeType="text/javascript";l.editor.setOption("readOnly",true);const d=this._user=new b.CodeEditorWrapper({model:new b.CodeEditor.Model,factory:s,config:{lineNumbers:true}});d.addClass(P);d.editor.model.mimeType="text/javascript";d.editor.model.value.changed.connect(this._onTextChanged,this);this._inspector=N(this,t.rendermime,this.translator);this.addClass(R);this._onSaveError=t.onSaveError;this.addWidget(O.defaultsEditor(l,this.translator));this.addWidget(O.userEditor(d,this._toolbar,this._inspector,this.translator))}get canRevert(){return this._canRevert}get canSave(){return this._canSave}get commandsChanged(){return this._commandsChanged}get isDirty(){var t,e;return(e=this._user.editor.model.value.text!==((t=this._settings)===null||t===void 0?void 0:t.raw))!==null&&e!==void 0?e:""}get settings(){return this._settings}set settings(t){if(!t&&!this._settings){return}const e=t&&this._settings&&t.plugin===this._settings.plugin;if(e){return}const s=this._defaults;const i=this._user;if(this._settings){this._settings.changed.disconnect(this._onSettingsChanged,this)}if(t){this._settings=t;this._settings.changed.connect(this._onSettingsChanged,this);this._onSettingsChanged()}else{this._settings=null;s.editor.model.value.text="";i.editor.model.value.text=""}this.update()}get sizes(){return this.relativeSizes()}set sizes(t){this.setRelativeSizes(t)}get source(){return this._user.editor}dispose(){if(this.isDisposed){return}super.dispose();this._defaults.dispose();this._user.dispose()}revert(){var t,e;this._user.editor.model.value.text=(e=(t=this.settings)===null||t===void 0?void 0:t.raw)!==null&&e!==void 0?e:"";this._updateToolbar(false,false)}save(){if(!this.isDirty||!this._settings){return Promise.resolve(undefined)}const t=this._settings;const e=this._user.editor.model.value.text;return t.save(e).then((()=>{this._updateToolbar(false,false)})).catch((t=>{this._updateToolbar(true,false);this._onSaveError(t,this.translator)}))}onAfterAttach(t){O.populateToolbar(this._commands,this._toolbar);this.update()}onUpdateRequest(t){const e=this._settings;const s=this._defaults;const i=this._user;if(e){s.editor.refresh();i.editor.refresh()}}_onTextChanged(){const t=this._user.editor.model.value.text;const e=this._settings;this.removeClass($);if(!e||e.raw===t){this._updateToolbar(false,false);return}const s=e.validate(t);if(s){this.addClass($);this._updateToolbar(true,false);return}this._updateToolbar(true,true)}_onSettingsChanged(){var t,e;const s=this._settings;const i=this._defaults;const r=this._user;i.editor.model.value.text=(t=s===null||s===void 0?void 0:s.annotatedDefaults())!==null&&t!==void 0?t:"";r.editor.model.value.text=(e=s===null||s===void 0?void 0:s.raw)!==null&&e!==void 0?e:""}_updateToolbar(t=this._canRevert,e=this._canSave){const s=this._commands;this._canRevert=t;this._canSave=e;this._commandsChanged.emit([s.revert,s.save])}}var O;(function(t){function e(t,e){e=e||r.nullTranslator;const s=e.load("jupyterlab");const n=new a.Widget;const o=n.layout=new a.BoxLayout({spacing:0});const l=new a.Widget;const d=new i.Toolbar;const c=s.__("System Defaults");l.node.innerText=c;d.insertItem(0,"banner",l);o.addWidget(d);o.addWidget(t);return n}t.defaultsEditor=e;function s(t,e){const{registry:s,revert:r,save:n}=t;e.addItem("spacer",i.Toolbar.createSpacerItem());[r,n].forEach((t=>{const r=new i.CommandToolbarButton({commands:s,id:t});e.addItem(t,r)}))}t.populateToolbar=s;function n(t,e,s,i){i=i||r.nullTranslator;const n=i.load("jupyterlab");const o=n.__("User Preferences");const l=new a.Widget;const d=l.layout=new a.BoxLayout({spacing:0});const c=new a.Widget;c.node.innerText=o;e.insertItem(0,"banner",c);d.addWidget(e);d.addWidget(t);d.addWidget(s);return l}t.userEditor=n})(O||(O={}));const I="jp-PluginEditor";class L extends a.Widget{constructor(t){super();this._settings=null;this._stateChanged=new n.Signal(this);this.addClass(I);const{commands:e,editorFactory:s,registry:i,rendermime:o,translator:l}=t;this.translator=l||r.nullTranslator;this._trans=this.translator.load("jupyterlab");const d=this.layout=new a.StackedLayout;const{onSaveError:c}=z;this.raw=this._rawEditor=new q({commands:e,editorFactory:s,onSaveError:c,registry:i,rendermime:o,translator:l});this._rawEditor.handleMoved.connect(this._onStateChanged,this);d.addWidget(this._rawEditor)}get isDirty(){return this._rawEditor.isDirty}get settings(){return this._settings}set settings(t){if(this._settings===t){return}const e=this._rawEditor;this._settings=e.settings=t;this.update()}get state(){const t=this._settings?this._settings.id:"";const{sizes:e}=this._rawEditor;return{plugin:t,sizes:e}}set state(t){if(m.JSONExt.deepEqual(this.state,t)){return}this._rawEditor.sizes=t.sizes;this.update()}get stateChanged(){return this._stateChanged}confirm(){if(this.isHidden||!this.isAttached||!this.isDirty){return Promise.resolve(undefined)}return(0,i.showDialog)({title:this._trans.__("You have unsaved changes."),body:this._trans.__("Do you want to leave without saving?"),buttons:[i.Dialog.cancelButton({label:this._trans.__("Cancel")}),i.Dialog.okButton({label:this._trans.__("Ok")})]}).then((t=>{if(!t.button.accept){throw new Error("User canceled.")}}))}dispose(){if(this.isDisposed){return}super.dispose();this._rawEditor.dispose()}onAfterAttach(t){this.update()}onUpdateRequest(t){const e=this._rawEditor;const s=this._settings;if(!s){this.hide();return}this.show();e.show()}_onStateChanged(){this.stateChanged.emit(undefined)}}var z;(function(t){function e(t,e){e=e||r.nullTranslator;const s=e.load("jupyterlab");console.error(`Saving setting editor value failed: ${t.message}`);void(0,i.showErrorMessage)(s.__("Your changes were not saved."),t)}t.onSaveError=e})(z||(z={}));const A={sizes:[1,3],container:{editor:"raw",plugin:"",sizes:[1,1]}};class M extends k{constructor(t){super({orientation:"horizontal",renderer:k.defaultRenderer,spacing:1});this._fetching=null;this._saving=false;this._state=m.JSONExt.deepCopy(A);this.translator=t.translator||r.nullTranslator;const e=this.translator.load("jupyterlab");this.addClass("jp-SettingEditor");this.key=t.key;this.state=t.state;const{commands:s,editorFactory:n,rendermime:a}=t;const l=this.registry=t.registry;const c=this._instructions=i.ReactWidget.create(o.createElement(o.Fragment,null,o.createElement("h2",null,o.createElement(d.jupyterIcon.react,{className:"jp-SettingEditorInstructions-icon",tag:"span",elementPosition:"center",height:"auto",width:"60px"}),o.createElement("span",{className:"jp-SettingEditorInstructions-title"},e.__("Settings"))),o.createElement("span",{className:"jp-SettingEditorInstructions-text"},e.__("Select a plugin from the list to view and edit its preferences."))));c.addClass("jp-SettingEditorInstructions");const h=this._editor=new L({commands:s,editorFactory:n,registry:l,rendermime:a,translator:this.translator});const u=()=>h.confirm();const p=this._list=new g({confirm:u,registry:l,translator:this.translator});const _=t.when;if(_){this._when=Array.isArray(_)?Promise.all(_):_}this.addWidget(p);this.addWidget(c);k.setStretch(p,0);k.setStretch(c,1);k.setStretch(h,1);h.stateChanged.connect(this._onStateChanged,this);p.changed.connect(this._onStateChanged,this);this.handleMoved.connect(this._onStateChanged,this)}get canRevertRaw(){return this._editor.raw.canRevert}get canSaveRaw(){return this._editor.raw.canSave}get commandsChanged(){return this._editor.raw.commandsChanged}get settings(){return this._editor.settings}get source(){return this._editor.raw.source}dispose(){if(this.isDisposed){return}super.dispose();this._editor.dispose();this._instructions.dispose();this._list.dispose()}revert(){this._editor.raw.revert()}save(){return this._editor.raw.save()}onAfterAttach(t){super.onAfterAttach(t);this.hide();this._fetchState().then((()=>{this.show();this._setState()})).catch((t=>{console.error("Fetching setting editor state failed",t);this.show();this._setState()}))}onCloseRequest(t){this._editor.confirm().then((()=>{super.onCloseRequest(t);this.dispose()})).catch((()=>{}))}_fetchState(){if(this._fetching){return this._fetching}const{key:t,state:e}=this;const s=[e.fetch(t),this._when];return this._fetching=Promise.all(s).then((([t])=>{this._fetching=null;if(this._saving){return}this._state=W.normalizeState(t,this._state)}))}async _onStateChanged(){this._state.sizes=this.relativeSizes();this._state.container=this._editor.state;this._state.container.plugin=this._list.selection;try{await this._saveState()}catch(t){console.error("Saving setting editor state failed",t)}this._setState()}async _saveState(){const{key:t,state:e}=this;const s=this._state;this._saving=true;try{await e.save(t,s);this._saving=false}catch(i){this._saving=false;throw i}}_setLayout(){const t=this._editor;const e=this._state;t.state=e.container;requestAnimationFrame((()=>{this.setRelativeSizes(e.sizes)}))}_setState(){const t=this._editor;const e=this._list;const{container:s}=this._state;if(!s.plugin){t.settings=null;e.selection="";this._setLayout();return}if(t.settings&&t.settings.id===s.plugin){this._setLayout();return}const i=this._instructions;this.registry.load(s.plugin).then((r=>{if(i.isAttached){i.parent=null}if(!t.isAttached){this.addWidget(t)}t.settings=r;e.selection=s.plugin;this._setLayout()})).catch((i=>{console.error(`Loading ${s.plugin} settings failed.`,i);e.selection=this._state.container.plugin="";t.settings=null;this._setLayout()}))}}var W;(function(t){function e(t,e){if(!t){return m.JSONExt.deepCopy(A)}if(!("sizes"in t)||!s(t.sizes)){t.sizes=m.JSONExt.deepCopy(A.sizes)}if(!("container"in t)){t.container=m.JSONExt.deepCopy(A.container);return t}const i="container"in t&&t.container&&typeof t.container==="object"?t.container:{};t.container={plugin:typeof i.plugin==="string"?i.plugin:A.container.plugin,sizes:s(i.sizes)?i.sizes:m.JSONExt.deepCopy(A.container.sizes)};return t}t.normalizeState=e;function s(t){return Array.isArray(t)&&t.every((t=>typeof t==="number"))}})(W||(W={}));var J=s(73808)}}]);
//# sourceMappingURL=5731.8ecec1031e3fc1067b48.js.map?v=8ecec1031e3fc1067b48