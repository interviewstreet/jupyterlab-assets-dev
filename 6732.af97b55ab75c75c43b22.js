"use strict";(self["webpackChunk_jupyterlab_application_top"]=self["webpackChunk_jupyterlab_application_top"]||[]).push([[6732],{26732:(e,t,n)=>{n.r(t);n.d(t,{DocumentManager:()=>M,DocumentWidgetManager:()=>b,IDocumentManager:()=>N,IDocumentWidgetOpener:()=>V,PathStatus:()=>A,SaveHandler:()=>C,SavingStatus:()=>R,isValidFileName:()=>u,renameDialog:()=>c,renameFile:()=>h,shouldOverwrite:()=>d});var s=n(87447);var i=n(78098);var a=n(50724);var o=n(65178);const r="jp-FileDialog";const l="jp-new-name-title";function c(e,t,n){n=n||a.nullTranslator;const i=n.load("jupyterlab");const o=t.localPath.split("/");const r=o.pop()||t.localPath;return(0,s.showDialog)({title:i.__("Rename File"),body:new g(r),focusNodeSelector:"input",buttons:[s.Dialog.cancelButton(),s.Dialog.okButton({label:i.__("Rename"),ariaLabel:i.__("Rename File")})]}).then((e=>{if(!e.value){return null}if(!u(e.value)){void(0,s.showErrorMessage)(i.__("Rename Error"),Error(i.__('"%1" is not a valid name for a file. Names must have nonzero length, and cannot include "/", "\\", or ":"',e.value)));return null}return t.rename(e.value)}))}function h(e,t,n){return e.rename(t,n).catch((s=>{if(s.response.status!==409){throw s}return d(n).then((s=>{if(s){return e.overwrite(t,n)}return Promise.reject("File not renamed")}))}))}function d(e,t){t=t||a.nullTranslator;const n=t.load("jupyterlab");const i={title:n.__("Overwrite file?"),body:n.__('"%1" already exists, overwrite?',e),buttons:[s.Dialog.cancelButton(),s.Dialog.warnButton({label:n.__("Overwrite"),ariaLabel:n.__("Overwrite Existing File")})]};return(0,s.showDialog)(i).then((e=>Promise.resolve(e.button.accept)))}function u(e){const t=/[\/\\:]/;return e.length>0&&!t.test(e)}class g extends o.Widget{constructor(e){super({node:_.createRenameNode(e)});this.addClass(r);const t=i.PathExt.extname(e);const n=this.inputNode.value=i.PathExt.basename(e);this.inputNode.setSelectionRange(0,n.length-t.length)}get inputNode(){return this.node.getElementsByTagName("input")[0]}getValue(){return this.inputNode.value}}var _;(function(e){function t(e,t){t=t||a.nullTranslator;const n=t.load("jupyterlab");const s=document.createElement("div");const i=document.createElement("label");i.textContent=n.__("File Path");const o=document.createElement("span");o.textContent=e;const r=document.createElement("label");r.textContent=n.__("New Name");r.className=l;const c=document.createElement("input");s.appendChild(i);s.appendChild(o);s.appendChild(r);s.appendChild(c);return s}e.createRenameNode=t})(_||(_={}));var m=n(35627);var f=n(10535);var p=n(55172);var v=n(60796);var w=n(19289);class C{constructor(e){this._autosaveTimer=-1;this._minInterval=-1;this._interval=-1;this._isActive=false;this._inDialog=false;this._isDisposed=false;this._multiplier=10;this._context=e.context;this._isConnectedCallback=e.isConnectedCallback||(()=>true);const t=e.saveInterval||120;this._minInterval=t*1e3;this._interval=this._minInterval;this._context.fileChanged.connect(this._setTimer,this);this._context.disposed.connect(this.dispose,this)}get saveInterval(){return this._interval/1e3}set saveInterval(e){this._minInterval=this._interval=e*1e3;if(this._isActive){this._setTimer()}}get isActive(){return this._isActive}get isDisposed(){return this._isDisposed}dispose(){if(this.isDisposed){return}this._isDisposed=true;clearTimeout(this._autosaveTimer);w.Signal.clearData(this)}start(){this._isActive=true;this._setTimer()}stop(){this._isActive=false;clearTimeout(this._autosaveTimer)}_setTimer(){clearTimeout(this._autosaveTimer);if(!this._isActive){return}this._autosaveTimer=window.setTimeout((()=>{if(this._isConnectedCallback()){this._save()}}),this._interval)}_save(){const e=this._context;this._setTimer();if(!e){return}const t=e.contentsModel&&e.contentsModel.writable;if(!t||!e.model.dirty||this._inDialog){return}const n=(new Date).getTime();e.save().then((()=>{if(this.isDisposed){return}const e=(new Date).getTime()-n;this._interval=Math.max(this._multiplier*e,this._minInterval);this._setTimer()})).catch((e=>{const{name:t}=e;if(t==="ModalCancelError"||t==="ModalDuplicateError"){return}console.error("Error in Auto-Save",e.message)}))}}var y=n(82524);var D=n(37917);const x="jp-Document";class b{constructor(e){this._activateRequested=new w.Signal(this);this._confirmClosingTab=false;this._isDisposed=false;this._stateChanged=new w.Signal(this);this._registry=e.registry;this.translator=e.translator||a.nullTranslator}get activateRequested(){return this._activateRequested}get confirmClosingDocument(){return this._confirmClosingTab}set confirmClosingDocument(e){if(this._confirmClosingTab!==e){const t=this._confirmClosingTab;this._confirmClosingTab=e;this._stateChanged.emit({name:"confirmClosingDocument",oldValue:t,newValue:e})}}get stateChanged(){return this._stateChanged}get isDisposed(){return this._isDisposed}dispose(){if(this.isDisposed){return}this._isDisposed=true;w.Signal.disconnectReceiver(this)}createWidget(e,t){const n=e.createNew(t);this._initializeWidget(n,e,t);return n}_initializeWidget(e,t,n){P.factoryProperty.set(e,t);const s=new y.DisposableSet;for(const i of this._registry.widgetExtensions(t.name)){const t=i.createNew(e,n);if(t){s.add(t)}}P.disposablesProperty.set(e,s);e.disposed.connect(this._onWidgetDisposed,this);this.adoptWidget(n,e);n.fileChanged.connect(this._onFileChanged,this);n.pathChanged.connect(this._onPathChanged,this);void n.ready.then((()=>{void this.setCaption(e)}))}adoptWidget(e,t){const n=P.widgetsProperty.get(e);n.push(t);D.MessageLoop.installMessageHook(t,this);t.addClass(x);t.title.closable=true;t.disposed.connect(this._widgetDisposed,this);P.contextProperty.set(t,e)}findWidget(e,t){const n=P.widgetsProperty.get(e);if(!n){return undefined}return(0,f.find)(n,(e=>{const n=P.factoryProperty.get(e);if(!n){return false}return n.name===t}))}contextForWidget(e){return P.contextProperty.get(e)}cloneWidget(e){const t=P.contextProperty.get(e);if(!t){return undefined}const n=P.factoryProperty.get(e);if(!n){return undefined}const s=n.createNew(t,e);this._initializeWidget(s,n,t);return s}closeWidgets(e){const t=P.widgetsProperty.get(e);return Promise.all(t.map((e=>this.onClose(e)))).then((()=>undefined))}deleteWidgets(e){const t=P.widgetsProperty.get(e);return Promise.all(t.map((e=>this.onDelete(e)))).then((()=>undefined))}messageHook(e,t){switch(t.type){case"close-request":void this.onClose(e);return false;case"activate-request":{const t=this.contextForWidget(e);if(t){this._activateRequested.emit(t.path)}break}default:break}return true}async setCaption(e){const t=this.translator.load("jupyterlab");const n=P.contextProperty.get(e);if(!n){return}const s=n.contentsModel;if(!s){e.title.caption="";return}return n.listCheckpoints().then((a=>{if(e.isDisposed){return}const o=a[a.length-1];const r=o?i.Time.format(o.last_modified):"None";let l=t.__("Name: %1\nPath: %2\n",s.name,s.path);if(n.model.readOnly){l+=t.__("Read-only")}else{l+=t.__("Last Saved: %1\n",i.Time.format(s.last_modified))+t.__("Last Checkpoint: %1",r)}e.title.caption=l}))}async onClose(e){var t;const[n,s]=await this._maybeClose(e,this.translator);if(e.isDisposed){return true}if(n){if(!s){const n=P.contextProperty.get(e);if(!n){return true}if((t=n.contentsModel)===null||t===void 0?void 0:t.writable){await n.save()}else{await n.saveAs()}}if(e.isDisposed){return true}e.dispose()}return n}onDelete(e){e.dispose();return Promise.resolve(void 0)}async _maybeClose(e,t){var n,i;t=t||a.nullTranslator;const o=t.load("jupyterlab");const r=P.contextProperty.get(e);if(!r){return Promise.resolve([true,true])}let l=P.widgetsProperty.get(r);if(!l){return Promise.resolve([true,true])}l=l.filter((e=>{const t=P.factoryProperty.get(e);if(!t){return false}return t.readOnly===false}));const c=e.title.label;const h=P.factoryProperty.get(e);const d=r.model.dirty&&l.length<=1&&!((n=h===null||h===void 0?void 0:h.readOnly)!==null&&n!==void 0?n:true);if(this.confirmClosingDocument){const e=[s.Dialog.cancelButton(),s.Dialog.okButton({label:d?o.__("Close and save"):o.__("Close"),ariaLabel:d?o.__("Close and save Document"):o.__("Close Document")})];if(d){e.splice(1,0,s.Dialog.warnButton({label:o.__("Close without saving"),ariaLabel:o.__("Close Document without saving")}))}const t=await(0,s.showDialog)({title:o.__("Confirmation"),body:o.__('Please confirm you want to close "%1".',c),checkbox:d?null:{label:o.__("Do not ask me again."),caption:o.__("If checked, no confirmation to close a document will be asked in the future.")},buttons:e});if(t.isChecked){this.confirmClosingDocument=false}return Promise.resolve([t.button.accept,d?t.button.displayType==="warn":true])}else{if(!d){return Promise.resolve([true,true])}const e=((i=r.contentsModel)===null||i===void 0?void 0:i.writable)?o.__("Save"):o.__("Save as");const t=await(0,s.showDialog)({title:o.__("Save your work"),body:o.__('Save changes in "%1" before closing?',c),buttons:[s.Dialog.cancelButton(),s.Dialog.warnButton({label:o.__("Discard"),ariaLabel:o.__("Discard changes to file")}),s.Dialog.okButton({label:e})]});return[t.button.accept,t.button.displayType==="warn"]}}_widgetDisposed(e){const t=P.contextProperty.get(e);if(!t){return}const n=P.widgetsProperty.get(t);if(!n){return}f.ArrayExt.removeFirstOf(n,e);if(!n.length){t.dispose()}}_onWidgetDisposed(e){const t=P.disposablesProperty.get(e);t.dispose()}_onFileChanged(e){const t=P.widgetsProperty.get(e);for(const n of t){void this.setCaption(n)}}_onPathChanged(e){const t=P.widgetsProperty.get(e);for(const n of t){void this.setCaption(n)}}}var P;(function(e){e.contextProperty=new v.AttachedProperty({name:"context",create:()=>undefined});e.factoryProperty=new v.AttachedProperty({name:"factory",create:()=>undefined});e.widgetsProperty=new v.AttachedProperty({name:"widgets",create:()=>[]});e.disposablesProperty=new v.AttachedProperty({name:"disposables",create:()=>new y.DisposableSet})})(P||(P={}));class M{constructor(e){var t;this._activateRequested=new w.Signal(this);this._contexts=[];this._isDisposed=false;this._autosave=true;this._autosaveInterval=120;this._lastModifiedCheckMargin=500;this._renameUntitledFileOnSave=true;this._stateChanged=new w.Signal(this);this.translator=e.translator||a.nullTranslator;this.registry=e.registry;this.services=e.manager;this._dialogs=(t=e.sessionDialogs)!==null&&t!==void 0?t:new s.SessionContextDialogs({translator:e.translator});this._isConnectedCallback=e.isConnectedCallback||(()=>true);this._opener=e.opener;this._when=e.when||e.manager.ready;const n=new b({registry:this.registry,translator:this.translator});n.activateRequested.connect(this._onActivateRequested,this);n.stateChanged.connect(this._onWidgetStateChanged,this);this._widgetManager=n;this._setBusy=e.setBusy}get activateRequested(){return this._activateRequested}get autosave(){return this._autosave}set autosave(e){if(this._autosave!==e){const t=this._autosave;this._autosave=e;this._contexts.forEach((t=>{const n=S.saveHandlerProperty.get(t);if(!n){return}if(e===true&&!n.isActive){n.start()}else if(e===false&&n.isActive){n.stop()}}));this._stateChanged.emit({name:"autosave",oldValue:t,newValue:e})}}get autosaveInterval(){return this._autosaveInterval}set autosaveInterval(e){if(this._autosaveInterval!==e){const t=this._autosaveInterval;this._autosaveInterval=e;this._contexts.forEach((t=>{const n=S.saveHandlerProperty.get(t);if(!n){return}n.saveInterval=e||120}));this._stateChanged.emit({name:"autosaveInterval",oldValue:t,newValue:e})}}get confirmClosingDocument(){return this._widgetManager.confirmClosingDocument}set confirmClosingDocument(e){if(this._widgetManager.confirmClosingDocument!==e){const t=this._widgetManager.confirmClosingDocument;this._widgetManager.confirmClosingDocument=e;this._stateChanged.emit({name:"confirmClosingDocument",oldValue:t,newValue:e})}}get lastModifiedCheckMargin(){return this._lastModifiedCheckMargin}set lastModifiedCheckMargin(e){if(this._lastModifiedCheckMargin!==e){const t=this._lastModifiedCheckMargin;this._lastModifiedCheckMargin=e;this._contexts.forEach((t=>{t.lastModifiedCheckMargin=e}));this._stateChanged.emit({name:"lastModifiedCheckMargin",oldValue:t,newValue:e})}}get renameUntitledFileOnSave(){return this._renameUntitledFileOnSave}set renameUntitledFileOnSave(e){if(this._renameUntitledFileOnSave!==e){const t=this._renameUntitledFileOnSave;this._renameUntitledFileOnSave=e;this._stateChanged.emit({name:"renameUntitledFileOnSave",oldValue:t,newValue:e})}}get stateChanged(){return this._stateChanged}get isDisposed(){return this._isDisposed}dispose(){if(this.isDisposed){return}this._isDisposed=true;w.Signal.clearData(this);this._contexts.forEach((e=>this._widgetManager.closeWidgets(e)));this._widgetManager.dispose();this._contexts.length=0}cloneWidget(e){return this._widgetManager.cloneWidget(e)}closeAll(){return Promise.all(this._contexts.map((e=>this._widgetManager.closeWidgets(e)))).then((()=>undefined))}closeFile(e){const t=this._contextsForPath(e).map((e=>this._widgetManager.closeWidgets(e)));return Promise.all(t).then((e=>undefined))}contextForWidget(e){return this._widgetManager.contextForWidget(e)}copy(e,t){return this.services.contents.copy(e,t)}createNew(e,t="default",n){return this._createOrOpenDocument("create",e,t,n)}deleteFile(e){return this.services.sessions.stopIfNeeded(e).then((()=>this.services.contents.delete(e))).then((()=>{this._contextsForPath(e).forEach((e=>this._widgetManager.deleteWidgets(e)));return Promise.resolve(void 0)}))}duplicate(e){const t=i.PathExt.dirname(e);return this.services.contents.copy(e,t)}findWidget(e,t="default"){const n=i.PathExt.normalize(e);let s=[t];if(t==="default"){const e=this.registry.defaultWidgetFactory(n);if(!e){return undefined}s=[e.name]}else if(t===null){s=this.registry.preferredWidgetFactories(n).map((e=>e.name))}for(const i of this._contextsForPath(n)){for(const e of s){if(e!==null){const t=this._widgetManager.findWidget(i,e);if(t){return t}}}}return undefined}newUntitled(e){if(e.type==="file"){e.ext=e.ext||".txt"}return this.services.contents.newUntitled(e)}open(e,t="default",n,s){return this._createOrOpenDocument("open",e,t,n,s)}openOrReveal(e,t="default",n,s){const i=this.findWidget(e,t);if(i){this._opener.open(i,{type:t,...s});return i}return this.open(e,t,n,s!==null&&s!==void 0?s:{})}overwrite(e,t){const n=`${t}.${p.UUID.uuid4()}`;const s=()=>this.rename(n,t);return this.rename(e,n).then((()=>this.deleteFile(t))).then(s,s)}rename(e,t){return this.services.contents.rename(e,t)}_findContext(e,t){const n=this.services.contents.normalize(e);return(0,f.find)(this._contexts,(e=>e.path===n&&e.factoryName===t))}_contextsForPath(e){const t=this.services.contents.normalize(e);return this._contexts.filter((e=>e.path===t))}_createContext(e,t,n){const s=(e,t)=>{this._widgetManager.adoptWidget(i,e);this._opener.open(e,t)};const i=new m.Context({opener:s,manager:this.services,factory:t,path:e,kernelPreference:n,setBusy:this._setBusy,sessionDialogs:this._dialogs,lastModifiedCheckMargin:this._lastModifiedCheckMargin,translator:this.translator});const a=new C({context:i,isConnectedCallback:this._isConnectedCallback,saveInterval:this.autosaveInterval});S.saveHandlerProperty.set(i,a);void i.ready.then((()=>{if(this.autosave){a.start()}}));i.disposed.connect(this._onContextDisposed,this);this._contexts.push(i);return i}_onContextDisposed(e){f.ArrayExt.removeFirstOf(this._contexts,e)}_widgetFactoryFor(e,t){const{registry:n}=this;if(t==="default"){const s=n.defaultWidgetFactory(e);if(!s){return undefined}t=s.name}return n.getWidgetFactory(t)}_createOrOpenDocument(e,t,n="default",s,i){const a=this._widgetFactoryFor(t,n);if(!a){return undefined}const o=a.modelName||"text";const r=this.registry.getModelFactory(o);if(!r){return undefined}const l=this.registry.getKernelPreference(t,a.name,s);let c;let h=Promise.resolve(undefined);if(e==="open"){c=this._findContext(t,r.name)||null;if(!c){c=this._createContext(t,r,l);h=this._when.then((()=>c.initialize(false)))}}else if(e==="create"){c=this._createContext(t,r,l);h=this._when.then((()=>c.initialize(true)))}else{throw new Error(`Invalid argument 'which': ${e}`)}const d=this._widgetManager.createWidget(a,c);this._opener.open(d,{type:a.name,...i});h.catch((e=>{console.error(`Failed to initialize the context with '${r.name}' for ${t}`,e);d.close()}));return d}_onActivateRequested(e,t){this._activateRequested.emit(t)}_onWidgetStateChanged(e,t){if(t.name==="confirmClosingDocument"){this._stateChanged.emit(t)}}}var S;(function(e){e.saveHandlerProperty=new v.AttachedProperty({name:"saveHandler",create:()=>undefined})})(S||(S={}));var F=n(53825);var T=n(27425);var W=n(37900);var k=n.n(W);function E(e){return k().createElement(F.TextItem,{source:e.name,title:e.fullPath})}class A extends T.VDomRenderer{constructor(e){super(new A.Model(e.docManager));this.node.title=this.model.path}render(){return k().createElement(E,{fullPath:this.model.path,name:this.model.name})}}(function(e){class t extends T.VDomModel{constructor(e){super();this._onTitleChange=e=>{const t=this._getAllState();this._name=e.label;this._triggerChange(t,this._getAllState())};this._onPathChange=(e,t)=>{const n=this._getAllState();this._path=t;this._name=i.PathExt.basename(t);this._triggerChange(n,this._getAllState())};this._path="";this._name="";this._widget=null;this._docManager=e}get path(){return this._path}get name(){return this._name}get widget(){return this._widget}set widget(e){const t=this._widget;if(t!==null){const e=this._docManager.contextForWidget(t);if(e){e.pathChanged.disconnect(this._onPathChange)}else{t.title.changed.disconnect(this._onTitleChange)}}const n=this._getAllState();this._widget=e;if(this._widget===null){this._path="";this._name=""}else{const e=this._docManager.contextForWidget(this._widget);if(e){this._path=e.path;this._name=i.PathExt.basename(e.path);e.pathChanged.connect(this._onPathChange)}else{this._path="";this._name=this._widget.title.label;this._widget.title.changed.connect(this._onTitleChange)}}this._triggerChange(n,this._getAllState())}_getAllState(){return[this._path,this._name]}_triggerChange(e,t){if(e[0]!==t[0]||e[1]!==t[1]){this.stateChanged.emit(void 0)}}}e.Model=t})(A||(A={}));function I(e){return k().createElement(F.TextItem,{source:e.fileStatus})}const O=2e3;class R extends T.VDomRenderer{constructor(e){super(new R.Model(e.docManager));const t=e.translator||a.nullTranslator;const n=t.load("jupyterlab");this._statusMap={completed:n.__("Saving completed"),started:n.__("Saving started"),failed:n.__("Saving failed")}}render(){if(this.model===null||this.model.status===null){return null}else{return k().createElement(I,{fileStatus:this._statusMap[this.model.status]})}}}(function(e){class t extends T.VDomModel{constructor(e){super();this._onStatusChange=(e,t)=>{this._status=t;if(this._status==="completed"){setTimeout((()=>{this._status=null;this.stateChanged.emit(void 0)}),O);this.stateChanged.emit(void 0)}else{this.stateChanged.emit(void 0)}};this._status=null;this._widget=null;this._status=null;this.widget=null;this._docManager=e}get status(){return this._status}get widget(){return this._widget}set widget(e){var t,n;const s=this._widget;if(s!==null){const e=this._docManager.contextForWidget(s);if(e){e.saveState.disconnect(this._onStatusChange)}else if((t=this._widget.content)===null||t===void 0?void 0:t.saveStateChanged){this._widget.content.saveStateChanged.disconnect(this._onStatusChange)}}this._widget=e;if(this._widget===null){this._status=null}else{const e=this._docManager.contextForWidget(this._widget);if(e){e.saveState.connect(this._onStatusChange)}else if((n=this._widget.content)===null||n===void 0?void 0:n.saveStateChanged){this._widget.content.saveStateChanged.connect(this._onStatusChange)}}}}e.Model=t})(R||(R={}));const N=new p.Token("@jupyterlab/docmanager:IDocumentManager",`A service for the manager for all\n  documents used by the application. Use this if you want to open and close documents,\n  create and delete files, and otherwise interact with the file system.`);const V=new p.Token("@jupyterlab/docmanager:IDocumentWidgetOpener",`A service to open a widget.`)}}]);
//# sourceMappingURL=6732.af97b55ab75c75c43b22.js.map?v=af97b55ab75c75c43b22