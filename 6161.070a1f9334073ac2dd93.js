"use strict";(self["webpackChunk_jupyterlab_application_top"]=self["webpackChunk_jupyterlab_application_top"]||[]).push([[6161],{26161:(e,t,n)=>{n.r(t);n.d(t,{ExtensionsPanel:()=>D,ListModel:()=>u});var s=n(87447);var a=n(78098);var i=n(4702);var r=n(50724);var l=n(27425);var o=n(65061);var c=n(97699);var h=n(37900);function d(e,t,n){n=n||r.nullTranslator;const a=n.load("jupyterlab");const i=[];i.push(h.createElement("p",null,a.__(`An error occurred installing "${e}".`)));if(t){i.push(h.createElement("p",null,h.createElement("span",{className:"jp-extensionmanager-dialog-subheader"},a.__("Error message:"))),h.createElement("pre",null,t.trim()))}const l=h.createElement("div",{className:"jp-extensionmanager-dialog"},i);void(0,s.showDialog)({title:a.__("Extension Installation Error"),body:l,buttons:[s.Dialog.warnButton({label:a.__("Ok")})]})}const m="lab/api/extensions";class u extends l.VDomModel{constructor(e,t){super();this.actionError=null;this.installedError=null;this.searchError=null;this.promptReload=false;this._isDisclaimed=false;this._isEnabled=false;this._isLoadingInstalledExtensions=false;this._isSearching=false;this._query="";this._page=1;this._pagination=30;this._lastPage=1;this._pendingActions=[];const n=JSON.parse(a.PageConfig.getOption("extensionManager")||"{}");this.name=n.name;this.canInstall=n.can_install;this.installPath=n.install_path;this.translator=t||r.nullTranslator;this._installed=[];this._lastSearchResult=[];this.serviceManager=e;this._debouncedSearch=new o.Debouncer(this.search.bind(this),1e3)}get installed(){return this._installed}get isDisclaimed(){return this._isDisclaimed}set isDisclaimed(e){if(e!==this._isDisclaimed){this._isDisclaimed=e;this.stateChanged.emit();void this._debouncedSearch.invoke()}}get isEnabled(){return this._isEnabled}set isEnabled(e){if(e!==this._isEnabled){this._isEnabled=e;this.stateChanged.emit()}}get isLoadingInstalledExtensions(){return this._isLoadingInstalledExtensions}get isSearching(){return this._isSearching}get searchResult(){return this._lastSearchResult}get query(){return this._query}set query(e){if(this._query!==e){this._query=e;this._page=1;void this._debouncedSearch.invoke()}}get page(){return this._page}set page(e){if(this._page!==e){this._page=e;void this._debouncedSearch.invoke()}}get pagination(){return this._pagination}set pagination(e){if(this._pagination!==e){this._pagination=e;void this._debouncedSearch.invoke()}}get lastPage(){return this._lastPage}dispose(){if(this.isDisposed){return}this._debouncedSearch.dispose();super.dispose()}hasPendingActions(){return this._pendingActions.length>0}async install(e,t={}){await this.performAction("install",e,t).then((t=>{if(t.status!=="ok"){d(e.name,t.message,this.translator)}return this.update(true)}))}async uninstall(e){if(!e.installed){throw new Error(`Not installed, cannot uninstall: ${e.name}`)}await this.performAction("uninstall",e);return this.update(true)}async enable(e){if(e.enabled){throw new Error(`Already enabled: ${e.name}`)}await this.performAction("enable",e);await this.refreshInstalled(true)}async disable(e){if(!e.enabled){throw new Error(`Already disabled: ${e.name}`)}await this.performAction("disable",e);await this.refreshInstalled(true)}async refreshInstalled(e=false){this.installedError=null;this._isLoadingInstalledExtensions=true;this.stateChanged.emit();try{const[t]=await p.requestAPI({refresh:e?1:0});this._installed=t.sort(p.comparator)}catch(t){this.installedError=t.toString()}finally{this._isLoadingInstalledExtensions=false;this.stateChanged.emit()}}async search(e=false){var t,n;if(!this.isDisclaimed){return Promise.reject("Installation warning is not disclaimed.")}this.searchError=null;this._isSearching=true;this.stateChanged.emit();try{const[s,i]=await p.requestAPI({query:(t=this.query)!==null&&t!==void 0?t:"",page:this.page,per_page:this.pagination,refresh:e?1:0});const r=i["last"];if(r){const e=a.URLExt.queryStringToObject((n=a.URLExt.parse(r).search)!==null&&n!==void 0?n:"")["page"];if(e){this._lastPage=parseInt(e,10)}}const l=this._installed.map((e=>e.name));this._lastSearchResult=s.filter((e=>!l.includes(e.name))).sort(p.comparator)}catch(s){this.searchError=s.toString()}finally{this._isSearching=false;this.stateChanged.emit()}}async update(e=false){if(this.isDisclaimed){await this.refreshInstalled(e);await this.search()}}performAction(e,t,n={}){const a={cmd:e,extension_name:t.name};if(n.useVersion){a["extension_version"]=n.useVersion}const i=p.requestAPI({},{method:"POST",body:JSON.stringify(a)});i.then((([e])=>{const t=this.translator.load("jupyterlab");if(e.needs_restart.includes("server")){void(0,s.showDialog)({title:t.__("Information"),body:t.__("You will need to restart JupyterLab to apply the changes."),buttons:[s.Dialog.okButton({label:t.__("Ok")})]})}else{const n=[];if(e.needs_restart.includes("frontend")){n.push(window.isElectron?t.__("reload JupyterLab"):t.__("refresh the web page"))}if(e.needs_restart.includes("kernel")){n.push(t.__("install the extension in all kernels and restart them"))}void(0,s.showDialog)({title:t.__("Information"),body:t.__("You will need to %1 to apply the changes.",n.join(t.__(" and "))),buttons:[s.Dialog.okButton({label:t.__("Ok")})]})}this.actionError=null}),(e=>{this.actionError=e.toString()}));this.addPendingAction(i);return i.then((([e])=>e))}addPendingAction(e){this._pendingActions.push(e);const t=()=>{const t=this._pendingActions.indexOf(e);this._pendingActions.splice(t,1);this.stateChanged.emit(undefined)};e.then(t,t);this.stateChanged.emit(undefined)}}(function(e){function t(e){if(!e.installed||!e.latest_version){return false}return c.lt(e.installed_version,e.latest_version)}e.entryHasUpdate=t})(u||(u={}));var p;(function(e){function t(e,t){if(e.name===t.name){return 0}else{return e.name>t.name?1:-1}}e.comparator=t;const n=/<([^>]+)>; rel="([^"]+)",?/g;async function s(e={},t={}){var s;const r=i.ServerConnection.makeSettings();const l=a.URLExt.join(r.baseUrl,m);let o;try{o=await i.ServerConnection.makeRequest(l+a.URLExt.objectToQueryString(e),t,r)}catch(p){throw new i.ServerConnection.NetworkError(p)}let c=await o.text();if(c.length>0){try{c=JSON.parse(c)}catch(p){console.log("Not a JSON response body.",o)}}if(!o.ok){throw new i.ServerConnection.ResponseError(o,c.message||c)}const h=(s=o.headers.get("Link"))!==null&&s!==void 0?s:"";const d={};let u=null;while((u=n.exec(h))!==null){d[u[2]]=u[1]}return[c,d]}e.requestAPI=s})(p||(p={}));var g=n(37492);var _=n.n(g);const f=32;const E=Math.floor(devicePixelRatio*f);function b(e){if(e.homepage_url&&e.homepage_url.startsWith("https://github.com/")){return e.homepage_url.split("/")[3]}else if(e.repository_url&&e.repository_url.startsWith("https://github.com/")){return e.repository_url.split("/")[3]}return null}function v(e){const{canFetch:t,entry:n,supportInstallation:s,trans:a}=e;const i=[];if(n.status&&["ok","warning","error"].indexOf(n.status)!==-1){i.push(`jp-extensionmanager-entry-${n.status}`)}const r=t?b(n):null;if(!n.allowed){i.push(`jp-extensionmanager-entry-should-be-uninstalled`)}return h.createElement("li",{className:`jp-extensionmanager-entry ${i.join(" ")}`,style:{display:"flex"}},h.createElement("div",{style:{marginRight:"8px"}},r?h.createElement("img",{src:`https://github.com/${r}.png?size=${E}`,style:{width:"32px",height:"32px"}}):h.createElement("div",{style:{width:`${f}px`,height:`${f}px`}})),h.createElement("div",{className:"jp-extensionmanager-entry-description"},h.createElement("div",{className:"jp-extensionmanager-entry-title"},h.createElement("div",{className:"jp-extensionmanager-entry-name"},n.homepage_url?h.createElement("a",{href:n.homepage_url,target:"_blank",rel:"noopener noreferrer",title:a.__("%1 extension home page",n.name)},n.name):h.createElement("div",null,n.name)),h.createElement("div",{className:"jp-extensionmanager-entry-version"},h.createElement("div",{title:a.__("Version: %1",n.installed_version)},n.installed_version)),n.installed&&!n.allowed&&h.createElement(l.ToolbarButtonComponent,{icon:l.infoIcon,iconLabel:a.__("%1 extension is not allowed anymore. Please uninstall it immediately or contact your administrator.",n.name),onClick:()=>window.open("https://jupyterlab.readthedocs.io/en/latest/user/extensions.html")}),n.approved&&h.createElement(l.jupyterIcon.react,{className:"jp-extensionmanager-is-approved",top:"1px",height:"auto",width:"1em",title:a.__("This extension is approved by your security team.")})),h.createElement("div",{className:"jp-extensionmanager-entry-content"},h.createElement("div",{className:"jp-extensionmanager-entry-description"},n.description),e.performAction&&h.createElement("div",{className:"jp-extensionmanager-entry-buttons"},n.installed?h.createElement(h.Fragment,null,s&&h.createElement(h.Fragment,null,u.entryHasUpdate(n)&&h.createElement(l.Button,{onClick:()=>e.performAction("install",n,{useVersion:n.latest_version}),title:a.__('Update "%1" to "%2"',n.name,n.latest_version),minimal:true,small:true},a.__("Update to %1",n.latest_version)),h.createElement(l.Button,{onClick:()=>e.performAction("uninstall",n),title:a.__('Uninstall "%1"',n.name),minimal:true,small:true},a.__("Uninstall"))),n.enabled?h.createElement(l.Button,{onClick:()=>e.performAction("disable",n),title:a.__('Disable "%1"',n.name),minimal:true,small:true},a.__("Disable")):h.createElement(l.Button,{onClick:()=>e.performAction("enable",n),title:a.__('Enable "%1"',n.name),minimal:true,small:true},a.__("Enable"))):s&&h.createElement(l.Button,{onClick:()=>e.performAction("install",n),title:a.__('Install "%1"',n.name),minimal:true,small:true},a.__("Install"))))))}function y(e){var t;const{canFetch:n,performAction:s,supportInstallation:a,trans:i}=e;return h.createElement("div",{className:"jp-extensionmanager-listview-wrapper"},e.entries.length>0?h.createElement("ul",{className:"jp-extensionmanager-listview"},e.entries.map((e=>h.createElement(v,{key:e.name,canFetch:n,entry:e,performAction:s,supportInstallation:a,trans:i})))):h.createElement("div",{key:"message",className:"jp-extensionmanager-listview-message"},i.__("No entries")),e.numPages>1&&h.createElement("div",{className:"jp-extensionmanager-pagination"},h.createElement(_(),{previousLabel:"<",nextLabel:">",breakLabel:"...",breakClassName:"break",initialPage:((t=e.initialPage)!==null&&t!==void 0?t:1)-1,pageCount:e.numPages,marginPagesDisplayed:2,pageRangeDisplayed:3,onPageChange:t=>e.onPage(t.selected+1),activeClassName:"active"})))}function x(e){return h.createElement("div",{className:"jp-extensionmanager-error"},e.children)}class w extends l.ReactWidget{constructor(e,t,n){super();this.model=e;this.trans=t;this.searchInputRef=n;e.stateChanged.connect(this.update,this);this.addClass("jp-extensionmanager-header")}render(){return h.createElement(h.Fragment,null,h.createElement("div",{className:"jp-extensionmanager-title"},h.createElement("span",null,this.trans.__("%1 Manager",this.model.name)),this.model.installPath&&h.createElement(l.infoIcon.react,{className:"jp-extensionmanager-path",tag:"span",title:this.trans.__("Extension installation path: %1",this.model.installPath)})),h.createElement(l.FilterBox,{placeholder:this.trans.__("Search extensions"),disabled:!this.model.isDisclaimed,updateFilter:(e,t)=>{this.model.query=t!==null&&t!==void 0?t:""},useFuzzyFilter:false,inputRef:this.searchInputRef}),h.createElement("div",{className:`jp-extensionmanager-pending ${this.model.hasPendingActions()?"jp-mod-hasPending":""}`}),this.model.actionError&&h.createElement(x,null,h.createElement("p",null,this.trans.__("Error when performing an action.")),h.createElement("p",null,this.trans.__("Reason given:")),h.createElement("pre",null,this.model.actionError)))}}class I extends l.ReactWidget{constructor(e,t){super();this.model=e;this.trans=t;this.addClass("jp-extensionmanager-disclaimer");e.stateChanged.connect(this.update,this)}render(){return h.createElement(h.Fragment,null,h.createElement("p",null,this.trans.__(`The JupyterLab development team is excited to have a robust\nthird-party extension community. However, we do not review\nthird-party extensions, and some extensions may introduce security\nrisks or contain malicious code that runs on your machine. Moreover in order\nto work, this panel needs to fetch data from web services. Do you agree to\nactivate this feature?`),h.createElement("br",null),h.createElement("a",{href:"https://jupyterlab.readthedocs.io/en/latest/privacy_policies.html",target:"_blank",rel:"noreferrer"},this.trans.__("Please read the privacy policy."))),this.model.isDisclaimed?h.createElement(l.Button,{className:"jp-extensionmanager-disclaimer-disable",onClick:e=>{this.model.isDisclaimed=false},title:this.trans.__("This will withdraw your consent.")},this.trans.__("No")):h.createElement("div",null,h.createElement(l.Button,{className:"jp-extensionmanager-disclaimer-enable",onClick:()=>{this.model.isDisclaimed=true}},this.trans.__("Yes")),h.createElement(l.Button,{className:"jp-extensionmanager-disclaimer-disable",onClick:()=>{this.model.isEnabled=false},title:this.trans.__("This will disable the extension manager panel; including the listing of installed extension.")},this.trans.__("No, disable"))))}}class j extends l.ReactWidget{constructor(e,t){super();this.model=e;this.trans=t;e.stateChanged.connect(this.update,this)}render(){return h.createElement(h.Fragment,null,this.model.installedError!==null?h.createElement(x,null,`Error querying installed extensions${this.model.installedError?`: ${this.model.installedError}`:"."}`):this.model.isLoadingInstalledExtensions?h.createElement("div",{className:"jp-extensionmanager-loader"},this.trans.__("Updating extensions list…")):h.createElement(y,{canFetch:this.model.isDisclaimed,entries:this.model.installed.filter((e=>new RegExp(this.model.query.toLowerCase()).test(e.name))),numPages:1,trans:this.trans,onPage:e=>{},performAction:this.model.isDisclaimed?this.onAction.bind(this):null,supportInstallation:this.model.canInstall&&this.model.isDisclaimed}))}onAction(e,t,n={}){switch(e){case"install":return this.model.install(t,n);case"uninstall":return this.model.uninstall(t);case"enable":return this.model.enable(t);case"disable":return this.model.disable(t);default:throw new Error(`Invalid action: ${e}`)}}}class C extends l.ReactWidget{constructor(e,t){super();this.model=e;this.trans=t;e.stateChanged.connect(this.update,this)}onPage(e){this.model.page=e}onAction(e,t,n={}){switch(e){case"install":return this.model.install(t,n);case"uninstall":return this.model.uninstall(t);case"enable":return this.model.enable(t);case"disable":return this.model.disable(t);default:throw new Error(`Invalid action: ${e}`)}}render(){return h.createElement(h.Fragment,null,this.model.searchError!==null?h.createElement(x,null,`Error searching for extensions${this.model.searchError?`: ${this.model.searchError}`:"."}`):this.model.isSearching?h.createElement("div",{className:"jp-extensionmanager-loader"},this.trans.__("Updating extensions list…")):h.createElement(y,{canFetch:this.model.isDisclaimed,entries:this.model.searchResult,initialPage:this.model.page,numPages:this.model.lastPage,onPage:e=>{this.onPage(e)},performAction:this.model.isDisclaimed?this.onAction.bind(this):null,supportInstallation:this.model.canInstall&&this.model.isDisclaimed,trans:this.trans}))}update(){this.title.label=this.model.query?this.trans.__("Search Results"):this.trans.__("Discover");super.update()}}class D extends l.SidePanel{constructor(e){const{model:t,translator:n}=e;super({translator:n});this._wasInitialized=false;this._wasDisclaimed=true;this.model=t;this._searchInputRef=h.createRef();this.addClass("jp-extensionmanager-view");this.trans=n.load("jupyterlab");this.header.addWidget(new w(t,this.trans,this._searchInputRef));const s=new I(t,this.trans);s.title.label=this.trans.__("Warning");this.addWidget(s);const a=new l.PanelWithToolbar;a.addClass("jp-extensionmanager-installedlist");a.title.label=this.trans.__("Installed");a.toolbar.addItem("refresh",new l.ToolbarButton({icon:l.refreshIcon,onClick:()=>{t.refreshInstalled(true).catch((e=>{console.error(`Failed to refresh the installed extensions list:\n${e}`)}))},tooltip:this.trans.__("Refresh extensions list")}));a.addWidget(new j(t,this.trans));this.addWidget(a);if(this.model.canInstall){const e=new C(t,this.trans);e.addClass("jp-extensionmanager-searchresults");this.addWidget(e)}this._wasDisclaimed=this.model.isDisclaimed;if(this.model.isDisclaimed){this.content.collapse(0);this.content.layout.setRelativeSizes([0,1,1])}else{this.content.expand(0);this.content.collapse(1);this.content.collapse(2)}this.model.stateChanged.connect(this._onStateChanged,this)}dispose(){if(this.isDisposed){return}this.model.stateChanged.disconnect(this._onStateChanged,this);super.dispose()}handleEvent(e){switch(e.type){case"focus":case"blur":this._toggleFocused();break;default:break}}onBeforeAttach(e){this.node.addEventListener("focus",this,true);this.node.addEventListener("blur",this,true);super.onBeforeAttach(e)}onBeforeShow(e){if(!this._wasInitialized){this._wasInitialized=true;this.model.refreshInstalled().catch((e=>{console.log(`Failed to refresh installed extension list:\n${e}`)}))}}onAfterDetach(e){super.onAfterDetach(e);this.node.removeEventListener("focus",this,true);this.node.removeEventListener("blur",this,true)}onActivateRequest(e){if(this.isAttached){const e=this._searchInputRef.current;if(e){e.focus();e.select()}}super.onActivateRequest(e)}_onStateChanged(){if(!this._wasDisclaimed&&this.model.isDisclaimed){this.content.collapse(0);this.content.expand(1);this.content.expand(2)}this._wasDisclaimed=this.model.isDisclaimed}_toggleFocused(){const e=document.activeElement===this._searchInputRef.current;this.toggleClass("lm-mod-focused",e)}}}}]);
//# sourceMappingURL=6161.070a1f9334073ac2dd93.js.map?v=070a1f9334073ac2dd93